<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>투자 대시보드</title>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
    <style>
        :root {
            --claude-orange: #E57B53;
            --bg-dark: #1a1a1a;
            --bg-medium: #252525;
            --bg-light: #2d2d2d;
            --bg-hover: #3a3a3a;
            --border-color: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #888888;
            --text-dim: #666666;

            /* 차트랩 전용 색상 변수 */
            --chartlab-primary: #C15F3C;
            --chartlab-highlight: #4a4a4a;
            --chartlab-active-bg: #3a3a3a;
            --chartlab-gray-warm: #B1ADA1;
            --chartlab-terra: #da7756;
            --chartlab-sage: #7D8471;
            --chartlab-lavender: #9B8AA6;
            --chartlab-tan: #D4A574;
            --chartlab-slate: #6B7B8C;
            --chartlab-coffee: #A67B5B;
        }

        [data-theme="light"] {
            --bg-dark: #ffffff;
            --bg-medium: #f5f5f5;
            --bg-light: #ebebeb;
            --bg-hover: #d8d8d8;
            --border-color: #d0d0d0;
            --text-primary: #1a1a1a;
            --text-secondary: #333333;
            --text-muted: #666666;
            --text-dim: #999999;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 300;
            line-height: 1.3;
            height: 100vh;
            overflow: hidden;
            background: var(--bg-dark);
            color: var(--text-secondary);
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* 아이콘 사이드바 */
        .icon-sidebar {
            width: 48px;
            min-width: 48px;
            background: var(--bg-dark);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 0;
        }

        .icon-sidebar-item {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 4px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
            color: var(--text-muted);
        }

        .icon-sidebar-item:hover {
            background: rgba(229, 123, 83, 0.15);
            color: var(--claude-orange);
        }

        .icon-sidebar-item.active {
            background: rgba(229, 123, 83, 0.2);
            color: var(--claude-orange);
        }

        .icon-sidebar-item svg {
            width: 20px;
            height: 20px;
        }

        .icon-sidebar-spacer {
            flex: 1;
        }

        /* 중앙 패널 */
        .center-panel {
            flex: 1;
            min-width: 0;  /* flex 아이템 축소 허용 */
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chart-header {
            padding: 16px 8px 0;
        }

        .search-title-container {
            position: relative;
        }

        .chart-search-input {
            width: 450px;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 15px;
            outline: none;
            background: var(--bg-medium);
            color: var(--text-primary);
        }

        .chart-search-input::placeholder {
            color: var(--text-dim);
        }

        .chart-search-input:focus {
            border-color: var(--claude-orange);
        }

        .chart-title {
            font-size: 20px;
            font-weight: 500;
            color: var(--text-primary);
            margin: 0;
            margin-left: 16px;
            padding: 8px 0;
            display: none;
            cursor: pointer;
        }

        .chart-title:hover {
            color: var(--claude-orange);
        }

        /* Chart Area with Sidebar - ChartLab Style */
        .chart-area {
            display: flex;
            flex: 0 0 auto;
            min-height: 0;
            height: 55vh;
            min-height: 500px;
            margin: 40px 8px 0;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: #1a1a1a;
        }

        .chart-sidebar {
            width: 200px;
            min-width: 200px;
            border-right: 1px solid var(--border-color);
            background: #1a1a1a;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border-radius: 8px 0 0 8px;
        }

        /* 탭 토글 */
        .chart-sidebar .tab-toggle {
            display: flex;
            padding: 12px 12px 0;
            gap: 0;
        }

        .chart-sidebar .tab-btn {
            flex: 1;
            padding: 8px 12px;
            background: transparent;
            border: 1px solid #3a3a3a;
            color: #888;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.15s;
        }

        .chart-sidebar .tab-btn:first-child {
            border-radius: 4px 0 0 4px;
            border-right: none;
        }

        .chart-sidebar .tab-btn:last-child {
            border-radius: 0 4px 4px 0;
        }

        .chart-sidebar .tab-btn.active {
            background: #3a3a3a;
            color: #fff;
            font-weight: 300;
        }

        .chart-sidebar .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
        }

        /* 섹션 */
        .chart-sidebar .sidebar-section {
            padding: 16px 12px;
            border-bottom: 1px solid #2a2a2a;
        }

        .chart-sidebar .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .chart-sidebar .section-title {
            font-size: 11px;
            font-weight: 500;
            color: #999;
            margin-bottom: 10px;
        }

        .chart-sidebar .section-add-btn {
            font-size: 11px;
            color: #888;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px 8px;
        }

        .chart-sidebar .section-add-btn:hover {
            color: #fff;
        }

        /* 드롭다운 */
        .chart-sidebar .sidebar-dropdown {
            position: relative;
            margin-bottom: 12px;
        }

        .chart-sidebar .sidebar-dropdown:last-child {
            margin-bottom: 0;
        }

        .chart-sidebar .dropdown-label {
            font-size: 10px;
            color: #888;
            margin-bottom: 6px;
        }

        .chart-sidebar .dropdown-select {
            width: 100%;
            padding: 8px 28px 8px 10px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
            font-size: 12px;
            font-weight: 300;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        .chart-sidebar .dropdown-select option {
            font-weight: 300;
            background: #2a2a2a;
            color: #fff;
        }

        .chart-sidebar .dropdown-select:hover {
            border-color: #666;
            background: #333;
        }

        .chart-sidebar .dropdown-select:focus {
            outline: none;
            border-color: #666;
        }

        /* select 드롭다운 화살표 - dropdown-with-icon이 없는 경우만 */
        .chart-sidebar .sidebar-dropdown:not(:has(.dropdown-with-icon))::after {
            content: '';
            position: absolute;
            right: 10px;
            bottom: 13px;
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 5px solid #888;
            pointer-events: none;
        }

        .chart-sidebar .dropdown-with-icon {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 28px 8px 10px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
        }

        .chart-sidebar .dropdown-with-icon::after {
            content: '';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 5px solid #888;
            pointer-events: none;
        }

        .chart-sidebar .dropdown-with-icon:hover {
            border-color: #666;
            background: #333;
        }

        .chart-sidebar .dropdown-icon {
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 드롭다운 그리드 */
        .chart-sidebar .dropdown-row {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .chart-sidebar .dropdown-row .sidebar-dropdown {
            flex: 1;
            margin-bottom: 0;
        }

        /* 시리즈 아이템 - 레전드 스타일 */
        .chart-sidebar .series-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 4px;
            transition: opacity 0.2s;
        }

        .chart-sidebar .series-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .chart-sidebar .series-item.hidden {
            opacity: 0.4;
        }

        .chart-sidebar .series-item.hidden .series-line {
            opacity: 0.4;
        }

        /* 시리즈 색상 라인 */
        .chart-sidebar .series-line {
            width: 18px;
            height: 3px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        /* 시리즈 이름 */
        .chart-sidebar .series-name {
            font-size: 12px;
            color: #ccc;
            font-weight: 300;
            flex: 1;
        }

        .chart-sidebar .series-remove {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 14px;
            padding: 0 2px;
            line-height: 1;
        }

        .chart-sidebar .series-remove:hover {
            color: #fff;
        }

        /* 시리즈 추가 버튼 */
        .chart-sidebar .add-series-btn {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            background: transparent;
            border: 1px dashed #555;
            border-radius: 4px;
            color: #888;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .chart-sidebar .add-series-btn:hover {
            border-color: #777;
            color: #aaa;
            background: rgba(255, 255, 255, 0.05);
        }

        /* 지표 선택 모달 */
        /* 지표 추가 팝오버 */
        .indicator-popover {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            width: 180px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            z-index: 100;
            display: none;
            max-height: 240px;
            overflow-y: auto;
        }

        .indicator-popover.visible {
            display: block;
        }

        .indicator-popover-list {
            padding: 4px;
        }

        .indicator-popover-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.15s;
        }

        .indicator-popover-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .indicator-popover-empty {
            padding: 12px;
            text-align: center;
            color: var(--text-muted);
            font-size: 11px;
        }

        .indicator-select-item .indicator-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .indicator-select-item .indicator-name {
            flex: 1;
            font-size: 13px;
            color: var(--text-primary);
        }

        .indicator-select-item .indicator-unit {
            font-size: 11px;
            color: var(--text-muted);
        }

        .chart-container {
            flex: 1;
            min-width: 0;
            padding: 8px;
            background: transparent;
            border-radius: 0 8px 8px 0;
        }

        #stockChart {
            width: 100%;
            height: 100%;
        }

        .table-container {
            flex: 1;
            min-width: 0;  /* flex 아이템 축소 허용 */
            min-height: 200px;
            width: calc(100% - 16px);   /* 부모 너비에 맞춤 */
            overflow-x: auto;
            overflow-y: auto;
            padding: 0;
            margin: 20px 8px 8px;  /* 차트-테이블 사이 여백 0.5cm(20px) */
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: #1a1a1a;
        }

        .data-table {
            width: max-content;
            min-width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .data-table th,
        .data-table td {
            border: 1px solid var(--border-color);
            padding: 6px 8px;
            text-align: center;
            white-space: nowrap;
            width: 45px;
            min-width: 45px;
            box-sizing: border-box;
        }

        /* 출처 이름 열 고정 너비 - 차트 사이드바(200px)와 정렬 */
        .data-table td.source-name {
            width: 200px;
            min-width: 200px;
            max-width: 200px;
        }

        /* rowspan 있는 첫 번째 헤더 셀 - 차트 사이드바(200px)와 정렬 */
        .data-table th[rowspan] {
            width: 200px;
            min-width: 200px;
            max-width: 200px;
        }

        /* 테이블 마지막 행 하단 border 유지 */
        .data-table tr:last-child td {
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th:last-child,
        .data-table td:last-child {
            border-right: none;
        }

        .data-table tr:first-child th {
            border-top: none;
        }

        .data-table th {
            background: var(--bg-medium);
            font-weight: 300;
            color: var(--text-muted);
            position: sticky;
            top: 0;
        }

        .data-table th.period-header {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .data-table th.period-header:hover {
            background: var(--bg-hover);
            color: var(--claude-orange);
        }

        .data-table th.year-header {
            background: var(--bg-medium);
            font-weight: 300;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border-color);
            padding: 2px 8px;
            font-size: 11px;
        }

        .data-table th.month-header {
            padding: 2px 8px;
            font-size: 11px;
            min-width: 45px;
            width: 45px;
            text-align: center !important;
        }

        .data-table thead tr:first-child th:first-child,
        .data-table tbody td:first-child {
            text-align: left;
            width: 200px;
            min-width: 200px;
            max-width: 200px;
            border-left: none;
        }

        .data-table td:first-child {
            font-weight: 400;
            color: var(--text-muted);
        }

        .data-table td.source-name {
            cursor: pointer;
            color: var(--text-secondary);
        }

        .data-table td.source-name:hover {
            text-decoration: underline;
            color: var(--claude-orange);
        }

        /* 목록 뷰 스타일 */
        .list-view {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .list-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            font-weight: 500;
        }

        .list-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .list-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .list-item:hover {
            background: var(--bg-hover);
        }

        .list-item-date {
            font-size: 12px;
            color: var(--text-muted);
            flex-shrink: 0;
            width: 45px;
        }

        .list-item-title {
            font-size: 13px;
            color: var(--text-primary);
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .list-item-revenue {
            font-size: 12px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        /* 뒤로가기 버튼 */
        .back-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 12px 16px;
            cursor: pointer;
            font-size: 13px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            width: 100%;
        }

        .back-btn svg {
            flex-shrink: 0;
        }

        .back-btn:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .source-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 6px 0;
            padding-left: 0;
            position: relative;
        }

        .source-item:hover {
            color: var(--claude-orange);
        }

        .source-item::before {
            display: none;
        }

        .source-item-date {
            flex-shrink: 0;
            width: 40px;
            font-size: 11px;
            color: var(--text-muted);
        }

        .source-item-title {
            flex: 1;
            max-width: calc(75% - 40px);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .source-item-revenue {
            position: absolute;
            left: 80%;
            font-size: 10px;
            color: var(--text-secondary);
            max-width: 18%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .data-table td.has-data {
            cursor: pointer;
            color: var(--claude-orange);
            font-weight: 400;
            text-align: center;
            padding: 4px 8px;
        }

        .data-table td.has-data:hover {
            background: rgba(229, 123, 83, 0.1);
        }

        .cell-preview {
            font-size: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
            display: inline-block;
            vertical-align: middle;
        }

        .cell-badge {
            background: var(--claude-orange);
            color: white;
            font-size: 9px;
            padding: 1px 4px;
            border-radius: 8px;
            margin-left: 4px;
            vertical-align: middle;
        }

        /* 테이블 헤더 - 기간 선택 버튼 */
        .period-selector {
            display: inline-flex;
            gap: 2px;
        }

        .period-btn {
            width: 28px;
            height: 24px;
            border: 1px solid var(--border-color);
            background: var(--bg-light);
            color: var(--text-muted);
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.15s;
            padding: 0;
        }

        .period-btn:hover {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .period-btn.active {
            background: var(--claude-orange);
            color: #fff;
            border-color: var(--claude-orange);
        }

        /* 출처 관리 버튼 및 패널 */
        .source-manager-container {
            position: relative;
            display: inline-block;
            margin-left: 8px;
        }

        .source-manager-btn {
            height: 24px;
            padding: 0 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-light);
            color: var(--text-muted);
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .source-manager-btn:hover {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .source-manager-btn.active {
            background: #555;
            color: #fff;
            border-color: #555;
        }

        .source-manager-panel {
            position: fixed;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            z-index: 1000;
            display: none;
            overflow: hidden;
        }

        .source-manager-panel.visible {
            display: flex;
        }

        .source-manager-main {
            padding: 12px;
            min-width: 200px;
            border-right: 1px solid var(--border-color);
        }

        .source-manager-panel:not(.expanded) .source-manager-main {
            border-right: none;
        }

        /* 피드 소스 컬럼 (파인더 스타일) */
        .feed-source-column {
            width: 0;
            overflow: hidden;
            transition: width 0.2s ease;
            background: var(--bg-secondary);
        }

        .source-manager-panel.expanded .feed-source-column {
            width: 200px;
        }

        .feed-source-column-inner {
            padding: 12px;
            width: 200px;
            box-sizing: border-box;
        }

        .feed-source-column-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .feed-source-column-search {
            width: 100%;
            padding: 5px 8px;
            font-size: 11px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-light);
            color: var(--text-primary);
            outline: none;
            box-sizing: border-box;
            margin-bottom: 8px;
        }

        .feed-source-column-search:focus {
            border-color: var(--claude-orange);
        }

        .feed-source-column-search::placeholder {
            color: var(--text-muted);
        }

        .feed-source-column-list {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-height: 200px;
            overflow-y: auto;
        }

        .feed-source-column-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 5px 8px;
            font-size: 11px;
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.1s;
        }

        .feed-source-column-item:hover:not(.disabled) {
            background: #3a3a3a;
        }

        .feed-source-column-item.selected {
            background: #444;
        }

        .feed-source-column-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .feed-source-column-item input[type="checkbox"] {
            width: 12px;
            height: 12px;
            accent-color: #666;
        }

        .feed-source-column-actions {
            margin-top: 10px;
            display: flex;
            gap: 6px;
        }

        .feed-source-column-actions button {
            flex: 1;
            padding: 5px 8px;
            font-size: 10px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            background: var(--bg-light);
            color: var(--text-secondary);
            transition: all 0.15s;
        }

        .feed-source-column-actions button:hover {
            background: var(--bg-secondary);
        }

        .feed-source-column-actions button.primary {
            background: #555;
            border-color: #555;
            color: white;
        }

        .feed-source-column-actions button.primary:hover {
            background: #666;
        }

        .source-manager-section {
            margin-bottom: 12px;
        }

        .source-manager-section:last-child {
            margin-bottom: 0;
        }

        .source-manager-section-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .source-checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .source-checkbox-item:hover {
            color: var(--text-primary);
        }

        .source-checkbox-item input[type="checkbox"] {
            accent-color: #555;
            cursor: pointer;
        }

        .source-checkbox-item.custom {
            justify-content: space-between;
        }

        .source-checkbox-item .delete-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 14px;
            padding: 0 4px;
            line-height: 1;
        }

        .source-checkbox-item .delete-btn:hover {
            color: #e74c3c;
        }

        .source-manager-divider {
            height: 1px;
            background: var(--border-color);
            margin: 8px 0;
        }

        .upload-btn {
            width: 100%;
            padding: 8px 12px;
            border: 1px dashed var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .upload-btn:hover {
            border-color: #555;
            color: #ccc;
            background: rgba(85, 85, 85, 0.2);
        }

        .source-apply-btn {
            width: 100%;
            padding: 10px 12px;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: background 0.15s;
        }

        .source-apply-btn:hover {
            background: #666;
        }

        /* 파일 업로드 모달 */
        .upload-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            padding-left: 200px;
            padding-bottom: 100px;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .upload-modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .upload-modal {
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            padding: 24px;
            width: 400px;
            max-width: 90vw;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .upload-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .upload-modal-title {
            font-size: 13px;
            font-weight: 400;
            color: var(--text-primary);
        }

        .upload-modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 20px;
            line-height: 1;
        }

        .upload-modal-close:hover {
            color: var(--text-primary);
        }

        .upload-form-group {
            margin-bottom: 16px;
        }

        .upload-form-label {
            display: block;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .upload-form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-light);
            color: var(--text-primary);
            border-radius: 2px;
            font-size: 13px;
        }

        .upload-form-input:focus {
            outline: none;
            border-color: var(--claude-orange);
        }

        .upload-dropzone {
            border: 1px solid var(--border-color);
            border-radius: 2px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
        }

        .upload-dropzone:hover,
        .upload-dropzone.dragover {
            border-color: var(--claude-orange);
            background: rgba(229, 123, 83, 0.1);
        }

        .upload-dropzone-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .upload-dropzone-text {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .upload-dropzone-hint {
            font-size: 11px;
            color: var(--text-muted);
        }

        .upload-file-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--bg-light);
            border-radius: 2px;
            margin-top: 12px;
        }

        .upload-file-name {
            flex: 1;
            font-size: 12px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .upload-file-remove {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 16px;
        }

        .upload-file-remove:hover {
            color: #e74c3c;
        }

        .upload-format-info {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 8px;
            padding: 8px;
            background: var(--bg-light);
            border-radius: 2px;
        }

        .upload-modal-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .upload-modal-btn {
            padding: 8px 16px;
            border-radius: 2px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .upload-modal-btn.cancel {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .upload-modal-btn.cancel:hover {
            background: var(--bg-hover);
        }

        .upload-modal-btn.submit {
            background: var(--claude-orange);
            border: 1px solid var(--claude-orange);
            color: #fff;
        }

        .upload-modal-btn.submit:hover {
            background: #d06a44;
        }

        .upload-modal-btn.submit:disabled {
            background: var(--bg-light);
            border-color: var(--border-color);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        /* 피드 소스 선택 모달 */
        .feed-source-modal {
            background: var(--bg-secondary);
            border-radius: 6px;
            padding: 14px;
            width: 320px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .feed-source-modal h3 {
            margin: 0 0 8px 0;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .feed-source-search {
            width: 100%;
            padding: 6px 10px;
            font-size: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-light);
            color: var(--text-primary);
            outline: none;
            box-sizing: border-box;
        }

        .feed-source-search:focus {
            border-color: var(--claude-orange);
        }

        .feed-source-search::placeholder {
            color: var(--text-muted);
        }

        .feed-source-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin: 10px 0;
            max-height: 240px;
            overflow-y: auto;
        }

        .feed-source-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            font-size: 12px;
        }

        .feed-source-item:hover:not(.disabled) {
            border-color: var(--claude-orange);
        }

        .feed-source-item.selected {
            border-color: var(--claude-orange);
            background: rgba(255, 152, 0, 0.1);
        }

        .feed-source-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .feed-source-item input[type="checkbox"] {
            width: 14px;
            height: 14px;
            accent-color: var(--claude-orange);
        }

        .feed-source-modal-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 12px;
        }

        /* 우측 패널 */
        .right-panel {
            flex: 1;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 280px;
            max-width: 450px;
            padding-right: 0;
            margin-right: 0;
            transition: width 0.2s ease, min-width 0.2s ease, max-width 0.2s ease;
        }

        .right-panel.collapsed {
            display: none;
            min-width: 0;
            max-width: 0;
            width: 0 !important;
            overflow: hidden;
        }

        /* 접힌 상태의 리사이저 - 펼치기 힌트 표시 */
        .resizer-horizontal.panel-collapsed::after {
            content: '◀';
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--claude-orange);
            font-size: 10px;
            pointer-events: none;
        }

        .detail-container {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding-right: 0;
        }

        /* 탭 스타일 */
        .detail-tabs {
            display: flex;
            gap: 6px;
            padding: 12px 12px 0;
            background: var(--bg-medium);
            flex-shrink: 0;
        }

        .detail-tab {
            padding: 10px 24px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            border-radius: 8px 8px 0 0;
            transition: all 0.2s ease;
            border: none;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.2);
        }

        /* 탭 공통 스타일 */
        .detail-tab {
            background: var(--bg-light);
            color: var(--claude-orange);
        }

        .detail-tab:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
        }

        .detail-tab.active {
            background: var(--claude-orange);
            color: #fff;
            box-shadow: 0 -4px 12px rgba(229, 123, 83, 0.4);
        }

        .detail-tab-content {
            flex: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        /* 스크롤바 빈 공간 제거 */
        .detail-tab-content::-webkit-scrollbar {
            width: 6px;
            background: var(--bg-dark);
        }

        .detail-tab-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .detail-tab-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .detail-tab-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .detail-placeholder {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 13px;
        }

        .detail-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-medium);
        }

        .detail-source {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .detail-date {
            font-size: 11px;
            color: var(--text-dim);
        }

        .detail-chart {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            min-height: 180px;
        }

        #detailChart {
            width: 100%;
            height: 160px;
        }

        .detail-charts {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-chart-item {
            height: 220px;
        }

        /* 기간별 차트 뷰 스타일 */
        .period-charts-view {
            padding: 16px;
        }

        .period-charts-header {
            margin-bottom: 16px;
        }

        .period-charts-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .period-charts-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        .period-charts-total {
            font-size: 13px;
            color: var(--text-secondary);
            padding: 8px 12px;
            background: var(--bg-medium);
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .period-chart-item {
            margin-bottom: 16px;
            background: var(--bg-medium);
            border-radius: 6px;
            padding: 12px;
        }

        .period-chart-item h4 {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .period-chart-container {
            height: 180px;
        }

        .period-events-list {
            margin-top: 16px;
            border-top: 1px solid var(--border-color);
            padding-top: 12px;
        }

        .period-events-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .period-event-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            font-size: 12px;
        }

        .period-event-item:last-child {
            border-bottom: none;
        }

        .period-event-item:hover {
            color: var(--claude-orange);
        }

        .period-event-source {
            background: var(--claude-orange);
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .period-event-date {
            color: var(--text-muted);
            font-size: 11px;
            flex-shrink: 0;
            width: 45px;
        }

        .period-event-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: var(--text-secondary);
        }

        .detail-content {
            padding: 16px;
            padding-right: 10px;
        }

        .detail-title {
            font-size: 14px;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .detail-summary {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .detail-summary ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .detail-summary li {
            padding: 6px 0;
            padding-left: 16px;
            position: relative;
        }

        .detail-summary li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--text-muted);
        }

        /* 분석 섹션 */
        .detail-analysis {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .detail-analysis h4 {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 16px 0 8px 0;
        }

        .detail-analysis h5 {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 12px 0 6px 0;
        }

        .detail-analysis p {
            margin: 8px 0;
        }

        .detail-analysis strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .detail-analysis ul {
            list-style: none;
            padding: 0;
            margin: 8px 0;
        }

        .detail-analysis li {
            padding: 4px 0 4px 16px;
            position: relative;
        }

        .detail-analysis li::before {
            content: '▸';
            position: absolute;
            left: 0;
            color: var(--text-muted);
            font-size: 10px;
        }

        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 11px;
        }

        .analysis-table th,
        .analysis-table td {
            border: 1px solid var(--border-color);
            padding: 6px 8px;
            text-align: left;
        }

        .analysis-table th {
            background: var(--bg-medium);
            font-weight: 500;
            color: var(--text-primary);
        }

        .analysis-table td {
            color: var(--text-secondary);
        }

        /* 팝오버 */
        .popover {
            position: fixed;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px;
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            z-index: 1000;
            display: none;
        }

        .popover.visible {
            display: block;
        }

        .popover-title {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--border-color);
        }

        .popover-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: var(--text-secondary);
            padding: 6px 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.15s;
        }

        .popover-item:hover {
            color: var(--claude-orange);
            background: rgba(229, 123, 83, 0.15);
        }

        .popover-date {
            font-size: 10px;
            color: var(--text-muted);
            flex-shrink: 0;
            width: 40px;
        }

        .popover-title-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* 형광펜 드로잉 캔버스 */
        .highlight-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .highlight-canvas.active {
            pointer-events: auto;
            cursor: crosshair;
        }

        /* 드로잉 버튼 */
        .drawing-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.1s, border-color 0.1s;
        }

        .drawing-btn:hover {
            transform: scale(1.1);
        }

        .drawing-btn.active {
            transform: scale(1.15);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .drawing-btn.yellow { background: rgba(255, 235, 59, 0.5); }
        .drawing-btn.green { background: rgba(129, 199, 132, 0.5); }
        .drawing-btn.blue { background: rgba(100, 181, 246, 0.5); }
        .drawing-btn.orange { background: rgba(255, 152, 0, 0.5); }

        .drawing-btn.eraser {
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .drawing-btn.clear {
            background: var(--danger-color);
            color: white;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .drawing-btn.undo {
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .drawing-btn.undo:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .drawing-divider {
            width: 1px;
            height: 20px;
            background: var(--border-color);
            margin: 4px 2px;
        }

        /* 셀 카운트 스타일 */
        .cell-count {
            font-size: 11px;
            color: var(--claude-orange);
            font-weight: 400;
            cursor: pointer;
        }

        .cell-count:hover {
            text-decoration: underline;
        }

        /* 스크롤바 공통 - 오버레이 방식 */
        .source-list,
        .table-container,
        .detail-container,
        .detail-tab-content {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        /* 스크롤바 스타일 - Webkit */
        .source-list::-webkit-scrollbar,
        .table-container::-webkit-scrollbar,
        .detail-container::-webkit-scrollbar,
        .detail-tab-content::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .source-list::-webkit-scrollbar-track,
        .table-container::-webkit-scrollbar-track,
        .detail-container::-webkit-scrollbar-track,
        .detail-tab-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .source-list::-webkit-scrollbar-thumb,
        .table-container::-webkit-scrollbar-thumb,
        .detail-container::-webkit-scrollbar-thumb,
        .detail-tab-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .source-list::-webkit-scrollbar-thumb:hover,
        .table-container::-webkit-scrollbar-thumb:hover,
        .detail-container::-webkit-scrollbar-thumb:hover,
        .detail-tab-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Highcharts 커스텀 */
        .highcharts-button-box {
            fill: var(--bg-light);
        }

        .highcharts-button text {
            fill: var(--text-secondary) !important;
            font-weight: 300 !important;
        }

        .highcharts-button-pressed .highcharts-button-box {
            fill: var(--claude-orange) !important;
        }

        .highcharts-button-pressed text {
            fill: #fff !important;
        }

        /* Highcharts 햄버거 메뉴 버튼 축소 */
        .highcharts-exporting-group {
            transform: scale(0.6);
            transform-origin: top right;
            opacity: 0.4;
            transition: opacity 0.2s;
        }

        .highcharts-exporting-group:hover {
            opacity: 0.8;
        }

        .highcharts-button-symbol {
            stroke: var(--text-muted) !important;
            stroke-width: 1.5px !important;
        }

        .highcharts-menu {
            background: var(--bg-light) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }

        .highcharts-menu-item {
            color: var(--text-secondary) !important;
            font-size: 11px !important;
        }

        .highcharts-menu-item:hover {
            background: var(--bg-hover) !important;
            color: var(--claude-orange) !important;
        }

        /* 메인 콘텐츠 영역 (중앙+우측+하단) */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* 상단 영역 (중앙+우측) */
        .upper-area {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* 리사이저 공통 스타일 */
        .resizer {
            background: var(--border-color);
            flex-shrink: 0;
            transition: background 0.15s;
            position: relative;
        }

        .resizer:hover {
            background: rgba(229, 123, 83, 0.5);
        }

        .resizer.active {
            background: var(--claude-orange);
        }

        /* 수평 리사이저 (좌우 조절) */
        .resizer-horizontal {
            width: 5px;
            cursor: col-resize;
        }

        /* 전망 탭 스타일 */
        .forecast-container {
            padding: 16px;
            padding-right: 10px;
        }

        .forecast-header {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .forecast-title {
            font-weight: 400;
        }

        .forecast-period {
            font-size: 11px;
            color: var(--text-muted);
        }

        .forecast-content {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .forecast-section h4 {
            font-size: 12px;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .forecast-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .forecast-section li {
            padding: 4px 0;
            padding-left: 16px;
            position: relative;
        }

        .forecast-section li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--text-muted);
        }

        /* 원문 탭 스타일 */
        .source-container {
            padding: 16px;
            padding-right: 10px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .source-header {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .source-title {
            font-weight: 500;
            line-height: 1.4;
        }

        .source-date {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 400;
        }

        .source-content {
            flex: 1;
            overflow-y: auto;
        }

        .source-text {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 12px;
            line-height: 1.8;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            padding: 0;
            background: transparent;
            border: none;
        }

        .source-empty {
            font-size: 12px;
            color: var(--text-muted);
            text-align: center;
            padding: 40px 0;
        }

        /* 산업 분석 스타일 */
        .industry-analysis-view {
            padding: 24px;
            height: 100%;
            overflow-y: auto;
        }

        /* 도넛 차트 스타일 */
        .donut-chart-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            width: 100%;
        }

        .donut-chart-svg {
            transform: rotate(-90deg);
        }

        .donut-center-text {
            text-anchor: middle;
            fill: var(--text-primary);
        }

        .donut-center-value {
            font-size: 24px;
            font-weight: 700;
        }

        .donut-center-label {
            font-size: 12px;
            fill: var(--text-secondary);
        }

        .donut-legend {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .donut-legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .donut-legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .donut-legend-label {
            min-width: 80px;
        }

        .donut-legend-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* 파이 차트 스타일 */
        .pie-chart-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            width: 100%;
        }

        .pie-legend {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .pie-legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .pie-legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .pie-legend-label {
            min-width: 60px;
        }

        .pie-legend-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* 레이더 차트 스타일 */
        .radar-chart-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            width: 100%;
        }

        .radar-legend {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radar-legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .radar-legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .radar-legend-label {
            min-width: 40px;
        }

        .radar-legend-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .industry-section {
            margin-bottom: 24px;
            background: var(--card-bg);
            border-radius: 8px;
            padding: 24px;
        }

        .industry-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .industry-section-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: var(--claude-orange);
            border-radius: 2px;
        }

        .industry-chart-container {
            height: 320px;
            margin-top: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .industry-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .industry-tab {
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .industry-tab:hover {
            background: var(--bg-tertiary);
        }

        .industry-tab.active {
            background: var(--claude-orange);
            color: white;
            border-color: var(--claude-orange);
        }

        /* 산업 분석 개선 - 선택기 스타일 */
        .industry-selector {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        #industryItems, #intraItems {
            display: contents;
        }

        .industry-selector-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .industry-selector-item .remove-btn {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-muted);
            border-radius: 50%;
            transition: all 0.2s;
        }

        .industry-selector-item .remove-btn:hover {
            background: rgba(193,95,60,0.2);
            color: var(--claude-crail);
        }

        .industry-add-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px dashed var(--border-color);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .industry-add-btn:hover {
            border-color: var(--claude-orange);
            color: var(--claude-orange);
        }

        .industry-dropdown-wrapper {
            position: relative;
            display: inline-block;
        }

        .industry-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 160px;
            max-height: 200px;
            overflow-y: auto;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
        }

        .industry-dropdown.show {
            display: block;
        }

        .industry-dropdown-item {
            padding: 10px 12px;
            font-size: 12px;
            color: var(--text-primary);
            cursor: pointer;
            transition: background 0.2s;
        }

        .industry-dropdown-item:hover {
            background: var(--bg-hover);
        }

        .industry-dropdown-item.disabled {
            color: var(--text-muted);
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* 차트와 테이블 가로 배치 */
        .industry-content-row {
            display: flex;
            gap: 20px;
            margin-top: 12px;
        }

        .industry-chart-wrapper {
            flex: 1;
            min-width: 0;
        }

        .industry-chart-wrapper .industry-chart-container {
            height: 280px;
        }

        .industry-table-wrapper {
            flex: 0 0 320px;
            max-height: 320px;
            overflow-y: auto;
        }

        /* 데이터 테이블 스타일 */
        .industry-data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .industry-data-table thead {
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
        }

        .industry-data-table th {
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .industry-data-table td {
            padding: 10px 12px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-subtle);
        }

        .industry-data-table tr:hover td {
            background: var(--bg-hover);
        }

        .industry-data-table .value-positive {
            color: #22c55e;
        }

        .industry-data-table .value-negative {
            color: #ef4444;
        }

        .industry-data-table .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 11px;
            font-weight: 600;
        }

        .industry-data-table .rank-1 {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
        }

        .industry-data-table .rank-2 {
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
            color: white;
        }

        .industry-data-table .rank-3 {
            background: linear-gradient(135deg, #CD7F32, #B8860B);
            color: white;
        }

        .industry-data-table .rank-other {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        /* 반응형 */
        @media (max-width: 900px) {
            .industry-content-row {
                flex-direction: column;
            }
            .industry-table-wrapper {
                flex: none;
                max-height: 250px;
            }
        }

        .industry-bar-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .industry-bar-label {
            width: 80px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .industry-bar-wrapper {
            flex: 1;
            height: 24px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 12px;
        }

        .industry-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .industry-bar-value {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            min-width: 60px;
            text-align: right;
        }

        .industry-analysis-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        /* 사용자 매뉴얼 스타일 */
        .manual-view {
            padding: 16px;
            height: 100%;
            overflow-y: auto;
        }
        .manual-header {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        .manual-section {
            margin-bottom: 20px;
            background: var(--bg-medium);
            border-radius: 2px;
            padding: 16px;
        }
        .manual-section-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .manual-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 2px;
        }
        .manual-item:last-child {
            margin-bottom: 0;
        }
        .manual-icon {
            width: 32px;
            height: 32px;
            background: rgba(229,123,83,0.15);
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--claude-orange);
            flex-shrink: 0;
        }
        .manual-icon svg {
            width: 16px;
            height: 16px;
        }
        .manual-content h4 {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--text-primary);
        }
        .manual-content p {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.5;
        }
        .manual-shortcut {
            display: inline-block;
            padding: 2px 6px;
            background: var(--bg-light);
            border-radius: 2px;
            font-size: 11px;
            font-family: monospace;
        }

        /* 매뉴얼 목차 (우측 패널) */
        .manual-toc {
            padding: 16px;
            height: 100%;
            overflow-y: auto;
        }
        .manual-toc-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .manual-toc-header-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        .manual-toc-header-desc {
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.6;
        }
        .manual-toc-header svg {
            width: 20px;
            height: 20px;
            color: var(--claude-orange);
        }
        .manual-toc-item {
            padding: 14px 16px;
            margin-bottom: 8px;
            background: var(--bg-medium);
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .manual-toc-item:hover {
            background: var(--bg-light);
        }
        .manual-toc-item.active {
            background: #555;
            color: white;
        }
        .manual-toc-text {
            flex: 1;
        }
        .manual-toc-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        .manual-toc-desc {
            font-size: 11px;
            opacity: 0.7;
        }

        /* 매뉴얼 상세 (중앙 패널) */
        .manual-detail {
            padding: 16px;
            height: 100%;
            overflow-y: auto;
        }
        .manual-detail-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .manual-detail-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        .manual-detail-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        .manual-detail-desc {
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.6;
        }
        .manual-detail-section {
            margin-bottom: 32px;
        }
        .manual-detail-subtitle {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 12px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .manual-detail-subtitle::before {
            content: '';
            width: 4px;
            height: 18px;
            background: #555;
            border-radius: 2px;
        }
        .manual-detail-text {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        .manual-detail-list {
            list-style: none;
            padding: 0;
            margin: 0 0 16px 0;
        }
        .manual-detail-list li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .manual-detail-list li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #555;
            font-weight: bold;
        }
        .manual-illustration {
            background: var(--bg-medium);
            border-radius: 2px;
            padding: 24px;
            margin: 16px 0;
            border: 1px solid var(--border-color);
        }
        .manual-illustration svg {
            width: 100%;
            max-width: 500px;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        .illustration-caption {
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 12px;
        }
        .manual-tip {
            background: rgba(229,123,83,0.1);
            border-left: 3px solid var(--claude-orange);
            padding: 12px 16px;
            border-radius: 0 2px 2px 0;
            margin: 16px 0;
        }
        .manual-tip-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--claude-orange);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .manual-tip-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .manual-welcome {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
        }
        .manual-welcome-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }
        .manual-welcome-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        .manual-welcome-text {
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.6;
            max-width: 400px;
        }

        /* 캘린더 스타일 */
        .calendar-view { padding: 16px; height: 100%; display: flex; flex-direction: column; }
        .calendar-header { display: flex; align-items: center; gap: 16px; margin-bottom: 16px; }
        .calendar-title { font-size: 18px; font-weight: 600; }
        .calendar-nav { display: flex; gap: 8px; }
        .calendar-nav-btn { background: var(--bg-medium); border: none; padding: 8px 12px;
                            border-radius: 2px; cursor: pointer; color: var(--text-primary); }
        .calendar-nav-btn:hover { background: var(--bg-light); }

        /* 필터 검색창 */
        .calendar-filter { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
        .calendar-filter-input { width: 300px; padding: 8px 12px;
                                 background: var(--bg-medium); border: 1px solid var(--border-color);
                                 border-radius: 2px; color: var(--text-primary); }
        .calendar-filter-input::placeholder { color: var(--text-muted); }
        .calendar-filter-select { padding: 8px 12px; background: var(--bg-medium);
                                  border: 1px solid var(--border-color); border-radius: 2px;
                                  color: var(--text-primary); cursor: pointer; }

        /* 출처 범례 */
        .calendar-legend { display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; }
        .calendar-legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; }
        .calendar-legend-color { width: 12px; height: 12px; border-radius: 2px; }

        /* 캘린더 그리드 */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); flex: 1; gap: 1px;
                         background: var(--border-color); border: 1px solid var(--border-color); border-radius: 2px; overflow: hidden; }
        .calendar-day-header { background: var(--bg-medium); padding: 8px; text-align: center;
                               font-size: 12px; font-weight: 500; color: var(--text-muted); }
        .calendar-day { background: var(--bg-dark); padding: 4px; min-height: 100px; overflow: hidden; }
        .calendar-day.other-month { background: var(--bg-darker); opacity: 0.5; }
        .calendar-day-number { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }
        .calendar-day.today .calendar-day-number { background: var(--claude-orange);
                                                    color: white; border-radius: 50%;
                                                    width: 24px; height: 24px; display: flex;
                                                    align-items: center; justify-content: center; }
        .calendar-day.sunday .calendar-day-number { color: #EA4335; }
        .calendar-day.saturday .calendar-day-number { color: #4285F4; }

        /* Claude 8색 팔레트 */
        :root {
            --claude-crail: #C15F3C;      /* 메인 러스트 오렌지 - 실적발표 */
            --claude-sage: #7D8471;       /* 세이지 그린 - 뉴스 */
            --claude-tan: #D4A574;        /* 탄 - 보고서 */
            --claude-lavender: #9B8AA6;   /* 라벤더 - 컨퍼런스 */
            --claude-coffee: #A67B5B;     /* 커피 브라운 - 배당 */
        }

        /* 이벤트 아이템 (Claude 팔레트) */
        .calendar-event { font-size: 10px; padding: 2px 4px; margin-bottom: 2px;
                          border-radius: 2px; white-space: nowrap; overflow: hidden;
                          text-overflow: ellipsis; cursor: pointer;
                          background: transparent; color: var(--text-primary);
                          display: flex; align-items: center; gap: 4px; }
        .calendar-event:hover { background: var(--bg-light); }
        .calendar-event::before { content: '●'; font-size: 8px; flex-shrink: 0; }
        .calendar-event.source-earnings::before { color: var(--claude-crail); }
        .calendar-event.source-news::before { color: var(--claude-sage); }
        .calendar-event.source-report::before { color: var(--claude-tan); }
        .calendar-event.source-conference::before { color: var(--claude-lavender); }
        .calendar-event.source-dividend::before { color: var(--claude-coffee); }

        /* 미니 캘린더 */
        .mini-calendar { padding: 20px; border-bottom: 1px solid var(--border-color); }
        .mini-calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .mini-calendar-title { font-size: 16px; font-weight: 500; }
        .mini-calendar-nav-group { display: flex; gap: 8px; }
        .mini-calendar-nav { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px 8px; font-size: 14px; }
        .mini-calendar-nav:hover { color: var(--text-primary); }
        .mini-calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; font-size: 12px; color: var(--text-muted); text-align: center; margin-bottom: 8px; }
        .mini-calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; font-size: 14px; }
        .mini-calendar-day { text-align: center; padding: 8px; border-radius: 50%; cursor: pointer; color: var(--text-muted); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; margin: 0 auto; }
        .mini-calendar-day:hover { background: var(--bg-light); }
        .mini-calendar-day.current-month { color: var(--text-primary); }
        .mini-calendar-day.today { background: #DA7756; color: white; }
        .mini-calendar-day.selected { border: 1px solid #DA7756; }
        .mini-calendar-day.has-event::after { content: ''; display: block; width: 4px; height: 4px; background: #DA7756; border-radius: 50%; margin: 2px auto 0; }

        /* 캘린더 통계 섹션 */
        .calendar-stats { padding: 16px; }
        .stats-header { font-size: 13px; font-weight: 600; margin-bottom: 12px; color: var(--text-primary); }
        .stats-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color); }
        .stats-label { color: var(--text-muted); font-size: 12px; }
        .stats-value { font-weight: 500; font-size: 12px; }
        .stats-divider { height: 1px; background: var(--border-color); margin: 16px 0; }
        .stats-company { display: flex; justify-content: space-between; padding: 6px 0; font-size: 12px; }
        .stats-count { color: var(--text-muted); }
        .upcoming-event { display: flex; align-items: flex-start; gap: 8px; padding: 8px 0; }
        .upcoming-dot { font-size: 10px; margin-top: 2px; }
        .upcoming-info { flex: 1; }
        .upcoming-title { font-size: 12px; margin-bottom: 2px; }
        .upcoming-date { font-size: 11px; color: var(--text-muted); }

        /* 파이 차트 */
        .pie-chart-container { text-align: center; margin: 16px 0; }
        .pie-chart { width: 140px; height: 140px; }
        .pie-chart-legend { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 12px; }
        .pie-legend-item { display: flex; align-items: center; gap: 4px; font-size: 11px; color: var(--text-muted); }
        .pie-legend-color { width: 10px; height: 10px; border-radius: 2px; }

        /* 이벤트 모달 */
        .calendar-event-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                                background: var(--bg-dark); border: 1px solid var(--border-color);
                                border-radius: 2px; padding: 20px; min-width: 300px; z-index: 1000;
                                box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .calendar-modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                                  background: rgba(0,0,0,0.5); z-index: 999; }
        .calendar-modal-header { font-size: 16px; font-weight: 600; margin-bottom: 12px; }
        .calendar-modal-close { position: absolute; top: 12px; right: 12px; background: none;
                                border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; }

        /* 알림 모달 */
        .notification-modal {
            position: fixed;
            width: 360px;
            max-height: 480px;
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .notification-header h3 {
            font-size: 14px;
            font-weight: 400;
            color: var(--text-primary);
            margin: 0;
            letter-spacing: 0.5px;
        }
        .notification-mark-read {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .notification-mark-read:hover {
            color: var(--claude-orange);
        }
        .notification-tabs {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .notification-tab {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 2px;
            cursor: pointer;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            transition: all 0.15s;
        }
        .notification-tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        .notification-tab.active {
            background: #555;
            border-color: #555;
            color: #fff;
        }
        .notification-list {
            overflow-y: auto;
            max-height: 320px;
            flex: 1;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }
        .notification-list::-webkit-scrollbar {
            width: 6px;
        }
        .notification-list::-webkit-scrollbar-track {
            background: transparent;
        }
        .notification-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .notification-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .notification-settings {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }
        .notification-settings::-webkit-scrollbar {
            width: 6px;
        }
        .notification-settings::-webkit-scrollbar-track {
            background: transparent;
        }
        .notification-settings::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .notification-settings::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.15s;
        }
        .notification-item:hover {
            background: var(--bg-hover);
        }
        .notification-item.unread {
            border-left: 3px solid var(--claude-orange);
            background: rgba(229, 123, 83, 0.05);
        }
        .notification-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 4px;
        }
        .notification-item-title {
            font-size: 13px;
            font-weight: 400;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .notification-item-title .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--claude-orange);
            flex-shrink: 0;
        }
        .notification-item.unread .notification-item-title .dot {
            display: inline-block;
        }
        .notification-item:not(.unread) .notification-item-title .dot {
            display: none;
        }
        .notification-item-time {
            font-size: 11px;
            color: var(--text-dim);
            flex-shrink: 0;
        }
        .notification-item-desc {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
            padding-left: 12px;
        }
        .notification-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }
        .notification-empty svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        .notification-empty h4 {
            font-size: 14px;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .notification-empty p {
            font-size: 12px;
            line-height: 1.5;
            margin-bottom: 16px;
        }
        .notification-empty button {
            background: var(--claude-orange);
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 2px;
            font-size: 12px;
            cursor: pointer;
        }
        .notification-empty button:hover {
            opacity: 0.9;
        }
        /* 알림 설정 */
        .notification-settings {
            padding: 16px;
            overflow-y: auto;
            max-height: 320px;
        }
        .notification-settings-section {
            margin-bottom: 20px;
        }
        .notification-settings-section h4 {
            font-size: 12px;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 12px;
        }
        .notification-company-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }
        .notification-company-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .notification-company-tag .remove {
            cursor: pointer;
            color: var(--text-dim);
            font-size: 14px;
            line-height: 1;
        }
        .notification-company-tag .remove:hover {
            color: var(--claude-orange);
        }
        .notification-add-company {
            position: relative;
            display: inline-block;
        }
        .notification-add-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: transparent;
            border: 1px dashed var(--border-color);
            border-radius: 2px;
            font-size: 12px;
            color: var(--text-muted);
            cursor: pointer;
        }
        .notification-add-btn:hover {
            border-color: var(--claude-orange);
            color: var(--claude-orange);
        }
        .notification-company-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10;
            min-width: 140px;
            max-height: 200px;
            overflow-y: auto;
        }
        .notification-company-dropdown-item {
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            color: var(--text-secondary);
        }
        .notification-company-dropdown-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        .notification-company-remove {
            cursor: pointer;
            color: var(--text-dim);
            font-size: 16px;
            line-height: 1;
            padding: 2px 4px;
        }
        .notification-company-remove:hover {
            color: var(--claude-orange);
        }
        .notification-toggle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        .notification-toggle-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .notification-toggle {
            position: relative;
            width: 28px;
            height: 14px;
            background: var(--bg-light);
            border-radius: 2px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .notification-toggle.active {
            background: #555;
        }
        .notification-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 2px;
            transition: left 0.2s;
        }
        .notification-toggle.active::after {
            left: 16px;
        }
        .notification-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 8px;
            height: 8px;
            background: var(--claude-orange);
            border-radius: 50%;
            display: none;
        }
        .notification-badge.show {
            display: block;
        }
        .notification-email-input {
            margin-top: 8px;
        }
        .notification-email-input input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-main);
            color: var(--text-primary);
            font-size: 12px;
        }
        .notification-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-main);
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
        }
        .notification-radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 4px;
        }
        .notification-radio-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 4px 0;
        }
        .notification-radio-item input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border: 2px solid #666;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
        }
        .notification-radio-item input[type="radio"]:checked {
            border-color: var(--claude-orange);
        }
        .notification-radio-item input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: var(--claude-orange);
            border-radius: 50%;
        }
        .notification-radio-item label {
            font-size: 12px;
            color: var(--text-primary);
            cursor: pointer;
        }
        .notification-quiet-hours {
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .notification-quiet-hours input {
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-main);
            color: var(--text-primary);
            font-size: 12px;
        }

        /* 관심회사 모달 */
        .watchlist-modal {
            position: fixed;
            width: 380px;
            max-height: 520px;
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .watchlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .watchlist-header h3 {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .watchlist-header h3 svg {
            width: 16px;
            height: 16px;
            color: var(--claude-orange);
        }
        .watchlist-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            line-height: 1;
        }
        .watchlist-close:hover {
            color: var(--text-primary);
        }
        .watchlist-search {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .watchlist-search input {
            width: 100%;
            padding: 10px 12px;
            padding-left: 36px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-light);
            color: var(--text-primary);
            font-size: 13px;
            outline: none;
        }
        .watchlist-search input::placeholder {
            color: var(--text-dim);
        }
        .watchlist-search input:focus {
            border-color: var(--claude-orange);
        }
        .watchlist-search-wrapper {
            position: relative;
        }
        .watchlist-search-wrapper svg {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 14px;
            height: 14px;
            color: var(--text-dim);
        }
        .watchlist-tabs {
            display: flex;
            gap: 6px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
        }
        .watchlist-tab {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s;
        }
        .watchlist-tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        .watchlist-tab.active {
            background: #555;
            border-color: #555;
            color: #fff;
        }
        .watchlist-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            font-size: 11px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-dark);
        }
        .watchlist-info-title {
            font-weight: 500;
            color: var(--text-secondary);
        }
        .watchlist-company-list {
            flex: 1;
            overflow-y: auto;
            max-height: 280px;
        }
        .watchlist-company-list::-webkit-scrollbar {
            width: 6px;
        }
        .watchlist-company-list::-webkit-scrollbar-track {
            background: transparent;
        }
        .watchlist-company-list::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }
        .watchlist-company-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
        .watchlist-company-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.15s;
        }
        .watchlist-company-item:hover {
            background: transparent;
        }
        .watchlist-company-item.selected {
            background: transparent;
        }
        .watchlist-company-item.selected:hover {
            background: transparent;
        }
        .watchlist-company-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }
        .watchlist-company-item.selected .watchlist-company-checkbox {
            background: #555;
            border-color: #555;
        }
        .watchlist-company-checkbox svg {
            width: 12px;
            height: 12px;
            color: #fff;
            opacity: 0;
        }
        .watchlist-company-item.selected .watchlist-company-checkbox svg {
            opacity: 1;
        }
        .watchlist-company-info {
            flex: 1;
            min-width: 0;
        }
        .watchlist-company-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        .watchlist-company-ticker {
            font-size: 11px;
            color: var(--text-dim);
        }
        .watchlist-company-change {
            font-size: 13px;
            font-weight: 500;
            text-align: right;
        }
        .watchlist-company-change.positive {
            color: #22c55e;
        }
        .watchlist-company-change.negative {
            color: #ef4444;
        }
        .watchlist-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }
        .watchlist-empty svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        .watchlist-empty p {
            font-size: 13px;
            line-height: 1.5;
        }
        .watchlist-footer {
            padding: 12px 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-dark);
        }
        .watchlist-footer-count {
            font-size: 12px;
            color: var(--text-muted);
        }
        .watchlist-footer-count span {
            color: var(--claude-orange);
            font-weight: 500;
        }
        .watchlist-add-btn {
            padding: 8px 20px;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.15s;
        }
        .watchlist-add-btn:hover {
            background: #666;
        }
        .watchlist-add-btn:disabled {
            background: var(--bg-light);
            color: var(--text-dim);
            cursor: not-allowed;
        }

        /* 포럼 스타일 */
        .forum-container {
            display: flex;
            height: 100%;
            overflow: hidden;
        }

        .forum-list-panel {
            width: 40%;
            min-width: 320px;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .forum-detail-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .forum-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            background: transparent;
        }

        .forum-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .forum-search-box {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            flex: 1;
            min-width: 180px;
            max-width: 350px;
        }

        .forum-search-box svg {
            color: var(--text-dim);
            flex-shrink: 0;
        }

        .forum-search-box input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-size: 13px;
        }

        .forum-search-box input::placeholder {
            color: var(--text-dim);
        }

        .forum-tab {
            padding: 6px 16px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.15s;
        }

        .forum-tab:hover {
            border-color: #4a4a4a;
            color: var(--text-primary);
        }

        .forum-tab.active {
            background: #4a4a4a;
            border-color: #4a4a4a;
            color: #fff;
        }

        .forum-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .forum-sort-select {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-light);
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
        }

        .forum-write-btn {
            padding: 8px 16px;
            background: #4a4a4a;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.15s;
            margin-left: auto;
        }

        .forum-write-btn:hover {
            background: #3a3a3a;
        }

        .forum-post-list {
            flex: 1;
            overflow-y: auto;
        }

        .forum-post-card {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.15s;
        }

        .forum-post-card:hover {
            background: var(--bg-hover);
        }

        .forum-post-card.active {
            background: rgba(177, 173, 161, 0.1);
            border-left: 3px solid #B1ADA1;
        }

        .forum-post-card.unread::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--claude-orange);
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .forum-post-category {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .forum-post-category.portfolio {
            background: transparent;
            border: 1px solid #C15F3C;
            color: #C15F3C;
        }

        .forum-post-category.stock {
            background: transparent;
            border: 1px solid #6B7B8C;
            color: #6B7B8C;
        }

        .forum-post-category.discussion {
            background: transparent;
            border: 1px solid #7D8471;
            color: #7D8471;
        }

        .forum-post-category.news {
            background: transparent;
            border: 1px solid #9B8AA6;
            color: #9B8AA6;
        }

        .forum-post-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .forum-post-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: var(--text-muted);
        }

        .forum-post-author {
            color: var(--text-secondary);
        }

        .forum-post-stats {
            display: flex;
            gap: 12px;
            margin-top: 8px;
            font-size: 11px;
            color: var(--text-muted);
        }

        .forum-post-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* 포럼 상세 패널 */
        .forum-detail-empty {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 13px;
        }

        /* 포럼 기본 대시보드 */
        .forum-dashboard {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
            overflow-y: auto;
        }

        .forum-dashboard-section {
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        .forum-dashboard-section-title {
            padding: 12px 16px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-light);
        }

        .forum-popular-list {
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .forum-popular-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .forum-popular-card:hover {
            background: var(--bg-hover);
            border-color: var(--border-color);
        }

        .forum-popular-card-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .forum-popular-rank {
            font-size: 12px;
            font-weight: 700;
            color: var(--accent-color);
            min-width: 20px;
        }

        .forum-popular-category {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 2px;
            text-transform: uppercase;
        }

        .forum-popular-title {
            font-size: 13px;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 6px;
        }

        .forum-popular-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 11px;
            color: var(--text-dim);
        }

        .forum-recent-list {
            padding: 0;
        }

        .forum-recent-item {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: background 0.15s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .forum-recent-item:last-child {
            border-bottom: none;
        }

        .forum-recent-item:hover {
            background: var(--bg-hover);
        }

        .forum-recent-title {
            flex: 1;
            font-size: 12px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .forum-recent-time {
            font-size: 10px;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .forum-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .forum-detail-header {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .forum-detail-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .forum-detail-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .forum-detail-author {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .forum-author-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 14px;
            font-weight: 600;
        }

        .forum-author-name {
            color: var(--text-primary);
            font-weight: 500;
        }

        .forum-detail-body {
            font-size: 14px;
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .forum-detail-body p {
            margin-bottom: 16px;
        }

        .forum-tickers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .forum-ticker {
            padding: 4px 12px;
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 12px;
            color: var(--claude-orange);
            cursor: pointer;
            transition: all 0.15s;
        }

        .forum-ticker:hover {
            background: rgba(229, 123, 83, 0.1);
            border-color: var(--claude-orange);
        }

        .forum-chart-snapshot {
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .forum-chart-snapshot-title {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .forum-chart-placeholder {
            height: 200px;
            background: var(--bg-light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dim);
            font-size: 12px;
        }

        .forum-chart-svg {
            width: 100%;
            height: 300px;
            background: var(--bg-light);
            border-radius: 4px;
        }

        .forum-detail-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            margin-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .forum-vote-group {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #2a2a2a;
            border-radius: 20px;
            padding: 4px 8px;
        }

        .forum-vote-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            font-size: 16px;
            line-height: 1;
            transition: color 0.15s;
        }

        .forum-vote-btn:hover {
            color: #ff4500;
        }

        .forum-vote-btn.upvoted {
            color: #ff4500;
        }

        .forum-vote-btn.downvoted {
            color: #7193ff;
        }

        .forum-vote-count {
            font-weight: 600;
            color: var(--text-primary);
            min-width: 40px;
            text-align: center;
            font-size: 13px;
        }

        .forum-action-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #2a2a2a;
            border: none;
            border-radius: 20px;
            padding: 8px 12px;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .forum-action-btn:hover {
            background: #3a3a3a;
        }

        .forum-action-btn.liked {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .forum-award-btn .award-icon {
            font-size: 14px;
        }

        /* 포럼 우측 패널 (랭킹) */
        .forum-ranking-section {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .forum-ranking-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .forum-ranking-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .forum-ranking-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background: var(--bg-medium);
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .forum-ranking-item:hover {
            background: var(--bg-hover);
        }

        .forum-ranking-rank {
            width: 20px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
        }

        .forum-ranking-rank.top {
            color: #A67B5B;
        }

        .forum-ranking-name {
            flex: 1;
            font-size: 12px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .forum-ranking-value {
            font-size: 11px;
            color: var(--text-muted);
        }

        .forum-ranking-bar {
            height: 4px;
            background: var(--bg-light);
            border-radius: 2px;
            margin-top: 6px;
            overflow: hidden;
        }

        .forum-ranking-bar-fill {
            height: 100%;
            background: #D4A574;
            border-radius: 2px;
        }

        .forum-hot-change {
            font-size: 11px;
            font-weight: 500;
        }

        .forum-hot-change.positive {
            color: #22c55e;
        }

        .forum-hot-change.negative {
            color: #ef4444;
        }

        /* 글쓰기 모달 */
        .forum-write-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .forum-write-modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .forum-write-modal {
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 600px;
            max-width: 90vw;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        .forum-write-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .forum-write-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .forum-write-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 20px;
        }

        .forum-write-close:hover {
            color: var(--text-primary);
        }

        .forum-write-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .forum-write-group {
            margin-bottom: 16px;
        }

        .forum-write-label {
            display: block;
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .forum-write-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-light);
            color: var(--text-primary);
            font-size: 13px;
        }

        .forum-write-input:focus {
            outline: none;
            border-color: var(--claude-orange);
        }

        .forum-write-textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-light);
            color: var(--text-primary);
            font-size: 13px;
            resize: vertical;
            font-family: inherit;
        }

        .forum-write-textarea:focus {
            outline: none;
            border-color: var(--claude-orange);
        }

        .forum-write-category-btns {
            display: flex;
            gap: 8px;
        }

        .forum-write-category-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: transparent;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .forum-write-category-btn:hover {
            border-color: #4a4a4a;
            color: #4a4a4a;
        }

        .forum-write-category-btn.active {
            background: #4a4a4a;
            border-color: #4a4a4a;
            color: #fff;
        }

        .forum-write-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
        }

        .forum-write-btn-cancel {
            padding: 8px 20px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: transparent;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
        }

        .forum-write-btn-cancel:hover {
            background: var(--bg-hover);
        }

        .forum-write-btn-submit {
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            background: #4a4a4a;
            color: #fff;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
        }

        .forum-write-btn-submit:hover {
            background: #3a3a3a;
        }

        /* 이미지 업로드 영역 */
        .forum-write-image-upload {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-light);
        }

        .forum-write-image-upload:hover {
            border-color: var(--text-muted);
            background: var(--bg-hover);
        }

        .forum-write-image-upload.dragover {
            border-color: var(--claude-orange);
            background: rgba(193, 95, 60, 0.1);
        }

        .forum-write-image-upload-icon {
            color: var(--text-dim);
            margin-bottom: 8px;
        }

        .forum-write-image-upload-text {
            font-size: 13px;
            color: var(--text-muted);
        }

        .forum-write-image-upload-hint {
            font-size: 11px;
            color: var(--text-dim);
            margin-top: 4px;
        }

        .forum-write-image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .forum-write-image-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .forum-write-image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .forum-write-image-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .forum-write-image-remove:hover {
            background: #ef5350;
        }

        /* 피드 그리드 스타일 */
        .feed-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .feed-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .feed-header-info {
            font-size: 12px;
            color: var(--text-dim);
        }

        .feed-search-area {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feed-category-select,
        .feed-priority-select {
            padding: 6px 10px;
            font-size: 11px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .feed-search-box {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .feed-search-box svg {
            color: var(--text-dim);
            flex-shrink: 0;
        }

        .feed-search-box input {
            border: none;
            background: transparent;
            font-size: 11px;
            color: var(--text-primary);
            outline: none;
            width: 200px;
        }

        .feed-search-box input::placeholder {
            color: var(--text-muted);
        }

        .feed-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            padding: 16px;
            flex: 1;
            overflow-y: auto;
        }

        .feed-source-card {
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            min-height: 300px;
            max-height: 400px;
        }

        .feed-source-header {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 500;
            font-size: 13px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-light);
            border-radius: 4px 4px 0 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .feed-source-card .feed-source-list {
            display: block;
            flex: 1;
            overflow-y: auto;
            padding: 4px 0;
            margin: 0;
            max-height: none;
            gap: 0;
        }

        .feed-source-card .feed-source-list::-webkit-scrollbar {
            width: 6px;
        }

        .feed-source-card .feed-source-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .feed-source-card .feed-source-list::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .feed-source-card .feed-source-list::-webkit-scrollbar-thumb:hover {
            background: var(--text-dim);
        }

        .feed-source-card .feed-source-item {
            display: block;
            padding: 6px 12px;
            cursor: pointer;
            transition: background 0.15s;
            border-bottom: 1px solid var(--border-subtle);
        }

        .feed-source-card .feed-source-item:last-child {
            border-bottom: none;
        }

        .feed-source-card .feed-source-item:hover {
            background: var(--bg-hover);
        }

        .feed-item-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
        }

        .feed-item-title {
            font-size: 12px;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex: 1;
        }

        .feed-item-stats {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
        }

        .feed-item-priority {
            font-size: 9px;
            padding: 1px 4px;
            border-radius: 2px;
        }

        .feed-item-priority.high {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .feed-item-priority.medium {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .feed-item-priority.low {
            display: none;
        }

        .feed-item-views {
            font-size: 10px;
            color: var(--text-dim);
            white-space: nowrap;
        }

        .feed-item-meta {
            font-size: 10px;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .feed-item-time {
            color: var(--text-muted);
        }

        .feed-item-source {
            color: var(--text-dim);
        }

        @media (max-width: 1400px) {
            .feed-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .feed-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ===== 차트랩 스타일 ===== */
        .chartlab-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: var(--bg-dark);
            padding-top: 24px;
        }

        .chartlab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            background: transparent;
            gap: 10px;
            flex-wrap: wrap;
        }

        .chartlab-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .chartlab-datasource-select {
            padding: 8px 12px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 13px;
            cursor: pointer;
            min-width: 180px;
        }

        .chartlab-datasource-select:hover {
            border-color: var(--chartlab-highlight);
        }

        .chartlab-filter-chips {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .chartlab-filter-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .chartlab-filter-chip .remove-btn {
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.15s;
        }

        .chartlab-filter-chip .remove-btn:hover {
            opacity: 1;
        }

        .chartlab-add-filter-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px dashed var(--border-color);
            border-radius: 16px;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .chartlab-add-filter-btn:hover {
            border-color: var(--chartlab-highlight);
            color: var(--text-secondary);
        }

        .chartlab-header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chartlab-btn {
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .chartlab-btn-secondary {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .chartlab-btn-secondary:hover {
            background: var(--bg-medium);
            border-color: #4a4a4a;
        }

        .chartlab-btn-primary {
            background: var(--claude-orange);
            border: none;
            color: #fff;
        }

        .chartlab-btn-primary:hover {
            background: #e07b00;
        }

        .chartlab-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .chartlab-sidebar {
            width: 280px;
            min-width: 280px;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            background: var(--bg-medium);
            display: flex;
            flex-direction: column;
        }

        .chartlab-type-selector {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-type-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .chartlab-type-dropdown {
            width: 100%;
            padding: 6px 8px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            color: var(--text-primary);
            font-size: 11px;
            cursor: pointer;
        }

        .chartlab-type-dropdown:hover {
            border-color: var(--chartlab-highlight);
        }

        /* 커스텀 드롭다운 스타일 */
        .chartlab-custom-dropdown {
            position: relative;
        }

        .chartlab-dropdown-selected {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            cursor: pointer;
            font-size: 11px;
        }

        .chartlab-dropdown-selected:hover {
            border-color: var(--chartlab-highlight);
        }

        .chartlab-dropdown-text {
            flex: 1;
        }

        .chartlab-dropdown-arrow {
            width: 14px;
            height: 14px;
            transition: transform 0.2s;
        }

        .chartlab-custom-dropdown.open .chartlab-dropdown-arrow {
            transform: rotate(180deg);
        }

        .chartlab-dropdown-options {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 2px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .chartlab-custom-dropdown.open .chartlab-dropdown-options {
            display: block;
        }

        .chartlab-dropdown-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            cursor: pointer;
            font-size: 11px;
        }

        .chartlab-dropdown-option:hover {
            background: var(--bg-light);
        }

        .chartlab-dropdown-option.selected {
            background: var(--chartlab-highlight);
        }

        .chartlab-dropdown-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chartlab-dropdown-icon svg {
            width: 16px;
            height: 16px;
        }

        .chartlab-dropdown-check {
            width: 14px;
            height: 14px;
            margin-left: auto;
        }

        /* 스냅샷 커스텀 드롭다운 스타일 */
        .snapshot-custom-dropdown {
            position: relative;
        }

        .snapshot-dropdown-selected {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            cursor: pointer;
            font-size: 11px;
        }

        .snapshot-dropdown-selected:hover {
            border-color: var(--chartlab-highlight);
        }

        .snapshot-dropdown-text {
            flex: 1;
        }

        .snapshot-dropdown-arrow {
            width: 14px;
            height: 14px;
            transition: transform 0.2s;
        }

        .snapshot-custom-dropdown.open .snapshot-dropdown-arrow {
            transform: rotate(180deg);
        }

        .snapshot-dropdown-options {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 2px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .snapshot-custom-dropdown.open .snapshot-dropdown-options {
            display: block;
        }

        .snapshot-dropdown-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            cursor: pointer;
            font-size: 11px;
        }

        .snapshot-dropdown-option:hover {
            background: var(--bg-light);
        }

        .snapshot-dropdown-option.selected {
            background: var(--chartlab-highlight);
        }

        .snapshot-dropdown-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .snapshot-dropdown-icon svg {
            width: 16px;
            height: 16px;
        }

        .snapshot-dropdown-check {
            width: 14px;
            height: 14px;
            margin-left: auto;
        }

        .chartlab-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
        }

        .chartlab-tab:hover {
            color: var(--text-primary);
            background: var(--bg-light);
        }

        .chartlab-tab.active {
            color: var(--text-primary);
        }

        .chartlab-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--chartlab-highlight);
        }

        .chartlab-tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 6px 0;
        }

        .chartlab-section {
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-section:last-child {
            border-bottom: none;
        }

        .chartlab-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            cursor: pointer;
            user-select: none;
            transition: background 0.15s;
        }

        .chartlab-section-header:hover {
            background: var(--bg-light);
        }

        .chartlab-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
        }

        .chartlab-section-toggle {
            color: var(--text-muted);
            transition: transform 0.2s;
        }

        .chartlab-section.collapsed .chartlab-section-toggle {
            transform: rotate(-90deg);
        }

        .chartlab-section-content {
            padding: 0 12px 10px;
        }

        .chartlab-section.collapsed .chartlab-section-content {
            display: none;
        }

        .chartlab-field-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 6px;
        }

        .chartlab-field-item:last-child {
            margin-bottom: 0;
        }

        .chartlab-field-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .chartlab-field-name {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .chartlab-field-meta {
            font-size: 10px;
            color: var(--text-muted);
        }

        .chartlab-field-remove {
            padding: 4px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.15s;
        }

        .chartlab-field-remove:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .chartlab-field-dropdown {
            width: 100%;
            padding: 6px 8px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            color: var(--text-primary);
            font-size: 11px;
            margin-top: 6px;
        }

        .chartlab-add-field-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: transparent;
            border: 1px dashed var(--border-color);
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 11px;
            cursor: pointer;
            width: 100%;
            justify-content: center;
            transition: all 0.15s;
            margin-top: 6px;
        }

        .chartlab-add-field-btn:hover {
            border-color: var(--chartlab-highlight);
            color: #ccc;
        }

        .chartlab-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: auto;
            background: var(--bg-dark);
        }

        .chartlab-chart-wrapper {
            flex: 1;
            min-height: 400px;
            background: var(--bg-medium);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        .chartlab-chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            text-align: center;
        }

        #chartlab-chart {
            flex: 1;
            min-height: 350px;
        }

        .chartlab-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .chartlab-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .chartlab-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .chartlab-upload-area {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-upload-dropzone {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
        }

        .chartlab-upload-dropzone:hover,
        .chartlab-upload-dropzone.dragover {
            border-color: var(--chartlab-highlight);
            background: rgba(74, 74, 74, 0.1);
        }

        .chartlab-upload-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 8px;
            color: var(--text-muted);
        }

        .chartlab-upload-text {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .chartlab-upload-hint {
            font-size: 11px;
            color: var(--text-muted);
        }

        .chartlab-empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 300px;
            color: var(--text-muted);
            text-align: center;
        }

        .chartlab-empty-icon {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .chartlab-empty-text {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .chartlab-empty-hint {
            font-size: 12px;
            color: var(--text-dim);
        }

        /* 스타일 탭 관련 */
        .chartlab-style-section {
            padding: 12px 16px;
        }

        .chartlab-style-label {
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .chartlab-style-input {
            width: 100%;
            padding: 6px 8px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 11px;
        }

        .chartlab-style-input:focus {
            outline: none;
            border-color: var(--chartlab-highlight);
        }

        .chartlab-color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .chartlab-color-swatch {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
        }

        .chartlab-color-swatch:hover {
            transform: scale(1.1);
        }

        .chartlab-color-swatch.selected {
            border-color: #fff;
            box-shadow: 0 0 0 2px var(--chartlab-highlight);
        }

        .chartlab-radio-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .chartlab-radio-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .chartlab-radio-item input[type="radio"] {
            accent-color: var(--chartlab-highlight);
        }

        /* 필터 모달 */
        .chartlab-filter-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .chartlab-filter-modal-content {
            background: var(--bg-medium);
            border-radius: 12px;
            width: 400px;
            max-width: 90vw;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .chartlab-filter-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-filter-modal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chartlab-filter-modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
        }

        .chartlab-filter-modal-body {
            padding: 16px;
        }

        .chartlab-filter-row {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .chartlab-filter-select {
            flex: 1;
            padding: 8px 10px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 13px;
        }

        .chartlab-filter-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            padding: 16px;
            border-top: 1px solid var(--border-color);
        }

        /* 필드 선택 드롭다운 */
        .chartlab-field-select {
            position: relative;
        }

        .chartlab-field-select-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .chartlab-field-select-trigger:hover {
            border-color: var(--chartlab-highlight);
        }

        .chartlab-field-select-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-top: 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .chartlab-field-select-option {
            padding: 10px 12px;
            cursor: pointer;
            transition: background 0.15s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chartlab-field-select-option:hover {
            background: var(--bg-light);
        }

        .chartlab-field-select-option.selected {
            background: rgba(74, 74, 74, 0.2);
            color: var(--text-primary);
        }

        .chartlab-field-type-badge {
            font-size: 10px;
            padding: 2px 6px;
            background: var(--bg-dark);
            border-radius: 3px;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        /* Faceting 그리드 */
        .chartlab-facet-grid {
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .chartlab-facet-chart {
            background: var(--bg-medium);
            border-radius: 8px;
            padding: 12px;
        }

        .chartlab-facet-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-align: center;
        }

        /* 토스트 알림 */
        .chartlab-toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            animation: slideInUp 0.3s ease;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chartlab-toast-success {
            border-left: 3px solid #22c55e;
        }

        .chartlab-toast-error {
            border-left: 3px solid #ef4444;
        }

        .chartlab-toast-info {
            border-left: 3px solid #3b82f6;
        }

        /* ===== 다중 차트 스타일 (Livedocs 스타일) ===== */

        /* 차트랩 스크롤 컨테이너 */
        .chartlab-scroll-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* 개별 차트 블록 (Livedocs 스타일) */
        .chartlab-chart-block {
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .chartlab-chart-block.collapsed .chartlab-block-body {
            display: none;
        }

        .chartlab-chart-block.active {
            border-color: var(--chartlab-highlight);
        }

        /* 차트 블록 헤더 (Cell title 스타일) */
        .chartlab-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 10px;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-block-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chartlab-block-title-input {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 12px;
            padding: 3px 6px;
            border-radius: 4px;
            min-width: 100px;
        }

        .chartlab-block-title-input:hover,
        .chartlab-block-title-input:focus {
            background: var(--bg-light);
            outline: none;
        }

        .chartlab-block-datasource {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
            font-size: 11px;
        }

        .chartlab-block-datasource-select {
            padding: 3px 6px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-secondary);
            font-size: 11px;
            max-width: 130px;
            cursor: pointer;
        }

        .chartlab-block-actions {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .chartlab-block-action-btn {
            padding: 3px 5px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 10px;
            transition: all 0.15s;
        }

        .chartlab-block-action-btn:hover {
            background: var(--bg-light);
            color: var(--text-primary);
        }

        /* 차트 블록 바디 */
        .chartlab-block-body {
            display: flex;
            min-height: 180px;
        }

        /* Data/Style 탭 토글 (Livedocs 스타일) */
        .chartlab-tab-toggle {
            display: flex;
            background: var(--bg-dark);
            border-radius: 4px;
            padding: 2px;
            margin: 10px;
        }

        .chartlab-tab-toggle-btn {
            flex: 1;
            padding: 6px 12px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: var(--text-muted);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .chartlab-tab-toggle-btn.active {
            background: var(--chartlab-highlight);
            color: #fff;
        }

        /* X-axis 추가 설정 (Scale, Sort) */
        .chartlab-axis-options {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .chartlab-axis-option {
            flex: 1;
        }

        .chartlab-axis-option-label {
            font-size: 10px;
            color: var(--text-dim);
            margin-bottom: 4px;
        }

        .chartlab-axis-option-select {
            width: 100%;
            padding: 5px 6px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            color: var(--text-primary);
            font-size: 10px;
        }

        /* Y-axis 안내 메시지 */
        .chartlab-axis-hint {
            padding: 10px 12px;
            background: var(--bg-light);
            border: 1px dashed var(--border-color);
            border-radius: 4px;
            color: var(--text-dim);
            font-size: 11px;
            text-align: center;
        }

        /* Style 탭 아코디언 섹션 */
        .chartlab-style-accordion {
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-style-accordion-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            cursor: pointer;
            font-size: 11px;
            color: var(--text-primary);
        }

        .chartlab-style-accordion-header:hover {
            background: var(--bg-light);
        }

        .chartlab-style-accordion-content {
            padding: 0 12px 10px;
        }

        .chartlab-style-accordion.collapsed .chartlab-style-accordion-content {
            display: none;
        }

        .chartlab-style-accordion.collapsed .chartlab-accordion-icon {
            transform: rotate(-90deg);
        }

        .chartlab-accordion-icon {
            transition: transform 0.2s;
        }

        /* Style 탭 내 행 */
        .chartlab-style-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .chartlab-style-row:last-child {
            margin-bottom: 0;
        }

        .chartlab-style-number-input {
            width: 50px;
            padding: 5px 6px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 10px;
            text-align: center;
        }

        /* 새 차트 추가 버튼 (중앙) */
        .chartlab-add-chart-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 24px;
            background: transparent;
            border: 1px dashed var(--border-color);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s;
            font-size: 12px;
        }

        .chartlab-add-chart-btn:hover {
            border-color: var(--chartlab-highlight);
            color: #ccc;
        }

        /* 데이터소스 선택 모달 */
        .chartlab-datasource-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .chartlab-datasource-modal-content {
            background: var(--bg-dark);
            border-radius: 6px;
            width: 480px;
            max-width: 90vw;
            max-height: 80vh;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chartlab-ds-search {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-ds-search input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-size: 13px;
        }

        .chartlab-ds-search input::placeholder {
            color: var(--text-dim);
        }

        .chartlab-ds-sections {
            flex: 1;
            overflow-y: auto;
        }

        .chartlab-ds-section {
            border-bottom: 1px solid var(--border-color);
        }

        .chartlab-ds-section-title {
            padding: 10px 16px 6px;
            font-size: 10px;
            font-weight: 600;
            color: var(--chartlab-highlight);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chartlab-ds-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-primary);
            transition: background 0.1s;
        }

        .chartlab-ds-item:hover {
            background: var(--bg-light);
        }

        .chartlab-ds-item.selected {
            background: var(--chartlab-highlight);
        }

        .chartlab-ds-item-icon {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--chartlab-highlight);
        }

        .chartlab-ds-item-arrow {
            margin-left: auto;
            color: var(--text-dim);
        }

        .chartlab-ds-footer {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 10px 16px;
            border-top: 1px solid var(--border-color);
            font-size: 10px;
            color: var(--text-dim);
        }

        .chartlab-ds-footer-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .chartlab-ds-footer-key {
            padding: 2px 6px;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            font-size: 9px;
        }

        /* 토글 스위치 */
        .chartlab-toggle {
            position: relative;
            display: inline-block;
            width: 28px;
            height: 14px;
        }

        .chartlab-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .chartlab-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            transition: 0.2s;
        }

        .chartlab-toggle-slider:before {
            position: absolute;
            content: "";
            height: 10px;
            width: 10px;
            left: 1px;
            bottom: 1px;
            background-color: var(--text-muted);
            border-radius: 50%;
            transition: 0.2s;
        }

        .chartlab-toggle input:checked + .chartlab-toggle-slider {
            background-color: var(--chartlab-highlight);
            border-color: var(--chartlab-highlight);
        }

        .chartlab-toggle input:checked + .chartlab-toggle-slider:before {
            transform: translateX(14px);
            background-color: white;
        }

        /* 미니 드롭다운 (Legend Position 등) */
        .chartlab-mini-dropdown {
            padding: 4px 8px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 2px;
            color: var(--text-primary);
            font-size: 10px;
            cursor: pointer;
            min-width: 70px;
        }

        .chartlab-mini-dropdown:hover {
            border-color: var(--chartlab-highlight);
        }

        /* 우측 패널 - 차트 목록 */
        .chartlab-list-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: transparent;
            padding-top: 24px;
        }

        .chartlab-list-header {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chartlab-list-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chartlab-list-item {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .chartlab-list-item:hover {
            border-color: #4a4a4a;
        }

        .chartlab-list-item.active {
            border-color: var(--chartlab-highlight);
            background: rgba(74, 74, 74, 0.1);
        }

        .chartlab-list-item-title {
            font-size: 11px;
            font-weight: 500;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chartlab-list-item-preview {
            height: 60px;
            background: var(--bg-dark);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dim);
            font-size: 10px;
            overflow: hidden;
        }

        .chartlab-list-item-meta {
            margin-top: 6px;
            font-size: 10px;
            color: var(--text-muted);
        }

        .chartlab-list-add-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 12px;
            background: transparent;
            border: 1px dashed var(--border-color);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 11px;
            transition: all 0.15s;
        }

        .chartlab-list-add-btn:hover {
            border-color: var(--chartlab-highlight);
            color: #ccc;
        }

        /* 차트랩 미리보기 섹션 */
        .chartlab-preview-section {
            flex: 0.8;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            background: var(--bg-medium);
            overflow: hidden;
        }

        .chartlab-preview-header {
            padding: 10px 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .chartlab-preview-content {
            flex: 1;
            padding: 10px;
            overflow: hidden;
        }

        .chartlab-preview-chart {
            width: 100%;
            height: 100%;
        }

        .chartlab-preview-empty {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dim);
            font-size: 12px;
        }

        /* 차트 블록 내 사이드바 */
        .chartlab-block-sidebar {
            width: 240px;
            min-width: 240px;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            background: var(--bg-medium);
            display: flex;
            flex-direction: column;
        }

        /* 차트 블록 내 메인 영역 */
        .chartlab-block-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 16px;
            overflow: auto;
            background: var(--bg-dark);
        }

        .chartlab-block-chart-wrapper {
            flex: 1;
            min-height: 150px;
            background: var(--bg-medium);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        /* Y-axis 추가 링크 */
        .chartlab-add-link {
            font-size: 11px;
            color: var(--text-muted);
            cursor: pointer;
            text-decoration: none;
        }

        .chartlab-add-link:hover {
            text-decoration: underline;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 아이콘 사이드바 -->
        <div class="icon-sidebar">
            <div class="icon-sidebar-item active" title="스냅샷" onclick="showChartView()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
            </div>
            <div class="icon-sidebar-item" title="피드" onclick="showFeed()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 11a9 9 0 0 1 9 9"></path>
                    <path d="M4 4a16 16 0 0 1 16 16"></path>
                    <circle cx="5" cy="19" r="1"></circle>
                </svg>
            </div>
            <div class="icon-sidebar-item" title="캘린더" onclick="showCalendar()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
            </div>
            <div class="icon-sidebar-item" title="차트랩" onclick="showChartLab()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <!-- 심플 플라스크 아이콘 -->
                    <path d="M9 3h6v5l5 10a2 2 0 0 1-1.8 3H5.8a2 2 0 0 1-1.8-3l5-10V3z"></path>
                    <line x1="9" y1="3" x2="15" y2="3"></line>
                </svg>
            </div>
            <div class="icon-sidebar-item" title="산업분석" onclick="showIndustryAnalysis()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <!-- 연결선 -->
                    <line x1="8" y1="6" x2="16" y2="12"></line>
                    <line x1="8" y1="18" x2="16" y2="12"></line>
                    <!-- 노드 -->
                    <circle cx="5" cy="6" r="3"></circle>
                    <circle cx="5" cy="18" r="3"></circle>
                    <circle cx="19" cy="12" r="3"></circle>
                </svg>
            </div>
            <div class="icon-sidebar-item" title="포럼" onclick="showForum()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
            </div>
            <div class="icon-sidebar-spacer"></div>
            <div class="icon-sidebar-item" title="관심회사" onclick="showWatchlist()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>
            </div>
            <div class="icon-sidebar-item" title="알람" onclick="showNotifications()" style="position: relative;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <div class="notification-badge" id="notificationBadge"></div>
            </div>
            <div class="icon-sidebar-item" title="매뉴얼" onclick="showUserManual()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
            </div>
            <div class="icon-sidebar-item" title="테마 변경" onclick="toggleTheme()" id="themeToggleBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="themeIcon">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </div>
            <div class="icon-sidebar-item" title="계정" onclick="showAccount()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </div>
        </div>

        <!-- 메인 콘텐츠 영역 -->
        <div class="main-content">
            <!-- 상단 영역 (중앙+우측) -->
            <div class="upper-area" id="upperArea">
                <!-- 중앙 패널 -->
                <div class="center-panel" id="centerPanel">
                    <div class="chart-header">
                        <div class="search-title-container">
                            <input type="text" class="chart-search-input" id="chartSearchInput"
                                   placeholder="검색어를 입력하세요 (예: 삼성전자 매출액)" />
                            <h2 class="chart-title" id="chartTitle"></h2>
                        </div>
                    </div>
                    <div class="chart-area">
                        <div class="chart-sidebar" id="chartSidebar">
                            <!-- 사이드바 내용은 JavaScript로 렌더링 -->
                        </div>
                        <div class="chart-container">
                            <div id="stockChart"></div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="dataTable">
                            <!-- 테이블 내용 -->
                        </table>
                    </div>
                </div>

                <!-- 중앙-우측 리사이저 -->
                <!-- 중앙-우측 리사이저 -->
                <div class="resizer resizer-horizontal" id="resizerCenter"></div>

                <!-- 우측 패널 -->
                <div class="right-panel" id="rightPanel">
                    <div class="detail-container" id="detailContainer">
                        <div class="detail-placeholder" id="detailPlaceholder">
                            항목을 선택하세요
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 팝오버 -->
    <div class="popover" id="popover">
        <div class="popover-title" id="popoverTitle"></div>
        <div class="popover-content" id="popoverContent"></div>
    </div>

    <script>
        // 알림 데이터
        const notificationData = [
            { id: 'n1', type: 'company', title: '넥슨 4분기 실적 공시', company: '넥슨', date: '2026-01-30 14:30', read: false },
            { id: 'n2', type: 'company', title: '크래프톤 신작 발표', company: '크래프톤', date: '2026-01-30 10:15', read: false },
            { id: 'n3', type: 'reply', title: '회원님의 분석글에 댓글', content: '좋은 분석이네요!', author: 'user123', date: '2026-01-29 18:20', read: true },
            { id: 'n4', type: 'company', title: '엔씨소프트 배당 공시', company: '엔씨소프트', date: '2026-01-29 09:00', read: true },
            { id: 'n5', type: 'reply', title: '회원님의 댓글에 답글', content: '동의합니다', author: 'investor99', date: '2026-01-28 15:45', read: true },
            { id: 'n6', type: 'company', title: '넷마블 IR 일정 등록', company: '넷마블', date: '2026-01-28 11:00', read: true }
        ];

        // 알림 설정
        const notificationSettings = {
            companies: {
                '넥슨': true,
                '크래프톤': true,
                '엔씨소프트': true,
                '넷마블': true
            },
            postNotifications: {
                commentOnMyPost: true,
                replyToMyComment: true,
                mentionMe: true
            },
            emailNotification: false,
            emailAddress: '',
            notificationFrequency: 'realtime',
            soundEnabled: false,
            quietHoursEnabled: false,
            quietHoursStart: '22:00',
            quietHoursEnd: '08:00'
        };

        // 추가 가능한 회사 목록
        const availableCompanies = ['넥슨', '크래프톤', '엔씨소프트', '넷마블', '펄어비스', '카카오게임즈', '위메이드', '컴투스'];

        // 출처별 더미 데이터
        const sourceData = {
            dart: {
                name: '공시(DART)',
                items: [
                    '넥슨 2024년 사업보고서',
                    '2024년 4분기 실적공시',
                    '2024년 3분기 분기보고서',
                    '2024년 2분기 분기보고서',
                    '2024년 1분기 분기보고서',
                    '주요사항보고서(자기주식취득)',
                    '임원현황 공시'
                ]
            },
            darkReport: {
                name: '다크리포트',
                items: [
                    '넥슨 매출 둔화 우려 분석',
                    '메이플스토리 매출 하락 리포트',
                    '던전앤파이터 중국 매출 분석',
                    'FC온라인 시즌 매출 추정',
                    '신작 기대작 매출 전망'
                ]
            },
            policy: {
                name: '정책/규제',
                items: [
                    '확률형 아이템 규제 강화안',
                    '게임산업법 개정 논의',
                    '청소년 게임시간 제한 완화',
                    '중국 판호 정책 변화',
                    '일본 게임시장 규제 동향'
                ]
            },
            news: {
                name: '뉴스/기타',
                items: [
                    '넥슨 신작 "퍼스트 디센던트" 출시',
                    '블루아카이브 글로벌 흥행',
                    '메이플스토리 20주년 이벤트',
                    '넥슨 북미 스튜디오 확장',
                    'EA와 전략적 파트너십 체결',
                    'FC온라인 e스포츠 대회 개최'
                ]
            },
            paper: {
                name: '논문',
                items: [
                    '게임 산업 성장 동력 분석',
                    'MMORPG 유저 행동 패턴 연구',
                    '게임 내 경제 시스템 연구',
                    'AI 기반 게임 콘텐츠 생성'
                ]
            },
            patent: {
                name: '특허',
                items: [
                    '게임 매칭 시스템 특허',
                    'AI NPC 행동 알고리즘',
                    '실시간 렌더링 기술',
                    '게임 내 거래 시스템'
                ]
            },
            sec: {
                name: 'SEC',
                items: [
                    'Form 20-F 연차보고서',
                    'Form 6-K 수시보고서',
                    '주요 주주 변동 보고'
                ]
            },
            edinet: {
                name: 'EDINET',
                items: [
                    '유가증권보고서',
                    '분기보고서',
                    '대량보유보고서'
                ]
            }
        };

        // 테이블 기간 선택 (기본값: 분기별)
        let selectedPeriod = 'quarter';

        // 출처 관리 상태
        const defaultSources = ['dart', 'darkReport', 'policy', 'paper', 'patent', 'sec', 'edinet'];
        let activeSources = [...defaultSources];
        let tempActiveSources = [...defaultSources]; // 임시 선택 상태
        let customSources = {}; // { key: { name: '출처명' } }
        let customSourceData = {}; // { key: { name: '...', items: [...] } }
        let customEventData = {}; // { key: { 'YYYY-MM': [...] } }

        // 이벤트 데이터 (날짜별) - 확장된 구조
        const eventData = {
            dart: {
                '2022-01': [{
                    id: 'dart-2022-01-1',
                    title: '2021년 4분기 잠정실적 공시',
                    summary: ['매출 2.5조원 달성', '영업이익 6,500억원', '던전앤파이터 중국 매출 호조', '메이플스토리 안정적 성장', '해외 매출 비중 65%'],
                    content: `[공시 원문]

주식회사 넥슨코리아 (대표이사: 이정헌)

2021년 4분기 잠정실적 공시

1. 개요
당사는 2021년 제4분기(2021.10.01 ~ 2021.12.31) 잠정 연결재무제표를 다음과 같이 공시합니다.

2. 주요 재무현황
가. 매출액: 2조 5,000억원
   - 전년 동기 대비 8% 증가
   - PC 온라인 게임: 1조 3,750억원 (55%)
   - 모바일 게임: 8,750억원 (35%)
   - 콘솔/기타: 2,500억원 (10%)

나. 영업이익: 6,500억원
   - 전년 동기 대비 5% 증가
   - 영업이익률: 26.0%

다. 당기순이익: 5,200억원
   - 전년 동기 대비 3% 증가

3. 주요 게임별 실적
가. 던전앤파이터
   - 중국 서비스 분기 매출 7,000억원
   - 신규 캐릭터 업데이트로 활성 유저 15% 증가

나. 메이플스토리
   - 국내 MMORPG 시장 점유율 1위 유지
   - 신규 콘텐츠 업데이트로 결제 유저 10% 증가

다. FC 온라인
   - 분기 매출 5,000억원
   - 시즌 업데이트 호조

4. 향후 전망
   - 2022년 상반기 신규 게임 출시 예정
   - 글로벌 시장 확대 지속
   - 메타버스 및 NFT 관련 사업 검토 중

본 잠정실적은 외부감사인의 감사가 완료되지 않은 상태에서 작성되었으며, 확정 실적과 차이가 있을 수 있습니다.

2022년 1월 15일
주식회사 넥슨코리아`,
                    charts: [
                        {
                            title: '분기별 매출 추이 (억원)',
                            type: 'column',
                            data: [
                                { name: 'Q1', y: 21000 },
                                { name: 'Q2', y: 22000 },
                                { name: 'Q3', y: 23000 },
                                { name: 'Q4', y: 25000 }
                            ]
                        },
                        {
                            title: '게임별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '메이플', y: 32 },
                                { name: '던파', y: 28 },
                                { name: 'FC온라인', y: 20 },
                                { name: '기타', y: 20 }
                            ]
                        }
                    ],
                    date: '2022-01-15',
                    analysis: `## 데이터 기반 평가

**실적 평가: 양호 (★★★★☆)**

2021년 4분기 실적은 예상치에 부합하는 안정적인 실적을 기록했습니다.

### 핵심 지표 분석

| 지표 | 실적 | 전년비 | 평가 |
|------|------|--------|------|
| 매출 | 2.5조 | +8% | 양호 |
| 영업이익 | 6,500억 | +5% | 안정 |
| 영업이익률 | 26% | -1%p | 유지 |

### 성장 동력
1. **던전앤파이터**: 중국 시장 매출 안정적 유지
2. **메이플스토리**: 국내 MMORPG 1위 지속
3. **FC온라인**: e스포츠 연계 마케팅 효과

### 투자 의견
안정적인 실적 기반으로 2022년 성장 기대. 신작 파이프라인 확충 필요.`
                }],
                '2022-02': [{
                    id: 'dart-2022-02-1',
                    title: '2021년 사업보고서 제출',
                    summary: ['연간 총 매출 8.5조원', '해외 매출 비중 68%', '신규 IP 개발 투자'],
                    charts: [],
                    date: '2022-02-28'
                }],
                '2022-03': [],
                '2022-04': [{
                    id: 'dart-2022-04-1',
                    title: '2022년 1분기 분기보고서',
                    summary: ['매출 2.3조원', '영업이익 5,800억원', '메이플스토리 리마스터 효과', '블루아카이브 글로벌 출시', '신규 유저 유입 증가'],
                    content: `[공시 원문]

주식회사 넥슨코리아 (대표이사: 이정헌)

2022년 1분기 분기보고서

Ⅰ. 회사의 개요
1. 회사의 개요
   - 상호: 주식회사 넥슨코리아
   - 설립일: 2002년 5월 15일
   - 본점 소재지: 경기도 성남시 분당구 판교로 256번길 7

Ⅱ. 사업의 내용
당사는 온라인/모바일 게임 개발 및 퍼블리싱을 주요 사업으로 영위하고 있습니다.

Ⅲ. 재무에 관한 사항
1. 요약 연결재무정보 (단위: 억원)

   가. 매출액: 23,000
      - 게임 매출: 22,310 (97%)
      - 기타 매출: 690 (3%)

   나. 영업이익: 5,800
      - 영업이익률: 25.2%

   다. 법인세비용차감전순이익: 6,100

   라. 당기순이익: 4,880

2. 부문별 매출 현황
   가. PC 온라인: 12,650억원 (55%)
   나. 모바일: 8,050억원 (35%)
   다. 콘솔/기타: 2,300억원 (10%)

3. 주요 게임별 실적
   가. 메이플스토리
      - 리마스터 업데이트 효과로 전분기 대비 매출 12% 증가
      - 복귀 유저 캠페인 성공

   나. 블루 아카이브
      - 글로벌 서비스 확대
      - 일본 시장 매출 급성장

   다. 던전앤파이터
      - 중국 매출 안정적 유지

Ⅳ. 감사인의 의견
본 분기보고서는 외부감사인의 검토를 받았습니다.

2022년 4월 15일
주식회사 넥슨코리아`,
                    charts: [
                        {
                            title: '전년 동기 대비 (억원)',
                            type: 'comparison',
                            categories: ['매출', '영업이익'],
                            series: [
                                { name: '2021 Q1', data: [21000, 5500], color: '#5B9BD5' },
                                { name: '2022 Q1', data: [23000, 5800], color: '#E57B53' }
                            ]
                        },
                        {
                            title: '지역별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '한국', y: 32 },
                                { name: '중국', y: 30 },
                                { name: '일본', y: 22 },
                                { name: '기타', y: 16 }
                            ]
                        }
                    ],
                    date: '2022-04-15',
                    analysis: `## 데이터 기반 평가

**1분기 실적 평가: 긍정적 (★★★★☆)**

메이플스토리 리마스터 업데이트 효과로 견조한 실적 달성.

### 핵심 지표

| 지표 | Q1 2022 | Q1 2021 | 증감 |
|------|---------|---------|------|
| 매출 | 2.3조 | 2.1조 | +9.5% |
| 영업이익 | 5,800억 | 5,500억 | +5.5% |

### 주요 이슈
- 메이플스토리 대규모 리마스터로 복귀 유저 증가
- 블루아카이브 글로벌 서비스 확대
- 던파 모바일 중국 안정적 운영`
                }],
                '2022-05': [],
                '2022-06': [],
                '2022-07': [{
                    id: 'dart-2022-07-1',
                    title: '2022년 2분기 분기보고서',
                    summary: ['매출 2.4조원', '영업이익 6,200억원', 'FC온라인 시즌 업데이트 효과', '블루아카이브 1주년 이벤트', '해외 매출 성장 지속'],
                    charts: [
                        {
                            title: '2022년 상반기 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: 'Q1', y: 23000 },
                                { name: 'Q2', y: 24000 }
                            ]
                        },
                        {
                            title: '게임별 성장률 (%)',
                            type: 'comparison',
                            categories: ['FC온라인', '블루아카', '메이플'],
                            series: [
                                { name: '성장률', data: [15, 25, 8], color: '#E57B53' }
                            ]
                        },
                        {
                            title: '플랫폼별 매출',
                            type: 'pie',
                            data: [
                                { name: 'PC', y: 55 },
                                { name: '모바일', y: 35 },
                                { name: '콘솔', y: 10 }
                            ]
                        }
                    ],
                    date: '2022-07-15',
                    analysis: `## 데이터 기반 평가

**2분기 실적 평가: 우수 (★★★★☆)**

FC온라인 시즌 업데이트와 블루아카이브 1주년 효과로 전분기 대비 성장.

### 핵심 지표

| 지표 | Q2 2022 | Q1 2022 | 증감 |
|------|---------|---------|------|
| 매출 | 2.4조 | 2.3조 | +4.3% |
| 영업이익 | 6,200억 | 5,800억 | +6.9% |
| 영업이익률 | 25.8% | 25.2% | +0.6%p |

### 성장 포인트
1. **FC온라인**: 2022 시즌 업데이트 흥행
2. **블루아카이브**: 1주년 이벤트로 일본 매출 급증
3. **던파 모바일**: 중국 신규 콘텐츠 반응 호조`
                }],
                '2022-08': [],
                '2022-09': [],
                '2022-10': [{
                    id: 'dart-2022-10-1',
                    title: '2022년 3분기 분기보고서',
                    summary: ['매출 2.6조원', '영업이익 6,800억원', '블루아카이브 글로벌 성장', '던파 신규 직업 업데이트', '월드컵 시즌 기대감'],
                    charts: [
                        {
                            title: '2022년 분기별 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: 'Q1', y: 23000 },
                                { name: 'Q2', y: 24000 },
                                { name: 'Q3', y: 26000 }
                            ]
                        },
                        {
                            title: '영업이익률 추이 (%)',
                            type: 'line',
                            data: [
                                { name: 'Q1', y: 25.2 },
                                { name: 'Q2', y: 25.8 },
                                { name: 'Q3', y: 26.2 }
                            ]
                        },
                        {
                            title: '신규 vs 기존 IP',
                            type: 'pie',
                            data: [
                                { name: '기존 IP', y: 82 },
                                { name: '신규 IP', y: 18 }
                            ]
                        }
                    ],
                    date: '2022-10-15',
                    analysis: `## 데이터 기반 평가

**3분기 실적 평가: 매우 긍정적 (★★★★★)**

블루아카이브 글로벌 성장과 던파 업데이트로 연간 최고 분기 실적 달성.

### 핵심 지표

| 지표 | Q3 2022 | Q2 2022 | 증감 |
|------|---------|---------|------|
| 매출 | 2.6조 | 2.4조 | +8.3% |
| 영업이익 | 6,800억 | 6,200억 | +9.7% |

### 하이라이트
1. **블루아카이브**: 일본 앱스토어 10위권 안착
2. **던파**: 신규 직업 출시로 중국 매출 증가
3. **FC온라인**: 월드컵 시즌 앞두고 기대감 상승

### 연간 전망
9.8조원 연간 매출 달성 가능성 높음. 4분기 월드컵 효과 기대.`
                }],
                '2022-11': [],
                '2022-12': [{
                    id: 'dart-2022-12-1',
                    title: '2022년 4분기 잠정실적 공시',
                    summary: ['매출 2.8조원 예상', '연간 매출 9.8조원 전망', '신작 개발 진행'],
                    charts: [],
                    date: '2022-12-20'
                }],
                '2023-01': [{
                    id: 'dart-2023-01-1',
                    title: '2022년 4분기 잠정실적 공시',
                    summary: ['매출 2.8조원 달성', '영업이익 7,200억원', '연간 매출 9.8조원 확정', 'FC온라인 월드컵 효과', '역대 최고 4분기 실적'],
                    content: `[공시 원문]

주식회사 넥슨코리아 (대표이사: 이정헌)

2022년 4분기 및 연간 잠정실적 공시

1. 개요
당사는 2022년 제4분기(2022.10.01 ~ 2022.12.31) 및 연간 잠정 연결재무제표를 다음과 같이 공시합니다.

2. 2022년 4분기 재무현황 (단위: 억원)
가. 매출액: 28,000
   - 전년 동기 대비 12% 증가
   - 역대 최고 4분기 실적 달성

나. 영업이익: 7,200
   - 전년 동기 대비 10.8% 증가
   - 영업이익률: 25.7%

다. 당기순이익: 5,760

3. 2022년 연간 실적 요약 (단위: 억원)
가. 매출액: 98,000
   - 전년(85,000) 대비 15.3% 증가
   - 역대 최고 연간 매출 달성

나. 영업이익: 26,800
   - 전년(22,000) 대비 21.8% 증가
   - 영업이익률: 27.3%

다. 해외 매출 비중: 70%

4. 4분기 주요 성과
가. FC 온라인
   - 카타르 월드컵 연계 이벤트 대성공
   - 월드컵 기간 동시 접속자 200% 증가
   - 분기 매출 7,840억원 (전분기 대비 30% 증가)

나. 메이플스토리
   - 겨울 대규모 업데이트 호조
   - 분기 매출 8,400억원 (전년 동기 대비 8% 증가)

다. 던전앤파이터
   - 연말 시즌 이벤트 성공
   - 분기 매출 7,000억원

라. 블루아카이브
   - 하프 애니버서리 이벤트
   - 분기 매출 2,800억원

5. 2023년 전망
   - 연간 매출 10조원 돌파 목표
   - 퍼스트 디센던트 개발 순조로운 진행
   - 글로벌 신작 라인업 확대 예정

본 잠정실적은 외부감사인의 감사가 완료되지 않은 상태에서 작성되었으며, 확정 실적과 차이가 있을 수 있습니다.

2023년 1월 15일
주식회사 넥슨코리아`,
                    charts: [
                        {
                            title: '2022년 분기별 실적 (억원)',
                            type: 'waterfall',
                            data: [
                                { name: 'Q1', y: 23000, color: '#4ECDC4' },
                                { name: 'Q2 증가', y: 1000, color: '#4ECDC4' },
                                { name: 'Q3 증가', y: 2000, color: '#4ECDC4' },
                                { name: 'Q4 증가', y: 2000, color: '#4ECDC4' },
                                { name: '연간', isSum: true, color: '#E57B53' }
                            ]
                        },
                        {
                            title: '전년 대비 성장률',
                            type: 'comparison',
                            categories: ['매출', '영업이익'],
                            series: [
                                { name: '2021', data: [85000, 22000], color: '#5B9BD5' },
                                { name: '2022', data: [98000, 26800], color: '#E57B53' }
                            ]
                        },
                        {
                            title: '4분기 게임별 기여도',
                            type: 'pie',
                            data: [
                                { name: 'FC온라인', y: 28 },
                                { name: '메이플', y: 30 },
                                { name: '던파', y: 25 },
                                { name: '기타', y: 17 }
                            ]
                        }
                    ],
                    date: '2023-01-15',
                    analysis: `## 데이터 기반 평가

**4분기 실적 평가: 최고 수준 (★★★★★)**

월드컵 효과와 연말 이벤트로 역대 최고 4분기 실적 달성.

### 연간 실적 요약

| 지표 | 2022년 | 2021년 | 성장률 |
|------|--------|--------|--------|
| 매출 | 9.8조 | 8.5조 | +15.3% |
| 영업이익 | 2.68조 | 2.2조 | +21.8% |
| 영업이익률 | 27.3% | 25.9% | +1.4%p |

### 2022년 성과
1. **FC온라인**: 월드컵 연계 이벤트 대성공
2. **블루아카이브**: 신규 캐시카우로 자리매김
3. **던파 모바일**: 중국 안정적 매출 유지

### 2023년 전망
10조원 매출 돌파 기대. 신작 퍼스트 디센던트 개발 진행.`
                }],
                '2023-02': [{
                    id: 'dart-2023-02-1',
                    title: '2022년 사업보고서 제출',
                    summary: ['연간 총 매출 9.8조원', '해외 매출 비중 70%', '퍼스트 디센던트 개발 발표'],
                    charts: [],
                    date: '2023-02-28'
                }],
                '2023-03': [],
                '2023-04': [{
                    id: 'dart-2023-04-1',
                    title: '2023년 1분기 분기보고서',
                    summary: ['매출 2.8조원', '영업이익 6,800억원', '블루아카이브 일본 매출 상승', '메이플스토리 신규 콘텐츠', '퍼스트 디센던트 개발 진행'],
                    charts: [
                        {
                            title: '전년 동기 대비 (억원)',
                            type: 'comparison',
                            categories: ['매출', '영업이익'],
                            series: [
                                { name: 'Q1 2022', data: [23000, 5800], color: '#5B9BD5' },
                                { name: 'Q1 2023', data: [28000, 6800], color: '#E57B53' }
                            ]
                        },
                        {
                            title: '일본 시장 성장',
                            type: 'line',
                            data: [
                                { name: 'Q1 2022', y: 4500 },
                                { name: 'Q2 2022', y: 4800 },
                                { name: 'Q3 2022', y: 5200 },
                                { name: 'Q4 2022', y: 5500 },
                                { name: 'Q1 2023', y: 6200 }
                            ]
                        },
                        {
                            title: '주요 게임 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '메이플', y: 33 },
                                { name: '던파', y: 26 },
                                { name: 'FC온라인', y: 18 },
                                { name: '블루아카', y: 12 },
                                { name: '기타', y: 11 }
                            ]
                        }
                    ],
                    date: '2023-04-15',
                    analysis: `## 데이터 기반 평가

**1분기 실적 평가: 긍정적 (★★★★☆)**

전년 동기 대비 21.7% 성장하며 연간 성장 기조 유지.

### 핵심 지표

| 지표 | Q1 2023 | Q1 2022 | 증감 |
|------|---------|---------|------|
| 매출 | 2.8조 | 2.3조 | +21.7% |
| 영업이익 | 6,800억 | 5,800억 | +17.2% |
| 일본매출 | 6,200억 | 4,500억 | +37.8% |

### 성장 동력
1. **블루아카이브**: 일본 서브컬처 시장 선두
2. **메이플스토리**: 20주년 앞두고 신규 콘텐츠 강화
3. **글로벌 확장**: 해외 매출 비중 72%로 증가`
                }],
                '2023-05': [],
                '2023-06': [],
                '2023-07': [{
                    id: 'dart-2023-07-1',
                    title: '2023년 2분기 분기보고서',
                    summary: ['매출 2.9조원', '영업이익 7,500억원', '던파 모바일 중국 호조', '블루아카이브 1.5주년', '퍼스트 디센던트 CBT 예정'],
                    charts: [
                        {
                            title: '2023년 상반기 실적 (억원)',
                            type: 'column',
                            data: [
                                { name: 'Q1', y: 28000 },
                                { name: 'Q2', y: 29000 }
                            ]
                        },
                        {
                            title: '중국 매출 추이 (억원)',
                            type: 'line',
                            data: [
                                { name: 'Q4 2022', y: 8500 },
                                { name: 'Q1 2023', y: 8800 },
                                { name: 'Q2 2023', y: 9500 }
                            ]
                        },
                        {
                            title: '지역별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '한국', y: 25 },
                                { name: '중국', y: 33 },
                                { name: '일본', y: 24 },
                                { name: '기타', y: 18 }
                            ]
                        }
                    ],
                    date: '2023-07-15',
                    analysis: `## 데이터 기반 평가

**2분기 실적 평가: 우수 (★★★★☆)**

던파 모바일 신규 콘텐츠와 블루아카이브 1.5주년으로 실적 성장 지속.

### 핵심 지표

| 지표 | Q2 2023 | Q1 2023 | 증감 |
|------|---------|---------|------|
| 매출 | 2.9조 | 2.8조 | +3.6% |
| 영업이익 | 7,500억 | 6,800억 | +10.3% |
| 중국매출 | 9,500억 | 8,800억 | +8.0% |

### 주요 이슈
1. **던파 모바일**: 신규 직업 업데이트로 중국 매출 급증
2. **블루아카이브**: 1.5주년 이벤트 대성공
3. **퍼스트 디센던트**: 하반기 CBT 진행 예정`
                }],
                '2023-08': [],
                '2023-09': [],
                '2023-10': [{
                    id: 'dart-2023-10-1',
                    title: '2023년 3분기 분기보고서',
                    summary: ['매출 3.0조원', '영업이익 8,000억원', '메이플스토리 20주년 준비', '퍼스트 디센던트 CBT 성공', '연간 12조원 달성 전망'],
                    charts: [
                        {
                            title: '2023년 분기별 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: 'Q1', y: 28000 },
                                { name: 'Q2', y: 29000 },
                                { name: 'Q3', y: 30000 }
                            ]
                        },
                        {
                            title: '영업이익률 추이 (%)',
                            type: 'line',
                            data: [
                                { name: 'Q1', y: 24.3 },
                                { name: 'Q2', y: 25.9 },
                                { name: 'Q3', y: 26.7 }
                            ]
                        },
                        {
                            title: '신작 개발 현황',
                            type: 'pie',
                            data: [
                                { name: '퍼스트디센던트', y: 40 },
                                { name: '기타 신작', y: 35 },
                                { name: '기존IP 업뎃', y: 25 }
                            ]
                        }
                    ],
                    date: '2023-10-15',
                    analysis: `## 데이터 기반 평가

**3분기 실적 평가: 매우 긍정적 (★★★★★)**

3분기 연속 성장하며 연간 12조원 매출 달성 확실시.

### 핵심 지표

| 지표 | Q3 2023 | Q2 2023 | 증감 |
|------|---------|---------|------|
| 매출 | 3.0조 | 2.9조 | +3.4% |
| 영업이익 | 8,000억 | 7,500억 | +6.7% |
| 영업이익률 | 26.7% | 25.9% | +0.8%p |

### 성장 포인트
1. **메이플스토리**: 20주년 이벤트 준비로 기대감 상승
2. **퍼스트 디센던트**: CBT 호평, 2024년 출시 확정
3. **블루아카이브**: 애니메이션 발표로 IP 확장

### 2024년 전망
퍼스트 디센던트 출시로 신규 성장 동력 확보 기대.`
                }],
                '2023-11': [],
                '2023-12': [{
                    id: 'dart-2023-12-1',
                    title: '2023년 4분기 잠정실적 공시',
                    summary: ['매출 3.2조원 예상', '연간 매출 11.97조원 전망', '퍼스트 디센던트 출시 예정'],
                    charts: [],
                    date: '2023-12-20'
                }],
                '2024-01': [{
                    id: 'dart-2024-01-1',
                    title: '2023년 4분기 잠정실적 공시',
                    summary: [
                        '매출 3.2조원 달성 (전년 동기 대비 12% 증가)',
                        '영업이익 8,500억원 (영업이익률 26.6%)',
                        '메이플스토리, 던전앤파이터 매출 견조',
                        'FC온라인 시즌 매출 호조',
                        '중국 던파 모바일 월 매출 2,000억원 추정',
                        '블루아카이브 일본 매출 상승세 지속',
                        '퍼스트 디센던트 개발 진행률 85%',
                        '2024년 연간 매출 가이던스 상향 조정',
                        '현금성 자산 5조원 돌파',
                        '배당금 증가 및 자사주 매입 계획 발표',
                        '게임 라이브 서비스 모델 전환 가속화',
                        '글로벌 e스포츠 투자 확대 전략 수립'
                    ],
                    charts: [
                        {
                            title: '분기별 실적 흐름 (억원)',
                            type: 'waterfall',
                            data: [
                                { name: 'Q1', y: 28000, color: '#4ECDC4' },
                                { name: 'Q2 증가', y: 1500, color: '#4ECDC4' },
                                { name: 'Q3 증가', y: 700, color: '#4ECDC4' },
                                { name: 'Q4 증가', y: 1800, color: '#4ECDC4' },
                                { name: '연간', isSum: true, color: '#E57B53' }
                            ]
                        },
                        {
                            title: '성장률 비교',
                            type: 'comparison',
                            categories: ['매출성장률', '영업이익률'],
                            series: [
                                { name: '넥슨', data: [12, 26.6], color: '#E57B53' },
                                { name: '업계평균', data: [8, 18], color: '#5B9BD5' }
                            ]
                        },
                        {
                            title: '게임별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '메이플', y: 35 },
                                { name: '던파', y: 25 },
                                { name: 'FC온라인', y: 22 },
                                { name: '기타', y: 18 }
                            ]
                        }
                    ],
                    date: '2024-01-15',
                    analysis: `## 데이터 기반 평가

**실적 평가: 긍정적 (★★★★☆)**

2023년 4분기 실적은 시장 예상치를 상회하는 호실적을 기록했습니다. 매출 3.2조원은 전년 동기 대비 12% 성장으로, 게임업계 평균 성장률(8%)을 크게 웃도는 수치입니다.

### 핵심 지표 분석

| 지표 | 실적 | 업계평균 | 평가 |
|------|------|---------|------|
| 매출성장률 | 12% | 8% | 우수 |
| 영업이익률 | 26.6% | 18% | 최상위권 |
| ROE | 18.2% | 12% | 양호 |

### 성장 동력
1. **메이플스토리**: 20주년 이벤트 효과로 복귀 유저 급증
2. **던전앤파이터**: 중국 모바일 버전 월 매출 2,000억원 추정
3. **FC온라인**: 시즌 전환 효과로 과금 유저 증가

### 리스크 요인
- 중국 게임 규제 불확실성 지속
- 신작 퍼스트 디센던트 출시 지연 가능성
- 원/엔 환율 변동에 따른 일본 매출 영향

### 투자 의견
현재 주가 대비 적정 가치 평가. 2024년 신작 출시 일정에 따라 추가 상승 여력 존재. 다만 중국 리스크 모니터링 필요.`
                },
                {
                    id: 'dart-2024-01-2',
                    title: '주요사항보고서(유상증자)',
                    summary: ['유상증자 500억원 결정', '신주 발행가 50,000원'],
                    charts: [],
                    date: '2024-01-20'
                },
                {
                    id: 'dart-2024-01-3',
                    title: '임원보수한도 승인의 건',
                    summary: ['이사보수 한도 30억원', '감사보수 한도 5억원'],
                    charts: [],
                    date: '2024-01-25'
                },
                {
                    id: 'dart-2024-01-4',
                    title: '자기주식 처분결과 보고서',
                    summary: ['자기주식 100만주 처분', '처분금액 500억원'],
                    charts: [],
                    date: '2024-01-28'
                }],
                '2024-02': [{
                    id: 'dart-2024-02-1',
                    title: '2023년 사업보고서 제출',
                    summary: [
                        '연간 총 매출 11.97조원 기록',
                        '해외 매출 비중 75% 달성',
                        '신규 IP 개발 투자 확대',
                        '임직원 수 7,200명으로 증가'
                    ],
                    charts: [
                        {
                            title: '연간 매출 성장 (억원)',
                            type: 'waterfall',
                            data: [
                                { name: '2021', y: 85000, color: '#4ECDC4' },
                                { name: '2022 증가', y: 13000, color: '#4ECDC4' },
                                { name: '2023 증가', y: 21700, color: '#4ECDC4' },
                                { name: '누적', isSum: true, color: '#E57B53' }
                            ]
                        },
                        {
                            title: '매출 지역별 비중 (%)',
                            type: 'pie',
                            data: [
                                { name: '국내', y: 25 },
                                { name: '해외', y: 75 }
                            ]
                        },
                        {
                            title: '연간 성장률 비교',
                            type: 'comparison',
                            categories: ['매출성장률', '인력성장률'],
                            series: [
                                { name: '넥슨', data: [22.2, 5.9], color: '#E57B53' },
                                { name: '업계평균', data: [12, 3], color: '#5B9BD5' }
                            ]
                        }
                    ],
                    date: '2024-02-28',
                    analysis: `## 데이터 기반 평가

**연간 실적 평가: 매우 긍정적 (★★★★★)**

2023년 연간 실적은 역대 최고 수준을 기록했습니다. 매출 11.97조원은 전년 대비 22.2% 성장으로, 게임업계 내 압도적인 성과입니다.

### 핵심 지표 분석

| 지표 | 2023년 | 2022년 | 성장률 |
|------|--------|--------|--------|
| 매출 | 11.97조 | 9.8조 | +22.2% |
| 영업이익 | 3.2조 | 2.5조 | +28% |
| 해외비중 | 75% | 70% | +5%p |

### 성장 포인트
1. **글로벌 확장**: 해외 매출 비중 75%로 국내 의존도 감소
2. **포트폴리오 다각화**: 신규 IP 투자로 리스크 분산
3. **인력 확충**: 개발 역량 강화를 위한 적극적 채용

### 향후 전망
2024년은 퍼스트 디센던트 출시와 기존 IP 업데이트로 추가 성장 기대. 다만 인건비 상승에 따른 수익성 관리 필요.`
                },
                {
                    id: 'dart-2024-02-2',
                    title: '정기주주총회 소집공고',
                    summary: ['제27기 정기주주총회 개최 안내', '배당금 지급 안건 상정'],
                    charts: [],
                    date: '2024-02-15'
                },
                {
                    id: 'dart-2024-02-3',
                    title: '감사보고서 제출',
                    summary: ['외부감사인 적정의견', '내부회계관리제도 적정'],
                    charts: [],
                    date: '2024-02-20'
                }],
                '2024-03': [],
                '2024-04': [{
                    id: 'dart-2024-04-1',
                    title: '2024년 1분기 분기보고서',
                    summary: [
                        '매출 3.1조원 (전년 동기 대비 8% 증가)',
                        '영업이익 7,800억원',
                        '블루아카이브 글로벌 성장세',
                        '신작 퍼스트 디센던트 개발 진행 중'
                    ],
                    charts: [
                        {
                            title: '분기 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: 'Q1 2023', y: 28000 },
                                { name: 'Q1 2024', y: 31000 }
                            ]
                        },
                        {
                            title: '게임별 매출 비중 (%)',
                            type: 'pie',
                            data: [
                                { name: '메이플', y: 35 },
                                { name: '던파', y: 25 },
                                { name: 'FC온라인', y: 20 },
                                { name: '기타', y: 20 }
                            ]
                        },
                        {
                            title: '영업이익 추이 (억원)',
                            type: 'line',
                            data: [
                                { name: 'Q1 2023', y: 6800 },
                                { name: 'Q1 2024', y: 7800 }
                            ]
                        }
                    ],
                    date: '2024-04-15',
                    analysis: `## 데이터 기반 평가

**1분기 실적 평가: 긍정적 (★★★★☆)**

2024년 1분기 실적은 전년 동기 대비 8% 성장하며 안정적인 출발을 보였습니다.

### 핵심 지표 분석

| 지표 | Q1 2024 | Q1 2023 | 증감 |
|------|---------|---------|------|
| 매출 | 3.1조 | 2.8조 | +10.7% |
| 영업이익 | 7,800억 | 6,800억 | +14.7% |
| 영업이익률 | 25.2% | 24.3% | +0.9%p |

### 주요 분석
1. **블루아카이브**: 일본 시장에서 지속적인 성장세
2. **퍼스트 디센던트**: CBT 반응 긍정적, 7월 출시 예정
3. **FC온라인**: 시즌 업데이트로 매출 유지

### 투자 포인트
신작 출시 전 안정적인 기존 IP 매출 유지. 하반기 퍼스트 디센던트 출시에 따른 실적 개선 기대.`
                }],
                '2024-05': [{
                    id: 'dart-2024-05-1',
                    title: '주요사항보고서(자기주식취득)',
                    summary: [
                        '자기주식 500억원 규모 취득 결정',
                        '주주가치 제고 목적',
                        '취득 기간: 2024.05 ~ 2024.08',
                        '취득 방법: 장내 매수'
                    ],
                    charts: [
                        {
                            title: '자사주 매입 규모 (억원)',
                            type: 'column',
                            data: [
                                { name: '2022', y: 300 },
                                { name: '2023', y: 400 },
                                { name: '2024', y: 500 }
                            ]
                        },
                        {
                            title: '주주환원율 (%)',
                            type: 'line',
                            data: [
                                { name: '2022', y: 15 },
                                { name: '2023', y: 18 },
                                { name: '2024', y: 22 }
                            ]
                        },
                        {
                            title: '자사주 비중 (%)',
                            type: 'pie',
                            data: [
                                { name: '유통주식', y: 92 },
                                { name: '자사주', y: 8 }
                            ]
                        }
                    ],
                    date: '2024-05-10'
                }],
                '2024-06': [],
                '2024-07': [{
                    id: 'dart-2024-07-1',
                    title: '2024년 2분기 분기보고서',
                    summary: [
                        '매출 3.3조원 (전분기 대비 6% 증가)',
                        '영업이익 8,200억원',
                        '퍼스트 디센던트 출시 효과',
                        '중국 시장 매출 회복세'
                    ],
                    charts: [
                        {
                            title: '2024년 분기별 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: 'Q1', y: 31000 },
                                { name: 'Q2', y: 33000 }
                            ]
                        },
                        {
                            title: '영업이익률 (%)',
                            type: 'line',
                            data: [
                                { name: 'Q1', y: 25.2 },
                                { name: 'Q2', y: 24.8 }
                            ]
                        },
                        {
                            title: '지역별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '한국', y: 22 },
                                { name: '중국', y: 35 },
                                { name: '일본', y: 25 },
                                { name: '기타', y: 18 }
                            ]
                        }
                    ],
                    date: '2024-07-15',
                    analysis: `## 데이터 기반 평가

**2분기 실적 평가: 매우 긍정적 (★★★★★)**

퍼스트 디센던트 출시 효과와 중국 시장 회복으로 예상을 뛰어넘는 실적 달성.

### 핵심 지표 분석

| 지표 | Q2 2024 | Q1 2024 | 증감 |
|------|---------|---------|------|
| 매출 | 3.3조 | 3.1조 | +6.5% |
| 영업이익 | 8,200억 | 7,800억 | +5.1% |
| 중국 비중 | 35% | 32% | +3%p |

### 성장 동력
1. **퍼스트 디센던트**: 7월 출시 직후 글로벌 흥행
2. **던파 중국**: 신규 직업 업데이트로 매출 급증
3. **블루아카이브**: 2주년 이벤트 성공

### 시장 반응
출시 첫 주 스팀 동시접속 26만명 달성. 글로벌 루터슈터 시장 진입 성공으로 평가.`
                }],
                '2024-08': [],
                '2024-09': [],
                '2024-10': [{
                    id: 'dart-2024-10-1',
                    title: '2024년 3분기 분기보고서',
                    summary: [
                        '매출 3.5조원 (전분기 대비 6% 증가)',
                        '영업이익 9,100억원 (역대 최고)',
                        '퍼스트 디센던트 누적 매출 3,000억원',
                        '블루아카이브 일본 매출 1위 달성'
                    ],
                    charts: [
                        {
                            title: '2024년 분기별 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: 'Q1', y: 31000 },
                                { name: 'Q2', y: 33000 },
                                { name: 'Q3', y: 35000 }
                            ]
                        },
                        {
                            title: '영업이익률 (%)',
                            type: 'line',
                            data: [
                                { name: 'Q1', y: 25.2 },
                                { name: 'Q2', y: 24.8 },
                                { name: 'Q3', y: 26.0 }
                            ]
                        },
                        {
                            title: '신작 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '퍼스트디센던트', y: 25 },
                                { name: '기존 IP', y: 75 }
                            ]
                        }
                    ],
                    date: '2024-10-15',
                    analysis: `## 데이터 기반 평가

**3분기 실적 평가: 최고 수준 (★★★★★)**

역대 최고 분기 영업이익 달성. 퍼스트 디센던트 누적 매출 3,000억원 돌파.

### 핵심 지표 분석

| 지표 | Q3 2024 | Q2 2024 | 증감 |
|------|---------|---------|------|
| 매출 | 3.5조 | 3.3조 | +6.1% |
| 영업이익 | 9,100억 | 8,200억 | +11% |
| 영업이익률 | 26.0% | 24.8% | +1.2%p |

### 성공 요인
1. **퍼스트 디센던트**: 시즌1 업데이트로 유저 리텐션 유지
2. **블루아카이브**: 일본 매출 1위 달성
3. **메이플스토리**: 20주년 이벤트 흥행

### 신작 기여도
퍼스트 디센던트가 전체 매출의 25%를 차지하며 신규 캐시카우로 자리매김.`
                }],
                '2024-11': [],
                '2024-12': [{
                    id: 'dart-2024-12-1',
                    title: '2024년 4분기 잠정실적 공시',
                    content: `[잠정실적(공정공시)]

1. 실적 개요
   - 대상기간: 2024년 4분기 (2024.10.01 ~ 2024.12.31)
   - 공시일: 2024년 12월 20일

2. 잠정 실적 (연결기준)

   구분           당분기         전분기         전년동기
   ─────────────────────────────────────────────────────
   매출액         3.8조원        3.5조원        3.2조원
   영업이익       1.0조원        0.91조원       0.82조원
   영업이익률     26.3%          26.0%          25.6%
   당기순이익     0.8조원        0.73조원       0.65조원

3. 2024년 연간 실적 (잠정)

   구분           2024년(E)      2023년         증감률
   ─────────────────────────────────────────────────────
   매출액         13.7조원       12.0조원       +14.2%
   영업이익       3.6조원        3.0조원        +20.0%
   당기순이익     2.9조원        2.4조원        +20.8%

4. 주요 성과

   [게임별 실적]
   • 메이플스토리: 20주년 효과 지속, 연간 매출 역대 최고
   • 던전앤파이터: 중국 시장 안정적 성과 유지
   • FC온라인: EA스포츠FC25 성공적 전환
   • 퍼스트디센던트: 시즌2 업데이트로 매출 반등
   • 블루아카이브: 일본 시장 매출 1위 다수 달성

   [지역별 매출 비중]
   • 한국: 41% (전년비 +3%p)
   • 중국: 26% (전년비 -2%p)
   • 일본: 17% (전년비 +1%p)
   • 북미/유럽: 12% (전년비 +2%p)
   • 기타: 4%

5. 2025년 전망

   • 신작 출시 예정: 프로젝트 매그넘, 드래곤하운드 등
   • 기존 IP 확장: 메이플스토리 유니버스 확대
   • 글로벌 시장 공략 강화
   • 자사주 매입 프로그램 지속 (500억엔 규모)

6. 기타 참고사항
   - 상기 실적은 잠정치이며, 외부감사인의 회계감사 결과에 따라 변동될 수 있습니다.
   - 확정 실적은 2025년 2월 사업보고서를 통해 공시 예정입니다.`,
                    summary: [
                        '매출 3.8조원 (역대 최고 분기 실적)',
                        '영업이익 1조원 돌파',
                        '연간 총 매출 13.7조원 전망',
                        '2025년 신작 라인업 발표 예정'
                    ],
                    charts: [
                        {
                            title: '2024년 분기별 실적 흐름 (억원)',
                            type: 'waterfall',
                            data: [
                                { name: 'Q1', y: 31000, color: '#4ECDC4' },
                                { name: 'Q2 증가', y: 2000, color: '#4ECDC4' },
                                { name: 'Q3 증가', y: 2000, color: '#4ECDC4' },
                                { name: 'Q4 증가', y: 3000, color: '#4ECDC4' },
                                { name: '연간', isSum: true, color: '#E57B53' }
                            ]
                        },
                        {
                            title: '전년 대비 성장률 (%)',
                            type: 'comparison',
                            categories: ['매출성장률', '영업이익률', 'ROE'],
                            series: [
                                { name: '넥슨', data: [14.5, 26.3, 18.2], color: '#4ECDC4' },
                                { name: '업계평균', data: [6.2, 15.8, 10.5], color: '#5B9BD5' }
                            ]
                        },
                        {
                            title: '게임별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '메이플', y: 32 },
                                { name: '던파', y: 28 },
                                { name: 'FC온라인', y: 18 },
                                { name: '퍼스트디센던트', y: 12 },
                                { name: '기타', y: 10 }
                            ]
                        }
                    ],
                    date: '2024-12-20',
                    analysis: `## 데이터 기반 평가

**연간 실적 평가: 역대 최고 (★★★★★)**

2024년 연간 매출 13.7조원으로 사상 최대 실적 달성 전망.

### 핵심 지표 분석

| 지표 | 2024년(E) | 2023년 | 증감 |
|------|-----------|--------|------|
| 매출 | 13.7조 | 11.97조 | +14.5% |
| 영업이익 | 3.5조 | 3.2조 | +9.4% |
| 영업이익률 | 26.3% | 26.7% | -0.4%p |

### 2024년 성과
1. **퍼스트 디센던트**: 신작 성공으로 글로벌 포트폴리오 다각화
2. **기존 IP 안정성**: 메이플, 던파 등 꾸준한 매출 유지
3. **일본 시장**: 블루아카이브 1위로 일본 내 입지 강화

### 2025년 전망
신작 라인업 발표 예정. 퍼스트 디센던트 시즌2, 메이플 신규 월드 등 기대작 다수.`
                }],
                '2025-01': [{
                    id: 'dart-2025-01-1',
                    title: '2024년 연간 실적 확정 공시',
                    content: '연간 매출 13.7조원, 영업이익 3.6조원 확정',
                    summary: ['연간 매출 13.7조원 확정', '영업이익 3.6조원'],
                    charts: [],
                    date: '2025-01-15'
                }],
                '2025-02': [{
                    id: 'dart-2025-02-1',
                    title: '2024년 사업보고서 제출',
                    content: '2024년 사업보고서 및 감사보고서 제출',
                    summary: ['사업보고서 제출', '외부감사 적정의견'],
                    charts: [],
                    date: '2025-02-28'
                }],
                '2025-03': [{
                    id: 'dart-2025-03-1',
                    title: '2025년 1분기 잠정실적 공시',
                    content: '1분기 매출 3.2조원, 영업이익 0.85조원',
                    summary: ['매출 3.2조원', '영업이익 0.85조원'],
                    charts: [],
                    date: '2025-03-20'
                }],
                '2025-04': [],
                '2025-05': [{
                    id: 'dart-2025-05-1',
                    title: '정기주주총회 결과 공시',
                    content: '이사 선임, 배당금 결정 등',
                    summary: ['배당금 주당 1,500원', '신규 사외이사 선임'],
                    charts: [],
                    date: '2025-05-15'
                }],
                '2025-06': [{
                    id: 'dart-2025-06-1',
                    title: '2025년 2분기 잠정실적 공시',
                    content: '2분기 매출 3.4조원, 영업이익 0.92조원',
                    summary: ['매출 3.4조원', '영업이익 0.92조원'],
                    charts: [],
                    date: '2025-06-20'
                }],
                '2025-07': [],
                '2025-08': [],
                '2025-09': [{
                    id: 'dart-2025-09-1',
                    title: '2025년 3분기 잠정실적 공시',
                    content: '3분기 매출 3.6조원, 영업이익 0.98조원',
                    summary: ['매출 3.6조원', '영업이익 0.98조원'],
                    charts: [],
                    date: '2025-09-20'
                }],
                '2025-10': [],
                '2025-11': [],
                '2025-12': [{
                    id: 'dart-2025-12-1',
                    title: '2025년 4분기 잠정실적 공시',
                    content: '4분기 매출 4.0조원, 영업이익 1.1조원 (역대 최고)',
                    summary: ['매출 4.0조원 (역대 최고)', '영업이익 1.1조원'],
                    charts: [],
                    date: '2025-12-20'
                }]
            },
            darkReport: {
                '2022-01': [],
                '2022-02': [{
                    id: 'dark-2022-02-1',
                    title: '던파 모바일 중국 매출 분석',
                    summary: ['던전앤파이터 모바일 중국 월 매출 1,500억원 추정', '텐센트 협력 효과'],
                    charts: [],
                    date: '2022-02-10'
                }],
                '2022-03': [],
                '2022-04': [{
                    id: 'dark-2022-04-1',
                    title: '메이플스토리 유저 분석',
                    summary: ['리마스터 업데이트 후 복귀 유저 증가', 'DAU 15% 상승', '신규 유저 유입률 개선', '결제 유저 비율 증가'],
                    charts: [
                        {
                            title: 'DAU 변화 (만명)',
                            type: 'column',
                            data: [
                                { name: '리마스터 전', y: 32 },
                                { name: '리마스터 후', y: 37 }
                            ]
                        },
                        {
                            title: '유저 유형별 비율',
                            type: 'pie',
                            data: [
                                { name: '복귀유저', y: 35 },
                                { name: '기존유저', y: 50 },
                                { name: '신규유저', y: 15 }
                            ]
                        }
                    ],
                    date: '2022-04-05',
                    analysis: `## 유저 분석 리포트

**업데이트 효과: 긍정적 (★★★★☆)**

리마스터 업데이트 후 DAU 15% 상승, 복귀 유저 비율 35% 기록.

### 주요 지표

| 지표 | 업데이트 전 | 업데이트 후 | 변화 |
|------|------------|------------|------|
| DAU | 32만 | 37만 | +15.6% |
| 결제율 | 8.2% | 9.5% | +1.3%p |
| ARPU | 15,000원 | 17,500원 | +16.7% |

### 시사점
리마스터 업데이트가 유저 복귀와 결제율 향상에 효과적임을 입증.`
                }],
                '2022-05': [],
                '2022-06': [{
                    id: 'dark-2022-06-1',
                    title: 'FC온라인 시즌 분석',
                    summary: ['월드컵 시즌 효과 예상', '과금 유저 증가 전망'],
                    charts: [],
                    date: '2022-06-15'
                }],
                '2022-07': [],
                '2022-08': [],
                '2022-09': [{
                    id: 'dark-2022-09-1',
                    title: '블루아카이브 글로벌 성장',
                    summary: ['일본 앱스토어 매출 10위권 진입', '2차 창작 커뮤니티 활성화'],
                    charts: [],
                    date: '2022-09-20'
                }],
                '2022-10': [],
                '2022-11': [],
                '2022-12': [{
                    id: 'dark-2022-12-1',
                    title: '넥슨 연간 전망',
                    summary: ['2022년 연간 매출 9.8조원 예상', '2023년 10조원 돌파 전망'],
                    charts: [],
                    date: '2022-12-15'
                }],
                '2023-01': [],
                '2023-02': [{
                    id: 'dark-2023-02-1',
                    title: '메이플스토리 매출 분석',
                    summary: ['20주년 이벤트 준비 중', '신규 콘텐츠 개발 진행'],
                    charts: [],
                    date: '2023-02-05'
                }],
                '2023-03': [{
                    id: 'dark-2023-03-1',
                    title: '던파 중국 규제 영향',
                    summary: ['미성년자 게임 시간 제한 영향 분석', '넥슨 중국 매출 영향 제한적'],
                    charts: [],
                    date: '2023-03-10'
                }],
                '2023-04': [],
                '2023-05': [{
                    id: 'dark-2023-05-1',
                    title: 'FC온라인 경쟁 분석',
                    summary: ['EA FC 출시 대응 전략', '국내 축구게임 점유율 75% 유지'],
                    charts: [],
                    date: '2023-05-20'
                }],
                '2023-06': [],
                '2023-07': [{
                    id: 'dark-2023-07-1',
                    title: '블루아카이브 1.5주년',
                    summary: ['일본 매출 급증', '글로벌 MAU 500만 돌파', '2차 창작 커뮤니티 활성화', '일본 앱스토어 5위권'],
                    charts: [
                        {
                            title: '월 매출 추이 (억원)',
                            type: 'column',
                            data: [
                                { name: '5월', y: 450 },
                                { name: '6월', y: 520 },
                                { name: '7월', y: 680 }
                            ]
                        },
                        {
                            title: 'MAU 추이 (만명)',
                            type: 'line',
                            data: [
                                { name: '1주년', y: 350 },
                                { name: '1.5주년', y: 500 }
                            ]
                        },
                        {
                            title: '지역별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: '일본', y: 55 },
                                { name: '한국', y: 20 },
                                { name: '글로벌', y: 25 }
                            ]
                        }
                    ],
                    date: '2023-07-10',
                    analysis: `## 블루아카이브 분석

**성장 평가: 매우 긍정적 (★★★★★)**

1.5주년 이벤트로 일본 시장에서 폭발적 성장 기록.

### 핵심 지표

| 지표 | 1주년 | 1.5주년 | 성장률 |
|------|-------|---------|--------|
| MAU | 350만 | 500만 | +42.9% |
| 월매출 | 450억 | 680억 | +51.1% |
| 일본순위 | 10위 | 5위 | +5 |

### 성공 요인
1. **2차 창작**: 동인 커뮤니티 활성화로 바이럴 효과
2. **캐릭터 IP**: 독보적인 일러스트 퀄리티
3. **이벤트 운영**: 유저 친화적 보상 정책`
                }],
                '2023-08': [],
                '2023-09': [{
                    id: 'dark-2023-09-1',
                    title: '퍼스트 디센던트 CBT 분석',
                    summary: ['베타 테스트 유저 반응 분석', '그래픽 호평, 최적화 개선 필요'],
                    charts: [],
                    date: '2023-09-15'
                }],
                '2023-10': [],
                '2023-11': [{
                    id: 'dark-2023-11-1',
                    title: '넥슨 하반기 전망',
                    summary: ['연간 매출 12조원 예상', '2024년 신작 기대감'],
                    charts: [],
                    date: '2023-11-10'
                }],
                '2023-12': [],
                '2024-01': [],
                '2024-02': [{
                    id: 'dark-2024-02-1',
                    title: '메이플 매출 하락 분석',
                    summary: [
                        '메이플스토리 1월 매출 전월 대비 15% 하락',
                        '신규 콘텐츠 부재로 유저 이탈 가속화',
                        '경쟁작 대비 업데이트 주기 늦어',
                        '20주년 이벤트로 반등 기대'
                    ],
                    charts: [
                        {
                            title: '월별 매출 추이 (억원)',
                            type: 'column',
                            data: [
                                { name: '11월', y: 1200 },
                                { name: '12월', y: 1400 },
                                { name: '1월', y: 1190 }
                            ]
                        },
                        {
                            title: 'DAU 추이 (만명)',
                            type: 'line',
                            data: [
                                { name: '11월', y: 45 },
                                { name: '12월', y: 52 },
                                { name: '1월', y: 38 }
                            ]
                        },
                        {
                            title: '경쟁작 대비 점유율',
                            type: 'pie',
                            data: [
                                { name: '메이플', y: 42 },
                                { name: '로아', y: 35 },
                                { name: '기타', y: 23 }
                            ]
                        }
                    ],
                    date: '2024-02-05',
                    analysis: `## 리스크 분석

**위험도 평가: 중간 (⚠️⚠️⚠️)**

메이플스토리 매출 하락은 일시적 현상으로 판단되나, 구조적 문제 가능성도 존재.

### 하락 요인 분석

| 요인 | 영향도 | 지속성 |
|------|--------|--------|
| 콘텐츠 부재 | 높음 | 단기 |
| 경쟁작 출시 | 중간 | 중기 |
| 유저 피로도 | 중간 | 장기 |

### 모니터링 포인트
- 20주년 이벤트 효과 확인 필요
- DAU 추이 지속 관찰
- 경쟁작 대비 점유율 변화

### 대응 전략 제언
신규 콘텐츠 업데이트 주기 단축 및 복귀 유저 이벤트 강화 필요.`
                }],
                '2024-03': [{
                    id: 'dark-2024-03-1',
                    title: '던파 중국 매출 추정',
                    summary: [
                        '던전앤파이터 모바일 중국 매출 월 2,000억원 추정',
                        '텐센트 협력으로 안정적 운영',
                        '신규 직업 업데이트로 매출 상승',
                        '규제 리스크는 제한적'
                    ],
                    charts: [
                        {
                            title: '월 매출 추정 (억원)',
                            type: 'column',
                            data: [
                                { name: '1월', y: 1800 },
                                { name: '2월', y: 2200 },
                                { name: '3월', y: 2000 }
                            ]
                        },
                        {
                            title: '중국 게임 순위',
                            type: 'line',
                            data: [
                                { name: '1월', y: 3 },
                                { name: '2월', y: 2 },
                                { name: '3월', y: 2 }
                            ]
                        },
                        {
                            title: '플랫폼별 비중',
                            type: 'pie',
                            data: [
                                { name: 'iOS', y: 45 },
                                { name: 'Android', y: 55 }
                            ]
                        }
                    ],
                    date: '2024-03-12'
                }],
                '2024-04': [{
                    id: 'dark-2024-04-1',
                    title: '블루아카이브 일본 시장 분석',
                    summary: ['일본 앱스토어 매출 5위권 유지', '일러스트 퀄리티로 2차 창작 활성화'],
                    charts: [],
                    date: '2024-04-05'
                },
                {
                    id: 'dark-2024-04-2',
                    title: '넥슨 인력 구조조정 루머',
                    summary: ['비용 절감 차원 구조조정 진행 추정', '개발 인력 영향은 제한적'],
                    charts: [],
                    date: '2024-04-10'
                },
                {
                    id: 'dark-2024-04-3',
                    title: '퍼스트 디센던트 CBT 분석',
                    summary: ['CBT 유저 피드백 분석', '최적화 이슈 개선 필요'],
                    charts: [],
                    date: '2024-04-15'
                },
                {
                    id: 'dark-2024-04-4',
                    title: '메이플스토리 네오 업데이트 반응',
                    summary: ['신규 콘텐츠 호평', 'DAU 20% 상승'],
                    charts: [],
                    date: '2024-04-20'
                },
                {
                    id: 'dark-2024-04-5',
                    title: '중국 게임 규제 영향 분석',
                    summary: ['미성년자 플레이 시간 제한 강화', '넥슨 중국 매출 영향 제한적'],
                    charts: [],
                    date: '2024-04-25'
                }],
                '2024-05': [{
                    id: 'dark-2024-05-1',
                    title: 'FC온라인 시즌 리포트',
                    summary: [
                        'FC온라인 시즌 전환기 매출 급증',
                        '월드컵 효과로 유저 유입 증가',
                        '경쟁작 EA FC 대비 국내 점유율 우위',
                        'e스포츠 투자 확대 전략'
                    ],
                    charts: [
                        {
                            title: '시즌별 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: '23시즌', y: 3200 },
                                { name: '24시즌', y: 3800 }
                            ]
                        },
                        {
                            title: '신규 유저 추이 (만명)',
                            type: 'line',
                            data: [
                                { name: '3월', y: 12 },
                                { name: '4월', y: 18 },
                                { name: '5월', y: 25 }
                            ]
                        },
                        {
                            title: '국내 축구게임 점유율',
                            type: 'pie',
                            data: [
                                { name: 'FC온라인', y: 72 },
                                { name: 'EA FC', y: 28 }
                            ]
                        }
                    ],
                    date: '2024-05-20'
                }],
                '2024-06': [{
                    id: 'dark-2024-06-1',
                    title: '넥슨 종합 매출 전망',
                    summary: [
                        '2024년 연간 매출 13조원 상회 전망',
                        '퍼스트 디센던트 출시로 하반기 실적 기대',
                        '해외 매출 비중 80% 돌파 예상',
                        '목표주가 상향 조정'
                    ],
                    charts: [
                        {
                            title: 'FCF 분석 (억원)',
                            type: 'waterfall',
                            data: [
                                { name: '영업CF', y: 35000, color: '#4ECDC4' },
                                { name: '감가상각', y: 4000, color: '#4ECDC4' },
                                { name: '투자', y: -8000, color: '#FF6B6B' },
                                { name: '운전자본', y: -2000, color: '#FF6B6B' },
                                { name: 'FCF', isSum: true, color: '#E57B53' }
                            ]
                        },
                        {
                            title: '성장률 비교 (%)',
                            type: 'comparison',
                            categories: ['5년 평균', '최근 1년'],
                            series: [
                                { name: '넥슨', data: [19.2, 14.2], color: '#4ECDC4' },
                                { name: '업계', data: [8.5, 5.3], color: '#5B9BD5' },
                                { name: '시장', data: [9.1, 11.2], color: '#E57B53' }
                            ]
                        },
                        {
                            title: '해외 매출 비중 (%)',
                            type: 'pie',
                            data: [
                                { name: '해외', y: 80 },
                                { name: '국내', y: 20 }
                            ]
                        }
                    ],
                    date: '2024-06-15'
                }],
                '2024-07': [],
                '2024-08': [{
                    id: 'dark-2024-08-1',
                    title: '신작 기대작 분석',
                    summary: [
                        '퍼스트 디센던트 출시 첫 주 매출 500억원',
                        '스팀 동시접속 20만명 달성',
                        '과금 모델에 대한 유저 반응 엇갈려',
                        '장기 운영 전략이 관건'
                    ],
                    charts: [
                        {
                            title: '일별 매출 추이 (억원)',
                            type: 'column',
                            data: [
                                { name: '1일차', y: 120 },
                                { name: '2일차', y: 95 },
                                { name: '3일차', y: 85 },
                                { name: '7일차', y: 70 }
                            ]
                        },
                        {
                            title: '동시접속자 (만명)',
                            type: 'line',
                            data: [
                                { name: '1일차', y: 26 },
                                { name: '2일차', y: 22 },
                                { name: '3일차', y: 20 },
                                { name: '7일차', y: 15 }
                            ]
                        },
                        {
                            title: '플랫폼별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: 'Steam', y: 40 },
                                { name: 'PS5', y: 35 },
                                { name: 'Xbox', y: 25 }
                            ]
                        }
                    ],
                    date: '2024-08-05'
                }],
                '2024-09': [],
                '2024-10': [{
                    id: 'dark-2024-10-1',
                    title: '퍼스트디센던트 매출 분석',
                    summary: [
                        '출시 3개월 누적 매출 2,500억원',
                        '콘솔 플랫폼 매출 비중 60%',
                        '시즌 업데이트로 유저 복귀 증가',
                        '연내 추가 콘텐츠 업데이트 예정'
                    ],
                    charts: [
                        {
                            title: '월별 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: '7월', y: 1200 },
                                { name: '8월', y: 800 },
                                { name: '9월', y: 500 }
                            ]
                        },
                        {
                            title: 'MAU 추이 (만명)',
                            type: 'line',
                            data: [
                                { name: '7월', y: 450 },
                                { name: '8월', y: 280 },
                                { name: '9월', y: 180 }
                            ]
                        },
                        {
                            title: '플랫폼별 매출 비중',
                            type: 'pie',
                            data: [
                                { name: 'PC', y: 40 },
                                { name: 'PS5', y: 35 },
                                { name: 'Xbox', y: 25 }
                            ]
                        }
                    ],
                    date: '2024-10-08'
                }],
                '2024-11': [{
                    id: 'dark-2024-11-1',
                    title: '블루아카이브 글로벌 분석',
                    summary: [
                        '블루아카이브 글로벌 월 매출 800억원',
                        '일본 시장 앱스토어 매출 1위 기록',
                        '2.5주년 이벤트로 복귀 유저 급증',
                        '서브컬처 장르 대표 IP로 성장'
                    ],
                    charts: [
                        {
                            title: '월 매출 추이 (억원)',
                            type: 'column',
                            data: [
                                { name: '9월', y: 650 },
                                { name: '10월', y: 720 },
                                { name: '11월', y: 800 }
                            ]
                        },
                        {
                            title: 'DAU 추이 (만명)',
                            type: 'line',
                            data: [
                                { name: '9월', y: 120 },
                                { name: '10월', y: 145 },
                                { name: '11월', y: 180 }
                            ]
                        },
                        {
                            title: '지역별 매출 비중 (%)',
                            type: 'pie',
                            data: [
                                { name: '일본', y: 50 },
                                { name: '한국', y: 20 },
                                { name: '북미', y: 15 },
                                { name: '기타', y: 15 }
                            ]
                        }
                    ],
                    date: '2024-11-12'
                }],
                '2024-12': [],
                '2025-01': [{
                    id: 'dark-2025-01-1',
                    title: '메이플스토리 유니버스 확장 분석',
                    summary: ['메이플 IP 다각화 전략 분석', '신규 플랫폼 진출 전망'],
                    charts: [],
                    date: '2025-01-10'
                }],
                '2025-02': [],
                '2025-03': [{
                    id: 'dark-2025-03-1',
                    title: '넥슨 신작 라인업 분석',
                    summary: ['프로젝트 매그넘 기대작 분석', '2025년 출시 예정 타이틀'],
                    charts: [],
                    date: '2025-03-15'
                }],
                '2025-04': [],
                '2025-05': [],
                '2025-06': [{
                    id: 'dark-2025-06-1',
                    title: '글로벌 게임시장 트렌드',
                    summary: ['모바일 시장 성장세 둔화', 'PC/콘솔 크로스플랫폼 확대'],
                    charts: [],
                    date: '2025-06-20'
                }],
                '2025-07': [],
                '2025-08': [],
                '2025-09': [{
                    id: 'dark-2025-09-1',
                    title: '넥슨 하반기 전망',
                    summary: ['퍼스트 디센던트 시즌3 분석', '연말 신작 출시 일정'],
                    charts: [],
                    date: '2025-09-10'
                }],
                '2025-10': [],
                '2025-11': [],
                '2025-12': []
            },
            policy: {
                '2022-01': [],
                '2022-02': [{
                    id: 'policy-2022-02-1',
                    title: '게임 셧다운제 완화 논의',
                    summary: ['청소년 게임 이용시간 제한 완화 검토', '업계 자율규제 전환 논의'],
                    charts: [],
                    date: '2022-02-15'
                }],
                '2022-03': [],
                '2022-04': [],
                '2022-05': [{
                    id: 'policy-2022-05-1',
                    title: '확률형 아이템 규제 논의',
                    summary: ['확률 공개 의무화 법안 발의', '게임사 자율 공개 확대'],
                    charts: [],
                    date: '2022-05-20'
                }],
                '2022-06': [],
                '2022-07': [],
                '2022-08': [],
                '2022-09': [{
                    id: 'policy-2022-09-1',
                    title: '중국 게임 규제 동향',
                    summary: ['판호 발급 재개', '한국 게임사 진출 기회'],
                    charts: [],
                    date: '2022-09-10'
                }],
                '2022-10': [],
                '2022-11': [],
                '2022-12': [],
                '2023-01': [],
                '2023-02': [],
                '2023-03': [{
                    id: 'policy-2023-03-1',
                    title: '게임산업진흥법 개정',
                    summary: ['게임 이용자 보호 조항 강화', '결제 한도 조정 논의'],
                    charts: [],
                    date: '2023-03-15'
                }],
                '2023-04': [],
                '2023-05': [],
                '2023-06': [{
                    id: 'policy-2023-06-1',
                    title: '셧다운제 폐지 추진',
                    summary: ['청소년 보호법 개정안 발의', '게임 이용 자율화 방향'],
                    charts: [],
                    date: '2023-06-20'
                }],
                '2023-07': [],
                '2023-08': [],
                '2023-09': [],
                '2023-10': [{
                    id: 'policy-2023-10-1',
                    title: '중국 판호 정책 변화',
                    summary: ['판호 발급 건수 증가', '한국 게임사 신청 증가'],
                    charts: [],
                    date: '2023-10-10'
                }],
                '2023-11': [],
                '2023-12': [{
                    id: 'policy-2023-12-1',
                    title: '연말 정책 동향',
                    summary: ['2024년 게임 정책 방향 발표', '산업 지원 확대 예고'],
                    charts: [],
                    date: '2023-12-15'
                }],
                '2024-01': [],
                '2024-02': [],
                '2024-03': [{
                    id: 'policy-2024-03-1',
                    title: '확률형 아이템 규제안 발의',
                    summary: [
                        '국회 확률형 아이템 확률 공개 의무화 법안 발의',
                        '게임사 자율 규제 강화 요구',
                        '넥슨 등 주요 게임사 이미 확률 공개 중',
                        '실제 영향은 제한적일 전망'
                    ],
                    charts: [
                        {
                            title: '확률 공개 현황 (개사)',
                            type: 'column',
                            data: [
                                { name: '공개', y: 45 },
                                { name: '미공개', y: 12 }
                            ]
                        },
                        {
                            title: '규제 영향도 (점)',
                            type: 'line',
                            data: [
                                { name: '넥슨', y: 2 },
                                { name: '엔씨', y: 3 },
                                { name: '크래프톤', y: 2 }
                            ]
                        },
                        {
                            title: '가챠 매출 비중 (%)',
                            type: 'pie',
                            data: [
                                { name: '가챠', y: 35 },
                                { name: '기타', y: 65 }
                            ]
                        }
                    ],
                    date: '2024-03-25'
                }],
                '2024-04': [],
                '2024-05': [],
                '2024-06': [{
                    id: 'policy-2024-06-1',
                    title: '게임산업법 개정 논의',
                    summary: [
                        '게임산업진흥법 개정안 국회 상임위 통과',
                        '게임 이용자 보호 조항 강화',
                        '결제 한도 상향 조정 포함',
                        '업계 의견 수렴 진행 중'
                    ],
                    charts: [
                        {
                            title: '결제 한도 변화 (만원)',
                            type: 'column',
                            data: [
                                { name: '현행', y: 50 },
                                { name: '개정안', y: 100 }
                            ]
                        },
                        {
                            title: '업계 찬반 비율 (%)',
                            type: 'pie',
                            data: [
                                { name: '찬성', y: 68 },
                                { name: '반대', y: 22 },
                                { name: '보류', y: 10 }
                            ]
                        },
                        {
                            title: '민원 건수 추이',
                            type: 'line',
                            data: [
                                { name: '4월', y: 320 },
                                { name: '5월', y: 280 },
                                { name: '6월', y: 195 }
                            ]
                        }
                    ],
                    date: '2024-06-20'
                }],
                '2024-07': [],
                '2024-08': [],
                '2024-09': [{
                    id: 'policy-2024-09-1',
                    title: '중국 판호 정책 완화 소식',
                    summary: [
                        '중국 판호 발급 재개 및 확대',
                        '한국 게임사 신청 가능성 열려',
                        '넥슨 던전앤파이터 모바일 후속작 진출 기대',
                        '단, 실제 발급까지 시간 필요'
                    ],
                    charts: [
                        {
                            title: '월별 판호 발급 건수',
                            type: 'column',
                            data: [
                                { name: '7월', y: 88 },
                                { name: '8월', y: 95 },
                                { name: '9월', y: 102 }
                            ]
                        },
                        {
                            title: '한국게임 발급 추이',
                            type: 'line',
                            data: [
                                { name: '2022', y: 2 },
                                { name: '2023', y: 5 },
                                { name: '2024', y: 8 }
                            ]
                        },
                        {
                            title: '장르별 발급 비중',
                            type: 'pie',
                            data: [
                                { name: 'RPG', y: 45 },
                                { name: '캐주얼', y: 30 },
                                { name: '기타', y: 25 }
                            ]
                        }
                    ],
                    date: '2024-09-10'
                }],
                '2024-10': [],
                '2024-11': [],
                '2024-12': [{
                    id: 'policy-2024-12-1',
                    title: '청소년 보호법 개정',
                    summary: [
                        '게임 셧다운제 폐지 확정',
                        '자율규제 체계로 전환',
                        '게임사 부담 완화 기대',
                        '2025년 시행 예정'
                    ],
                    charts: [
                        {
                            title: '셧다운제 비용 절감 (억원)',
                            type: 'column',
                            data: [
                                { name: '넥슨', y: 45 },
                                { name: '엔씨', y: 38 },
                                { name: '크래프톤', y: 25 }
                            ]
                        },
                        {
                            title: '청소년 이용시간 변화 예상',
                            type: 'line',
                            data: [
                                { name: '현행', y: 2.5 },
                                { name: '개정후', y: 3.2 }
                            ]
                        },
                        {
                            title: '규제 현황 (국가수)',
                            type: 'pie',
                            data: [
                                { name: '규제', y: 3 },
                                { name: '자율', y: 42 }
                            ]
                        }
                    ],
                    date: '2024-12-15'
                }],
                '2025-01': [],
                '2025-02': [{
                    id: 'policy-2025-02-1',
                    title: '게임산업 진흥법 시행령 개정',
                    summary: ['게임 등급 분류 체계 개선', '인디 게임 지원 확대'],
                    charts: [],
                    date: '2025-02-10'
                }],
                '2025-03': [],
                '2025-04': [],
                '2025-05': [{
                    id: 'policy-2025-05-1',
                    title: 'AI 게임 규제 가이드라인',
                    summary: ['AI 생성 콘텐츠 규제 논의', '자율 규제 원칙 발표'],
                    charts: [],
                    date: '2025-05-20'
                }],
                '2025-06': [],
                '2025-07': [],
                '2025-08': [],
                '2025-09': [],
                '2025-10': [{
                    id: 'policy-2025-10-1',
                    title: '게임 이용자 보호 강화 방안',
                    summary: ['확률형 아이템 규제 강화', '이용자 환불권 확대'],
                    charts: [],
                    date: '2025-10-15'
                }],
                '2025-11': [],
                '2025-12': []
            },
            news: {
                '2022-01': [{
                    id: 'news-2022-01-1',
                    title: '메이플스토리 리마스터 업데이트',
                    summary: ['대규모 리마스터 업데이트 진행', '그래픽 및 시스템 개선', '복귀 유저 이벤트'],
                    charts: [],
                    date: '2022-01-20'
                }],
                '2022-02': [],
                '2022-03': [{
                    id: 'news-2022-03-1',
                    title: '넥슨 개발자 컨퍼런스 NDC 2022',
                    summary: ['온라인 개최', '신작 3종 발표', 'AI 기술 세션'],
                    charts: [],
                    date: '2022-03-10'
                }],
                '2022-04': [],
                '2022-05': [{
                    id: 'news-2022-05-1',
                    title: 'FC온라인 시즌 업데이트',
                    summary: ['2022 시즌 대규모 업데이트', '신규 선수 카드 추가'],
                    charts: [],
                    date: '2022-05-15'
                }],
                '2022-06': [],
                '2022-07': [{
                    id: 'news-2022-07-1',
                    title: '블루아카이브 1주년',
                    summary: ['글로벌 1주년 기념 이벤트', '신규 캐릭터 추가', '무료 가챠 이벤트', '일본 트렌드 1위 기록'],
                    charts: [
                        {
                            title: '이벤트 기간 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: '이벤트 전', y: 280 },
                                { name: '이벤트 중', y: 520 }
                            ]
                        },
                        {
                            title: 'DAU 변화 (만명)',
                            type: 'line',
                            data: [
                                { name: '6월', y: 180 },
                                { name: '7월초', y: 250 },
                                { name: '7월말', y: 320 }
                            ]
                        },
                        {
                            title: '신규 캐릭터 인기',
                            type: 'pie',
                            data: [
                                { name: '호시노', y: 40 },
                                { name: '시로코', y: 35 },
                                { name: '기타', y: 25 }
                            ]
                        }
                    ],
                    date: '2022-07-10',
                    analysis: `## 1주년 이벤트 분석

**이벤트 효과: 매우 긍정적 (★★★★★)**

블루아카이브 1주년 이벤트로 DAU 78% 급증, 일본 앱스토어 상위권 진입.

### 이벤트 성과

| 지표 | 이벤트 전 | 이벤트 중 | 증가율 |
|------|----------|----------|--------|
| DAU | 180만 | 320만 | +77.8% |
| 매출 | 280억 | 520억 | +85.7% |
| 신규유저 | 5만/일 | 15만/일 | +200% |

### 마케팅 인사이트
무료 가챠와 신규 캐릭터 조합이 유저 유입과 결제 전환에 효과적.`
                }],
                '2022-08': [],
                '2022-09': [],
                '2022-10': [{
                    id: 'news-2022-10-1',
                    title: '던전앤파이터 신규 직업',
                    summary: ['신규 직업 업데이트', '중국 동시 출시'],
                    charts: [],
                    date: '2022-10-05'
                }],
                '2022-11': [{
                    id: 'news-2022-11-1',
                    title: 'FC온라인 월드컵 이벤트',
                    summary: ['카타르 월드컵 연계 이벤트', '특별 선수 카드 출시'],
                    charts: [],
                    date: '2022-11-20'
                }],
                '2022-12': [],
                '2023-01': [{
                    id: 'news-2023-01-1',
                    title: '메이플스토리 신규 보스',
                    summary: ['신규 보스 콘텐츠 추가', '엔드게임 콘텐츠 강화'],
                    charts: [],
                    date: '2023-01-15'
                }],
                '2023-02': [],
                '2023-03': [{
                    id: 'news-2023-03-1',
                    title: 'NDC 2023 개최',
                    summary: ['넥슨 개발자 컨퍼런스', '퍼스트 디센던트 공개'],
                    charts: [],
                    date: '2023-03-15'
                }],
                '2023-04': [{
                    id: 'news-2023-04-1',
                    title: '블루아카이브 애니메이션 발표',
                    summary: ['애니메이션 제작 발표', '2024년 방영 예정'],
                    charts: [],
                    date: '2023-04-10'
                }],
                '2023-05': [],
                '2023-06': [{
                    id: 'news-2023-06-1',
                    title: 'FC온라인 시즌 전환',
                    summary: ['2023 시즌 업데이트', 'e스포츠 리그 확대'],
                    charts: [],
                    date: '2023-06-15'
                }],
                '2023-07': [{
                    id: 'news-2023-07-1',
                    title: '퍼스트 디센던트 CBT',
                    summary: ['클로즈드 베타 테스트 진행', '글로벌 유저 참여', '스팀 CBT 호평', '그래픽 퀄리티 호평'],
                    charts: [
                        {
                            title: 'CBT 참여자 (만명)',
                            type: 'column',
                            data: [
                                { name: 'PC', y: 45 },
                                { name: 'PS5', y: 30 },
                                { name: 'Xbox', y: 20 }
                            ]
                        },
                        {
                            title: '유저 평가 분포 (%)',
                            type: 'pie',
                            data: [
                                { name: '긍정', y: 72 },
                                { name: '중립', y: 18 },
                                { name: '부정', y: 10 }
                            ]
                        }
                    ],
                    date: '2023-07-20',
                    analysis: `## CBT 분석 리포트

**CBT 평가: 긍정적 (★★★★☆)**

글로벌 95만명 참여, 긍정 평가 72%로 출시 기대감 상승.

### CBT 결과

| 항목 | 수치 | 평가 |
|------|------|------|
| 참여자 | 95만명 | 목표 초과 |
| 긍정률 | 72% | 양호 |
| 플레이타임 | 평균 12시간 | 우수 |

### 피드백 요약
- 그래픽 퀄리티 호평
- 전투 시스템 재미있음
- 최적화 개선 필요
- 콘텐츠 볼륨 확대 요청`
                }],
                '2023-08': [],
                '2023-09': [{
                    id: 'news-2023-09-1',
                    title: '던파 모바일 업데이트',
                    summary: ['대규모 콘텐츠 업데이트', '중국 매출 급증'],
                    charts: [],
                    date: '2023-09-10'
                }],
                '2023-10': [{
                    id: 'news-2023-10-1',
                    title: '메이플스토리 20주년 예고',
                    summary: ['20주년 기념 이벤트 예고', '특별 콘텐츠 준비 중'],
                    charts: [],
                    date: '2023-10-20'
                }],
                '2023-11': [],
                '2023-12': [{
                    id: 'news-2023-12-1',
                    title: '연말 대규모 업데이트',
                    summary: ['주요 게임 연말 이벤트', '2024년 로드맵 공개'],
                    charts: [],
                    date: '2023-12-20'
                }],
                '2024-01': [{
                    id: 'news-2024-01-1',
                    title: '메이플스토리 신규 직업 출시',
                    summary: [
                        '메이플스토리 신규 직업 "라라" 업데이트',
                        '자연 친화 컨셉의 마법사 계열',
                        '출시 첫 주 동시접속 30% 증가',
                        '유저 반응 호평'
                    ],
                    charts: [
                        {
                            title: '동시접속자 변화 (만명)',
                            type: 'column',
                            data: [
                                { name: '출시전', y: 12 },
                                { name: '출시후', y: 15.6 }
                            ]
                        },
                        {
                            title: '신규 캐릭터 생성 수',
                            type: 'line',
                            data: [
                                { name: '1일차', y: 85000 },
                                { name: '3일차', y: 120000 },
                                { name: '7일차', y: 180000 }
                            ]
                        },
                        {
                            title: '직업별 점유율 (%)',
                            type: 'pie',
                            data: [
                                { name: '라라', y: 18 },
                                { name: '기존직업', y: 82 }
                            ]
                        }
                    ],
                    date: '2024-01-18'
                }],
                '2024-02': [],
                '2024-03': [{
                    id: 'news-2024-03-1',
                    title: '넥슨 북미 스튜디오 설립 발표',
                    summary: [
                        'LA에 신규 개발 스튜디오 설립',
                        '글로벌 AAA 게임 개발 목표',
                        '초기 인력 100명 규모',
                        '언리얼 엔진 기반 프로젝트 진행'
                    ],
                    charts: [
                        {
                            title: '해외 스튜디오 투자 (억원)',
                            type: 'column',
                            data: [
                                { name: '2022', y: 800 },
                                { name: '2023', y: 1200 },
                                { name: '2024', y: 1800 }
                            ]
                        },
                        {
                            title: '글로벌 인력 추이 (명)',
                            type: 'line',
                            data: [
                                { name: '2022', y: 350 },
                                { name: '2023', y: 480 },
                                { name: '2024', y: 620 }
                            ]
                        },
                        {
                            title: '지역별 스튜디오 분포',
                            type: 'pie',
                            data: [
                                { name: '한국', y: 65 },
                                { name: '북미', y: 20 },
                                { name: '일본', y: 10 },
                                { name: '유럽', y: 5 }
                            ]
                        }
                    ],
                    date: '2024-03-05'
                }],
                '2024-04': [{
                    id: 'news-2024-04-1',
                    title: '블루아카이브 2주년 이벤트',
                    summary: [
                        '블루아카이브 글로벌 2주년 기념 이벤트',
                        '신규 학생 캐릭터 3종 추가',
                        '2주년 기념 무료 가챠 제공',
                        '실시간 트렌드 1위 기록'
                    ],
                    charts: [
                        {
                            title: '이벤트 기간 매출 (억원)',
                            type: 'column',
                            data: [
                                { name: '이벤트전', y: 180 },
                                { name: '이벤트중', y: 420 }
                            ]
                        },
                        {
                            title: 'DAU 변화 (만명)',
                            type: 'line',
                            data: [
                                { name: '1주전', y: 85 },
                                { name: '이벤트', y: 145 },
                                { name: '1주후', y: 110 }
                            ]
                        },
                        {
                            title: '신규 캐릭터 인기도',
                            type: 'pie',
                            data: [
                                { name: '캐릭터A', y: 45 },
                                { name: '캐릭터B', y: 35 },
                                { name: '캐릭터C', y: 20 }
                            ]
                        }
                    ],
                    date: '2024-04-09'
                }],
                '2024-05': [],
                '2024-06': [{
                    id: 'news-2024-06-1',
                    title: 'FC온라인 시즌 업데이트',
                    summary: [
                        'FC온라인 2024 시즌 대규모 업데이트',
                        '유로 2024 공식 라이선스 콘텐츠',
                        '신규 선수 카드 500종 추가',
                        '시즌 패스 판매 호조'
                    ],
                    charts: [
                        {
                            title: '시즌패스 판매량 (만건)',
                            type: 'column',
                            data: [
                                { name: '23시즌', y: 85 },
                                { name: '24시즌', y: 120 }
                            ]
                        },
                        {
                            title: 'DAU 추이 (만명)',
                            type: 'line',
                            data: [
                                { name: '5월', y: 180 },
                                { name: '6월초', y: 220 },
                                { name: '6월말', y: 245 }
                            ]
                        },
                        {
                            title: '콘텐츠별 이용 비중',
                            type: 'pie',
                            data: [
                                { name: '매치', y: 55 },
                                { name: '팩개봉', y: 30 },
                                { name: '기타', y: 15 }
                            ]
                        }
                    ],
                    date: '2024-06-10'
                }],
                '2024-07': [{
                    id: 'news-2024-07-1',
                    title: '퍼스트 디센던트 출시',
                    summary: [
                        '넥슨 신작 루터 슈터 "퍼스트 디센던트" 정식 출시',
                        'PC, PS5, Xbox 동시 출시',
                        '출시 첫날 스팀 동시접속 10만명',
                        'F2P 모델로 진입 장벽 낮춰'
                    ],
                    charts: [
                        {
                            title: '플랫폼별 다운로드 (만건)',
                            type: 'column',
                            data: [
                                { name: 'Steam', y: 180 },
                                { name: 'PS5', y: 120 },
                                { name: 'Xbox', y: 80 }
                            ]
                        },
                        {
                            title: '동시접속자 추이 (만명)',
                            type: 'line',
                            data: [
                                { name: '1일차', y: 10 },
                                { name: '2일차', y: 18 },
                                { name: '3일차', y: 22 }
                            ]
                        },
                        {
                            title: '지역별 유저 분포',
                            type: 'pie',
                            data: [
                                { name: '북미', y: 35 },
                                { name: '유럽', y: 30 },
                                { name: '아시아', y: 25 },
                                { name: '기타', y: 10 }
                            ]
                        }
                    ],
                    date: '2024-07-02',
                    analysis: `## 출시 영향 분석

**시장 반응: 매우 긍정적 (★★★★★)**

퍼스트 디센던트의 글로벌 동시 출시는 넥슨의 AAA급 게임 개발 역량을 입증.

### 출시 성과

| 지표 | 수치 | 평가 |
|------|------|------|
| 첫날 동접 | 10만명 | 우수 |
| 플랫폼 다운로드 | 380만건 | 초과달성 |
| 스팀 평점 | 7.2/10 | 양호 |

### 성공 요인
1. **멀티플랫폼**: PC, PS5, Xbox 동시 출시로 접근성 극대화
2. **F2P 모델**: 진입 장벽 낮춰 유저 유입 촉진
3. **루터슈터 장르**: 글로벌 인기 장르 진출

### 향후 전망
지속적인 콘텐츠 업데이트가 관건. 시즌제 운영으로 장기 수익 창출 기대.`
                },
                {
                    id: 'news-2024-07-2',
                    title: '넥슨 북미 스튜디오 인수',
                    summary: ['Embark Studios 인수 완료', '3A급 신작 개발 계획'],
                    charts: [],
                    date: '2024-07-05'
                },
                {
                    id: 'news-2024-07-3',
                    title: '메이플스토리 월드 오픈베타',
                    summary: ['유저 제작 콘텐츠 플랫폼 오픈', '초기 반응 호조'],
                    charts: [],
                    date: '2024-07-10'
                },
                {
                    id: 'news-2024-07-4',
                    title: 'EA와 파트너십 확대',
                    summary: ['FC 프랜차이즈 협력 강화', '새로운 스포츠 게임 공동 개발'],
                    charts: [],
                    date: '2024-07-15'
                },
                {
                    id: 'news-2024-07-5',
                    title: '던전앤파이터 모바일 신규 업데이트',
                    summary: ['신규 직업 "다크나이트" 추가', '중국 매출 순위 1위 탈환'],
                    charts: [],
                    date: '2024-07-20'
                },
                {
                    id: 'news-2024-07-6',
                    title: '블루아카이브 2주년 기념 이벤트',
                    summary: ['글로벌 동시 이벤트 진행', '유저 감사 보상 지급'],
                    charts: [],
                    date: '2024-07-25'
                }],
                '2024-08': [{
                    id: 'news-2024-08-1',
                    title: '퍼스트 디센던트 500만 다운로드',
                    summary: [
                        '출시 한 달 만에 글로벌 500만 다운로드 달성',
                        '스팀 최고 동시접속 26만명 기록',
                        '시즌 1 업데이트 예고',
                        '유저 피드백 반영 패치 진행'
                    ],
                    charts: [
                        {
                            title: '누적 다운로드 (만건)',
                            type: 'column',
                            data: [
                                { name: '1주차', y: 200 },
                                { name: '2주차', y: 350 },
                                { name: '4주차', y: 500 }
                            ]
                        },
                        {
                            title: '최고 동시접속 (만명)',
                            type: 'line',
                            data: [
                                { name: '1주차', y: 22 },
                                { name: '2주차', y: 26 },
                                { name: '4주차', y: 18 }
                            ]
                        },
                        {
                            title: '유저 평점 분포',
                            type: 'pie',
                            data: [
                                { name: '긍정', y: 68 },
                                { name: '중립', y: 18 },
                                { name: '부정', y: 14 }
                            ]
                        }
                    ],
                    date: '2024-08-02'
                }],
                '2024-09': [],
                '2024-10': [{
                    id: 'news-2024-10-1',
                    title: '메이플스토리 20주년',
                    summary: [
                        '메이플스토리 서비스 20주년 기념 행사',
                        '오프라인 팬미팅 1만명 참여',
                        '20주년 기념 캐릭터 및 아이템 출시',
                        '20년간의 역사 전시회 개최'
                    ],
                    charts: [
                        {
                            title: '연도별 매출 추이 (억원)',
                            type: 'column',
                            data: [
                                { name: '2014', y: 4500 },
                                { name: '2019', y: 8200 },
                                { name: '2024', y: 12000 }
                            ]
                        },
                        {
                            title: '누적 유저 수 (만명)',
                            type: 'line',
                            data: [
                                { name: '2014', y: 2500 },
                                { name: '2019', y: 4200 },
                                { name: '2024', y: 5800 }
                            ]
                        },
                        {
                            title: '이벤트 참여 비중',
                            type: 'pie',
                            data: [
                                { name: '온라인', y: 85 },
                                { name: '오프라인', y: 15 }
                            ]
                        }
                    ],
                    date: '2024-10-29',
                    analysis: `## 이벤트 영향 분석

**브랜드 가치: 최고 수준 (★★★★★)**

20년간 서비스 지속은 글로벌 게임 업계에서도 이례적인 성과.

### 20주년 성과

| 지표 | 수치 | 의미 |
|------|------|------|
| 누적 유저 | 1.8억명 | 글로벌 Top 5 |
| 서비스 기간 | 20년 | 업계 최장수 |
| 오프라인 참여 | 1만명 | 역대 최대 |

### 브랜드 파워
1. **세대 초월**: 10대부터 30대까지 폭넓은 유저층
2. **문화 아이콘**: 한국 게임 역사의 상징
3. **IP 확장성**: 애니메이션, 굿즈 등 다각화

### 투자 시사점
장수 IP의 안정적 수익 창출 능력 입증. 신규 콘텐츠와 노스탤지어 마케팅 병행으로 지속 성장 가능.`
                }],
                '2024-11': [{
                    id: 'news-2024-11-1',
                    title: '넥슨 개발자 컨퍼런스',
                    summary: [
                        'NDC 2024 온라인 개최',
                        '신작 5종 최초 공개',
                        '차세대 게임 엔진 발표',
                        'AI 기술 활용 사례 공유'
                    ],
                    charts: [
                        {
                            title: '참가자 수 추이 (명)',
                            type: 'column',
                            data: [
                                { name: '2022', y: 8500 },
                                { name: '2023', y: 12000 },
                                { name: '2024', y: 18000 }
                            ]
                        },
                        {
                            title: '세션 수 추이',
                            type: 'line',
                            data: [
                                { name: '2022', y: 85 },
                                { name: '2023', y: 110 },
                                { name: '2024', y: 145 }
                            ]
                        },
                        {
                            title: '분야별 세션 비중',
                            type: 'pie',
                            data: [
                                { name: '개발', y: 45 },
                                { name: 'AI/ML', y: 25 },
                                { name: '아트', y: 20 },
                                { name: '기타', y: 10 }
                            ]
                        }
                    ],
                    date: '2024-11-15'
                }],
                '2024-12': [{
                    id: 'news-2024-12-1',
                    title: '연말 대규모 업데이트',
                    summary: [
                        '주요 게임 연말 대규모 업데이트 일제히 진행',
                        '메이플스토리: 신규 보스 콘텐츠',
                        'FC온라인: 겨울 이벤트',
                        '블루아카이브: 크리스마스 스토리'
                    ],
                    charts: [
                        {
                            title: '게임별 업데이트 규모 (GB)',
                            type: 'column',
                            data: [
                                { name: '메이플', y: 3.2 },
                                { name: 'FC온라인', y: 5.8 },
                                { name: '블루아카', y: 2.1 }
                            ]
                        },
                        {
                            title: '예상 DAU 증가율 (%)',
                            type: 'line',
                            data: [
                                { name: '메이플', y: 25 },
                                { name: 'FC온라인', y: 35 },
                                { name: '블루아카', y: 40 }
                            ]
                        },
                        {
                            title: '콘텐츠 유형별 비중',
                            type: 'pie',
                            data: [
                                { name: '이벤트', y: 50 },
                                { name: '신규콘텐츠', y: 35 },
                                { name: '밸런스', y: 15 }
                            ]
                        }
                    ],
                    date: '2024-12-20'
                }],
                '2025-01': [{
                    id: 'news-2025-01-1',
                    title: '넥슨 2025년 신작 발표',
                    summary: ['프로젝트 매그넘 출시 일정 공개', '글로벌 동시 출시 예정'],
                    charts: [],
                    date: '2025-01-15'
                }],
                '2025-02': [],
                '2025-03': [{
                    id: 'news-2025-03-1',
                    title: 'GDC 2025 넥슨 참가',
                    summary: ['신기술 발표', 'AI NPC 시스템 공개'],
                    charts: [],
                    date: '2025-03-20'
                }],
                '2025-04': [],
                '2025-05': [{
                    id: 'news-2025-05-1',
                    title: '메이플스토리 21주년 이벤트',
                    summary: ['대규모 기념 이벤트', '신규 직업 출시'],
                    charts: [],
                    date: '2025-05-10'
                }],
                '2025-06': [],
                '2025-07': [{
                    id: 'news-2025-07-1',
                    title: '퍼스트 디센던트 1주년',
                    summary: ['1주년 기념 대규모 업데이트', '누적 다운로드 2,000만 돌파'],
                    charts: [],
                    date: '2025-07-11'
                }],
                '2025-08': [],
                '2025-09': [],
                '2025-10': [],
                '2025-11': [{
                    id: 'news-2025-11-1',
                    title: '블랙프라이데이 매출 신기록',
                    summary: ['글로벌 매출 전년 대비 30% 증가', '북미 시장 성장세'],
                    charts: [],
                    date: '2025-11-28'
                }],
                '2025-12': []
            },
            paper: {
                '2022-01': [],
                '2022-02': [{
                    id: 'paper-2022-02-1',
                    title: 'MMORPG 시장 분석 보고서',
                    summary: ['글로벌 MMORPG 시장 트렌드', '메이플스토리 사례 분석'],
                    charts: [],
                    date: '2022-02-10'
                }],
                '2022-03': [],
                '2022-04': [],
                '2022-05': [],
                '2022-06': [{
                    id: 'paper-2022-06-1',
                    title: '모바일 게임 수익 모델 연구',
                    summary: ['F2P 모델 분석', '과금 최적화 전략'],
                    charts: [],
                    date: '2022-06-15'
                }],
                '2022-07': [],
                '2022-08': [],
                '2022-09': [],
                '2022-10': [{
                    id: 'paper-2022-10-1',
                    title: '게임 유저 행동 분석',
                    summary: ['유저 리텐션 요인 분석', '이탈 예측 모델'],
                    charts: [],
                    date: '2022-10-20'
                }],
                '2022-11': [],
                '2022-12': [],
                '2023-01': [],
                '2023-02': [],
                '2023-03': [{
                    id: 'paper-2023-03-1',
                    title: '게임 AI 기술 동향',
                    summary: ['AI NPC 개발 트렌드', '강화학습 적용 사례'],
                    charts: [],
                    date: '2023-03-15'
                }],
                '2023-04': [],
                '2023-05': [],
                '2023-06': [],
                '2023-07': [{
                    id: 'paper-2023-07-1',
                    title: '크로스플랫폼 게임 연구',
                    summary: ['PC-콘솔-모바일 연동 기술', '유저 경험 분석'],
                    charts: [],
                    date: '2023-07-20'
                }],
                '2023-08': [],
                '2023-09': [],
                '2023-10': [],
                '2023-11': [{
                    id: 'paper-2023-11-1',
                    title: '게임 그래픽 기술 발전',
                    summary: ['차세대 렌더링 기술', '실시간 레이트레이싱'],
                    charts: [],
                    date: '2023-11-10'
                }],
                '2023-12': [],
                '2024-01': [],
                '2024-02': [{
                    id: 'paper-2024-02-1',
                    title: 'MMORPG 유저 리텐션 분석',
                    summary: ['메이플스토리 10년 유저 데이터 분석', '리텐션 핵심 요인 도출'],
                    charts: [],
                    date: '2024-02-15'
                }],
                '2024-03': [],
                '2024-04': [],
                '2024-05': [{
                    id: 'paper-2024-05-1',
                    title: '게임 내 경제 시스템 연구',
                    summary: ['가상 경제 인플레이션 모델링', '아이템 가격 안정화 방안'],
                    charts: [],
                    date: '2024-05-20'
                }],
                '2024-06': [],
                '2024-07': [],
                '2024-08': [{
                    id: 'paper-2024-08-1',
                    title: 'AI 기반 NPC 행동 패턴 연구',
                    summary: ['강화학습 기반 NPC 설계', '유저 몰입도 향상 효과 검증'],
                    charts: [],
                    date: '2024-08-10'
                }],
                '2024-09': [],
                '2024-10': [],
                '2024-11': [{
                    id: 'paper-2024-11-1',
                    title: '루터슈터 장르 시장 분석',
                    summary: ['퍼스트 디센던트 성공 요인', '경쟁작 대비 차별점 분석'],
                    charts: [],
                    date: '2024-11-05'
                }],
                '2024-12': [],
                '2025-01': [],
                '2025-02': [],
                '2025-03': [{
                    id: 'paper-2025-03-1',
                    title: '게임 AI NPC 발전 동향',
                    summary: ['LLM 기반 NPC 대화 시스템', '넥슨 기술 사례 분석'],
                    charts: [],
                    date: '2025-03-15'
                }],
                '2025-04': [],
                '2025-05': [],
                '2025-06': [{
                    id: 'paper-2025-06-1',
                    title: '크로스플랫폼 게임 개발 트렌드',
                    summary: ['PC-모바일-콘솔 통합 개발', '유저 데이터 연동 기술'],
                    charts: [],
                    date: '2025-06-20'
                }],
                '2025-07': [],
                '2025-08': [],
                '2025-09': [],
                '2025-10': [],
                '2025-11': [],
                '2025-12': []
            },
            patent: {
                '2022-01': [],
                '2022-02': [{
                    id: 'patent-2022-02-1',
                    title: '게임 최적화 기술 특허',
                    summary: ['모바일 게임 렌더링 최적화', '배터리 소모 감소 기술'],
                    charts: [],
                    date: '2022-02-15'
                }],
                '2022-03': [],
                '2022-04': [],
                '2022-05': [{
                    id: 'patent-2022-05-1',
                    title: '실시간 번역 시스템',
                    summary: ['게임 내 다국어 실시간 번역', 'AI 기반 자연어 처리'],
                    charts: [],
                    date: '2022-05-20'
                }],
                '2022-06': [],
                '2022-07': [],
                '2022-08': [],
                '2022-09': [{
                    id: 'patent-2022-09-1',
                    title: '안티치트 시스템 특허',
                    summary: ['비정상 플레이 탐지', '머신러닝 기반 치트 감지'],
                    charts: [],
                    date: '2022-09-10'
                }],
                '2022-10': [],
                '2022-11': [],
                '2022-12': [],
                '2023-01': [],
                '2023-02': [{
                    id: 'patent-2023-02-1',
                    title: '클라우드 게이밍 기술',
                    summary: ['저지연 스트리밍 기술', '적응형 화질 조절'],
                    charts: [],
                    date: '2023-02-15'
                }],
                '2023-03': [],
                '2023-04': [],
                '2023-05': [{
                    id: 'patent-2023-05-1',
                    title: '유저 매칭 알고리즘',
                    summary: ['스킬 기반 매칭', '대기 시간 최적화'],
                    charts: [],
                    date: '2023-05-20'
                }],
                '2023-06': [],
                '2023-07': [],
                '2023-08': [{
                    id: 'patent-2023-08-1',
                    title: 'AI NPC 행동 시스템',
                    summary: ['강화학습 기반 NPC', '동적 난이도 조절'],
                    charts: [],
                    date: '2023-08-15'
                }],
                '2023-09': [],
                '2023-10': [],
                '2023-11': [],
                '2023-12': [{
                    id: 'patent-2023-12-1',
                    title: '멀티플랫폼 동기화',
                    summary: ['크로스 세이브 기술', '실시간 데이터 동기화'],
                    charts: [],
                    date: '2023-12-10'
                }],
                '2024-01': [{
                    id: 'patent-2024-01-1',
                    title: '실시간 매칭 시스템 특허',
                    summary: ['스킬 기반 매칭 알고리즘', '대기 시간 최소화 기술'],
                    charts: [],
                    date: '2024-01-10'
                }],
                '2024-02': [],
                '2024-03': [{
                    id: 'patent-2024-03-1',
                    title: 'AI 기반 게임 밸런싱 특허',
                    summary: ['실시간 밸런스 조정 시스템', '유저 피드백 반영 알고리즘'],
                    charts: [],
                    date: '2024-03-15'
                }],
                '2024-04': [],
                '2024-05': [],
                '2024-06': [{
                    id: 'patent-2024-06-1',
                    title: '크로스플랫폼 세이브 동기화',
                    summary: ['PC-모바일-콘솔 연동 기술', '클라우드 기반 저장 시스템'],
                    charts: [],
                    date: '2024-06-20'
                }],
                '2024-07': [],
                '2024-08': [],
                '2024-09': [{
                    id: 'patent-2024-09-1',
                    title: '게임 내 거래 보안 시스템',
                    summary: ['블록체인 기반 거래 검증', '사기 방지 알고리즘'],
                    charts: [],
                    date: '2024-09-05'
                }],
                '2024-10': [],
                '2024-11': [],
                '2024-12': [{
                    id: 'patent-2024-12-1',
                    title: '차세대 렌더링 엔진 특허',
                    summary: ['실시간 레이트레이싱 최적화', '모바일 적용 기술'],
                    charts: [],
                    date: '2024-12-10'
                }],
                '2025-01': [],
                '2025-02': [{
                    id: 'patent-2025-02-1',
                    title: 'AI 기반 게임 밸런싱 시스템',
                    summary: ['실시간 게임 밸런스 조정', '머신러닝 기반 최적화'],
                    charts: [],
                    date: '2025-02-15'
                }],
                '2025-03': [],
                '2025-04': [],
                '2025-05': [{
                    id: 'patent-2025-05-1',
                    title: '메타버스 상호작용 기술',
                    summary: ['가상공간 내 다중 사용자 상호작용', '실시간 동기화 기술'],
                    charts: [],
                    date: '2025-05-20'
                }],
                '2025-06': [],
                '2025-07': [],
                '2025-08': [{
                    id: 'patent-2025-08-1',
                    title: '게임 내 경제 시스템 특허',
                    summary: ['가상 경제 안정화 알고리즘', '인플레이션 방지 기술'],
                    charts: [],
                    date: '2025-08-10'
                }],
                '2025-09': [],
                '2025-10': [],
                '2025-11': [],
                '2025-12': []
            },
            sec: {
                '2022-01': [],
                '2022-02': [],
                '2022-03': [{
                    id: 'sec-2022-03-1',
                    title: 'Form 20-F 연차보고서',
                    summary: ['2021 회계연도 실적 보고', 'SEC 제출 완료'],
                    charts: [],
                    date: '2022-03-31'
                }],
                '2022-04': [{
                    id: 'sec-2022-04-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['1분기 실적 발표', '주요 경영사항 공시'],
                    charts: [],
                    date: '2022-04-20'
                }],
                '2022-05': [],
                '2022-06': [],
                '2022-07': [{
                    id: 'sec-2022-07-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['2분기 실적 발표', '신작 개발 현황'],
                    charts: [],
                    date: '2022-07-25'
                }],
                '2022-08': [],
                '2022-09': [],
                '2022-10': [{
                    id: 'sec-2022-10-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['3분기 실적 발표', '해외 사업 확장'],
                    charts: [],
                    date: '2022-10-28'
                }],
                '2022-11': [],
                '2022-12': [],
                '2023-01': [],
                '2023-02': [],
                '2023-03': [{
                    id: 'sec-2023-03-1',
                    title: 'Form 20-F 연차보고서',
                    summary: ['2022 회계연도 실적 보고', 'SEC 제출 완료'],
                    charts: [],
                    date: '2023-03-31'
                }],
                '2023-04': [{
                    id: 'sec-2023-04-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['1분기 실적 발표', '신작 라인업 공개'],
                    charts: [],
                    date: '2023-04-20'
                }],
                '2023-05': [],
                '2023-06': [],
                '2023-07': [{
                    id: 'sec-2023-07-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['2분기 실적 발표', '글로벌 매출 성장'],
                    charts: [],
                    date: '2023-07-25'
                }],
                '2023-08': [],
                '2023-09': [],
                '2023-10': [{
                    id: 'sec-2023-10-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['3분기 실적 발표', '연간 가이던스 상향'],
                    charts: [],
                    date: '2023-10-28'
                }],
                '2023-11': [],
                '2023-12': [],
                '2024-01': [],
                '2024-02': [],
                '2024-03': [{
                    id: 'sec-2024-03-1',
                    title: 'Form 20-F 연차보고서',
                    summary: ['2023 회계연도 실적 보고', 'SEC 제출 완료'],
                    charts: [],
                    date: '2024-03-31'
                }],
                '2024-04': [{
                    id: 'sec-2024-04-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['1분기 실적 발표', '주요 경영사항 공시'],
                    charts: [],
                    date: '2024-04-20'
                }],
                '2024-05': [],
                '2024-06': [],
                '2024-07': [{
                    id: 'sec-2024-07-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['2분기 실적 발표', '신작 출시 관련 공시'],
                    charts: [],
                    date: '2024-07-25'
                }],
                '2024-08': [],
                '2024-09': [],
                '2024-10': [{
                    id: 'sec-2024-10-1',
                    title: 'Form 6-K 수시보고',
                    content: `FORM 6-K
REPORT OF FOREIGN PRIVATE ISSUER
PURSUANT TO RULE 13a-16 OR 15d-16
UNDER THE SECURITIES EXCHANGE ACT OF 1934

For the month of October 2024
Commission File Number: 001-41379

NEXON Co., Ltd.
(Translation of registrant's name into English)

1-6-1 Yoyogi, Shibuya-ku
Tokyo 151-0053, Japan
(Address of principal executive office)

SIGNATURES

Pursuant to the requirements of the Securities Exchange Act of 1934, the registrant has duly caused this report to be signed on its behalf by the undersigned, thereunto duly authorized.

NEXON Co., Ltd.

Date: October 28, 2024

By: /s/ Shiro Uemura
Name: Shiro Uemura
Title: Representative Director, President and CEO

EXHIBIT INDEX

Exhibit 99.1 - Consolidated Financial Results for the Third Quarter Ended September 30, 2024

CONSOLIDATED FINANCIAL RESULTS (Unaudited)
For the Nine Months Ended September 30, 2024

1. Consolidated Operating Results

Revenue: ¥346.2 billion (YoY +12%)
Operating Income: ¥98.4 billion (YoY +18%)
Net Income: ¥78.6 billion (YoY +15%)

2. Key Highlights

- MapleStory PC achieved record quarterly revenue in Korea
- Dungeon&Fighter Mobile maintained strong performance in China
- FC Online delivered stable results across regions
- The First Descendant launched globally with strong initial reception

3. Regional Performance

Korea: Revenue ¥142.8 billion (+15% YoY)
China: Revenue ¥89.3 billion (+8% YoY)
Japan: Revenue ¥58.7 billion (+11% YoY)
North America & Europe: Revenue ¥42.1 billion (+18% YoY)
Other: Revenue ¥13.3 billion (+5% YoY)

4. Share Repurchase Program

The Company announced a share repurchase program of up to ¥50 billion to be executed over the next 12 months, demonstrating commitment to shareholder returns.

5. Outlook

Full year 2024 revenue guidance maintained at ¥460-480 billion.
Continued investment in new game development and live services.`,
                    summary: ['3분기 매출 3,462억엔 (전년비 +12%)', '영업이익 984억엔 (전년비 +18%)', '메이플스토리 PC 한국 역대 최고 분기 매출', '더 퍼스트 디센던트 글로벌 런칭 호조', '자사주 매입 500억엔 규모 발표'],
                    charts: [],
                    date: '2024-10-28'
                }],
                '2024-11': [],
                '2024-12': [],
                '2025-01': [],
                '2025-02': [],
                '2025-03': [{
                    id: 'sec-2025-03-1',
                    title: 'Form 20-F 연차보고서',
                    summary: ['2024 회계연도 실적 보고', '역대 최고 실적 달성'],
                    charts: [],
                    date: '2025-03-31'
                }],
                '2025-04': [{
                    id: 'sec-2025-04-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['1분기 실적 발표', '신작 출시 일정 공개'],
                    charts: [],
                    date: '2025-04-20'
                }],
                '2025-05': [],
                '2025-06': [],
                '2025-07': [{
                    id: 'sec-2025-07-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['2분기 실적 발표', '퍼스트디센던트 1주년 성과'],
                    charts: [],
                    date: '2025-07-25'
                }],
                '2025-08': [],
                '2025-09': [],
                '2025-10': [{
                    id: 'sec-2025-10-1',
                    title: 'Form 6-K 수시보고',
                    summary: ['3분기 실적 발표', '연간 가이던스 상향'],
                    charts: [],
                    date: '2025-10-28'
                }],
                '2025-11': [],
                '2025-12': []
            },
            edinet: {
                '2022-01': [],
                '2022-02': [{
                    id: 'edinet-2022-02-1',
                    title: '유가증권보고서 (일본법인)',
                    summary: ['넥슨 재팬 2021년 실적', '일본 시장 매출 분석'],
                    charts: [],
                    date: '2022-02-28'
                }],
                '2022-03': [],
                '2022-04': [],
                '2022-05': [{
                    id: 'edinet-2022-05-1',
                    title: '분기보고서 Q1',
                    summary: ['일본법인 1분기 실적', '블루아카이브 출시 효과'],
                    charts: [],
                    date: '2022-05-15'
                }],
                '2022-06': [],
                '2022-07': [],
                '2022-08': [{
                    id: 'edinet-2022-08-1',
                    title: '분기보고서 Q2',
                    summary: ['일본법인 2분기 실적', '서브컬처 게임 성장'],
                    charts: [],
                    date: '2022-08-14'
                }],
                '2022-09': [],
                '2022-10': [],
                '2022-11': [{
                    id: 'edinet-2022-11-1',
                    title: '분기보고서 Q3',
                    summary: ['일본법인 3분기 실적', '블루아카이브 1주년 효과'],
                    charts: [],
                    date: '2022-11-14'
                }],
                '2022-12': [],
                '2023-01': [],
                '2023-02': [{
                    id: 'edinet-2023-02-1',
                    title: '유가증권보고서 (일본법인)',
                    summary: ['넥슨 재팬 2022년 실적', '일본 시장 매출 분석'],
                    charts: [],
                    date: '2023-02-28'
                }],
                '2023-03': [],
                '2023-04': [],
                '2023-05': [{
                    id: 'edinet-2023-05-1',
                    title: '분기보고서 Q1',
                    summary: ['일본법인 1분기 실적', '블루아카이브 매출 호조'],
                    charts: [],
                    date: '2023-05-15'
                }],
                '2023-06': [],
                '2023-07': [],
                '2023-08': [{
                    id: 'edinet-2023-08-1',
                    title: '분기보고서 Q2',
                    summary: ['일본법인 2분기 실적', '서브컬처 시장 선두'],
                    charts: [],
                    date: '2023-08-14'
                }],
                '2023-09': [],
                '2023-10': [],
                '2023-11': [{
                    id: 'edinet-2023-11-1',
                    title: '분기보고서 Q3',
                    summary: ['일본법인 3분기 실적', '블루아카이브 애니 발표 효과'],
                    charts: [],
                    date: '2023-11-14'
                }],
                '2023-12': [],
                '2024-01': [],
                '2024-02': [{
                    id: 'edinet-2024-02-1',
                    title: '유가증권보고서 (일본법인)',
                    summary: ['넥슨 재팬 2023년 실적', '일본 시장 매출 분석'],
                    charts: [],
                    date: '2024-02-28'
                }],
                '2024-03': [],
                '2024-04': [],
                '2024-05': [{
                    id: 'edinet-2024-05-1',
                    title: '분기보고서 Q1',
                    summary: ['일본법인 1분기 실적', '블루아카이브 매출 호조'],
                    charts: [],
                    date: '2024-05-15'
                }],
                '2024-06': [],
                '2024-07': [],
                '2024-08': [{
                    id: 'edinet-2024-08-1',
                    title: '분기보고서 Q2',
                    summary: ['일본법인 2분기 실적', '퍼스트 디센던트 일본 출시 효과'],
                    charts: [],
                    date: '2024-08-14'
                }],
                '2024-09': [],
                '2024-10': [],
                '2024-11': [{
                    id: 'edinet-2024-11-1',
                    title: '분기보고서 Q3',
                    content: `四半期報告書
第22期第3四半期（2024年7月1日～2024年9月30日）

株式会社ネクソン
東京都渋谷区代々木一丁目6番1号

【企業の概況】
1. 主要な経営指標等の推移

第3四半期連結累計期間（2024年1月1日～2024年9月30日）
・売上収益: 346,234百万円（前年同期比 +12.1%）
・営業利益: 98,421百万円（前年同期比 +18.3%）
・四半期利益: 78,612百万円（前年同期比 +15.2%）

2. 事業の状況

【経営成績の概況】
当第3四半期連結累計期間における世界経済は、インフレ圧力の緩和により緩やかな回復基調となりました。

オンラインゲーム業界においては、PCオンラインゲーム市場が安定的に推移する中、モバイルゲーム市場は競争が激化しております。

このような環境下、当社グループは以下の成果を達成しました。

【韓国】
・メイプルストーリー: 20周年記念イベントが大成功、四半期売上過去最高
・FCオンライン: EAスポーツFC25への移行が順調
・ダンジョンアンドファイター: 安定した収益貢献

【日本】
・ブルーアーカイブ: 2.5周年イベントで売上1位達成
・メイプルストーリー: 20周年コラボイベント好調

【中国】
・ダンジョンアンドファイターモバイル: 引き続き高い収益性を維持

【グローバル】
・The First Descendant: 7月のグローバルローンチ後、1,000万ダウンロード突破

3. 財政状態
・総資産: 1,234,567百万円
・純資産: 987,654百万円
・自己資本比率: 80.0%`,
                    summary: ['3분기 누적 매출 3,462억엔 (+12.1%)', '영업이익 984억엔 (+18.3%)', '메이플스토리 20주년 이벤트 대성공', '블루아카이브 일본 매출 1위 달성', 'The First Descendant 1000만 다운로드 돌파'],
                    charts: [],
                    date: '2024-11-14'
                }],
                '2024-12': [],
                '2025-01': [],
                '2025-02': [{
                    id: 'edinet-2025-02-1',
                    title: '유가증권보고서 (일본법인)',
                    summary: ['넥슨 재팬 2024년 연간 실적', '역대 최고 매출 달성'],
                    charts: [],
                    date: '2025-02-28'
                }],
                '2025-03': [],
                '2025-04': [],
                '2025-05': [{
                    id: 'edinet-2025-05-1',
                    title: '분기보고서 Q1',
                    summary: ['일본법인 1분기 실적', '신작 효과 반영'],
                    charts: [],
                    date: '2025-05-15'
                }],
                '2025-06': [],
                '2025-07': [],
                '2025-08': [{
                    id: 'edinet-2025-08-1',
                    title: '분기보고서 Q2',
                    summary: ['일본법인 2분기 실적', '블루아카이브 매출 증가'],
                    charts: [],
                    date: '2025-08-15'
                }],
                '2025-09': [],
                '2025-10': [],
                '2025-11': [{
                    id: 'edinet-2025-11-1',
                    title: '분기보고서 Q3',
                    summary: ['일본법인 3분기 실적', '연간 가이던스 달성 전망'],
                    charts: [],
                    date: '2025-11-14'
                }],
                '2025-12': []
            }
        };

        // 간단한 마크다운 파서
        function parseMarkdown(text) {
            if (!text) return '';

            let html = text
                // 테이블 처리
                .replace(/\|(.+)\|\n\|[-:| ]+\|\n((?:\|.+\|\n?)+)/g, (match, header, body) => {
                    const headers = header.split('|').filter(h => h.trim());
                    const rows = body.trim().split('\n').map(row =>
                        row.split('|').filter(c => c.trim())
                    );
                    return `<table class="analysis-table">
                        <thead><tr>${headers.map(h => `<th>${h.trim()}</th>`).join('')}</tr></thead>
                        <tbody>${rows.map(row => `<tr>${row.map(c => `<td>${c.trim()}</td>`).join('')}</tr>`).join('')}</tbody>
                    </table>`;
                })
                // h2 (##)
                .replace(/^## (.+)$/gm, '<h4>$1</h4>')
                // h3 (###)
                .replace(/^### (.+)$/gm, '<h5>$1</h5>')
                // 굵은 글씨 (**)
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                // 순서 있는 리스트
                .replace(/^\d+\. (.+)$/gm, '<li>$1</li>')
                // 순서 없는 리스트 (-)
                .replace(/^- (.+)$/gm, '<li>$1</li>')
                // 연속된 li를 ul/ol로 감싸기
                .replace(/(<li>.+<\/li>\n?)+/g, '<ul>$&</ul>')
                // 줄바꿈
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');

            return `<p>${html}</p>`;
        }

        // 시드 기반 난수 생성기
        function seededRandom(seed) {
            const x = Math.sin(seed++) * 10000;
            return x - Math.floor(x);
        }

        // 포럼 차트용 1년치 주가 데이터 생성 (postId별로 다른 패턴)
        function generateForumChartData(postId = 1) {
            const data = [];
            const now = new Date();
            const startDate = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());

            // postId에 따라 다른 시작 가격과 변동성
            const configs = {
                1: { startPrice: 180000, volatility: 3000, trend: 0.02, min: 160000, max: 220000 },
                2: { startPrice: 85000, volatility: 2000, trend: -0.01, min: 70000, max: 100000 },
                3: { startPrice: 320000, volatility: 8000, trend: 0.03, min: 280000, max: 400000 },
                default: { startPrice: 50000, volatility: 1500, trend: 0, min: 40000, max: 65000 }
            };
            const config = configs[postId] || configs.default;
            let price = config.startPrice;
            let seed = postId * 1000;

            for (let d = new Date(startDate); d <= now; d.setDate(d.getDate() + 1)) {
                if (d.getDay() !== 0 && d.getDay() !== 6) {
                    const rand = seededRandom(seed++);
                    const change = (rand - 0.48 + config.trend) * config.volatility;
                    price = Math.max(config.min, Math.min(config.max, price + change));
                    data.push({
                        date: new Date(d),
                        price: Math.round(price)
                    });
                }
            }
            return data;
        }

        // 포럼 차트 SVG 생성 (TradingView 스타일 - 단일 라인)
        function generateForumChartSVG(data, postId = 1) {
            if (!data || data.length === 0) return '';

            const width = 700;
            const height = 280;
            const padding = { top: 25, right: 30, bottom: 35, left: 60 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            // 가격 범위 계산
            const prices = data.map(d => d.price);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice || 1;

            // 스케일 함수
            const xScale = (index) => padding.left + (index / (data.length - 1)) * chartWidth;
            const yScale = (price) => padding.top + chartHeight - ((price - minPrice) / priceRange) * chartHeight;

            // 전체 라인 패스 생성
            let linePath = `M${xScale(0)},${yScale(data[0].price)}`;
            for (let i = 1; i < data.length; i++) {
                linePath += ` L${xScale(i)},${yScale(data[i].price)}`;
            }

            // 영역 채우기 패스
            const areaPath = linePath + ` L${xScale(data.length - 1)},${padding.top + chartHeight} L${xScale(0)},${padding.top + chartHeight} Z`;

            // 가격 포맷팅
            const formatPrice = (price) => {
                if (price >= 10000) return (price / 10000).toFixed(1) + '만';
                return price.toLocaleString();
            };

            // 월별 레이블
            const months = ['1월', '4월', '7월', '10월', '현재'];
            const monthPositions = [
                padding.left,
                padding.left + chartWidth * 0.25,
                padding.left + chartWidth * 0.5,
                padding.left + chartWidth * 0.75,
                padding.left + chartWidth
            ];

            // 마지막 가격 변동률 계산
            const firstPrice = data[0].price;
            const lastPrice = data[data.length - 1].price;
            const changePercent = ((lastPrice - firstPrice) / firstPrice * 100).toFixed(1);
            const isPositive = lastPrice >= firstPrice;

            // 라인 색상 (상승: 빨강, 하락: 파랑)
            const lineColor = isPositive ? '#ef5350' : '#42a5f5';

            // 그리드 라인 Y 위치
            const gridPrices = [maxPrice, (maxPrice + minPrice) / 2, minPrice];

            // gradient ID를 postId로 구분
            const gradientId = `forumChartGradient_${postId}`;

            return `
                <defs>
                    <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:${lineColor};stop-opacity:0.25"/>
                        <stop offset="100%" style="stop-color:${lineColor};stop-opacity:0.02"/>
                    </linearGradient>
                </defs>
                <!-- 그리드 라인 -->
                ${gridPrices.map(p => `<line x1="${padding.left}" y1="${yScale(p)}" x2="${width - padding.right}" y2="${yScale(p)}" stroke="#333" stroke-width="0.5" stroke-dasharray="3,3"/>`).join('')}
                <!-- 가격 축 -->
                ${gridPrices.map(p => `<text x="${padding.left - 8}" y="${yScale(p) + 4}" font-size="11" fill="#888" text-anchor="end">${formatPrice(p)}</text>`).join('')}
                <!-- 영역 채우기 -->
                <path d="${areaPath}" fill="url(#${gradientId})"/>
                <!-- 메인 라인 -->
                <path d="${linePath}" fill="none" stroke="${lineColor}" stroke-width="1.5"/>
                <!-- 시간 축 레이블 -->
                ${months.map((m, i) => `<text x="${monthPositions[i]}" y="${height - 10}" font-size="11" fill="#666" text-anchor="middle">${m}</text>`).join('')}
                <!-- 현재가 표시 -->
                <circle cx="${xScale(data.length - 1)}" cy="${yScale(lastPrice)}" r="4" fill="${lineColor}"/>
                <text x="${xScale(data.length - 1) + 10}" y="${yScale(lastPrice) + 4}" font-size="12" font-weight="500" fill="${lineColor}">${isPositive ? '+' : ''}${changePercent}%</text>
            `;
        }

        // 포럼 차트 데이터 캐시 (postId별)
        const forumChartDataCache = {};

        // 넥슨 주가 더미 데이터 생성
        function generateStockData() {
            const data = [];
            const startDate = new Date('2022-01-01');
            const endDate = new Date('2025-12-31');
            let price = 180000; // 시작 가격 (원)

            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                if (d.getDay() !== 0 && d.getDay() !== 6) { // 주말 제외
                    const change = (Math.random() - 0.48) * 5000;
                    price = Math.max(150000, Math.min(250000, price + change));
                    data.push([d.getTime(), Math.round(price)]);
                }
            }
            return data;
        }

        // 넥슨 분기별 매출액 데이터 생성
        function generateRevenueData() {
            const data = [];
            // 2022년 1월 ~ 2024년 12월 (12분기)
            const quarters = [
                { date: '2022-03-31', revenue: 0.85 },
                { date: '2022-06-30', revenue: 0.92 },
                { date: '2022-09-30', revenue: 1.05 },
                { date: '2022-12-31', revenue: 1.28 },
                { date: '2023-03-31', revenue: 0.95 },
                { date: '2023-06-30', revenue: 1.02 },
                { date: '2023-09-30', revenue: 1.15 },
                { date: '2023-12-31', revenue: 1.35 },
                { date: '2024-03-31', revenue: 1.08 },
                { date: '2024-06-30', revenue: 1.18 },
                { date: '2024-09-30', revenue: 1.25 },
                { date: '2024-12-31', revenue: 1.42 },
                { date: '2025-03-31', revenue: 1.15 },
                { date: '2025-06-30', revenue: 1.28 },
                { date: '2025-09-30', revenue: 1.35 },
                { date: '2025-12-31', revenue: 1.52 }
            ];

            quarters.forEach(q => {
                data.push([new Date(q.date).getTime(), q.revenue]);
            });

            return data;
        }

        // 영업이익 데이터 생성 (분기별)
        function generateOperatingProfitData() {
            const data = [];
            const quarters = [
                { date: '2022-03-31', profit: 2100 },
                { date: '2022-06-30', profit: 2450 },
                { date: '2022-09-30', profit: 2800 },
                { date: '2022-12-31', profit: 3500 },
                { date: '2023-03-31', profit: 2300 },
                { date: '2023-06-30', profit: 2650 },
                { date: '2023-09-30', profit: 3100 },
                { date: '2023-12-31', profit: 3800 },
                { date: '2024-03-31', profit: 2750 },
                { date: '2024-06-30', profit: 3200 },
                { date: '2024-09-30', profit: 3450 },
                { date: '2024-12-31', profit: 4100 },
                { date: '2025-03-31', profit: 2900 },
                { date: '2025-06-30', profit: 3400 },
                { date: '2025-09-30', profit: 3650 },
                { date: '2025-12-31', profit: 4350 }
            ];
            quarters.forEach(q => {
                data.push([new Date(q.date).getTime(), q.profit]);
            });
            return data;
        }

        // 순이익 데이터 생성 (분기별)
        function generateNetIncomeData() {
            const data = [];
            const quarters = [
                { date: '2022-03-31', income: 1680 },
                { date: '2022-06-30', income: 1960 },
                { date: '2022-09-30', income: 2240 },
                { date: '2022-12-31', income: 2800 },
                { date: '2023-03-31', income: 1840 },
                { date: '2023-06-30', income: 2120 },
                { date: '2023-09-30', income: 2480 },
                { date: '2023-12-31', income: 3040 },
                { date: '2024-03-31', income: 2200 },
                { date: '2024-06-30', income: 2560 },
                { date: '2024-09-30', income: 2760 },
                { date: '2024-12-31', income: 3280 },
                { date: '2025-03-31', income: 2320 },
                { date: '2025-06-30', income: 2720 },
                { date: '2025-09-30', income: 2920 },
                { date: '2025-12-31', income: 3480 }
            ];
            quarters.forEach(q => {
                data.push([new Date(q.date).getTime(), q.income]);
            });
            return data;
        }

        // USD/KRW 환율 데이터 생성 (일별)
        function generateExchangeRateData() {
            const data = [];
            const startDate = new Date('2022-01-01');
            const endDate = new Date('2025-12-31');
            let rate = 1200;

            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                if (d.getDay() !== 0 && d.getDay() !== 6) {
                    const change = (Math.random() - 0.5) * 15;
                    rate = Math.max(1100, Math.min(1450, rate + change));
                    data.push([d.getTime(), Math.round(rate)]);
                }
            }
            return data;
        }

        // PER 데이터 생성 (일별)
        function generatePERData() {
            const data = [];
            const startDate = new Date('2022-01-01');
            const endDate = new Date('2025-12-31');
            let per = 15;

            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                if (d.getDay() !== 0 && d.getDay() !== 6) {
                    const change = (Math.random() - 0.5) * 0.5;
                    per = Math.max(8, Math.min(25, per + change));
                    data.push([d.getTime(), Math.round(per * 100) / 100]);
                }
            }
            return data;
        }

        // PBR 데이터 생성 (일별)
        function generatePBRData() {
            const data = [];
            const startDate = new Date('2022-01-01');
            const endDate = new Date('2025-12-31');
            let pbr = 1.5;

            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                if (d.getDay() !== 0 && d.getDay() !== 6) {
                    const change = (Math.random() - 0.5) * 0.05;
                    pbr = Math.max(0.8, Math.min(3, pbr + change));
                    data.push([d.getTime(), Math.round(pbr * 100) / 100]);
                }
            }
            return data;
        }

        // 지표 설정
        const indicatorConfigs = {
            revenue: {
                name: '매출액',
                unit: '조원',
                color: '#888888',
                generateData: generateRevenueData,
                chartType: 'line',
                step: 'left',
                yAxisTitle: '매출액 (조원)',
                valueDecimals: 2
            },
            operatingProfit: {
                name: '영업이익',
                unit: '억원',
                color: '#4CAF50',
                generateData: generateOperatingProfitData,
                chartType: 'line',
                step: 'left',
                yAxisTitle: '영업이익 (억원)',
                valueDecimals: 0
            },
            netIncome: {
                name: '순이익',
                unit: '억원',
                color: '#2196F3',
                generateData: generateNetIncomeData,
                chartType: 'line',
                step: 'left',
                yAxisTitle: '순이익 (억원)',
                valueDecimals: 0
            },
            exchangeRate: {
                name: 'USD/KRW',
                unit: '원',
                color: '#FF9800',
                generateData: generateExchangeRateData,
                chartType: 'line',
                step: false,
                yAxisTitle: 'USD/KRW (원)',
                valueDecimals: 0
            },
            per: {
                name: 'PER',
                unit: '배',
                color: '#9C27B0',
                generateData: generatePERData,
                chartType: 'line',
                step: false,
                yAxisTitle: 'PER (배)',
                valueDecimals: 2
            },
            pbr: {
                name: 'PBR',
                unit: '배',
                color: '#00BCD4',
                generateData: generatePBRData,
                chartType: 'line',
                step: false,
                yAxisTitle: 'PBR (배)',
                valueDecimals: 2
            }
        };

        // 현재 활성화된 보조지표 (Y축 시리즈)
        let activeIndicators = ['revenue'];  // 기본: 매출액
        let currentSidebarTab = 'data';  // 현재 탭: data 또는 style

        // 시리즈 가시성 상태 (true = 보임, false = 숨김)
        let seriesVisibility = {
            stock: true  // 주가
        };

        // 스냅샷 차트 타입 정의
        const snapshotChartTypes = [
            { id: 'line', name: 'Line chart', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4,18 9,12 13,15 20,6"/></svg>` },
            { id: 'bar', name: 'Bar chart', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="12" width="4" height="8"/><rect x="10" y="8" width="4" height="12"/><rect x="16" y="4" width="4" height="16"/></svg>` },
            { id: 'area', name: 'Area chart', icon: `<svg viewBox="0 0 24 24" fill="currentColor" opacity="0.6"><path d="M4,20 L4,14 L9,10 L13,13 L20,6 L20,20 Z"/></svg>` }
        ];
        let currentSnapshotChartType = 'line';  // 현재 선택된 차트 타입

        // 사이드바 렌더링 - ChartLab 스타일
        function renderChartSidebar() {
            const sidebar = document.getElementById('chartSidebar');
            if (!sidebar) return;

            sidebar.innerHTML = `
                <div class="tab-toggle">
                    <button class="tab-btn ${currentSidebarTab === 'data' ? 'active' : ''}" onclick="switchSidebarTab('data')">데이터</button>
                    <button class="tab-btn ${currentSidebarTab === 'style' ? 'active' : ''}" onclick="switchSidebarTab('style')">스타일</button>
                </div>
                <div id="sidebarTabContent">
                    ${currentSidebarTab === 'data' ? renderDataTab() : renderStyleTab()}
                </div>
            `;
        }

        // 데이터 탭 렌더링
        function renderDataTab() {
            const currentType = snapshotChartTypes.find(t => t.id === currentSnapshotChartType) || snapshotChartTypes[0];
            return `
                <div class="sidebar-section">
                    <div class="section-title">차트 유형</div>
                    <div class="snapshot-custom-dropdown" id="snapshotChartTypeDropdown">
                        <div class="snapshot-dropdown-selected" onclick="toggleSnapshotChartTypeDropdown()">
                            <span class="snapshot-dropdown-icon">${currentType.icon}</span>
                            <span class="snapshot-dropdown-text">${currentType.name}</span>
                            <svg class="snapshot-dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6,9 12,15 18,9"/>
                            </svg>
                        </div>
                        <div class="snapshot-dropdown-options">
                            ${snapshotChartTypes.map(type => `
                                <div class="snapshot-dropdown-option ${currentSnapshotChartType === type.id ? 'selected' : ''}"
                                     onclick="selectSnapshotChartType('${type.id}')">
                                    <span class="snapshot-dropdown-icon">${type.icon}</span>
                                    <span>${type.name}</span>
                                    ${currentSnapshotChartType === type.id ? `<svg class="snapshot-dropdown-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">X축</div>
                    <div class="sidebar-dropdown">
                        <select class="dropdown-select" onchange="changeXAxisType(this.value)">
                            <option value="datetime" selected>날짜 (datetime)</option>
                            <option value="category">카테고리</option>
                        </select>
                    </div>
                    <div class="dropdown-row">
                        <div class="sidebar-dropdown">
                            <div class="dropdown-label">스케일 유형</div>
                            <select class="dropdown-select">
                                <option value="datetime" selected>날짜/시간</option>
                                <option value="linear">선형</option>
                            </select>
                        </div>
                        <div class="sidebar-dropdown">
                            <div class="dropdown-label">정렬</div>
                            <select class="dropdown-select">
                                <option value="asc">오름차순</option>
                                <option value="desc">내림차순</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-header" style="position: relative;">
                        <span class="section-title">시리즈</span>
                        <button class="section-add-btn" onclick="toggleIndicatorPopover(event)">+ 추가</button>
                        <div class="indicator-popover" id="indicatorPopover">
                            <div class="indicator-popover-list" id="indicatorPopoverList"></div>
                        </div>
                    </div>
                    <div id="yAxisSeriesList">
                        <!-- 주가 시리즈 (고정) -->
                        <div class="series-item ${!seriesVisibility.stock ? 'hidden' : ''}" onclick="toggleSeriesVisibility('stock')">
                            <span class="series-line" style="background: #E57B53;"></span>
                            <span class="series-name">주가</span>
                        </div>
                        <!-- 추가 지표 시리즈 -->
                        ${activeIndicators.map(key => {
                            const config = indicatorConfigs[key];
                            const isHidden = seriesVisibility[key] === false;
                            return `
                                <div class="series-item ${isHidden ? 'hidden' : ''}" onclick="toggleSeriesVisibility('${key}')">
                                    <span class="series-line" style="background: ${config.color};"></span>
                                    <span class="series-name">${config.name}</span>
                                    <button class="series-remove" onclick="event.stopPropagation(); removeIndicator('${key}')">&times;</button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // 스냅샷 차트 타입 드롭다운 토글
        function toggleSnapshotChartTypeDropdown() {
            const dropdown = document.getElementById('snapshotChartTypeDropdown');
            if (dropdown) {
                dropdown.classList.toggle('open');
            }
        }

        // 스냅샷 차트 타입 선택
        function selectSnapshotChartType(typeId) {
            currentSnapshotChartType = typeId;
            const dropdown = document.getElementById('snapshotChartTypeDropdown');
            if (dropdown) {
                dropdown.classList.remove('open');
            }
            renderChartSidebar();
            // TODO: 실제 차트 타입 변경 로직 추가 가능
        }

        // 스냅샷 드롭다운 외부 클릭 시 닫기
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.snapshot-custom-dropdown')) {
                document.querySelectorAll('.snapshot-custom-dropdown.open').forEach(d => d.classList.remove('open'));
            }
        });

        // 스타일 탭 렌더링
        function renderStyleTab() {
            return `
                <div class="sidebar-section">
                    <div class="section-title">라인 스타일</div>
                    <div class="sidebar-dropdown">
                        <div class="dropdown-label">선 두께</div>
                        <select class="dropdown-select" onchange="changeLineWidth(this.value)">
                            <option value="1">1px</option>
                            <option value="2" selected>2px</option>
                            <option value="3">3px</option>
                            <option value="4">4px</option>
                        </select>
                    </div>
                    <div class="sidebar-dropdown">
                        <div class="dropdown-label">마커 표시</div>
                        <select class="dropdown-select" onchange="toggleMarkers(this.value)">
                            <option value="true" selected>표시</option>
                            <option value="false">숨김</option>
                        </select>
                    </div>
                </div>
                <div class="sidebar-section">
                    <div class="section-title">축 설정</div>
                    <div class="sidebar-dropdown">
                        <div class="dropdown-label">Y축 위치</div>
                        <select class="dropdown-select">
                            <option value="left">왼쪽</option>
                            <option value="right" selected>오른쪽</option>
                        </select>
                    </div>
                </div>
            `;
        }

        // 탭 전환
        function switchSidebarTab(tab) {
            currentSidebarTab = tab;
            renderChartSidebar();
        }

        // 시리즈 가시성 토글
        function toggleSeriesVisibility(seriesKey) {
            // 가시성 상태 토글
            if (seriesVisibility[seriesKey] === undefined) {
                seriesVisibility[seriesKey] = false;  // 처음 클릭 시 숨김
            } else {
                seriesVisibility[seriesKey] = !seriesVisibility[seriesKey];
            }

            // Highcharts 시리즈 숨기기/보이기
            const chart = Highcharts.charts.find(c => c && c.renderTo && c.renderTo.id === 'stockChart');
            if (chart) {
                let seriesIndex;
                if (seriesKey === 'stock') {
                    seriesIndex = 0;  // 주가는 첫 번째 시리즈
                } else {
                    seriesIndex = activeIndicators.indexOf(seriesKey) + 1;  // 지표는 주가 다음
                }

                const series = chart.series[seriesIndex];
                if (series) {
                    if (seriesVisibility[seriesKey]) {
                        series.show();
                    } else {
                        series.hide();
                    }
                }
            }

            // 사이드바 UI 업데이트
            renderChartSidebar();
        }

        // 지표 추가 팝오버 토글
        function toggleIndicatorPopover(event) {
            event.stopPropagation();
            const popover = document.getElementById('indicatorPopover');
            const listContainer = document.getElementById('indicatorPopoverList');

            if (popover.classList.contains('visible')) {
                popover.classList.remove('visible');
                return;
            }

            const availableIndicators = Object.entries(indicatorConfigs)
                .filter(([key]) => !activeIndicators.includes(key));

            if (availableIndicators.length === 0) {
                listContainer.innerHTML = '<div class="indicator-popover-empty">추가할 지표가 없습니다</div>';
            } else {
                listContainer.innerHTML = availableIndicators.map(([key, config]) => `
                    <div class="indicator-popover-item" onclick="selectIndicatorFromPopover('${key}')">
                        <span class="indicator-color" style="background: ${config.color};"></span>
                        <span class="indicator-name">${config.name}</span>
                    </div>
                `).join('');
            }

            popover.classList.add('visible');
        }

        // 팝오버에서 지표 선택
        function selectIndicatorFromPopover(key) {
            addIndicator(key);
            document.getElementById('indicatorPopover').classList.remove('visible');
        }

        // 팝오버 외부 클릭 시 닫기
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.section-header')) {
                const popover = document.getElementById('indicatorPopover');
                if (popover) popover.classList.remove('visible');
            }
        });

        // 지표 추가
        function addIndicator(indicatorKey) {
            if (activeIndicators.includes(indicatorKey)) return;

            activeIndicators.push(indicatorKey);
            updateChartSeries();
            renderChartSidebar();
        }

        // 지표 제거
        function removeIndicator(indicatorKey) {
            const index = activeIndicators.indexOf(indicatorKey);
            if (index > -1) {
                activeIndicators.splice(index, 1);
                updateChartSeries();
                renderChartSidebar();
            }
        }

        // 차트 시리즈 업데이트
        function updateChartSeries() {
            const chart = Highcharts.charts.find(c => c && c.renderTo && c.renderTo.id === 'stockChart');
            if (!chart) return;

            // 주가 시리즈(인덱스 0)를 제외한 모든 시리즈 제거
            while (chart.series.length > 1) {
                chart.series[chart.series.length - 1].remove(false);
            }

            // 활성화된 지표들 추가
            activeIndicators.forEach(key => {
                const config = indicatorConfigs[key];
                chart.addSeries({
                    type: config.chartType,
                    step: config.step,
                    name: config.name,
                    data: config.generateData(),
                    color: config.color,
                    lineWidth: 2,
                    yAxis: 1,
                    marker: {
                        enabled: true,
                        radius: 4
                    },
                    tooltip: {
                        valueDecimals: config.valueDecimals,
                        valueSuffix: config.unit
                    }
                }, false);
            });

            // Y축 타이틀 업데이트
            if (activeIndicators.length > 0) {
                const firstConfig = indicatorConfigs[activeIndicators[0]];
                chart.yAxis[1].setTitle({ text: firstConfig.yAxisTitle }, false);
            } else {
                chart.yAxis[1].setTitle({ text: '' }, false);
            }

            chart.redraw();
        }

        // 라인 두께 변경
        function changeLineWidth(width) {
            const chart = Highcharts.charts.find(c => c && c.renderTo && c.renderTo.id === 'stockChart');
            if (!chart) return;

            chart.series.forEach(series => {
                series.update({ lineWidth: parseInt(width) }, false);
            });
            chart.redraw();
        }

        // 마커 토글
        function toggleMarkers(show) {
            const chart = Highcharts.charts.find(c => c && c.renderTo && c.renderTo.id === 'stockChart');
            if (!chart) return;

            chart.series.forEach((series, i) => {
                if (i > 0) { // 보조지표만
                    series.update({ marker: { enabled: show === 'true' } }, false);
                }
            });
            chart.redraw();
        }

        // X축 타입 변경 (placeholder)
        function changeXAxisType(type) {
            console.log('X axis type changed to:', type);
        }

        // 테이블 렌더링
        function renderTable(min, max) {
            const startDate = new Date(min);
            const endDate = new Date(max);

            let columns = [];
            // 선택된 기간 사용
            const grain = selectedPeriod;

            // 컬럼 생성
            if (grain === 'day') {
                // 일별: 각 날짜마다 컬럼
                let current = new Date(startDate);
                while (current <= endDate) {
                    columns.push({
                        label: `${current.getMonth() + 1}/${current.getDate()}`,
                        key: `${current.getFullYear()}-${String(current.getMonth() + 1).padStart(2, '0')}-${String(current.getDate()).padStart(2, '0')}`
                    });
                    current.setDate(current.getDate() + 1);
                }
            } else if (grain === 'month') {
                // 월별
                let current = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
                while (current <= endDate) {
                    const monthKey = `${current.getFullYear()}-${String(current.getMonth() + 1).padStart(2, '0')}`;
                    columns.push({
                        label: `${current.getMonth() + 1}월`,
                        key: monthKey
                    });
                    current.setMonth(current.getMonth() + 1);
                }
            } else if (grain === 'quarter') {
                // 분기별
                let current = new Date(startDate.getFullYear(), Math.floor(startDate.getMonth() / 3) * 3, 1);
                while (current <= endDate) {
                    const quarter = Math.floor(current.getMonth() / 3) + 1;
                    columns.push({
                        label: `${current.getFullYear()} Q${quarter}`,
                        key: `${current.getFullYear()}-Q${quarter}`
                    });
                    current.setMonth(current.getMonth() + 3);
                }
            } else if (grain === 'year') {
                // 연별: 각 연도마다 컬럼
                let current = new Date(startDate.getFullYear(), 0, 1);
                while (current <= endDate) {
                    columns.push({
                        label: `${current.getFullYear()}`,
                        key: `${current.getFullYear()}`
                    });
                    current.setFullYear(current.getFullYear() + 1);
                }
            }

            const table = document.getElementById('dataTable');
            // 활성화된 출처만 표시 (기본 출처 + 커스텀 출처)
            const sources = [...activeSources.filter(s => defaultSources.includes(s)), ...Object.keys(customSources).filter(s => activeSources.includes(s))];
            const sourceNamesShort = {
                dart: '공시',
                darkReport: '다크리포트',
                policy: '정책/규제',
                paper: '논문',
                patent: '특허',
                sec: 'SEC',
                edinet: 'EDINET',
                ...Object.fromEntries(Object.entries(customSources).map(([k, v]) => [k, v.name]))
            };

            let html = '<thead>';

            // 월별일 때 두 줄 헤더 (연도 + 1~12월)
            if (grain === 'month') {
                // 연도별로 컬럼 그룹화
                const yearGroups = {};
                columns.forEach(col => {
                    const year = col.key.split('-')[0];
                    if (!yearGroups[year]) yearGroups[year] = [];
                    yearGroups[year].push(col);
                });
                const years = Object.keys(yearGroups).sort();

                // 첫 번째 행: 연도
                html += `<tr><th rowspan="2">
                    <div class="period-selector">
                        <button class="period-btn${selectedPeriod === 'day' ? ' active' : ''}" data-period="day">D</button>
                        <button class="period-btn${selectedPeriod === 'month' ? ' active' : ''}" data-period="month">M</button>
                        <button class="period-btn${selectedPeriod === 'quarter' ? ' active' : ''}" data-period="quarter">Q</button>
                        <button class="period-btn${selectedPeriod === 'year' ? ' active' : ''}" data-period="year">Y</button>
                    </div>
                    <div class="source-manager-container">
                        <button class="source-manager-btn" onclick="toggleSourceManager(event)">
                            <span>출처</span>
                            <span style="font-size: 9px;">▼</span>
                        </button>
                        <div class="source-manager-panel" id="sourceManagerPanel"></div>
                    </div>
                </th>`;
                years.forEach(year => {
                    html += `<th colspan="${yearGroups[year].length}" class="year-header">${year}</th>`;
                });
                html += '</tr>';

                // 두 번째 행: 월 (1~12)
                html += '<tr>';
                columns.forEach(col => {
                    const month = parseInt(col.key.split('-')[1]);
                    html += `<th class="period-header month-header" onclick="handlePeriodHeaderClick('${col.key}', '${grain}')">${month}</th>`;
                });
                html += '</tr>';
            } else {
                // 기존 단일 행 헤더
                html += `<tr><th>
                    <div class="period-selector">
                        <button class="period-btn${selectedPeriod === 'day' ? ' active' : ''}" data-period="day">D</button>
                        <button class="period-btn${selectedPeriod === 'month' ? ' active' : ''}" data-period="month">M</button>
                        <button class="period-btn${selectedPeriod === 'quarter' ? ' active' : ''}" data-period="quarter">Q</button>
                        <button class="period-btn${selectedPeriod === 'year' ? ' active' : ''}" data-period="year">Y</button>
                    </div>
                    <div class="source-manager-container">
                        <button class="source-manager-btn" onclick="toggleSourceManager(event)">
                            <span>출처</span>
                            <span style="font-size: 9px;">▼</span>
                        </button>
                        <div class="source-manager-panel" id="sourceManagerPanel"></div>
                    </div>
                </th>`;
                columns.forEach(col => {
                    html += `<th class="period-header" onclick="handlePeriodHeaderClick('${col.key}', '${grain}')">${col.label}</th>`;
                });
                html += '</tr>';
            }
            html += '</thead><tbody>';

            sources.forEach(src => {
                const isCustom = Object.keys(customSources).includes(src);
                html += `<tr><td class="source-name" onclick="showSourceDetail('${src}')">${sourceNamesShort[src]}</td>`;
                columns.forEach(col => {
                    const events = getEventsForPeriod(src, col.key, grain);
                    const count = events.length;
                    if (count > 0) {
                        const tooltipText = getTooltipText(events);
                        const cellContent = getCellPreview(events);
                        html += `<td class="has-data" title="${tooltipText}" onclick="handleCellClick(event, '${src}', '${col.key}', '${grain}')">${cellContent}</td>`;
                    } else {
                        html += '<td>-</td>';
                    }
                });
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;

            // 출처 관리 패널 렌더링
            renderSourceManagerPanel();
        }

        // 출처 클릭 시 우측 패널에 보고서 목록 표시
        function showSourceDetail(source) {
            rightPanelView = 'list';
            currentListSource = source;

            const container = document.getElementById('detailContainer');
            // 기본 출처 또는 커스텀 출처 데이터 조회
            const data = sourceData[source] || customSourceData[source];
            const events = eventData[source] || customEventData[source];

            if (!data || !events) return;

            // eventData에서 모든 이벤트 수집
            const allEvents = [];
            Object.keys(events).forEach(key => {
                events[key].forEach(event => {
                    allEvents.push(event);
                });
            });

            // 날짜 역순 정렬 (최신순)
            allEvents.sort((a, b) => new Date(b.date) - new Date(a.date));

            let itemsHtml = '';
            allEvents.forEach(event => {
                // 날짜 포맷: YYYY-MM-DD → MM.DD
                const dateStr = event.date ? event.date.substring(5).replace('-', '.') : '';

                // 매출액 관련 항목 추출 (summary에서 '매출' 또는 '조원' 포함 항목)
                const revenueItem = event.summary ?
                    event.summary.find(s => s.includes('매출') || s.includes('조원')) : null;
                const revenueText = revenueItem ? revenueItem : '';

                const monthKey = event.date ? event.date.substring(0, 7) : '';
                const isCustom = source.startsWith('custom_');
                const dataSource = isCustom ? 'customEventData' : 'eventData';

                itemsHtml += `<div class="list-item" onclick="showDetail(${dataSource}['${source}']['${monthKey}'].find(e => e.id === '${event.id}'), '${source}')">
                    <span class="list-item-date">${dateStr}</span>
                    <span class="list-item-title">${event.title}</span>
                    <span class="list-item-revenue">${revenueText}</span>
                </div>`;
            });

            container.innerHTML = `
                <div class="list-view">
                    <div class="list-header">
                        <span class="list-title">${data.name} (${allEvents.length}건)</span>
                    </div>
                    <div class="list-content">
                        ${itemsHtml}
                    </div>
                </div>
            `;
        }

        // 기간별 이벤트 조회
        function getEventsForPeriod(source, key, grain) {
            const events = [];
            // 기본 출처 또는 커스텀 출처 데이터 조회
            const data = eventData[source] || customEventData[source];

            if (!data) return events;

            if (grain === 'day') {
                // 일별: YYYY-MM-DD 키에서 해당 월 데이터 내 특정 날짜 필터
                const [year, month, day] = key.split('-');
                const monthKey = `${year}-${month}`;
                if (data[monthKey]) {
                    events.push(...data[monthKey].filter(e => {
                        if (e.date) {
                            const eventDate = new Date(e.date);
                            return eventDate.getDate() === parseInt(day);
                        }
                        return false;
                    }));
                }
            } else if (grain === 'month') {
                // 월별
                if (data[key]) {
                    events.push(...data[key]);
                }
            } else if (grain === 'quarter') {
                // 분기별
                const [year, q] = key.split('-Q');
                const quarter = parseInt(q);
                const months = [(quarter - 1) * 3 + 1, (quarter - 1) * 3 + 2, (quarter - 1) * 3 + 3];
                months.forEach(m => {
                    const monthKey = `${year}-${String(m).padStart(2, '0')}`;
                    if (data[monthKey]) {
                        events.push(...data[monthKey]);
                    }
                });
            } else if (grain === 'year') {
                // 연별: 해당 연도의 모든 월 데이터 집계
                const year = key;
                for (let m = 1; m <= 12; m++) {
                    const monthKey = `${year}-${String(m).padStart(2, '0')}`;
                    if (data[monthKey]) {
                        events.push(...data[monthKey]);
                    }
                }
            }

            return events;
        }

        // 툴팁 텍스트 생성
        function getTooltipText(events) {
            if (events.length === 0) return '';
            const firstTitle = events[0].title;
            if (events.length === 1) {
                return firstTitle;
            }
            return `${firstTitle} 외 ${events.length - 1}건`;
        }

        // 셀 미리보기 생성
        function getCellPreview(events) {
            if (events.length === 0) return '-';
            return `<span class="cell-count">${events.length}건</span>`;
        }

        // 출처명 매핑
        const sourceNames = {
            dart: '공시(DART)',
            darkReport: '다크리포트',
            policy: '정책/규제',
            paper: '논문',
            patent: '특허',
            sec: 'SEC',
            edinet: 'EDINET'
        };

        // ===== 출처 관리 기능 =====

        // 출처 관리 패널 토글
        function toggleSourceManager(event) {
            event.stopPropagation();
            const panel = document.getElementById('sourceManagerPanel');
            const btn = event.currentTarget;
            const isOpening = !panel.classList.contains('visible');

            panel.classList.toggle('visible');
            btn.classList.toggle('active');

            // 패널 열 때 임시 상태 초기화 및 렌더링
            if (isOpening) {
                tempActiveSources = [...activeSources];
                renderSourceManagerPanel();

                // 버튼 위치 기준으로 패널 위치 설정 (fixed 포지션용)
                const btnRect = btn.getBoundingClientRect();
                panel.style.top = (btnRect.bottom + 4) + 'px';
                panel.style.left = btnRect.left + 'px';
            }
        }

        // 출처 관리 패널 렌더링
        function renderSourceManagerPanel() {
            const panel = document.getElementById('sourceManagerPanel');
            if (!panel) return;

            // 피드 소스 카테고리
            const feedCategories = [
                { key: 'disclosure', name: '공시' },
                { key: 'sec', name: 'SEC' },
                { key: 'edinet', name: 'EDINET' },
                { key: 'legislation', name: '법령' },
                { key: 'policy', name: '정책' },
                { key: 'macro', name: '거시지표' },
                { key: 'patent', name: '특허' },
                { key: 'research', name: '논문' },
                { key: 'bloomberg', name: 'Bloomberg' },
                { key: 'nytimes', name: 'NY Times' },
                { key: 'reuters', name: 'Reuters' },
                { key: 'wsj', name: 'WSJ' }
            ];

            // 이미 추가된 피드 소스 확인
            const addedFeedSources = Object.keys(customSources).filter(key => key.startsWith('feed_'));

            let mainHtml = `
                <div class="source-manager-section">
                    <div class="source-manager-section-title">기본 출처</div>
                    ${defaultSources.map(src => `
                        <label class="source-checkbox-item" onclick="event.stopPropagation()">
                            <input type="checkbox" ${tempActiveSources.includes(src) ? 'checked' : ''}
                                   onchange="toggleTempSource('${src}')" />
                            <span>${sourceNames[src] || src}</span>
                        </label>
                    `).join('')}
                </div>
            `;

            // 커스텀 출처가 있으면 표시
            const customKeys = Object.keys(customSources);
            if (customKeys.length > 0) {
                mainHtml += `
                    <div class="source-manager-divider"></div>
                    <div class="source-manager-section">
                        <div class="source-manager-section-title">커스텀 출처</div>
                        ${customKeys.map(key => `
                            <div class="source-checkbox-item custom" onclick="event.stopPropagation()">
                                <label style="display: flex; align-items: center; gap: 8px; flex: 1;">
                                    <input type="checkbox" ${tempActiveSources.includes(key) ? 'checked' : ''}
                                           onchange="toggleTempSource('${key}')" />
                                    <span>${customSources[key].name}</span>
                                </label>
                                <button class="delete-btn" onclick="event.stopPropagation(); removeCustomSource('${key}')" title="삭제">×</button>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            mainHtml += `
                <div class="source-manager-divider"></div>
                <button class="upload-btn" onclick="event.stopPropagation(); toggleFeedSourceColumn()">
                    <span>+</span>
                    <span>피드 소스 추가</span>
                </button>
                <div class="source-manager-divider"></div>
                <button class="source-apply-btn" onclick="event.stopPropagation(); applySourceChanges()">
                    적용하기
                </button>
            `;

            // 피드 소스 컬럼 HTML
            const feedColumnHtml = `
                <div class="feed-source-column-inner">
                    <div class="feed-source-column-title">피드 소스</div>
                    <input type="text" class="feed-source-column-search"
                           placeholder="검색..."
                           oninput="filterFeedSourcesColumn(this.value)"
                           onclick="event.stopPropagation()">
                    <div class="feed-source-column-list">
                        ${feedCategories.map(cat => {
                            const feedKey = 'feed_' + cat.key;
                            const isAdded = addedFeedSources.includes(feedKey);
                            return `
                                <div class="feed-source-column-item ${isAdded ? 'disabled' : ''}"
                                     data-key="${cat.key}"
                                     onclick="event.stopPropagation(); ${isAdded ? '' : 'toggleFeedSourceColumnItem(this)'}">
                                    <input type="checkbox" ${isAdded ? 'disabled checked' : ''} onclick="event.stopPropagation()">
                                    <span>${cat.name}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div class="feed-source-column-actions">
                        <button onclick="event.stopPropagation(); closeFeedSourceColumn()">취소</button>
                        <button class="primary" onclick="event.stopPropagation(); submitFeedSourcesColumn()">추가</button>
                    </div>
                </div>
            `;

            panel.innerHTML = `
                <div class="source-manager-main">${mainHtml}</div>
                <div class="feed-source-column">${feedColumnHtml}</div>
            `;
        }

        // 출처 직접 토글 (체크박스 변경 시 바로 적용)
        function toggleSourceDirect(sourceKey, isChecked) {
            if (isChecked) {
                if (!activeSources.includes(sourceKey)) {
                    activeSources.push(sourceKey);
                }
            } else {
                const idx = activeSources.indexOf(sourceKey);
                if (idx > -1) {
                    activeSources.splice(idx, 1);
                }
            }
            tempActiveSources = [...activeSources];

            // 테이블 다시 렌더링
            if (window.stockChart && window.stockChart.xAxis && window.stockChart.xAxis[0]) {
                const extremes = window.stockChart.xAxis[0].getExtremes();
                if (extremes && extremes.min && extremes.max) {
                    renderTable(extremes.min, extremes.max);
                }
            } else if (typeof stockData !== 'undefined' && stockData && stockData.length > 0) {
                const firstDate = stockData[0][0];
                const lastDate = stockData[stockData.length - 1][0];
                renderTable(firstDate, lastDate);
            }
        }

        // 출처 패널 닫기
        function closeSourcePanel() {
            const panel = document.getElementById('sourceManagerPanel');
            const btn = document.querySelector('.source-manager-btn');
            if (panel) panel.classList.remove('visible');
            if (btn) btn.classList.remove('active');
        }

        // 임시 출처 토글 (레거시)
        function toggleTempSource(sourceKey) {
            const idx = tempActiveSources.indexOf(sourceKey);
            if (idx > -1) {
                tempActiveSources.splice(idx, 1);
            } else {
                tempActiveSources.push(sourceKey);
            }
        }

        // 출처 변경 적용
        function applySourceChanges() {
            activeSources = [...tempActiveSources];

            // 패널 닫기
            const panel = document.getElementById('sourceManagerPanel');
            const btn = document.querySelector('.source-manager-btn');
            if (panel) panel.classList.remove('visible');
            if (btn) btn.classList.remove('active');

            // 테이블 다시 렌더링 - 모든 기간(D/M/Q/Y)에 일괄 적용
            let min, max;

            // Highcharts에서 차트 찾기 (initPeriodSelector와 동일한 방식)
            const chart = Highcharts.charts.find(c => c && c.renderTo && c.renderTo.id === 'stockChart');
            if (chart && chart.xAxis && chart.xAxis[0]) {
                try {
                    const extremes = chart.xAxis[0].getExtremes();
                    min = extremes.min;
                    max = extremes.max;
                } catch (e) {}
            }

            // 차트에서 못 가져오면 stockData에서
            if (!min || !max) {
                if (typeof stockData !== 'undefined' && stockData && stockData.length > 0) {
                    min = stockData[0][0];
                    max = stockData[stockData.length - 1][0];
                }
            }

            // 범위가 있으면 렌더링
            if (min && max) {
                renderTable(min, max);
            }
        }

        // 출처 토글 (레거시 - 직접 적용)
        function toggleSource(sourceKey) {
            const idx = activeSources.indexOf(sourceKey);
            if (idx > -1) {
                activeSources.splice(idx, 1);
            } else {
                activeSources.push(sourceKey);
            }
            tempActiveSources = [...activeSources];
            // 테이블 다시 렌더링
            if (window.stockChart) {
                const extremes = window.stockChart.xAxis[0].getExtremes();
                renderTable(extremes.min, extremes.max);
            }
        }

        // 업로드 모달 표시
        function showUploadModal() {
            // 패널 닫기
            const panel = document.getElementById('sourceManagerPanel');
            const btn = document.querySelector('.source-manager-btn');
            if (panel) panel.classList.remove('visible');
            if (btn) btn.classList.remove('active');

            // 모달이 없으면 생성
            let modal = document.getElementById('uploadModalOverlay');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'uploadModalOverlay';
                modal.className = 'upload-modal-overlay';
                modal.innerHTML = `
                    <div class="upload-modal">
                        <div class="upload-modal-header">
                            <span class="upload-modal-title">데이터 업로드</span>
                            <button class="upload-modal-close" onclick="hideUploadModal()">×</button>
                        </div>
                        <div class="upload-form-group">
                            <label class="upload-form-label">출처명 *</label>
                            <input type="text" class="upload-form-input" id="uploadSourceName"
                                   placeholder="예: 내부 보고서, 리서치 자료" />
                        </div>
                        <div class="upload-form-group">
                            <label class="upload-form-label">파일 선택</label>
                            <div class="upload-dropzone" id="uploadDropzone" onclick="document.getElementById('uploadFileInput').click()">
                                <div class="upload-dropzone-text">클릭하여 파일 선택</div>
                                <div class="upload-dropzone-hint">CSV, JSON, Excel (.xlsx) 지원</div>
                            </div>
                            <input type="file" id="uploadFileInput" style="display: none;"
                                   accept=".csv,.json,.xlsx" onchange="handleFileSelect(event)" />
                            <div class="upload-file-info" id="uploadFileInfo" style="display: none;">
                                <span class="upload-file-name" id="uploadFileName"></span>
                                <button class="upload-file-remove" onclick="clearFileSelection()">×</button>
                            </div>
                            <div class="upload-format-info">
                                <strong>데이터 형식:</strong><br>
                                • CSV/Excel: date, title, summary 컬럼<br>
                                • JSON: [{ date, title, summary }] 배열<br>
                                <em style="color: var(--claude-orange);">파일 없이 출처명만 입력하면 샘플 데이터로 추가됩니다.</em>
                            </div>
                        </div>
                        <div class="upload-modal-actions">
                            <button class="upload-modal-btn cancel" onclick="hideUploadModal()">취소</button>
                            <button class="upload-modal-btn submit" id="uploadSubmitBtn" onclick="submitUpload()">추가</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // 드래그 앤 드롭 이벤트
                const dropzone = modal.querySelector('#uploadDropzone');
                dropzone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropzone.classList.add('dragover');
                });
                dropzone.addEventListener('dragleave', () => {
                    dropzone.classList.remove('dragover');
                });
                dropzone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropzone.classList.remove('dragover');
                    if (e.dataTransfer.files.length > 0) {
                        handleFileSelectDrop(e.dataTransfer.files[0]);
                    }
                });

                // 오버레이 클릭 시 닫기
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) hideUploadModal();
                });
            }

            // 폼 초기화
            document.getElementById('uploadSourceName').value = '';
            clearFileSelection();

            // 모달 표시
            modal.classList.add('visible');
        }

        // 업로드 모달 숨기기
        function hideUploadModal() {
            const modal = document.getElementById('uploadModalOverlay');
            if (modal) {
                modal.classList.remove('visible');
            }
        }

        // 피드 소스 컬럼 토글 (파인더 스타일)
        function toggleFeedSourceColumn() {
            const panel = document.getElementById('sourceManagerPanel');
            if (panel) {
                panel.classList.toggle('expanded');
            }
        }

        // 피드 소스 컬럼 닫기
        function closeFeedSourceColumn() {
            const panel = document.getElementById('sourceManagerPanel');
            if (panel) {
                panel.classList.remove('expanded');
                // 선택 초기화
                const items = panel.querySelectorAll('.feed-source-column-item.selected');
                items.forEach(item => {
                    item.classList.remove('selected');
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    if (checkbox && !checkbox.disabled) checkbox.checked = false;
                });
                // 검색창 초기화
                const searchInput = panel.querySelector('.feed-source-column-search');
                if (searchInput) {
                    searchInput.value = '';
                    filterFeedSourcesColumn('');
                }
            }
        }

        // 피드 소스 컬럼 검색 필터
        function filterFeedSourcesColumn(query) {
            const items = document.querySelectorAll('.feed-source-column-item');
            const lowerQuery = query.toLowerCase();
            items.forEach(item => {
                const name = item.querySelector('span').textContent.toLowerCase();
                item.style.display = name.includes(lowerQuery) ? '' : 'none';
            });
        }

        // 피드 소스 컬럼 아이템 토글
        function toggleFeedSourceColumnItem(element) {
            if (element.classList.contains('disabled')) return;
            element.classList.toggle('selected');
            const checkbox = element.querySelector('input[type="checkbox"]');
            if (checkbox) checkbox.checked = !checkbox.checked;
        }

        // 피드 소스 컬럼에서 추가
        function submitFeedSourcesColumn() {
            const selectedItems = document.querySelectorAll('.feed-source-column-item.selected');
            if (selectedItems.length === 0) {
                alert('추가할 소스를 선택해주세요.');
                return;
            }

            selectedItems.forEach(item => {
                const key = item.dataset.key;
                addFeedSourceToTable(key);
            });

            // 패널 업데이트 및 컬럼 닫기
            closeFeedSourceColumn();
            renderSourceManagerPanel();
        }

        // 피드 소스를 테이블에 추가
        function addFeedSourceToTable(feedKey) {
            const feedData = feedSourceData[feedKey];
            if (!feedData) return;

            const sourceKey = 'feed_' + feedKey;
            const sourceName = feedData.title;

            // feedSourceData의 items를 이벤트 형식으로 변환
            const events = feedData.items.map((item, index) => {
                // time 형식: "2026.01.31 16:30" → "2026-01-31"
                const dateParts = item.time.split(' ')[0].split('.');
                const date = `${dateParts[0]}-${dateParts[1]}-${dateParts[2]}`;

                return {
                    id: `${sourceKey}-${index}`,
                    date: date,
                    title: item.title,
                    summary: [item.source, item.time]
                };
            });

            // 기존 addCustomSource 함수 활용
            addCustomSource(sourceKey, sourceName, events);
        }

        // 선택된 파일 정보 저장
        let selectedUploadFile = null;

        // 파일 선택 처리
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFileSelectDrop(file);
            }
        }

        function handleFileSelectDrop(file) {
            selectedUploadFile = file;
            document.getElementById('uploadFileName').textContent = file.name;
            document.getElementById('uploadFileInfo').style.display = 'flex';
            document.getElementById('uploadDropzone').style.display = 'none';
        }

        // 파일 선택 취소
        function clearFileSelection() {
            selectedUploadFile = null;
            document.getElementById('uploadFileInput').value = '';
            document.getElementById('uploadFileInfo').style.display = 'none';
            document.getElementById('uploadDropzone').style.display = 'block';
        }

        // 업로드 제출
        function submitUpload() {
            const sourceName = document.getElementById('uploadSourceName').value.trim();
            if (!sourceName) {
                alert('출처명을 입력해주세요.');
                return;
            }

            // 고유 키 생성
            const sourceKey = 'custom_' + Date.now();

            if (selectedUploadFile) {
                // 파일이 있으면 파싱
                parseUploadedFile(selectedUploadFile, sourceKey, sourceName);
            } else {
                // 파일이 없으면 샘플 데이터로 추가
                addCustomSourceWithSampleData(sourceKey, sourceName);
            }

            hideUploadModal();
        }

        // 파일 파싱
        function parseUploadedFile(file, sourceKey, sourceName) {
            const reader = new FileReader();
            const extension = file.name.split('.').pop().toLowerCase();

            reader.onload = function(e) {
                let events = [];

                try {
                    if (extension === 'json') {
                        events = parseJSON(e.target.result);
                    } else if (extension === 'csv') {
                        events = parseCSV(e.target.result);
                    } else if (extension === 'xlsx') {
                        // Excel 파싱은 라이브러리 필요 - 데모용 샘플 데이터 사용
                        console.log('Excel 파일은 데모 모드에서 샘플 데이터로 대체됩니다.');
                        addCustomSourceWithSampleData(sourceKey, sourceName);
                        return;
                    }

                    if (events.length > 0) {
                        addCustomSource(sourceKey, sourceName, events);
                    } else {
                        addCustomSourceWithSampleData(sourceKey, sourceName);
                    }
                } catch (error) {
                    console.error('파일 파싱 오류:', error);
                    addCustomSourceWithSampleData(sourceKey, sourceName);
                }
            };

            reader.readAsText(file);
        }

        // CSV 파싱
        function parseCSV(content) {
            const lines = content.trim().split('\n');
            if (lines.length < 2) return [];

            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            const dateIdx = headers.indexOf('date');
            const titleIdx = headers.indexOf('title');
            const summaryIdx = headers.indexOf('summary');

            if (dateIdx === -1 || titleIdx === -1) return [];

            const events = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length >= 2) {
                    events.push({
                        id: `custom-${Date.now()}-${i}`,
                        date: values[dateIdx]?.trim() || '',
                        title: values[titleIdx]?.trim() || '',
                        summary: summaryIdx > -1 && values[summaryIdx] ?
                            values[summaryIdx].trim().split(';').map(s => s.trim()) : []
                    });
                }
            }
            return events;
        }

        // JSON 파싱
        function parseJSON(content) {
            const data = JSON.parse(content);
            const arr = Array.isArray(data) ? data : [data];

            return arr.map((item, idx) => ({
                id: `custom-${Date.now()}-${idx}`,
                date: item.date || '',
                title: item.title || '',
                summary: Array.isArray(item.summary) ? item.summary :
                    (item.summary ? [item.summary] : [])
            }));
        }

        // 커스텀 출처 추가 (파싱된 데이터)
        function addCustomSource(sourceKey, sourceName, events) {
            // 커스텀 출처 등록
            customSources[sourceKey] = { name: sourceName };
            customSourceData[sourceKey] = { name: sourceName, items: events.map(e => e.title) };

            // 이벤트 데이터를 월별로 그룹화
            const groupedEvents = {};
            events.forEach(event => {
                if (event.date) {
                    const monthKey = event.date.substring(0, 7);
                    if (!groupedEvents[monthKey]) {
                        groupedEvents[monthKey] = [];
                    }
                    groupedEvents[monthKey].push(event);
                }
            });
            customEventData[sourceKey] = groupedEvents;

            // 활성 출처에 추가
            if (!activeSources.includes(sourceKey)) {
                activeSources.push(sourceKey);
            }

            // 테이블 다시 렌더링
            if (window.stockChart) {
                const extremes = window.stockChart.xAxis[0].getExtremes();
                renderTable(extremes.min, extremes.max);
            }
        }

        // 샘플 데이터로 커스텀 출처 추가
        function addCustomSourceWithSampleData(sourceKey, sourceName) {
            const sampleEvents = [
                {
                    id: `${sourceKey}-sample-1`,
                    date: '2024-01-15',
                    title: `${sourceName} - 샘플 보고서 1`,
                    summary: ['샘플 데이터입니다', '실제 파일을 업로드하면 대체됩니다']
                },
                {
                    id: `${sourceKey}-sample-2`,
                    date: '2024-02-20',
                    title: `${sourceName} - 샘플 보고서 2`,
                    summary: ['2월 샘플 데이터']
                },
                {
                    id: `${sourceKey}-sample-3`,
                    date: '2024-03-10',
                    title: `${sourceName} - 샘플 보고서 3`,
                    summary: ['3월 샘플 데이터']
                }
            ];

            addCustomSource(sourceKey, sourceName, sampleEvents);
        }

        // 커스텀 출처 삭제
        function removeCustomSource(sourceKey) {
            if (!confirm('이 출처를 삭제하시겠습니까?')) return;

            delete customSources[sourceKey];
            delete customSourceData[sourceKey];
            delete customEventData[sourceKey];

            // 활성 출처에서 제거
            const idx = activeSources.indexOf(sourceKey);
            if (idx > -1) {
                activeSources.splice(idx, 1);
            }

            // 임시 출처에서도 제거
            const tempIdx = tempActiveSources.indexOf(sourceKey);
            if (tempIdx > -1) {
                tempActiveSources.splice(tempIdx, 1);
            }

            // 패널 다시 렌더링
            renderSourceManagerPanel();

            // 테이블 다시 렌더링
            if (window.stockChart) {
                const extremes = window.stockChart.xAxis[0].getExtremes();
                renderTable(extremes.min, extremes.max);
            }
        }

        // 패널 외부 클릭 시 닫기
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('sourceManagerPanel');
            const btn = document.querySelector('.source-manager-btn');
            if (panel && !panel.contains(e.target) && (!btn || !btn.contains(e.target))) {
                panel.classList.remove('visible');
                if (btn) btn.classList.remove('active');
            }
        });

        // ===== 출처 관리 기능 끝 =====

        // 셀 클릭 핸들러
        function handleCellClick(event, source, key, grain) {
            const events = getEventsForPeriod(source, key, grain);
            if (events.length === 0) return;

            if (events.length === 1) {
                // 항목이 1개면 바로 상세보기 표시
                showDetail(events[0], source);
                hidePopover();
            } else {
                // 항목이 2개 이상이면 팝오버 표시
                showPopover(event, source, key, grain, events);
            }

            event.stopPropagation();
        }

        // 팝오버 표시
        function showPopover(event, source, key, grain, events) {
            const popover = document.getElementById('popover');
            const title = document.getElementById('popoverTitle');
            const content = document.getElementById('popoverContent');

            // 헤더: "공시(DART) · 1월" 형식
            const monthLabel = key.includes('-Q') ? key : key.split('-')[1] + '월';
            const sourceName = sourceNames[source] || (customSources[source] ? customSources[source].name : source);
            title.textContent = `${sourceName} · ${monthLabel}`;

            // 항목: 날짜 + 제목
            content.innerHTML = events.map((e, idx) => {
                const date = e.date ? e.date.substring(5).replace('-', '.') : '';
                const truncTitle = e.title.length > 20 ? e.title.substring(0, 20) + '…' : e.title;
                return `
                    <div class="popover-item" onclick="onPopoverItemClick(event, '${source}', '${key}', ${idx}, '${grain}')" title="${e.title}">
                        <span class="popover-date">${date}</span>
                        <span class="popover-title-text">${truncTitle}</span>
                    </div>
                `;
            }).join('');

            const rect = event.target.getBoundingClientRect();
            popover.style.left = `${rect.left}px`;
            popover.style.top = `${rect.bottom + 5}px`;
            popover.classList.add('visible');
        }

        // 팝오버 항목 클릭
        function onPopoverItemClick(event, source, key, index, grain) {
            currentListSource = null; // 목록 경유가 아닌 직접 클릭
            const events = getEventsForPeriod(source, key, grain);
            if (events && events[index]) {
                showDetail(events[index], source);
            }
            hidePopover();
            event.stopPropagation();
        }

        // 팝오버 숨기기
        function hidePopover() {
            document.getElementById('popover').classList.remove('visible');
        }

        document.addEventListener('click', (e) => {
            hidePopover();

            // 산업 분석 드롭다운 닫기
            if (!e.target.closest('.industry-dropdown-wrapper')) {
                document.querySelectorAll('.industry-dropdown').forEach(d => d.classList.remove('show'));
            }
        });

        // 상세보기 표시
        let detailCharts = [];
        let currentItem = null;
        let currentSource = null;
        let rightPanelView = 'placeholder'; // 'placeholder' | 'list' | 'detail'
        let currentListSource = null;

        function showDetail(item, source) {
            rightPanelView = 'detail';
            const container = document.getElementById('detailContainer');

            // 현재 항목 저장
            currentItem = item;
            currentSource = source;

            // 기존 차트 정리
            detailCharts.forEach(chart => {
                if (chart) chart.destroy();
            });
            detailCharts = [];

            const displaySourceName = sourceNames[source] || (customSources[source] ? customSources[source].name : source);

            // 뒤로가기 버튼 (목록에서 진입한 경우만)
            const listSourceName = sourceNames[currentListSource] ||
                (customSources[currentListSource] ? customSources[currentListSource].name : '목록');
            const backButton = currentListSource ?
                `<button class="back-btn" onclick="showSourceDetail('${currentListSource}')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    ${listSourceName}
                </button>` : '';

            // 원문 탭 내용 생성
            const sourceHtml = item.content ? `
                <div class="source-container">
                    <div class="source-header">
                        <span class="source-title">${item.title}</span>
                        <span class="source-date">${item.date}</span>
                    </div>
                    <div class="source-content">
                        <pre class="source-text">${item.content}</pre>
                    </div>
                </div>
            ` : `
                <div class="source-container">
                    <div class="source-header">
                        <span class="source-title">${item.title}</span>
                        <span class="source-date">${item.date}</span>
                    </div>
                    <div class="source-content">
                        <p class="source-empty">원문 데이터가 없습니다.</p>
                    </div>
                </div>
            `;

            // 요약 탭 내용 생성
            let chartsHtml = '';
            if (item.charts && item.charts.length > 0) {
                chartsHtml = `<div class="detail-charts">
                    ${item.charts.map((c, i) =>
                        `<div class="detail-chart-item" id="detailChart${i}"></div>`
                    ).join('')}
                </div>`;
            }

            const summaryHtml = item.summary ?
                `<ul>${item.summary.map(s => `<li>${s}</li>`).join('')}</ul>` :
                '<p>요약 정보가 없습니다.</p>';

            const analysisHtml = item.analysis ?
                `<div class="detail-analysis">${parseMarkdown(item.analysis)}</div>` :
                '';

            const summaryTabHtml = `
                <div class="detail-header">
                    <div class="detail-source">${displaySourceName}</div>
                    <div class="detail-date">${item.date}</div>
                </div>
                ${chartsHtml}
                <div class="detail-content">
                    <div class="detail-title">${item.title}</div>
                    <div class="detail-summary">${summaryHtml}</div>
                    ${analysisHtml}
                </div>
            `;

            // 탭 구조 생성
            container.innerHTML = `
                ${backButton}
                <div class="detail-tabs">
                    <div class="detail-tab active" data-tab="source">원문</div>
                    <div class="detail-tab" data-tab="summary">요약</div>
                </div>
                <div class="detail-tab-content" id="sourceContent">
                    ${sourceHtml}
                </div>
                <div class="detail-tab-content" id="summaryContent" style="display:none">
                    ${summaryTabHtml}
                </div>
            `;

            // 탭 클릭 이벤트
            container.querySelectorAll('.detail-tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
        }

        // 탭 전환
        function switchTab(tabName) {
            const container = document.getElementById('detailContainer');
            const tabs = container.querySelectorAll('.detail-tab');
            const sourceContent = document.getElementById('sourceContent');
            const summaryContent = document.getElementById('summaryContent');

            tabs.forEach(tab => {
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            if (tabName === 'summary') {
                sourceContent.style.display = 'none';
                summaryContent.style.display = 'block';

                // 요약 탭 활성화 시 차트 렌더링
                if (currentItem && currentItem.charts && currentItem.charts.length > 0) {
                    // 이미 렌더링된 차트가 없으면 렌더링
                    if (detailCharts.length === 0) {
                        currentItem.charts.forEach((chartConfig, i) => {
                            renderDetailChart(`detailChart${i}`, chartConfig);
                        });
                    }
                }
            } else {
                sourceContent.style.display = 'block';
                summaryContent.style.display = 'none';
            }
        }

        // 상세보기 차트 렌더링
        function renderDetailChart(containerId, chartConfig) {
            const chartType = chartConfig.type || 'column';

            if (chartType === 'waterfall') {
                renderWaterfallChart(containerId, chartConfig);
            } else if (chartType === 'comparison') {
                renderComparisonChart(containerId, chartConfig);
            } else if (chartType === 'pie') {
                renderPieChart(containerId, chartConfig);
            } else {
                renderColumnChart(containerId, chartConfig);
            }
        }

        // Waterfall 차트 렌더링
        function renderWaterfallChart(containerId, config) {
            const chart = Highcharts.chart(containerId, {
                chart: {
                    type: 'waterfall',
                    backgroundColor: 'transparent',
                    height: 220,
                    style: {
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        fontWeight: '300'
                    }
                },
                title: {
                    text: config.title || '',
                    style: { fontSize: '11px', fontWeight: '400', color: '#ccc' }
                },
                xAxis: {
                    type: 'category',
                    labels: { style: { fontSize: '9px', color: '#888' } },
                    lineColor: '#3a3a3a'
                },
                yAxis: {
                    title: { text: '' },
                    labels: { style: { fontSize: '9px', color: '#888' } },
                    gridLineColor: '#3a3a3a'
                },
                legend: { enabled: false },
                tooltip: {
                    backgroundColor: '#2d2d2d',
                    borderColor: '#E57B53',
                    borderRadius: 6,
                    style: { fontSize: '11px', color: '#ccc' },
                    pointFormat: '<b>{point.y}</b>'
                },
                plotOptions: {
                    waterfall: {
                        dataLabels: {
                            enabled: true,
                            formatter: function() {
                                if (this.point.isSum) return '';
                                return this.y > 0 ? '+' + this.y : this.y;
                            },
                            style: { fontSize: '9px', fontWeight: '300', color: '#ccc' }
                        },
                        borderWidth: 0,
                        lineColor: '#E57B53',
                        lineWidth: 1
                    }
                },
                series: [{
                    data: config.data,
                    upColor: '#E57B53',
                    color: '#666'
                }],
                credits: { enabled: false }
            });
            detailCharts.push(chart);
        }

        // 비교 차트 렌더링
        function renderComparisonChart(containerId, config) {
            const chart = Highcharts.chart(containerId, {
                chart: {
                    type: 'column',
                    backgroundColor: 'transparent',
                    height: 220,
                    style: {
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        fontWeight: '300'
                    }
                },
                title: {
                    text: config.title || '',
                    style: { fontSize: '11px', fontWeight: '400', color: '#ccc' }
                },
                xAxis: {
                    categories: config.categories,
                    labels: { style: { fontSize: '9px', color: '#888' } },
                    lineColor: '#3a3a3a'
                },
                yAxis: {
                    title: { text: '' },
                    plotLines: [{ value: 0, width: 1, color: '#666' }],
                    labels: { style: { fontSize: '9px', color: '#888' } },
                    gridLineColor: '#3a3a3a'
                },
                legend: {
                    enabled: true,
                    itemStyle: { fontSize: '9px', fontWeight: '300', color: '#888' }
                },
                tooltip: {
                    backgroundColor: '#2d2d2d',
                    borderColor: '#E57B53',
                    borderRadius: 6,
                    style: { fontSize: '11px', color: '#ccc' },
                    shared: true
                },
                plotOptions: {
                    column: {
                        dataLabels: {
                            enabled: true,
                            format: '{y}%',
                            style: { fontSize: '8px', fontWeight: '300', color: '#ccc' }
                        },
                        borderRadius: 2,
                        groupPadding: 0.1,
                        borderWidth: 0
                    }
                },
                series: config.series,
                credits: { enabled: false }
            });
            detailCharts.push(chart);
        }

        // 파이 차트 렌더링
        function renderPieChart(containerId, config) {
            const chart = Highcharts.chart(containerId, {
                chart: {
                    type: 'pie',
                    backgroundColor: 'transparent',
                    height: 220,
                    style: {
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        fontWeight: '300'
                    }
                },
                title: {
                    text: config.title || '',
                    style: { fontSize: '11px', fontWeight: '400', color: '#ccc' }
                },
                legend: { enabled: false },
                tooltip: {
                    backgroundColor: '#2d2d2d',
                    borderColor: '#E57B53',
                    borderRadius: 6,
                    style: { fontSize: '11px', color: '#ccc' }
                },
                plotOptions: {
                    pie: {
                        colors: ['#E57B53', '#c96a47', '#a55a3c', '#7a4a32', '#5a3a28'],
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}: {point.percentage:.0f}%',
                            style: {
                                fontSize: '9px',
                                fontWeight: '300',
                                color: '#ccc'
                            }
                        }
                    }
                },
                series: [{
                    name: '비중',
                    data: config.data
                }],
                credits: { enabled: false }
            });
            detailCharts.push(chart);
        }

        // 컬럼/라인 차트 렌더링
        function renderColumnChart(containerId, config) {
            const chartType = config.type || 'column';
            const chart = Highcharts.chart(containerId, {
                chart: {
                    type: chartType,
                    backgroundColor: 'transparent',
                    height: 220,
                    style: {
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        fontWeight: '300'
                    }
                },
                title: {
                    text: config.title || '',
                    style: { fontSize: '11px', fontWeight: '400', color: '#ccc' }
                },
                xAxis: {
                    type: 'category',
                    labels: { style: { fontSize: '10px', color: '#888' } },
                    lineColor: '#3a3a3a',
                    tickColor: '#3a3a3a'
                },
                yAxis: {
                    title: { text: '' },
                    labels: { style: { fontSize: '10px', color: '#888' } },
                    gridLineColor: '#3a3a3a'
                },
                legend: { enabled: false },
                tooltip: {
                    backgroundColor: '#2d2d2d',
                    borderColor: '#E57B53',
                    borderRadius: 6,
                    style: { fontSize: '11px', color: '#ccc' }
                },
                plotOptions: {
                    column: {
                        color: '#E57B53',
                        borderRadius: 3,
                        borderWidth: 0
                    },
                    bar: {
                        color: '#E57B53',
                        borderRadius: 3,
                        borderWidth: 0
                    },
                    line: {
                        color: '#E57B53',
                        marker: {
                            fillColor: '#E57B53',
                            lineColor: '#E57B53'
                        }
                    }
                },
                series: [{
                    name: '값',
                    data: config.data
                }],
                credits: { enabled: false }
            });
            detailCharts.push(chart);
        }

        // 차트 초기화
        function initChart() {
            const stockData = generateStockData();
            const revenueData = generateRevenueData();

            Highcharts.stockChart('stockChart', {
                chart: {
                    backgroundColor: 'transparent',
                    marginLeft: 80,
                    marginRight: 80,
                    spacingLeft: 10,
                    spacingRight: 10,
                    spacingTop: 50,
                    style: {
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        fontWeight: '300'
                    }
                },
                rangeSelector: {
                    buttonPosition: {
                        align: 'right',
                        x: -60,
                        y: 0
                    },
                    buttons: [{
                        type: 'month',
                        count: 1,
                        text: '1개월'
                    }, {
                        type: 'month',
                        count: 3,
                        text: '3개월'
                    }, {
                        type: 'month',
                        count: 6,
                        text: '6개월'
                    }, {
                        type: 'all',
                        text: '전체'
                    }],
                    selected: 3,
                    inputEnabled: false,
                    buttonTheme: {
                        fill: '#2d2d2d',
                        stroke: '#3a3a3a',
                        'stroke-width': 1,
                        r: 4,
                        style: {
                            color: '#888',
                            fontWeight: '300'
                        },
                        states: {
                            hover: {
                                fill: 'rgba(229, 123, 83, 0.2)',
                                style: {
                                    color: '#E57B53'
                                }
                            },
                            select: {
                                fill: '#E57B53',
                                style: {
                                    color: '#fff'
                                }
                            }
                        }
                    }
                },
                navigator: {
                    enabled: true,
                    height: 30,
                    maskFill: 'rgba(229, 123, 83, 0.15)',
                    outlineColor: '#3a3a3a',
                    handles: {
                        backgroundColor: '#E57B53',
                        borderColor: '#E57B53'
                    },
                    series: {
                        color: '#E57B53',
                        lineWidth: 1
                    }
                },
                scrollbar: {
                    enabled: false
                },
                xAxis: {
                    events: {
                        afterSetExtremes: function(e) {
                            renderTable(e.min, e.max);
                        }
                    },
                    lineColor: '#3a3a3a',
                    tickColor: '#3a3a3a',
                    labels: {
                        style: {
                            color: '#888',
                            fontWeight: '300'
                        }
                    }
                },
                yAxis: [{
                    // 주가 축 (왼쪽)
                    opposite: false,
                    gridLineColor: '#3a3a3a',
                    labels: {
                        align: 'right',
                        x: -3,
                        style: {
                            color: '#888',
                            fontWeight: '300'
                        },
                        formatter: function() {
                            return (this.value / 1000) + 'K';
                        }
                    },
                    title: {
                        text: '주가 (원)',
                        align: 'high',
                        rotation: 0,
                        x: 40,
                        y: -10,
                        style: {
                            color: '#888',
                            fontWeight: '300'
                        }
                    },
                    height: '100%'
                }, {
                    // 매출액 축 (오른쪽)
                    opposite: true,
                    gridLineWidth: 0,
                    labels: {
                        align: 'left',
                        x: 3,
                        style: {
                            color: '#888',
                            fontWeight: '300'
                        },
                        formatter: function() {
                            return this.value;
                        }
                    },
                    title: {
                        text: '매출액 (조원)',
                        align: 'high',
                        rotation: 0,
                        x: -40,
                        y: -10,
                        style: {
                            color: '#888',
                            fontWeight: '300'
                        }
                    },
                    height: '100%'
                }],
                tooltip: {
                    backgroundColor: '#2d2d2d',
                    borderColor: '#E57B53',
                    borderRadius: 6,
                    style: {
                        color: '#ccc',
                        fontWeight: '300'
                    },
                    shared: true
                },
                legend: {
                    enabled: false
                },
                series: [{
                    name: '주가',
                    data: stockData,
                    color: '#E57B53',
                    lineWidth: 2,
                    yAxis: 0,
                    tooltip: {
                        valueDecimals: 0,
                        valuePrefix: '₩'
                    }
                }, {
                    type: 'line',
                    step: 'left',
                    name: '매출액',
                    data: revenueData,
                    color: '#888888',
                    lineWidth: 2,
                    yAxis: 1,
                    marker: {
                        enabled: true,
                        radius: 4
                    },
                    tooltip: {
                        valueDecimals: 2,
                        valueSuffix: '조원'
                    }
                }],
                credits: {
                    enabled: false
                },
                exporting: {
                    enabled: false
                }
            });

            // 초기 테이블 렌더링
            const firstDate = stockData[0][0];
            const lastDate = stockData[stockData.length - 1][0];
            renderTable(firstDate, lastDate);

            // 차트 사이드바 초기화
            renderChartSidebar();
        }

        // 리사이저 기능
        function initResizers() {
            // 중앙-우측 리사이저
            initCenterResizer();
        }

        function initHorizontalResizer(resizerId, leftPanelId, rightPanelId, minWidth, maxWidth) {
            const resizer = document.getElementById(resizerId);
            const leftPanel = document.getElementById(leftPanelId);

            let isResizing = false;
            let startX, startWidth;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = leftPanel.offsetWidth;
                resizer.classList.add('active');
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const diff = e.clientX - startX;
                let newWidth = startWidth + diff;
                newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));
                leftPanel.style.width = newWidth + 'px';
                leftPanel.style.minWidth = newWidth + 'px';
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    resizer.classList.remove('active');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                    // 차트 리사이즈 트리거
                    window.dispatchEvent(new Event('resize'));
                }
            });
        }

        // 우측 패널 접힘 상태 관리
        let isRightPanelCollapsed = false;
        let savedRightPanelWidth = 350;

        function collapseRightPanel() {
            const rightPanel = document.getElementById('rightPanel');
            const resizer = document.getElementById('resizerCenter');
            savedRightPanelWidth = rightPanel.offsetWidth || 350;
            rightPanel.classList.add('collapsed');
            isRightPanelCollapsed = true;
            resizer.classList.add('panel-collapsed');
            localStorage.setItem('rightPanelCollapsed', 'true');
            localStorage.setItem('savedRightPanelWidth', savedRightPanelWidth.toString());
        }

        function expandRightPanel() {
            const rightPanel = document.getElementById('rightPanel');
            const resizer = document.getElementById('resizerCenter');
            rightPanel.classList.remove('collapsed');
            rightPanel.style.flex = '1';
            rightPanel.style.width = 'auto';
            rightPanel.style.maxWidth = 'none';
            isRightPanelCollapsed = false;
            resizer.classList.remove('panel-collapsed');
            localStorage.setItem('rightPanelCollapsed', 'false');
        }

        function initCenterResizer() {
            const resizer = document.getElementById('resizerCenter');
            const centerPanel = document.getElementById('centerPanel');
            const rightPanel = document.getElementById('rightPanel');
            const upperArea = document.getElementById('upperArea');

            let isResizing = false;
            let startX, startCenterWidth;

            // 페이지 로드 시 저장된 상태 복원
            const savedCollapsed = localStorage.getItem('rightPanelCollapsed');
            const savedWidth = localStorage.getItem('savedRightPanelWidth');
            if (savedWidth) {
                savedRightPanelWidth = parseInt(savedWidth, 10);
            }
            if (savedCollapsed === 'true') {
                collapseRightPanel();
                centerPanel.style.flex = 'none';
                centerPanel.style.width = (upperArea.offsetWidth - 5) + 'px';
            }

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startCenterWidth = centerPanel.offsetWidth;

                resizer.classList.add('active');
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const diff = e.clientX - startX;
                let newCenterWidth = startCenterWidth + diff;

                const minCenter = 400;
                const totalWidth = upperArea.offsetWidth - 5; // 리사이저 너비 제외
                const rightPanelWidth = totalWidth - newCenterWidth;

                // 우측 패널 접기 감지 (50px 이하)
                if (rightPanelWidth <= 50 && !isRightPanelCollapsed) {
                    collapseRightPanel();
                    newCenterWidth = totalWidth;
                }
                // 접힌 상태에서 좌측으로 드래그 시 복원
                else if (isRightPanelCollapsed && diff < -30) {
                    expandRightPanel();
                    newCenterWidth = totalWidth - savedRightPanelWidth;
                }

                // 최소 너비 제한
                if (newCenterWidth < minCenter) {
                    newCenterWidth = minCenter;
                }

                // 접히지 않은 상태에서 최대 너비 제한 (우측 패널 최소 250px)
                if (!isRightPanelCollapsed) {
                    const maxCenter = totalWidth - 250;
                    if (newCenterWidth > maxCenter) {
                        newCenterWidth = maxCenter;
                    }
                }

                centerPanel.style.flex = 'none';
                centerPanel.style.width = newCenterWidth + 'px';

                // 우측 패널은 남은 공간 차지 (접히지 않은 경우)
                if (!isRightPanelCollapsed) {
                    rightPanel.style.flex = '1';
                    rightPanel.style.width = 'auto';
                    rightPanel.style.maxWidth = 'none';
                }
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    resizer.classList.remove('active');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                    window.dispatchEvent(new Event('resize'));
                }
            });
        }

        // 전망 포인트 생성
        function generateForecast(item, source) {
            const forecastPoints = [];

            // 출처별 기본 전망 포인트
            if (source === 'dart') {
                forecastPoints.push('공시 자료 기반 실적 데이터로 신뢰도 높음');
                if (item.summary && item.summary.some(s => s.includes('매출'))) {
                    forecastPoints.push('매출 관련 핵심 지표 확인 필요');
                }
                if (item.summary && item.summary.some(s => s.includes('영업이익'))) {
                    forecastPoints.push('수익성 지표가 업계 평균 대비 양호한 수준');
                }
            } else if (source === 'darkReport') {
                forecastPoints.push('비공식 분석 자료로 참고용 활용 권장');
                forecastPoints.push('시장 센티먼트 파악에 유용한 데이터');
            } else if (source === 'policy') {
                forecastPoints.push('규제 환경 변화에 따른 사업 영향도 모니터링 필요');
                forecastPoints.push('중장기 전략 수립 시 반영 검토');
            } else if (source === 'news') {
                forecastPoints.push('시장 관심도 및 브랜드 인지도 관련 지표');
                forecastPoints.push('단기 주가 변동성에 영향 가능');
            }

            // 항목별 추가 전망 포인트
            if (item.charts && item.charts.length > 0) {
                const chartTypes = item.charts.map(c => c.type);
                if (chartTypes.includes('waterfall')) {
                    forecastPoints.push('누적 흐름 분석을 통한 성장 동인 파악 가능');
                }
                if (chartTypes.includes('comparison')) {
                    forecastPoints.push('경쟁사 대비 상대적 위치 확인 필요');
                }
                if (chartTypes.includes('pie')) {
                    forecastPoints.push('포트폴리오 구성 및 집중도 리스크 검토');
                }
            }

            return forecastPoints.slice(0, 4); // 최대 4개 전망 포인트
        }

        // 검색 실행 (Enter 키)
        function handleChartSearch(query) {
            if (!query.trim()) return;

            const titleEl = document.getElementById('chartTitle');
            const inputEl = document.getElementById('chartSearchInput');

            // 검색어를 그대로 타이틀로 사용 (추후 AI API 연동 가능)
            titleEl.textContent = query;
            titleEl.style.display = 'block';
            inputEl.style.display = 'none';
        }

        // 타이틀 클릭 시 검색창으로 전환
        function editChartTitle() {
            const titleEl = document.getElementById('chartTitle');
            const inputEl = document.getElementById('chartSearchInput');

            inputEl.value = titleEl.textContent;
            inputEl.style.display = 'block';
            titleEl.style.display = 'none';
            inputEl.focus();
            inputEl.select();
        }

        // 검색창 초기화
        function initChartSearch() {
            document.getElementById('chartSearchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleChartSearch(e.target.value);
                }
            });

            document.getElementById('chartTitle').addEventListener('click', editChartTitle);
        }

        // 기간 헤더 클릭 처리
        function handlePeriodHeaderClick(periodKey, grain) {
            const periodData = collectPeriodData(periodKey, grain);
            showPeriodCharts(periodKey, grain, periodData);
        }

        // 기간별 모든 출처 데이터 수집
        function collectPeriodData(periodKey, grain) {
            const sources = ['dart', 'darkReport', 'policy', 'paper', 'patent', 'sec', 'edinet'];
            const result = {
                bySource: {},
                allEvents: [],
                total: 0
            };

            sources.forEach(src => {
                const events = getEventsForPeriod(src, periodKey, grain);
                result.bySource[src] = events;
                result.allEvents.push(...events.map(e => ({ ...e, source: src })));
                result.total += events.length;
            });

            // 날짜 역순 정렬
            result.allEvents.sort((a, b) => new Date(b.date) - new Date(a.date));

            return result;
        }

        // 세부 기간 목록 생성
        function getSubPeriods(periodKey, grain) {
            const subPeriods = [];

            if (grain === 'year') {
                // 연도 -> 4분기
                const year = parseInt(periodKey);
                for (let q = 1; q <= 4; q++) {
                    subPeriods.push({
                        key: `${year}-Q${q}`,
                        label: `Q${q}`
                    });
                }
            } else if (grain === 'quarter') {
                // 분기 -> 3개월
                const [year, qStr] = periodKey.split('-Q');
                const quarter = parseInt(qStr);
                const startMonth = (quarter - 1) * 3 + 1;
                for (let m = startMonth; m < startMonth + 3; m++) {
                    subPeriods.push({
                        key: `${year}-${String(m).padStart(2, '0')}`,
                        label: `${m}월`
                    });
                }
            } else if (grain === 'month') {
                // 월 -> 주별 (1-7, 8-14, 15-21, 22-말일)
                const [year, month] = periodKey.split('-');
                const weeks = ['1주', '2주', '3주', '4주'];
                weeks.forEach((label, idx) => {
                    subPeriods.push({
                        key: `${periodKey}-W${idx + 1}`,
                        label: label
                    });
                });
            }

            return subPeriods;
        }

        // 기간 레이블 포맷팅
        function formatPeriodLabel(periodKey, grain) {
            if (grain === 'year') {
                return `${periodKey}년`;
            } else if (grain === 'quarter') {
                const [year, qStr] = periodKey.split('-Q');
                return `${year}년 ${qStr}분기`;
            } else if (grain === 'month') {
                const [year, month] = periodKey.split('-');
                return `${year}년 ${parseInt(month)}월`;
            } else if (grain === 'day') {
                const [year, month, day] = periodKey.split('-');
                return `${year}년 ${parseInt(month)}월 ${parseInt(day)}일`;
            }
            return periodKey;
        }

        // 히트맵 데이터 생성
        function generateHeatmapData(periodData, periodKey, grain) {
            const sources = ['dart', 'darkReport', 'policy', 'paper', 'patent', 'sec', 'edinet'];
            const sourceLabels = ['공시', '다크리포트', '정책/규제', '논문', '특허', 'SEC', 'EDINET'];
            const subPeriods = getSubPeriods(periodKey, grain);

            if (subPeriods.length === 0) return null;

            const data = [];
            const subGrain = grain === 'year' ? 'quarter' : (grain === 'quarter' ? 'month' : 'day');

            sources.forEach((src, yIdx) => {
                subPeriods.forEach((sub, xIdx) => {
                    let count = 0;
                    if (grain === 'month') {
                        // 주별 계산
                        const weekNum = xIdx + 1;
                        const events = periodData.bySource[src] || [];
                        count = events.filter(e => {
                            if (!e.date) return false;
                            const day = new Date(e.date).getDate();
                            if (weekNum === 1) return day <= 7;
                            if (weekNum === 2) return day >= 8 && day <= 14;
                            if (weekNum === 3) return day >= 15 && day <= 21;
                            return day >= 22;
                        }).length;
                    } else {
                        const subEvents = getEventsForPeriod(src, sub.key, subGrain);
                        count = subEvents.length;
                    }
                    data.push([xIdx, yIdx, count]);
                });
            });

            return {
                data,
                xCategories: subPeriods.map(p => p.label),
                yCategories: sourceLabels
            };
        }

        // 우측 패널에 기간별 차트 표시
        function showPeriodCharts(periodKey, grain, periodData) {
            const container = document.getElementById('detailContainer');
            const periodLabel = formatPeriodLabel(periodKey, grain);
            const subPeriods = getSubPeriods(periodKey, grain);

            // 출처별 데이터 집계
            const sourceLabels = {
                dart: '공시',
                darkReport: '다크리포트',
                policy: '정책/규제',
                paper: '논문',
                patent: '특허',
                sec: 'SEC',
                edinet: 'EDINET'
            };

            // HTML 생성
            let html = `
                <div class="detail-tabs">
                    <div class="detail-tab active">기간별 분석</div>
                </div>
                <div class="detail-tab-content" style="display:block">
                    <div class="period-charts-view">
                        <div class="period-charts-header">
                            <div class="period-charts-title">${periodLabel}</div>
                            <div class="period-charts-subtitle">기간별 이벤트 분석</div>
                        </div>
                        <div class="period-charts-total">총 ${periodData.total}건</div>

                        <div class="period-chart-item">
                            <h4>출처별 이벤트 수</h4>
                            <div class="period-chart-container" id="periodBarChart"></div>
                        </div>

                        ${subPeriods.length > 0 ? `
                        <div class="period-chart-item">
                            <h4>기간 내 트렌드</h4>
                            <div class="period-chart-container" id="periodLineChart"></div>
                        </div>

                        <div class="period-chart-item">
                            <h4>출처 × 기간 분포</h4>
                            <div class="period-chart-container" id="periodHeatmap"></div>
                        </div>
                        ` : ''}

                        <div class="period-events-list">
                            <div class="period-events-title">이벤트 목록 (${periodData.total}건)</div>
                            ${periodData.allEvents.slice(0, 20).map(e => `
                                <div class="period-event-item" onclick="showDetail(eventData['${e.source}']['${e.date ? e.date.substring(0, 7) : ''}'].find(ev => ev.id === '${e.id}'), '${e.source}')">
                                    <span class="period-event-source">${sourceLabels[e.source]}</span>
                                    <span class="period-event-date">${e.date ? e.date.substring(5).replace('-', '.') : ''}</span>
                                    <span class="period-event-title">${e.title}</span>
                                </div>
                            `).join('')}
                            ${periodData.total > 20 ? `<div style="padding: 8px; color: var(--text-muted); font-size: 11px;">... 외 ${periodData.total - 20}건</div>` : ''}
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;

            // 차트 렌더링
            setTimeout(() => {
                renderSourceBarChart('periodBarChart', periodData, sourceLabels);
                if (subPeriods.length > 0) {
                    renderTrendLineChart('periodLineChart', periodData, periodKey, grain);
                    renderSourceHeatmap('periodHeatmap', periodData, periodKey, grain);
                }
            }, 50);
        }

        // 출처별 막대 차트
        function renderSourceBarChart(containerId, periodData, sourceLabels) {
            const sources = ['dart', 'darkReport', 'policy', 'paper', 'patent', 'sec', 'edinet'];
            const categories = sources.map(s => sourceLabels[s]);
            const data = sources.map(s => (periodData.bySource[s] || []).length);

            Highcharts.chart(containerId, {
                chart: {
                    type: 'bar',
                    backgroundColor: 'transparent',
                    height: 180
                },
                title: { text: null },
                xAxis: {
                    categories: categories,
                    labels: { style: { color: '#888', fontSize: '10px' } },
                    lineColor: '#3a3a3a'
                },
                yAxis: {
                    min: 0,
                    title: { text: null },
                    labels: { style: { color: '#888', fontSize: '10px' } },
                    gridLineColor: '#3a3a3a'
                },
                legend: { enabled: false },
                credits: { enabled: false },
                plotOptions: {
                    bar: {
                        color: '#E57B53',
                        dataLabels: {
                            enabled: true,
                            style: { color: '#ccc', fontSize: '10px', textOutline: 'none' }
                        }
                    }
                },
                series: [{
                    name: '이벤트 수',
                    data: data
                }]
            });
        }

        // 트렌드 라인 차트
        function renderTrendLineChart(containerId, periodData, periodKey, grain) {
            const subPeriods = getSubPeriods(periodKey, grain);
            const subGrain = grain === 'year' ? 'quarter' : (grain === 'quarter' ? 'month' : 'day');

            const data = subPeriods.map(sub => {
                if (grain === 'month') {
                    // 주별 계산
                    const weekNum = parseInt(sub.key.split('-W')[1]);
                    let count = 0;
                    periodData.allEvents.forEach(e => {
                        if (!e.date) return;
                        const day = new Date(e.date).getDate();
                        if (weekNum === 1 && day <= 7) count++;
                        else if (weekNum === 2 && day >= 8 && day <= 14) count++;
                        else if (weekNum === 3 && day >= 15 && day <= 21) count++;
                        else if (weekNum === 4 && day >= 22) count++;
                    });
                    return count;
                } else {
                    let total = 0;
                    const sources = ['dart', 'darkReport', 'policy', 'paper', 'patent', 'sec', 'edinet'];
                    sources.forEach(src => {
                        total += getEventsForPeriod(src, sub.key, subGrain).length;
                    });
                    return total;
                }
            });

            Highcharts.chart(containerId, {
                chart: {
                    type: 'line',
                    backgroundColor: 'transparent',
                    height: 180
                },
                title: { text: null },
                xAxis: {
                    categories: subPeriods.map(p => p.label),
                    labels: { style: { color: '#888', fontSize: '10px' } },
                    lineColor: '#3a3a3a'
                },
                yAxis: {
                    min: 0,
                    title: { text: null },
                    labels: { style: { color: '#888', fontSize: '10px' } },
                    gridLineColor: '#3a3a3a'
                },
                legend: { enabled: false },
                credits: { enabled: false },
                plotOptions: {
                    line: {
                        color: '#E57B53',
                        marker: {
                            fillColor: '#E57B53',
                            lineColor: '#E57B53'
                        },
                        dataLabels: {
                            enabled: true,
                            style: { color: '#ccc', fontSize: '10px', textOutline: 'none' }
                        }
                    }
                },
                series: [{
                    name: '이벤트 수',
                    data: data
                }]
            });
        }

        // 히트맵 차트
        function renderSourceHeatmap(containerId, periodData, periodKey, grain) {
            const heatmapData = generateHeatmapData(periodData, periodKey, grain);
            if (!heatmapData) return;

            Highcharts.chart(containerId, {
                chart: {
                    type: 'heatmap',
                    backgroundColor: 'transparent',
                    height: 180
                },
                title: { text: null },
                xAxis: {
                    categories: heatmapData.xCategories,
                    labels: { style: { color: '#888', fontSize: '10px' } },
                    lineColor: '#3a3a3a'
                },
                yAxis: {
                    categories: heatmapData.yCategories,
                    title: { text: null },
                    labels: { style: { color: '#888', fontSize: '10px' } },
                    reversed: true
                },
                colorAxis: {
                    min: 0,
                    minColor: '#2d2d2d',
                    maxColor: '#E57B53'
                },
                legend: { enabled: false },
                credits: { enabled: false },
                tooltip: {
                    formatter: function() {
                        return `<b>${this.series.yAxis.categories[this.point.y]}</b><br>` +
                               `${this.series.xAxis.categories[this.point.x]}: <b>${this.point.value}건</b>`;
                    }
                },
                series: [{
                    name: '이벤트 수',
                    borderWidth: 1,
                    borderColor: '#3a3a3a',
                    data: heatmapData.data,
                    dataLabels: {
                        enabled: true,
                        color: '#ffffff',
                        style: { fontSize: '9px', textOutline: 'none' },
                        formatter: function() {
                            return this.point.value > 0 ? this.point.value : '';
                        }
                    }
                }]
            });
        }

        // 기간 선택 버튼 초기화 (이벤트 위임 방식)
        function initPeriodSelector() {
            document.getElementById('dataTable').addEventListener('click', (e) => {
                const btn = e.target.closest('.period-btn');
                if (!btn) return;

                // 활성 상태 변경
                document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // 선택된 기간 업데이트
                selectedPeriod = btn.dataset.period;

                // 테이블 다시 렌더링 (현재 차트 범위 기준)
                const chart = Highcharts.charts.find(c => c && c.renderTo.id === 'stockChart');
                if (chart) {
                    const extremes = chart.xAxis[0].getExtremes();
                    renderTable(extremes.min, extremes.max);
                }
            });
        }

        // 산업 분석 색상 팔레트
        const industryColors = [
            "#C15F3C",   // Crail (메인 러스트 오렌지)
            "#B1ADA1",   // Cloudy (웜 그레이)
            "#da7756",   // Terra Cotta (테라코타)
            "#7D8471",   // Sage (세이지 그린)
            "#9B8AA6",   // Lavender (라벤더)
            "#D4A574",   // Tan (탄)
            "#6B7B8C",   // Slate (슬레이트 그레이)
            "#A67B5B",   // Coffee (커피 브라운)
        ];

        // 산업 분석 데이터
        const industryData = {
            // 산업간 비교: 게임 vs 다른 산업 (시장 규모, 조원)
            interIndustry: {
                categories: ['게임', 'IT서비스', '엔터테인먼트', '콘텐츠'],
                data: [45.2, 38.7, 22.1, 18.5],
                colors: [industryColors[0], industryColors[1], industryColors[2], industryColors[3]]
            },
            // 산업내 비교: 넥슨 vs 경쟁사 (매출, 조원)
            competitors: {
                categories: ['넥슨', '엔씨소프트', '넷마블', '크래프톤'],
                data: [4.2, 2.1, 2.8, 1.5],
                colors: [industryColors[0], industryColors[4], industryColors[5], industryColors[6]]
            },
            // 장르별 비교 (시장 점유율, %)
            genres: {
                categories: ['MMORPG', 'FPS', '모바일', '캐주얼'],
                data: [35, 28, 45, 15],
                colors: [industryColors[0], industryColors[2], industryColors[3], industryColors[7]]
            },
            // 지역별 비교 (넥슨 매출, 조원)
            regions: {
                categories: ['한국', '일본', '미국', '중국'],
                data: [1.2, 1.8, 0.8, 0.4],
                colors: [industryColors[0], industryColors[1], industryColors[4], industryColors[6]]
            }
        };

        let currentIndustryTab = 'competitors';

        // 확장된 산업 데이터
        const extendedIndustryData = {
            industries: {
                game: { name: '게임', size: 45.2, growth: 8.5 },
                it: { name: 'IT서비스', size: 38.7, growth: 5.2 },
                entertainment: { name: '엔터테인먼트', size: 22.1, growth: 3.1 },
                content: { name: '콘텐츠', size: 18.5, growth: 4.8 },
                semiconductor: { name: '반도체', size: 180.5, growth: 12.3 },
                bio: { name: '바이오', size: 25.3, growth: 15.2 },
                finance: { name: '금융', size: 95.2, growth: 2.1 },
                retail: { name: '유통', size: 120.8, growth: 1.5 },
                manufacturing: { name: '제조', size: 210.3, growth: 3.8 }
            },
            companies: {
                nexon: { name: '넥슨', revenue: 4.2, growth: 5.5, marketCap: 18.5 },
                ncsoft: { name: '엔씨소프트', revenue: 2.1, growth: -3.2, marketCap: 8.2 },
                netmarble: { name: '넷마블', revenue: 2.8, growth: 2.1, marketCap: 6.5 },
                krafton: { name: '크래프톤', revenue: 1.5, growth: 8.9, marketCap: 12.3 },
                pearl: { name: '펄어비스', revenue: 0.5, growth: -5.2, marketCap: 2.1 },
                smilegate: { name: '스마일게이트', revenue: 1.2, growth: 3.5, marketCap: null },
                wemade: { name: '위메이드', revenue: 0.8, growth: 12.3, marketCap: 1.8 },
                kakao: { name: '카카오게임즈', revenue: 0.9, growth: 1.2, marketCap: 2.5 }
            },
            genres: {
                mmorpg: { name: 'MMORPG', share: 35, trend: 'stable' },
                fps: { name: 'FPS', share: 28, trend: 'up' },
                mobile: { name: '모바일', share: 45, trend: 'up' },
                casual: { name: '캐주얼', share: 15, trend: 'stable' },
                sports: { name: '스포츠', share: 12, trend: 'up' },
                strategy: { name: '전략', share: 8, trend: 'down' },
                simulation: { name: '시뮬레이션', share: 5, trend: 'stable' }
            },
            regions: {
                korea: { name: '한국', revenue: 1.2, share: 28.6 },
                japan: { name: '일본', revenue: 1.8, share: 42.9 },
                usa: { name: '미국', revenue: 0.8, share: 19.0 },
                china: { name: '중국', revenue: 0.4, share: 9.5 },
                sea: { name: '동남아', revenue: 0.3, share: 7.1 },
                europe: { name: '유럽', revenue: 0.2, share: 4.8 }
            }
        };

        // 선택 상태 변수
        let selectedIndustries = ['game', 'it', 'entertainment', 'content'];
        let selectedCompanies = ['nexon', 'ncsoft', 'netmarble', 'krafton'];
        let selectedGenres = ['mmorpg', 'fps', 'mobile', 'casual'];
        let selectedRegions = ['korea', 'japan', 'usa', 'china'];

        // 비교분석 아이콘 클릭 핸들러
        function showIndustryAnalysis() {
            // 사이드바 아이콘 활성화 상태 변경
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="산업분석"]').classList.add('active');

            // 중앙 패널 내용 변경
            const centerPanel = document.querySelector('.center-panel');
            centerPanel.innerHTML = `
                <div class="industry-analysis-view">
                    <div class="industry-analysis-header">산업 분석</div>

                    <!-- 산업간 비교 섹션 -->
                    <div class="industry-section">
                        <div class="industry-section-title">산업간 비교 (시장 규모)</div>

                        <!-- 산업 선택기 -->
                        <div class="industry-selector" id="industrySelector">
                            <div id="industryItems"></div>
                            <div class="industry-dropdown-wrapper">
                                <button class="industry-add-btn" onclick="toggleIndustryDropdown('industry')">+ 추가</button>
                                <div class="industry-dropdown" id="industryDropdown"></div>
                            </div>
                        </div>

                        <!-- 차트와 테이블 가로 배치 -->
                        <div class="industry-content-row">
                            <div class="industry-chart-wrapper">
                                <div id="inter-industry-chart" class="industry-chart-container"></div>
                            </div>
                            <div class="industry-table-wrapper">
                                <table class="industry-data-table">
                                    <thead>
                                        <tr>
                                            <th>산업</th>
                                            <th>시장규모</th>
                                            <th>성장률</th>
                                            <th>순위</th>
                                        </tr>
                                    </thead>
                                    <tbody id="industryTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 산업내 비교 섹션 -->
                    <div class="industry-section">
                        <div class="industry-section-title">산업내 비교</div>
                        <div class="industry-tabs">
                            <div class="industry-tab active" data-tab="competitors" onclick="switchIndustryTab('competitors')">경쟁사</div>
                            <div class="industry-tab" data-tab="genres" onclick="switchIndustryTab('genres')">장르별</div>
                            <div class="industry-tab" data-tab="regions" onclick="switchIndustryTab('regions')">지역별</div>
                        </div>

                        <!-- 탭별 선택기 -->
                        <div class="industry-selector" id="intraSelector">
                            <div id="intraItems"></div>
                            <div class="industry-dropdown-wrapper">
                                <button class="industry-add-btn" onclick="toggleIndustryDropdown('intra')">+ 추가</button>
                                <div class="industry-dropdown" id="intraDropdown"></div>
                            </div>
                        </div>

                        <!-- 차트와 테이블 가로 배치 -->
                        <div class="industry-content-row">
                            <div class="industry-chart-wrapper">
                                <div id="intra-industry-chart" class="industry-chart-container"></div>
                            </div>
                            <div class="industry-table-wrapper">
                                <table class="industry-data-table">
                                    <thead id="intraTableHead">
                                        <tr>
                                            <th>항목</th>
                                            <th>값</th>
                                            <th>성장률</th>
                                            <th>순위</th>
                                        </tr>
                                    </thead>
                                    <tbody id="intraTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // 선택기와 차트, 테이블 렌더링
            renderIndustrySelectorItems();
            renderIntraSelectorItems();
            renderInterIndustryChart();
            renderIntraIndustryChart();
            renderIndustryTable();
            renderIntraTable();
        }

        // 산업간 비교 선택기 렌더링
        function renderIndustrySelectorItems() {
            const container = document.getElementById('industryItems');
            if (!container) return;

            container.innerHTML = selectedIndustries.map(key => {
                const ind = extendedIndustryData.industries[key];
                return `
                    <div class="industry-selector-item">
                        <span>${ind.name}</span>
                        <span class="remove-btn" onclick="removeIndustryItem('industry', '${key}')">✕</span>
                    </div>
                `;
            }).join('');

            updateIndustryDropdown('industry');
        }

        // 산업내 비교 선택기 렌더링
        function renderIntraSelectorItems() {
            const container = document.getElementById('intraItems');
            if (!container) return;

            let items, dataSource;
            if (currentIndustryTab === 'competitors') {
                items = selectedCompanies;
                dataSource = extendedIndustryData.companies;
            } else if (currentIndustryTab === 'genres') {
                items = selectedGenres;
                dataSource = extendedIndustryData.genres;
            } else {
                items = selectedRegions;
                dataSource = extendedIndustryData.regions;
            }

            container.innerHTML = items.map(key => {
                const item = dataSource[key];
                return `
                    <div class="industry-selector-item">
                        <span>${item.name}</span>
                        <span class="remove-btn" onclick="removeIndustryItem('intra', '${key}')">✕</span>
                    </div>
                `;
            }).join('');

            updateIndustryDropdown('intra');
        }

        // 드롭다운 토글
        function toggleIndustryDropdown(type) {
            const dropdownId = type === 'industry' ? 'industryDropdown' : 'intraDropdown';
            const dropdown = document.getElementById(dropdownId);
            if (!dropdown) return;

            // 다른 드롭다운 닫기
            document.querySelectorAll('.industry-dropdown').forEach(d => {
                if (d.id !== dropdownId) d.classList.remove('show');
            });

            dropdown.classList.toggle('show');
        }

        // 드롭다운 내용 업데이트
        function updateIndustryDropdown(type) {
            if (type === 'industry') {
                const dropdown = document.getElementById('industryDropdown');
                if (!dropdown) return;

                const allIndustries = Object.keys(extendedIndustryData.industries);
                dropdown.innerHTML = allIndustries.map(key => {
                    const ind = extendedIndustryData.industries[key];
                    const isSelected = selectedIndustries.includes(key);
                    return `
                        <div class="industry-dropdown-item ${isSelected ? 'disabled' : ''}"
                             onclick="${isSelected ? '' : `addIndustryItem('industry', '${key}')`}">
                            ${ind.name} ${isSelected ? '✓' : ''}
                        </div>
                    `;
                }).join('');
            } else {
                const dropdown = document.getElementById('intraDropdown');
                if (!dropdown) return;

                let dataSource, selected;
                if (currentIndustryTab === 'competitors') {
                    dataSource = extendedIndustryData.companies;
                    selected = selectedCompanies;
                } else if (currentIndustryTab === 'genres') {
                    dataSource = extendedIndustryData.genres;
                    selected = selectedGenres;
                } else {
                    dataSource = extendedIndustryData.regions;
                    selected = selectedRegions;
                }

                const allItems = Object.keys(dataSource);
                dropdown.innerHTML = allItems.map(key => {
                    const item = dataSource[key];
                    const isSelected = selected.includes(key);
                    return `
                        <div class="industry-dropdown-item ${isSelected ? 'disabled' : ''}"
                             onclick="${isSelected ? '' : `addIndustryItem('intra', '${key}')`}">
                            ${item.name} ${isSelected ? '✓' : ''}
                        </div>
                    `;
                }).join('');
            }
        }

        // 항목 추가
        function addIndustryItem(type, key) {
            if (type === 'industry') {
                if (!selectedIndustries.includes(key)) {
                    selectedIndustries.push(key);
                    renderIndustrySelectorItems();
                    renderInterIndustryChart();
                    renderIndustryTable();
                }
            } else {
                let selected;
                if (currentIndustryTab === 'competitors') {
                    selected = selectedCompanies;
                } else if (currentIndustryTab === 'genres') {
                    selected = selectedGenres;
                } else {
                    selected = selectedRegions;
                }

                if (!selected.includes(key)) {
                    selected.push(key);
                    renderIntraSelectorItems();
                    renderIntraIndustryChart();
                    renderIntraTable();
                }
            }

            // 드롭다운 닫기
            document.querySelectorAll('.industry-dropdown').forEach(d => d.classList.remove('show'));
        }

        // 항목 제거
        function removeIndustryItem(type, key) {
            if (type === 'industry') {
                if (selectedIndustries.length > 1) {
                    selectedIndustries = selectedIndustries.filter(k => k !== key);
                    renderIndustrySelectorItems();
                    renderInterIndustryChart();
                    renderIndustryTable();
                }
            } else {
                let selected;
                if (currentIndustryTab === 'competitors') {
                    if (selectedCompanies.length > 1) {
                        selectedCompanies = selectedCompanies.filter(k => k !== key);
                    }
                } else if (currentIndustryTab === 'genres') {
                    if (selectedGenres.length > 1) {
                        selectedGenres = selectedGenres.filter(k => k !== key);
                    }
                } else {
                    if (selectedRegions.length > 1) {
                        selectedRegions = selectedRegions.filter(k => k !== key);
                    }
                }
                renderIntraSelectorItems();
                renderIntraIndustryChart();
                renderIntraTable();
            }
        }

        // 산업간 비교 테이블 렌더링
        function renderIndustryTable() {
            const tbody = document.getElementById('industryTableBody');
            if (!tbody) return;

            // 선택된 산업 데이터를 크기 순으로 정렬
            const sortedData = selectedIndustries.map(key => ({
                key,
                ...extendedIndustryData.industries[key]
            })).sort((a, b) => b.size - a.size);

            tbody.innerHTML = sortedData.map((item, idx) => {
                const rank = idx + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : 'rank-other';
                const growthClass = item.growth >= 0 ? 'value-positive' : 'value-negative';
                const growthSign = item.growth >= 0 ? '+' : '';

                return `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.size.toFixed(1)}조</td>
                        <td class="${growthClass}">${growthSign}${item.growth.toFixed(1)}%</td>
                        <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // 산업내 비교 테이블 렌더링
        function renderIntraTable() {
            const thead = document.getElementById('intraTableHead');
            const tbody = document.getElementById('intraTableBody');
            if (!thead || !tbody) return;

            let headers, rows;

            if (currentIndustryTab === 'competitors') {
                headers = '<tr><th>회사</th><th>매출</th><th>성장률</th><th>순위</th></tr>';
                const sortedData = selectedCompanies.map(key => ({
                    key,
                    ...extendedIndustryData.companies[key]
                })).sort((a, b) => b.revenue - a.revenue);

                rows = sortedData.map((item, idx) => {
                    const rank = idx + 1;
                    const rankClass = rank <= 3 ? `rank-${rank}` : 'rank-other';
                    const growthClass = item.growth >= 0 ? 'value-positive' : 'value-negative';
                    const growthSign = item.growth >= 0 ? '+' : '';

                    return `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.revenue.toFixed(1)}조</td>
                            <td class="${growthClass}">${growthSign}${item.growth.toFixed(1)}%</td>
                            <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                        </tr>
                    `;
                }).join('');

            } else if (currentIndustryTab === 'genres') {
                headers = '<tr><th>장르</th><th>점유율</th><th>추세</th><th>순위</th></tr>';
                const sortedData = selectedGenres.map(key => ({
                    key,
                    ...extendedIndustryData.genres[key]
                })).sort((a, b) => b.share - a.share);

                const trendText = { up: '↑ 상승', down: '↓ 하락', stable: '→ 유지' };
                const trendClass = { up: 'value-positive', down: 'value-negative', stable: '' };

                rows = sortedData.map((item, idx) => {
                    const rank = idx + 1;
                    const rankClass = rank <= 3 ? `rank-${rank}` : 'rank-other';

                    return `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.share}%</td>
                            <td class="${trendClass[item.trend]}">${trendText[item.trend]}</td>
                            <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                        </tr>
                    `;
                }).join('');

            } else {
                headers = '<tr><th>지역</th><th>매출</th><th>점유율</th><th>순위</th></tr>';
                const sortedData = selectedRegions.map(key => ({
                    key,
                    ...extendedIndustryData.regions[key]
                })).sort((a, b) => b.revenue - a.revenue);

                rows = sortedData.map((item, idx) => {
                    const rank = idx + 1;
                    const rankClass = rank <= 3 ? `rank-${rank}` : 'rank-other';

                    return `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.revenue.toFixed(1)}조</td>
                            <td>${item.share.toFixed(1)}%</td>
                            <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                        </tr>
                    `;
                }).join('');
            }

            thead.innerHTML = headers;
            tbody.innerHTML = rows;
        }

        // ===== 캘린더 기능 =====
        let currentCalendarDate = new Date();

        // 캘린더 이벤트 샘플 데이터
        const calendarEvents = [
            { date: '2026-01-15', title: '넥슨 4Q 실적발표', company: '넥슨', source: 'earnings' },
            { date: '2026-01-20', title: '엔씨소프트 배당금 지급', company: '엔씨소프트', source: 'dividend' },
            { date: '2026-01-22', title: '크래프톤 IR 컨퍼런스', company: '크래프톤', source: 'conference' },
            { date: '2026-01-25', title: '게임산업 분기 보고서', company: '산업', source: 'report' },
            { date: '2026-01-28', title: '넷마블 신작 발표', company: '넷마블', source: 'news' },
            { date: '2026-01-30', title: '넥슨 IR 데이', company: '넥슨', source: 'conference' },
            { date: '2026-02-05', title: '엔씨소프트 1Q 실적예고', company: '엔씨소프트', source: 'earnings' },
            { date: '2026-02-10', title: '크래프톤 배당 공시', company: '크래프톤', source: 'dividend' },
            { date: '2026-02-15', title: '게임주 투자 리포트', company: '산업', source: 'report' },
            { date: '2026-02-20', title: '넥슨 파트너 컨퍼런스', company: '넥슨', source: 'conference' },
        ];

        function showCalendar() {
            // 사이드바 아이콘 활성화 상태 변경
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="캘린더"]').classList.add('active');

            // 중앙 패널에 캘린더 표시
            const centerPanel = document.querySelector('.center-panel');
            centerPanel.innerHTML = `
                <div class="calendar-view">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" onclick="changeMonth(-1)">◀</button>
                            <button class="calendar-nav-btn" onclick="goToday()">오늘</button>
                            <button class="calendar-nav-btn" onclick="changeMonth(1)">▶</button>
                        </div>
                        <div class="calendar-title" id="calendarTitle">2026년 1월</div>
                    </div>

                    <div class="calendar-filter">
                        <input type="text" class="calendar-filter-input" placeholder="회사명 검색..."
                               id="companyFilter" onkeyup="filterCalendarEvents()">
                        <select class="calendar-filter-select" id="sourceFilter" onchange="filterCalendarEvents()">
                            <option value="">전체 출처</option>
                            <option value="earnings">실적발표</option>
                            <option value="news">뉴스</option>
                            <option value="report">보고서</option>
                            <option value="conference">컨퍼런스</option>
                            <option value="dividend">배당</option>
                        </select>
                    </div>

                    <div class="calendar-legend">
                        <div class="calendar-legend-item">
                            <div class="calendar-legend-color" style="background: var(--claude-crail);"></div>
                            <span>실적발표</span>
                        </div>
                        <div class="calendar-legend-item">
                            <div class="calendar-legend-color" style="background: var(--claude-sage);"></div>
                            <span>뉴스</span>
                        </div>
                        <div class="calendar-legend-item">
                            <div class="calendar-legend-color" style="background: var(--claude-tan);"></div>
                            <span>보고서</span>
                        </div>
                        <div class="calendar-legend-item">
                            <div class="calendar-legend-color" style="background: var(--claude-lavender);"></div>
                            <span>컨퍼런스</span>
                        </div>
                        <div class="calendar-legend-item">
                            <div class="calendar-legend-color" style="background: var(--claude-coffee);"></div>
                            <span>배당</span>
                        </div>
                    </div>

                    <div class="calendar-grid" id="calendarGrid">
                        <!-- 요일 헤더 -->
                        <div class="calendar-day-header">일</div>
                        <div class="calendar-day-header">월</div>
                        <div class="calendar-day-header">화</div>
                        <div class="calendar-day-header">수</div>
                        <div class="calendar-day-header">목</div>
                        <div class="calendar-day-header">금</div>
                        <div class="calendar-day-header">토</div>
                        <!-- 날짜 셀은 JavaScript로 동적 생성 -->
                    </div>
                </div>
            `;

            // 우측 패널에 미니 캘린더 + 통계 표시
            const rightPanel = document.querySelector('.right-panel');
            rightPanel.innerHTML = `
                <div class="mini-calendar">
                    <div class="mini-calendar-header">
                        <span class="mini-calendar-title" id="miniCalendarTitle">2026년 1월</span>
                        <div class="mini-calendar-nav-group">
                            <button class="mini-calendar-nav" onclick="changeMiniMonth(-1)">&lt;</button>
                            <button class="mini-calendar-nav" onclick="changeMiniMonth(1)">&gt;</button>
                        </div>
                    </div>
                    <div class="mini-calendar-weekdays">
                        <div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
                    </div>
                    <div class="mini-calendar-grid" id="miniCalendarGrid"></div>
                </div>
                <div class="calendar-stats" id="calendarStats"></div>
            `;

            renderCalendar(currentCalendarDate);
            renderMiniCalendar(currentCalendarDate);
            updateCalendarStats();
        }

        // 미니 캘린더 날짜 변수
        let miniCalendarDate = new Date();

        function renderMiniCalendar(date) {
            miniCalendarDate = new Date(date);
            const year = date.getFullYear();
            const month = date.getMonth();

            // 타이틀 업데이트
            const titleEl = document.getElementById('miniCalendarTitle');
            if (titleEl) titleEl.textContent = `${year}년 ${month + 1}월`;

            const grid = document.getElementById('miniCalendarGrid');
            if (!grid) return;

            grid.innerHTML = '';

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDayOfWeek = firstDay.getDay();
            const prevLastDay = new Date(year, month, 0).getDate();

            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

            // 이벤트가 있는 날짜 Set
            const eventDates = new Set(calendarEvents.map(e => e.date));

            for (let i = 0; i < 42; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'mini-calendar-day';

                let dayNumber;
                let cellDate;
                let isCurrentMonth = true;

                if (i < startDayOfWeek) {
                    dayNumber = prevLastDay - startDayOfWeek + i + 1;
                    cellDate = new Date(year, month - 1, dayNumber);
                    isCurrentMonth = false;
                } else if (i >= startDayOfWeek + lastDay.getDate()) {
                    dayNumber = i - startDayOfWeek - lastDay.getDate() + 1;
                    cellDate = new Date(year, month + 1, dayNumber);
                    isCurrentMonth = false;
                } else {
                    dayNumber = i - startDayOfWeek + 1;
                    cellDate = new Date(year, month, dayNumber);
                }

                if (isCurrentMonth) dayCell.classList.add('current-month');

                const dateStr = `${cellDate.getFullYear()}-${String(cellDate.getMonth() + 1).padStart(2, '0')}-${String(cellDate.getDate()).padStart(2, '0')}`;

                if (dateStr === todayStr) dayCell.classList.add('today');
                if (eventDates.has(dateStr)) dayCell.classList.add('has-event');

                dayCell.textContent = dayNumber;
                dayCell.onclick = () => {
                    currentCalendarDate = new Date(cellDate);
                    renderCalendar(currentCalendarDate);
                };
                grid.appendChild(dayCell);
            }
        }

        function changeMiniMonth(delta) {
            miniCalendarDate.setMonth(miniCalendarDate.getMonth() + delta);
            renderMiniCalendar(miniCalendarDate);
        }

        function generatePieChart(data) {
            const total = data.reduce((sum, item) => sum + item.value, 0);
            if (total === 0) {
                return `<svg class="pie-chart" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="40" fill="none" stroke="var(--border-color)" stroke-width="12"/>
                    <text x="50" y="50" text-anchor="middle" dy=".3em" fill="var(--text-muted)" font-size="10">데이터 없음</text>
                </svg>`;
            }

            const outerRadius = 44;
            const innerRadius = 28;
            let paths = '';
            let currentAngle = -90; // 12시 방향에서 시작

            data.forEach(item => {
                if (item.value === 0) return;

                const percentage = item.value / total;
                const angle = percentage * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;

                const startRad = (startAngle * Math.PI) / 180;
                const endRad = (endAngle * Math.PI) / 180;

                // 외부 호
                const outerX1 = 50 + outerRadius * Math.cos(startRad);
                const outerY1 = 50 + outerRadius * Math.sin(startRad);
                const outerX2 = 50 + outerRadius * Math.cos(endRad);
                const outerY2 = 50 + outerRadius * Math.sin(endRad);

                // 내부 호
                const innerX1 = 50 + innerRadius * Math.cos(startRad);
                const innerY1 = 50 + innerRadius * Math.sin(startRad);
                const innerX2 = 50 + innerRadius * Math.cos(endRad);
                const innerY2 = 50 + innerRadius * Math.sin(endRad);

                const largeArcFlag = angle > 180 ? 1 : 0;

                // 100%일 경우 도넛 전체를 그림
                if (percentage >= 0.9999) {
                    paths += `<circle cx="50" cy="50" r="${(outerRadius + innerRadius) / 2}" fill="none" stroke="${item.color}" stroke-width="${outerRadius - innerRadius}"/>`;
                } else {
                    // 도넛 조각: 외부 호 → 내부 호 (반대 방향)
                    paths += `<path d="M ${outerX1} ${outerY1} A ${outerRadius} ${outerRadius} 0 ${largeArcFlag} 1 ${outerX2} ${outerY2} L ${innerX2} ${innerY2} A ${innerRadius} ${innerRadius} 0 ${largeArcFlag} 0 ${innerX1} ${innerY1} Z" fill="${item.color}"/>`;
                }

                currentAngle = endAngle;
            });

            // 중앙에 전체 개수 표시
            return `<svg class="pie-chart" viewBox="0 0 100 100">
                ${paths}
                <text x="50" y="46" text-anchor="middle" fill="var(--text-primary)" font-size="14" font-weight="600">${total}</text>
                <text x="50" y="58" text-anchor="middle" fill="var(--text-muted)" font-size="8">이벤트</text>
            </svg>`;
        }

        function updateCalendarStats() {
            const statsEl = document.getElementById('calendarStats');
            if (!statsEl) return;

            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const monthStart = `${year}-${String(month + 1).padStart(2, '0')}-01`;
            const monthEnd = `${year}-${String(month + 1).padStart(2, '0')}-31`;

            // 이번 달 이벤트 필터링
            const monthEvents = calendarEvents.filter(e => e.date >= monthStart && e.date <= monthEnd);
            const earningsCount = monthEvents.filter(e => e.source === 'earnings').length;
            const newsCount = monthEvents.filter(e => e.source === 'news').length;
            const reportCount = monthEvents.filter(e => e.source === 'report').length;
            const conferenceCount = monthEvents.filter(e => e.source === 'conference').length;
            const dividendCount = monthEvents.filter(e => e.source === 'dividend').length;

            // 다가오는 일정 (오늘 이후)
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            const upcoming = calendarEvents.filter(e => e.date >= todayStr).sort((a, b) => a.date.localeCompare(b.date)).slice(0, 3);

            const sourceColors = {
                earnings: '#C15F3C',    // Crail (러스트 오렌지)
                news: '#7D8471',        // Sage (세이지 그린)
                report: '#D4A574',      // Tan (따뜻한 베이지)
                conference: '#9B8AA6',  // Lavender (라벤더)
                dividend: '#A67B5B'     // Coffee (커피 브라운)
            };

            // 파이 차트 데이터
            const pieData = [
                { label: '실적발표', value: earningsCount, color: sourceColors.earnings },
                { label: '뉴스', value: newsCount, color: sourceColors.news },
                { label: '보고서', value: reportCount, color: sourceColors.report },
                { label: '컨퍼런스', value: conferenceCount, color: sourceColors.conference },
                { label: '배당', value: dividendCount, color: sourceColors.dividend }
            ];

            const pieChartSvg = generatePieChart(pieData);
            const pieLegendHtml = pieData.filter(d => d.value > 0).map(d => `
                <div class="pie-legend-item">
                    <div class="pie-legend-color" style="background:${d.color}"></div>
                    <span>${d.label} (${d.value})</span>
                </div>
            `).join('');

            statsEl.innerHTML = `
                <div class="stats-header">이번 달 요약</div>
                <div class="pie-chart-container">
                    ${pieChartSvg}
                    <div class="pie-chart-legend">${pieLegendHtml}</div>
                </div>
                <div class="stats-item">
                    <span class="stats-label">전체 이벤트</span>
                    <span class="stats-value">${monthEvents.length}개</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">실적발표</span>
                    <span class="stats-value">${earningsCount}개</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">뉴스</span>
                    <span class="stats-value">${newsCount}개</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">보고서</span>
                    <span class="stats-value">${reportCount}개</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">컨퍼런스</span>
                    <span class="stats-value">${conferenceCount}개</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">배당</span>
                    <span class="stats-value">${dividendCount}개</span>
                </div>

                <div class="stats-divider"></div>

                <div class="stats-header">다가오는 일정</div>
                ${upcoming.length > 0 ? upcoming.map(event => `
                    <div class="upcoming-event">
                        <span class="upcoming-dot" style="color:${sourceColors[event.source] || 'var(--claude-crail)'}">●</span>
                        <div class="upcoming-info">
                            <div class="upcoming-title">${event.title}</div>
                            <div class="upcoming-date">${formatEventDate(event.date)}</div>
                        </div>
                    </div>
                `).join('') : '<div style="font-size:12px;color:var(--text-muted);">예정된 일정이 없습니다.</div>'}
            `;
        }

        function formatEventDate(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${parseInt(month)}월 ${parseInt(day)}일`;
        }

        function renderCalendar(date) {
            const year = date.getFullYear();
            const month = date.getMonth();

            // 타이틀 업데이트
            document.getElementById('calendarTitle').textContent = `${year}년 ${month + 1}월`;

            // 이번 달 첫째 날과 마지막 날
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);

            // 첫째 날의 요일 (0: 일요일)
            const startDayOfWeek = firstDay.getDay();

            // 이전 달 마지막 날
            const prevLastDay = new Date(year, month, 0).getDate();

            // 그리드 생성 (헤더 제외하고 날짜 셀만)
            const grid = document.getElementById('calendarGrid');

            // 기존 날짜 셀 제거 (헤더는 유지)
            const existingDays = grid.querySelectorAll('.calendar-day');
            existingDays.forEach(day => day.remove());

            // 필터 값 가져오기
            const companyFilter = document.getElementById('companyFilter')?.value.toLowerCase() || '';
            const sourceFilter = document.getElementById('sourceFilter')?.value || '';

            // 오늘 날짜
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

            // 총 42셀 (6주)
            for (let i = 0; i < 42; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';

                let dayNumber;
                let cellDate;
                let isOtherMonth = false;

                if (i < startDayOfWeek) {
                    // 이전 달
                    dayNumber = prevLastDay - startDayOfWeek + i + 1;
                    cellDate = new Date(year, month - 1, dayNumber);
                    isOtherMonth = true;
                } else if (i >= startDayOfWeek + lastDay.getDate()) {
                    // 다음 달
                    dayNumber = i - startDayOfWeek - lastDay.getDate() + 1;
                    cellDate = new Date(year, month + 1, dayNumber);
                    isOtherMonth = true;
                } else {
                    // 이번 달
                    dayNumber = i - startDayOfWeek + 1;
                    cellDate = new Date(year, month, dayNumber);
                }

                if (isOtherMonth) {
                    dayCell.classList.add('other-month');
                }

                // 요일 스타일
                const dayOfWeek = i % 7;
                if (dayOfWeek === 0) dayCell.classList.add('sunday');
                if (dayOfWeek === 6) dayCell.classList.add('saturday');

                // 날짜 문자열
                const dateStr = `${cellDate.getFullYear()}-${String(cellDate.getMonth() + 1).padStart(2, '0')}-${String(cellDate.getDate()).padStart(2, '0')}`;

                // 오늘 표시
                if (dateStr === todayStr) {
                    dayCell.classList.add('today');
                }

                // 날짜 번호
                const dayNumberDiv = document.createElement('div');
                dayNumberDiv.className = 'calendar-day-number';
                dayNumberDiv.textContent = dayNumber;
                dayCell.appendChild(dayNumberDiv);

                // 해당 날짜의 이벤트 필터링 및 표시
                const dayEvents = calendarEvents.filter(event => {
                    if (event.date !== dateStr) return false;
                    if (companyFilter && !event.company.toLowerCase().includes(companyFilter)) return false;
                    if (sourceFilter && event.source !== sourceFilter) return false;
                    return true;
                });

                dayEvents.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = `calendar-event source-${event.source}`;
                    eventDiv.textContent = event.title;
                    eventDiv.onclick = () => showEventDetail(event);
                    dayCell.appendChild(eventDiv);
                });

                grid.appendChild(dayCell);
            }
        }

        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar(currentCalendarDate);
            renderMiniCalendar(currentCalendarDate);
            updateCalendarStats();
        }

        function goToday() {
            currentCalendarDate = new Date();
            renderCalendar(currentCalendarDate);
            renderMiniCalendar(currentCalendarDate);
            updateCalendarStats();
        }

        function filterCalendarEvents() {
            renderCalendar(currentCalendarDate);
        }

        function showEventDetail(event) {
            // 기존 모달 제거
            const existingOverlay = document.querySelector('.calendar-modal-overlay');
            if (existingOverlay) existingOverlay.remove();
            const existingModal = document.querySelector('.calendar-event-modal');
            if (existingModal) existingModal.remove();

            // 모달 오버레이
            const overlay = document.createElement('div');
            overlay.className = 'calendar-modal-overlay';
            overlay.onclick = closeEventModal;

            // 모달
            const modal = document.createElement('div');
            modal.className = 'calendar-event-modal';

            const sourceNames = {
                earnings: '실적발표',
                news: '뉴스',
                report: '보고서',
                conference: '컨퍼런스',
                dividend: '배당'
            };

            modal.innerHTML = `
                <button class="calendar-modal-close" onclick="closeEventModal()">×</button>
                <div class="calendar-modal-header">${event.title}</div>
                <p><strong>회사:</strong> ${event.company}</p>
                <p><strong>날짜:</strong> ${event.date}</p>
                <p><strong>유형:</strong> <span class="calendar-event source-${event.source}" style="display: inline-block;">${sourceNames[event.source]}</span></p>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(modal);
        }

        function closeEventModal() {
            const overlay = document.querySelector('.calendar-modal-overlay');
            const modal = document.querySelector('.calendar-event-modal');
            if (overlay) overlay.remove();
            if (modal) modal.remove();
        }

        // 차트 뷰로 돌아가기
        function showChartView() {
            // 사이드바 아이콘 활성화 상태 변경
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="스냅샷"]').classList.add('active');

            // 페이지 새로고침하여 원래 상태로 복원
            location.reload();
        }

        // 피드 필터 상태 변수
        let currentFeedCategory = 'all';
        let currentFeedPriority = 'all';
        let currentFeedSearch = '';

        // 피드 필터 함수
        function filterFeed() {
            currentFeedCategory = document.getElementById('feedCategoryFilter')?.value || 'all';
            currentFeedPriority = document.getElementById('feedPriorityFilter')?.value || 'all';
            currentFeedSearch = document.getElementById('feedSearchInput')?.value.toLowerCase().trim() || '';
            renderFeedGrid();
        }

        // 피드 데이터
        const feedSourceData = {
            disclosure: {
                title: '공시',
                items: [
                    { title: '삼성전자, 2024년 4분기 실적 발표', time: '2026.01.31 16:30', source: '금융감독원', views: 8542, priority: 'high' },
                    { title: 'SK하이닉스 주요사항보고서 제출', time: '2026.01.31 15:45', source: 'DART', views: 5231, priority: 'high' },
                    { title: 'LG에너지솔루션 대규모 시설투자 결정', time: '2026.01.31 14:20', source: 'DART', views: 4127, priority: 'high' },
                    { title: '현대자동차 자기주식 취득 결정', time: '2026.01.31 12:15', source: 'DART', views: 3856, priority: 'medium' },
                    { title: 'NAVER 분기보고서 제출', time: '2026.01.30 17:30', source: 'DART', views: 2943, priority: 'medium' },
                    { title: '카카오 주식매수선택권 부여', time: '2026.01.30 16:00', source: 'DART', views: 2654, priority: 'medium' },
                    { title: '셀트리온 임상시험 결과 공시', time: '2026.01.30 14:45', source: 'DART', views: 2187, priority: 'medium' },
                    { title: '포스코홀딩스 이사회 결의', time: '2026.01.30 11:30', source: 'DART', views: 1876, priority: 'low' },
                    { title: 'KB금융 배당결정 공시', time: '2026.01.29 16:20', source: 'DART', views: 1543, priority: 'low' },
                    { title: '신한지주 자회사 설립 결정', time: '2026.01.29 15:00', source: 'DART', views: 1234, priority: 'low' },
                    { title: '하나금융지주 경영실적 공시', time: '2026.01.29 14:10', source: 'DART', views: 1098, priority: 'low' },
                    { title: '삼성SDI 시설투자 결정', time: '2026.01.29 11:45', source: 'DART', views: 987, priority: 'low' },
                    { title: 'LG화학 분할합병 결정', time: '2026.01.28 17:00', source: 'DART', views: 876, priority: 'low' },
                    { title: '기아 해외법인 출자 결정', time: '2026.01.28 15:30', source: 'DART', views: 654, priority: 'low' },
                    { title: '현대모비스 타법인 주식취득', time: '2026.01.28 14:00', source: 'DART', views: 543, priority: 'low' }
                ]
            },
            sec: {
                title: 'SEC',
                items: [
                    { title: 'Apple Inc. 10-K Annual Report Filed', time: '2026.01.31 15:30', source: 'SEC EDGAR', views: 7234, priority: 'high' },
                    { title: 'Tesla Form 8-K Current Report', time: '2026.01.31 14:20', source: 'SEC EDGAR', views: 6542, priority: 'high' },
                    { title: 'Microsoft Corp 10-Q Quarterly Report', time: '2026.01.31 13:45', source: 'SEC EDGAR', views: 5123, priority: 'high' },
                    { title: 'NVIDIA Form 4 Insider Trading', time: '2026.01.31 12:00', source: 'SEC EDGAR', views: 4876, priority: 'high' },
                    { title: 'Amazon.com Inc. S-1 Registration', time: '2026.01.31 10:30', source: 'SEC EDGAR', views: 3987, priority: 'medium' },
                    { title: 'Meta Platforms Form DEF 14A Proxy', time: '2026.01.30 16:45', source: 'SEC EDGAR', views: 3654, priority: 'medium' },
                    { title: 'Alphabet Inc. 10-K Annual Report', time: '2026.01.30 15:20', source: 'SEC EDGAR', views: 3210, priority: 'medium' },
                    { title: 'JPMorgan Chase 8-K Current Report', time: '2026.01.30 14:00', source: 'SEC EDGAR', views: 2876, priority: 'medium' },
                    { title: 'Berkshire Hathaway 13F Holdings', time: '2026.01.30 11:30', source: 'SEC EDGAR', views: 2543, priority: 'low' },
                    { title: 'Johnson & Johnson 10-Q Filed', time: '2026.01.29 16:15', source: 'SEC EDGAR', views: 1987, priority: 'low' },
                    { title: 'Visa Inc. Form 4 Filed', time: '2026.01.29 15:00', source: 'SEC EDGAR', views: 1654, priority: 'low' },
                    { title: 'Walmart Inc. 8-K Current Report', time: '2026.01.29 13:45', source: 'SEC EDGAR', views: 1432, priority: 'low' },
                    { title: 'Procter & Gamble 10-K Filed', time: '2026.01.29 11:20', source: 'SEC EDGAR', views: 1234, priority: 'low' },
                    { title: 'UnitedHealth Group S-3 Filing', time: '2026.01.28 16:30', source: 'SEC EDGAR', views: 987, priority: 'low' },
                    { title: 'Exxon Mobil 10-Q Quarterly Report', time: '2026.01.28 14:45', source: 'SEC EDGAR', views: 765, priority: 'low' }
                ]
            },
            edinet: {
                title: 'EDI NET',
                items: [
                    { title: 'トヨタ自動車 有価証券報告書', time: '2026.01.31 16:00', source: 'EDINET', views: 4532, priority: 'high' },
                    { title: 'ソニーグループ 四半期報告書', time: '2026.01.31 15:45', source: 'EDINET', views: 3876, priority: 'high' },
                    { title: '三菱UFJフィナンシャル 決算短信', time: '2026.01.31 14:30', source: 'EDINET', views: 3421, priority: 'high' },
                    { title: 'キーエンス 有価証券報告書', time: '2026.01.31 13:15', source: 'EDINET', views: 2987, priority: 'medium' },
                    { title: '日本電信電話 四半期報告書', time: '2026.01.31 11:00', source: 'EDINET', views: 2654, priority: 'medium' },
                    { title: 'ファーストリテイリング 決算公告', time: '2026.01.30 17:00', source: 'EDINET', views: 2345, priority: 'medium' },
                    { title: '東京エレクトロン 有価証券報告書', time: '2026.01.30 15:30', source: 'EDINET', views: 2123, priority: 'medium' },
                    { title: '三井住友フィナンシャル 四半期報告書', time: '2026.01.30 14:20', source: 'EDINET', views: 1876, priority: 'low' },
                    { title: 'HOYA 臨時報告書', time: '2026.01.30 12:45', source: 'EDINET', views: 1543, priority: 'low' },
                    { title: 'ダイキン工業 有価証券報告書', time: '2026.01.29 16:30', source: 'EDINET', views: 1234, priority: 'low' },
                    { title: '任天堂 四半期報告書', time: '2026.01.29 15:15', source: 'EDINET', views: 1098, priority: 'low' },
                    { title: 'リクルート 決算短信', time: '2026.01.29 14:00', source: 'EDINET', views: 876, priority: 'low' },
                    { title: '伊藤忠商事 有価証券報告書', time: '2026.01.29 11:30', source: 'EDINET', views: 765, priority: 'low' },
                    { title: '三菱商事 四半期報告書', time: '2026.01.28 16:45', source: 'EDINET', views: 654, priority: 'low' },
                    { title: '日立製作所 臨時報告書', time: '2026.01.28 14:20', source: 'EDINET', views: 543, priority: 'low' }
                ]
            },
            legislation: {
                title: '법령',
                items: [
                    { title: '자본시장법 시행령 일부개정령안 입법예고', time: '2026.01.31 14:00', source: '법제처', views: 3421, priority: 'high' },
                    { title: '금융소비자보호법 시행규칙 개정', time: '2026.01.30 16:30', source: '금융위원회', views: 2876, priority: 'high' },
                    { title: '전자금융거래법 개정안 국회 통과', time: '2026.01.29 15:00', source: '국회', views: 2543, priority: 'high' },
                    { title: '개인정보보호법 시행령 개정 공포', time: '2026.01.28 14:20', source: '개인정보보호위원회', views: 2187, priority: 'medium' },
                    { title: '공정거래법 하위법령 정비안 발표', time: '2026.01.25 11:00', source: '공정거래위원회', views: 1876, priority: 'medium' },
                    { title: '상법 일부개정법률 공포', time: '2026.01.24 16:00', source: '법제처', views: 1654, priority: 'medium' },
                    { title: '조세특례제한법 시행령 개정', time: '2026.01.24 14:30', source: '기획재정부', views: 1432, priority: 'medium' },
                    { title: '은행법 시행규칙 일부개정', time: '2026.01.23 15:45', source: '금융위원회', views: 1234, priority: 'low' },
                    { title: '보험업법 하위법령 개정안', time: '2026.01.23 11:20', source: '금융위원회', views: 1098, priority: 'low' },
                    { title: '신용정보법 시행령 개정 공고', time: '2026.01.22 16:15', source: '금융위원회', views: 987, priority: 'low' },
                    { title: '저작권법 시행규칙 개정', time: '2026.01.22 14:00', source: '문화체육관광부', views: 876, priority: 'low' },
                    { title: '특허법 시행령 일부개정', time: '2026.01.21 15:30', source: '특허청', views: 765, priority: 'low' },
                    { title: '독점규제법 시행령 개정안', time: '2026.01.21 11:45', source: '공정거래위원회', views: 654, priority: 'low' },
                    { title: '벤처투자법 하위법령 정비', time: '2026.01.20 16:00', source: '중소벤처기업부', views: 543, priority: 'low' },
                    { title: '외국환거래법 시행규칙 개정', time: '2026.01.20 14:20', source: '기획재정부', views: 432, priority: 'low' }
                ]
            },
            policy: {
                title: '정책',
                items: [
                    { title: '2025년 금융정책 방향 발표', time: '2026.01.31 16:00', source: '금융위원회', views: 4532, priority: 'high' },
                    { title: 'AI 규제 샌드박스 확대 시행', time: '2026.01.31 13:00', source: '과학기술정보통신부', views: 3987, priority: 'high' },
                    { title: '반도체 산업 지원 종합대책 발표', time: '2026.01.30 15:30', source: '산업통상자원부', views: 3654, priority: 'high' },
                    { title: '탄소중립 이행점검 결과 공개', time: '2026.01.29 14:00', source: '환경부', views: 2987, priority: 'medium' },
                    { title: '디지털 전환 촉진 기본계획 수립', time: '2026.01.28 16:20', source: '기획재정부', views: 2654, priority: 'medium' },
                    { title: '수출입 금융지원 확대 방안', time: '2026.01.28 11:30', source: '산업통상자원부', views: 2345, priority: 'medium' },
                    { title: '스타트업 육성 정책 발표', time: '2026.01.27 15:45', source: '중소벤처기업부', views: 2123, priority: 'medium' },
                    { title: '부동산 정책 보완 대책', time: '2026.01.27 14:00', source: '국토교통부', views: 1876, priority: 'low' },
                    { title: '에너지 전환 로드맵 공개', time: '2026.01.26 16:30', source: '산업통상자원부', views: 1654, priority: 'low' },
                    { title: '금융소비자 보호 강화 방안', time: '2026.01.26 11:15', source: '금융위원회', views: 1432, priority: 'low' },
                    { title: '첨단산업 인재양성 계획', time: '2026.01.25 15:00', source: '교육부', views: 1234, priority: 'low' },
                    { title: '공공데이터 개방 확대', time: '2026.01.25 13:30', source: '행정안전부', views: 1098, priority: 'low' },
                    { title: '혁신성장 전략 발표', time: '2026.01.24 16:00', source: '기획재정부', views: 987, priority: 'low' },
                    { title: '소재부품장비 경쟁력 강화', time: '2026.01.24 14:20', source: '산업통상자원부', views: 876, priority: 'low' },
                    { title: '바이오헬스 산업 육성 방안', time: '2026.01.23 15:45', source: '보건복지부', views: 765, priority: 'low' }
                ]
            },
            macro: {
                title: '거시지표',
                items: [
                    { title: '1월 소비자물가 전년비 2.3% 상승', time: '2026.01.31 16:00', source: '통계청', views: 5234, priority: 'high' },
                    { title: '한국은행 기준금리 동결 결정', time: '2026.01.31 14:30', source: '한국은행', views: 4876, priority: 'high' },
                    { title: '12월 수출입 동향 발표', time: '2026.01.30 15:00', source: '관세청', views: 3987, priority: 'high' },
                    { title: 'GDP 성장률 2.1% 잠정치 발표', time: '2026.01.29 14:00', source: '한국은행', views: 3654, priority: 'high' },
                    { title: '실업률 3.2% 기록, 전월비 소폭 상승', time: '2026.01.25 11:00', source: '통계청', views: 3210, priority: 'medium' },
                    { title: '12월 산업생산 동향', time: '2026.01.30 11:00', source: '통계청', views: 2876, priority: 'medium' },
                    { title: '소비자심리지수 98.5', time: '2026.01.29 10:00', source: '한국은행', views: 2543, priority: 'medium' },
                    { title: '외환보유액 4,150억 달러', time: '2026.01.28 15:00', source: '한국은행', views: 2187, priority: 'medium' },
                    { title: '제조업 PMI 51.2 발표', time: '2026.01.28 10:30', source: '한국은행', views: 1876, priority: 'low' },
                    { title: '12월 경상수지 흑자 62억불', time: '2026.01.27 14:00', source: '한국은행', views: 1654, priority: 'low' },
                    { title: '생산자물가 전년비 1.8% 상승', time: '2026.01.27 11:00', source: '한국은행', views: 1432, priority: 'low' },
                    { title: '미국 연준 금리 동결 결정', time: '2026.01.26 04:00', source: 'Federal Reserve', views: 1234, priority: 'low' },
                    { title: '중국 GDP 성장률 4.9%', time: '2026.01.25 11:00', source: 'NBS', views: 1098, priority: 'low' },
                    { title: '일본 CPI 2.1% 발표', time: '2026.01.24 09:30', source: '総務省', views: 987, priority: 'low' },
                    { title: '유로존 PMI 48.7', time: '2026.01.24 18:00', source: 'S&P Global', views: 876, priority: 'low' }
                ]
            },
            patent: {
                title: '특허',
                items: [
                    { title: '삼성전자 차세대 반도체 공정 특허 등록', time: '2026.01.31 15:00', source: '특허청', views: 3876, priority: 'high' },
                    { title: 'LG화학 이차전지 소재 특허 출원', time: '2026.01.31 12:00', source: '특허청', views: 3421, priority: 'high' },
                    { title: '현대모비스 자율주행 센서 특허 공개', time: '2026.01.30 16:00', source: '특허청', views: 2987, priority: 'high' },
                    { title: 'SK텔레콤 6G 통신 기술 특허 등록', time: '2026.01.29 14:30', source: '특허청', views: 2654, priority: 'medium' },
                    { title: '카카오 AI 음성인식 특허 출원', time: '2026.01.28 11:00', source: '특허청', views: 2345, priority: 'medium' },
                    { title: 'NAVER 검색 알고리즘 특허', time: '2026.01.28 15:30', source: '특허청', views: 2123, priority: 'medium' },
                    { title: '셀트리온 바이오시밀러 제조법 특허', time: '2026.01.27 14:00', source: '특허청', views: 1876, priority: 'medium' },
                    { title: 'SK하이닉스 HBM 적층 기술 특허', time: '2026.01.27 11:20', source: '특허청', views: 1654, priority: 'low' },
                    { title: '삼성SDI 전고체 배터리 특허 공개', time: '2026.01.26 16:00', source: '특허청', views: 1432, priority: 'low' },
                    { title: 'LG전자 OLED 패널 기술 특허', time: '2026.01.26 13:45', source: '특허청', views: 1234, priority: 'low' },
                    { title: '현대차 수소연료전지 특허 등록', time: '2026.01.25 15:20', source: '특허청', views: 1098, priority: 'low' },
                    { title: '포스코 이차전지 양극재 특허', time: '2026.01.25 11:30', source: '특허청', views: 987, priority: 'low' },
                    { title: 'KT AI 네트워크 최적화 특허', time: '2026.01.24 14:00', source: '특허청', views: 876, priority: 'low' },
                    { title: '두산에너빌리티 SMR 기술 특허', time: '2026.01.24 10:45', source: '특허청', views: 765, priority: 'low' },
                    { title: '한화솔루션 태양광 셀 특허', time: '2026.01.23 16:30', source: '특허청', views: 654, priority: 'low' }
                ]
            },
            research: {
                title: '논문',
                items: [
                    { title: '국내 반도체 산업 경쟁력 분석 연구', time: '2026.01.30 14:00', source: '산업연구원', views: 2876, priority: 'high' },
                    { title: '기후변화가 금융시장에 미치는 영향', time: '2026.01.29 15:00', source: '한국금융연구원', views: 2543, priority: 'high' },
                    { title: 'AI 기술 발전과 노동시장 변화 전망', time: '2026.01.28 11:00', source: '한국노동연구원', views: 2187, priority: 'high' },
                    { title: '전기차 배터리 기술 동향 분석', time: '2026.01.25 14:30', source: '에너지경제연구원', views: 1876, priority: 'medium' },
                    { title: '글로벌 공급망 재편과 한국 경제', time: '2026.01.24 16:00', source: '대외경제정책연구원', views: 1654, priority: 'medium' },
                    { title: '디지털 금융 혁신 동향 분석', time: '2026.01.24 11:00', source: '한국금융연구원', views: 1432, priority: 'medium' },
                    { title: '탄소중립 이행 경제적 영향 평가', time: '2026.01.23 15:30', source: '에너지경제연구원', views: 1234, priority: 'medium' },
                    { title: '스타트업 생태계 현황 조사', time: '2026.01.23 13:00', source: '중소기업연구원', views: 1098, priority: 'low' },
                    { title: '고령화 사회와 경제성장', time: '2026.01.22 14:20', source: '한국개발연구원', views: 987, priority: 'low' },
                    { title: '미중 기술패권 경쟁 분석', time: '2026.01.22 11:00', source: '대외경제정책연구원', views: 876, priority: 'low' },
                    { title: '부동산 시장 동향과 전망', time: '2026.01.21 16:00', source: '국토연구원', views: 765, priority: 'low' },
                    { title: '핵심광물 공급망 리스크 분석', time: '2026.01.21 14:00', source: '산업연구원', views: 654, priority: 'low' },
                    { title: '바이오산업 R&D 동향', time: '2026.01.20 15:30', source: '생명공학정책연구센터', views: 543, priority: 'low' },
                    { title: '플랫폼 경제 규제 방향 연구', time: '2026.01.20 11:45', source: '한국법제연구원', views: 432, priority: 'low' },
                    { title: '차세대 이동통신 기술 전망', time: '2026.01.19 14:00', source: '정보통신정책연구원', views: 321, priority: 'low' }
                ]
            },
            bloomberg: {
                title: 'Bloomberg',
                items: [
                    { title: 'Fed Holds Rates Steady, Signals Patience on Cuts', time: '2026.01.31 16:30', source: 'Bloomberg', views: 12543, priority: 'high' },
                    { title: 'Tesla Shares Surge on Q4 Delivery Beat', time: '2026.01.31 15:00', source: 'Bloomberg', views: 9876, priority: 'high' },
                    { title: 'Apple Vision Pro Sales Exceed Expectations', time: '2026.01.31 14:20', source: 'Bloomberg', views: 8765, priority: 'high' },
                    { title: 'NVIDIA CEO Hints at New AI Chip Architecture', time: '2026.01.31 12:45', source: 'Bloomberg', views: 7654, priority: 'high' },
                    { title: 'China Tech Stocks Rally on Policy Support', time: '2026.01.31 10:30', source: 'Bloomberg', views: 6543, priority: 'medium' },
                    { title: 'Oil Prices Jump on Middle East Tensions', time: '2026.01.30 16:00', source: 'Bloomberg', views: 5432, priority: 'medium' },
                    { title: 'European Banks Face New Capital Requirements', time: '2026.01.30 14:30', source: 'Bloomberg', views: 4321, priority: 'medium' },
                    { title: 'Bitcoin ETF Inflows Hit Record High', time: '2026.01.30 12:00', source: 'Bloomberg', views: 3987, priority: 'medium' },
                    { title: 'Microsoft Cloud Revenue Beats Estimates', time: '2026.01.30 10:15', source: 'Bloomberg', views: 3654, priority: 'low' },
                    { title: 'Amazon Plans Major Warehouse Expansion', time: '2026.01.29 15:45', source: 'Bloomberg', views: 3210, priority: 'low' },
                    { title: 'Global Bond Yields Rise on Inflation Fears', time: '2026.01.29 14:00', source: 'Bloomberg', views: 2876, priority: 'low' },
                    { title: 'Samsung Unveils Next-Gen Memory Technology', time: '2026.01.29 11:30', source: 'Bloomberg', views: 2543, priority: 'low' },
                    { title: 'JPMorgan Raises S&P 500 Target', time: '2026.01.28 16:20', source: 'Bloomberg', views: 2187, priority: 'low' },
                    { title: 'Google Parent Alphabet Reports Strong Ad Revenue', time: '2026.01.28 14:45', source: 'Bloomberg', views: 1876, priority: 'low' },
                    { title: 'Hedge Funds Bet Big on AI Stocks', time: '2026.01.28 12:00', source: 'Bloomberg', views: 1543, priority: 'low' }
                ]
            },
            nytimes: {
                title: 'NY Times',
                items: [
                    { title: 'AI Regulation Bill Advances in Congress', time: '2026.01.31 16:00', source: 'The New York Times', views: 8765, priority: 'high' },
                    { title: 'Tech Giants Face New Antitrust Scrutiny', time: '2026.01.31 14:30', source: 'The New York Times', views: 7654, priority: 'high' },
                    { title: 'Climate Change Impact on Global Supply Chains', time: '2026.01.31 12:15', source: 'The New York Times', views: 6543, priority: 'high' },
                    { title: 'Housing Market Shows Signs of Recovery', time: '2026.01.31 10:00', source: 'The New York Times', views: 5432, priority: 'medium' },
                    { title: 'Electric Vehicle Sales Surpass Gas Cars in Europe', time: '2026.01.30 15:45', source: 'The New York Times', views: 4876, priority: 'medium' },
                    { title: 'Healthcare Costs Continue to Rise', time: '2026.01.30 14:00', source: 'The New York Times', views: 4321, priority: 'medium' },
                    { title: 'Remote Work Reshapes Commercial Real Estate', time: '2026.01.30 11:30', source: 'The New York Times', views: 3987, priority: 'medium' },
                    { title: 'Student Loan Forgiveness Plan Under Review', time: '2026.01.29 16:20', source: 'The New York Times', views: 3654, priority: 'low' },
                    { title: 'Retail Sales Beat Holiday Expectations', time: '2026.01.29 14:45', source: 'The New York Times', views: 3210, priority: 'low' },
                    { title: 'Cybersecurity Threats Increase for Small Business', time: '2026.01.29 12:00', source: 'The New York Times', views: 2876, priority: 'low' },
                    { title: 'Immigration Reform Debate Heats Up', time: '2026.01.28 15:30', source: 'The New York Times', views: 2543, priority: 'low' },
                    { title: 'Renewable Energy Investment Hits Record', time: '2026.01.28 13:45', source: 'The New York Times', views: 2187, priority: 'low' },
                    { title: 'Banks Tighten Lending Standards', time: '2026.01.28 11:00', source: 'The New York Times', views: 1876, priority: 'low' },
                    { title: 'Manufacturing Returns to U.S. Shores', time: '2026.01.27 16:00', source: 'The New York Times', views: 1543, priority: 'low' },
                    { title: 'Gig Economy Workers Seek New Protections', time: '2026.01.27 14:20', source: 'The New York Times', views: 1234, priority: 'low' }
                ]
            },
            reuters: {
                title: 'Reuters',
                items: [
                    { title: 'ECB Signals Rate Cut Timing Uncertain', time: '2026.01.31 17:00', source: 'Reuters', views: 9876, priority: 'high' },
                    { title: 'China Manufacturing PMI Beats Forecast', time: '2026.01.31 15:30', source: 'Reuters', views: 8765, priority: 'high' },
                    { title: 'OPEC+ Considers Output Adjustment', time: '2026.01.31 13:45', source: 'Reuters', views: 7654, priority: 'high' },
                    { title: 'UK Economy Avoids Recession', time: '2026.01.31 11:00', source: 'Reuters', views: 6543, priority: 'high' },
                    { title: 'Japan Yen Weakens on BOJ Policy Outlook', time: '2026.01.31 09:30', source: 'Reuters', views: 5432, priority: 'medium' },
                    { title: 'Gold Prices Hit Six-Month High', time: '2026.01.30 16:15', source: 'Reuters', views: 4876, priority: 'medium' },
                    { title: 'India GDP Growth Forecast Raised', time: '2026.01.30 14:00', source: 'Reuters', views: 4321, priority: 'medium' },
                    { title: 'Shipping Costs Rise on Red Sea Disruptions', time: '2026.01.30 11:45', source: 'Reuters', views: 3987, priority: 'medium' },
                    { title: 'Brazil Central Bank Holds Rates Steady', time: '2026.01.29 16:30', source: 'Reuters', views: 3654, priority: 'low' },
                    { title: 'Australia Inflation Eases More Than Expected', time: '2026.01.29 14:15', source: 'Reuters', views: 3210, priority: 'low' },
                    { title: 'German Auto Industry Faces Transition Challenges', time: '2026.01.29 12:00', source: 'Reuters', views: 2876, priority: 'low' },
                    { title: 'Swiss Franc Strengthens on Safe Haven Demand', time: '2026.01.28 15:45', source: 'Reuters', views: 2543, priority: 'low' },
                    { title: 'South Korea Exports Rise for Fourth Month', time: '2026.01.28 13:30', source: 'Reuters', views: 2187, priority: 'low' },
                    { title: 'Mexico Remittances Hit New Record', time: '2026.01.28 11:00', source: 'Reuters', views: 1876, priority: 'low' },
                    { title: 'Singapore Growth Outlook Brightens', time: '2026.01.27 15:20', source: 'Reuters', views: 1543, priority: 'low' }
                ]
            },
            wsj: {
                title: 'WSJ',
                items: [
                    { title: 'Private Equity Firms Eye Tech Sector Deals', time: '2026.01.31 16:45', source: 'The Wall Street Journal', views: 10234, priority: 'high' },
                    { title: 'Corporate Earnings Season Exceeds Expectations', time: '2026.01.31 15:00', source: 'The Wall Street Journal', views: 8765, priority: 'high' },
                    { title: 'Venture Capital Funding Rebounds in Q4', time: '2026.01.31 13:30', source: 'The Wall Street Journal', views: 7654, priority: 'high' },
                    { title: 'Commercial Real Estate Faces Refinancing Wave', time: '2026.01.31 11:15', source: 'The Wall Street Journal', views: 6543, priority: 'high' },
                    { title: 'Semiconductor Chip Shortage Eases', time: '2026.01.31 09:00', source: 'The Wall Street Journal', views: 5876, priority: 'medium' },
                    { title: 'IPO Market Shows Signs of Life', time: '2026.01.30 16:30', source: 'The Wall Street Journal', views: 5432, priority: 'medium' },
                    { title: 'Activist Investors Target Underperforming Boards', time: '2026.01.30 14:15', source: 'The Wall Street Journal', views: 4876, priority: 'medium' },
                    { title: 'Supply Chain Disruptions Cost Companies Billions', time: '2026.01.30 12:00', source: 'The Wall Street Journal', views: 4321, priority: 'medium' },
                    { title: 'M&A Activity Picks Up Across Sectors', time: '2026.01.29 15:45', source: 'The Wall Street Journal', views: 3987, priority: 'low' },
                    { title: 'Banks Report Strong Trading Revenue', time: '2026.01.29 13:30', source: 'The Wall Street Journal', views: 3654, priority: 'low' },
                    { title: 'Energy Companies Boost Shareholder Returns', time: '2026.01.29 11:00', source: 'The Wall Street Journal', views: 3210, priority: 'low' },
                    { title: 'Retail Bankruptcies Expected to Rise', time: '2026.01.28 16:00', source: 'The Wall Street Journal', views: 2876, priority: 'low' },
                    { title: 'Insurance Rates Climb on Natural Disaster Losses', time: '2026.01.28 14:20', source: 'The Wall Street Journal', views: 2543, priority: 'low' },
                    { title: 'Corporate Bond Market Sees Record Issuance', time: '2026.01.28 12:00', source: 'The Wall Street Journal', views: 2187, priority: 'low' },
                    { title: 'Tech Layoffs Slow as Sector Stabilizes', time: '2026.01.27 15:30', source: 'The Wall Street Journal', views: 1876, priority: 'low' }
                ]
            }
        };

        // 피드 뷰 표시
        function showFeed() {
            // 사이드바 아이콘 활성화 상태 변경
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="피드"]').classList.add('active');

            // 중앙 패널에 피드 그리드 렌더링
            const centerPanel = document.querySelector('.center-panel');

            // 총 피드 항목 수 계산
            let totalItems = 0;
            Object.values(feedSourceData).forEach(cat => {
                totalItems += cat.items.length;
            });

            // 현재 날짜/시간 포맷
            const now = new Date();
            const updateTime = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

            centerPanel.innerHTML = `
                <div class="feed-container">
                    <div class="feed-header">
                        <div class="feed-header-info">
                            최근 업데이트: ${updateTime} · 총 ${totalItems}개 항목
                        </div>
                        <div class="feed-search-area">
                            <select class="feed-category-select" id="feedCategoryFilter" onchange="filterFeed()">
                                <option value="all">전체 카테고리</option>
                                <option value="disclosure">공시</option>
                                <option value="sec">SEC</option>
                                <option value="edinet">EDINET</option>
                                <option value="legislation">법령</option>
                                <option value="policy">정책</option>
                                <option value="macro">거시지표</option>
                                <option value="patent">특허</option>
                                <option value="research">논문</option>
                                <option value="bloomberg">Bloomberg</option>
                                <option value="nytimes">NY Times</option>
                                <option value="reuters">Reuters</option>
                                <option value="wsj">WSJ</option>
                            </select>
                            <select class="feed-priority-select" id="feedPriorityFilter" onchange="filterFeed()">
                                <option value="all">전체 우선순위</option>
                                <option value="high">높음</option>
                                <option value="medium">중간</option>
                                <option value="low">낮음</option>
                            </select>
                            <div class="feed-search-box">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                <input type="text" id="feedSearchInput" placeholder="검색..." oninput="filterFeed()" />
                            </div>
                        </div>
                    </div>
                    <div class="feed-grid" id="feedGrid"></div>
                </div>
            `;

            // 그리드 렌더링
            renderFeedGrid();

            // 우측 패널 비우기
            const rightPanel = document.querySelector('.right-panel');
            if (rightPanel) {
                rightPanel.innerHTML = `
                    <div style="padding: 20px; color: var(--text-dim); text-align: center;">
                        <p>피드 항목을 클릭하면 상세 정보가 표시됩니다.</p>
                    </div>
                `;
            }
        }

        // 피드 그리드 렌더링
        function renderFeedGrid() {
            const feedGrid = document.getElementById('feedGrid');
            if (!feedGrid) return;

            const categories = ['disclosure', 'sec', 'edinet', 'legislation', 'policy', 'macro', 'patent', 'research', 'bloomberg', 'nytimes', 'reuters', 'wsj'];

            const priorityLabels = {
                'high': '높음',
                'medium': '중간',
                'low': ''
            };

            // 카테고리 필터링
            const filteredCategories = currentFeedCategory === 'all'
                ? categories
                : categories.filter(cat => cat === currentFeedCategory);

            let html = '';
            filteredCategories.forEach(categoryId => {
                const category = feedSourceData[categoryId];

                // 아이템 필터링 (우선순위 + 검색어)
                const filteredItems = category.items.filter(item => {
                    // 우선순위 필터
                    if (currentFeedPriority !== 'all' && item.priority !== currentFeedPriority) {
                        return false;
                    }
                    // 검색어 필터
                    if (currentFeedSearch) {
                        const searchLower = currentFeedSearch;
                        const titleMatch = item.title.toLowerCase().includes(searchLower);
                        const sourceMatch = item.source.toLowerCase().includes(searchLower);
                        if (!titleMatch && !sourceMatch) {
                            return false;
                        }
                    }
                    return true;
                });

                // 필터링 결과가 없으면 카드 숨김
                if (filteredItems.length === 0) return;

                html += `
                    <div class="feed-source-card">
                        <div class="feed-source-header">
                            <span>${category.title}</span>
                        </div>
                        <div class="feed-source-list">
                            ${filteredItems.map(item => `
                                <div class="feed-source-item" onclick="showFeedItemDetail('${categoryId}', '${item.title.replace(/'/g, "\\'")}')">
                                    <div class="feed-item-row">
                                        <div class="feed-item-title">${item.title}</div>
                                        <div class="feed-item-stats">
                                            ${item.priority !== 'low' ? `<span class="feed-item-priority ${item.priority}">${priorityLabels[item.priority]}</span>` : ''}
                                            <span class="feed-item-views">${item.views.toLocaleString()}</span>
                                        </div>
                                    </div>
                                    <div class="feed-item-meta">
                                        <span class="feed-item-time">${item.time}</span>
                                        <span class="feed-item-source">${item.source}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            // 필터링 결과가 없을 때 메시지 표시
            if (!html) {
                html = `<div style="grid-column: 1 / -1; padding: 40px; text-align: center; color: var(--text-dim);">검색 결과가 없습니다.</div>`;
            }

            feedGrid.innerHTML = html;
        }

        // 카테고리별 샘플 원문 콘텐츠
        const feedDetailContents = {
            disclosure: {
                '삼성전자, 2024년 4분기 실적 발표': `
                    <div style="font-family: 'Malgun Gothic', sans-serif;">
                        <div style="border: 1px solid var(--border-color); padding: 16px; margin-bottom: 16px; background: var(--bg-light);">
                            <div style="text-align: center; font-weight: bold; font-size: 16px; margin-bottom: 12px;">주요사항보고서</div>
                            <div style="text-align: center; color: var(--text-dim); font-size: 11px;">금융위원회 / 한국거래소 귀중</div>
                        </div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 16px;">
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light); width: 30%;">회사명</td>
                                <td style="padding: 8px;">삼성전자주식회사</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">대표이사</td>
                                <td style="padding: 8px;">한종희, 경계현</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">본점 소재지</td>
                                <td style="padding: 8px;">경기도 수원시 영통구 삼성로 129</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">보고서 제출일</td>
                                <td style="padding: 8px;">2026년 01월 31일</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">결산기</td>
                                <td style="padding: 8px;">12월</td>
                            </tr>
                        </table>
                        <div style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">1. 실적 내용</div>
                        <p style="font-size: 12px; line-height: 1.8; margin-bottom: 16px;">당사는 2024년 4분기 연결기준 매출액 79조 8,000억원, 영업이익 9조 1,800억원을 기록하였습니다. 이는 전년 동기 대비 매출액 12.3% 증가, 영업이익 32.1% 증가한 수치입니다. 당기순이익은 7조 2,400억원으로 전년 동기 대비 28.5% 증가하였습니다.</p>
                        <div style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">2. 사업부문별 실적</div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin-bottom: 16px;">
                            <tr style="background: var(--bg-light); border-bottom: 1px solid var(--border-color);">
                                <th style="padding: 8px; text-align: left;">사업부문</th>
                                <th style="padding: 8px; text-align: right;">매출액</th>
                                <th style="padding: 8px; text-align: right;">영업이익</th>
                                <th style="padding: 8px; text-align: right;">전년비</th>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;">DS(반도체)</td>
                                <td style="padding: 8px; text-align: right;">28.5조원</td>
                                <td style="padding: 8px; text-align: right;">4.2조원</td>
                                <td style="padding: 8px; text-align: right; color: #4caf50;">+45.2%</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;">DX(가전/모바일)</td>
                                <td style="padding: 8px; text-align: right;">42.1조원</td>
                                <td style="padding: 8px; text-align: right;">3.8조원</td>
                                <td style="padding: 8px; text-align: right; color: #4caf50;">+8.3%</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;">SDC(디스플레이)</td>
                                <td style="padding: 8px; text-align: right;">9.2조원</td>
                                <td style="padding: 8px; text-align: right;">1.1조원</td>
                                <td style="padding: 8px; text-align: right; color: #4caf50;">+12.1%</td>
                            </tr>
                        </table>
                        <div style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">3. 실적 분석</div>
                        <p style="font-size: 12px; line-height: 1.8; margin-bottom: 12px;">반도체 부문은 AI 서버용 HBM(고대역폭메모리) 수요 급증과 서버용 SSD 판매 확대에 힘입어 전년 동기 대비 큰 폭의 성장을 기록하였습니다. 특히 HBM3E 제품의 양산이 본격화되면서 고부가가치 제품 비중이 확대되었습니다.</p>
                        <p style="font-size: 12px; line-height: 1.8; margin-bottom: 12px;">DX 부문은 갤럭시 S시리즈 신제품 출시 효과와 프리미엄 가전 판매 호조로 안정적인 실적을 유지하였습니다. 디스플레이 부문은 OLED 패널 수요 증가로 수익성이 개선되었습니다.</p>
                        <div style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">4. 향후 전망</div>
                        <p style="font-size: 12px; line-height: 1.8;">2026년에는 AI 관련 반도체 수요가 지속적으로 확대될 것으로 전망되며, 당사는 HBM 및 AI 가속기 등 고부가가치 제품 중심의 사업 포트폴리오를 강화해 나갈 계획입니다. 또한 2나노 파운드리 공정 양산을 통해 시스템반도체 사업의 경쟁력을 제고하겠습니다.</p>
                    </div>
                `
            },
            sec: {
                'Apple Inc. 10-K Annual Report Filed': `
                    <div style="font-family: 'Times New Roman', serif;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 11px; color: var(--text-dim);">UNITED STATES</div>
                            <div style="font-size: 13px; font-weight: bold;">SECURITIES AND EXCHANGE COMMISSION</div>
                            <div style="font-size: 11px; color: var(--text-dim);">Washington, D.C. 20549</div>
                        </div>
                        <div style="text-align: center; border: 2px solid var(--text-primary); padding: 8px; margin-bottom: 16px; font-weight: bold;">FORM 10-K</div>
                        <div style="font-size: 12px; margin-bottom: 16px;">
                            <p>☑ ANNUAL REPORT PURSUANT TO SECTION 13 OR 15(d) OF THE SECURITIES EXCHANGE ACT OF 1934</p>
                            <p style="margin-left: 20px;">For the fiscal year ended <strong>September 28, 2025</strong></p>
                            <p style="margin-top: 8px;">☐ TRANSITION REPORT PURSUANT TO SECTION 13 OR 15(d) OF THE SECURITIES EXCHANGE ACT OF 1934</p>
                        </div>
                        <div style="font-size: 11px; margin-bottom: 12px;">Commission File Number: <strong>001-36743</strong></div>
                        <div style="text-align: center; margin-bottom: 16px; padding: 12px; border: 1px solid var(--border-color);">
                            <div style="font-size: 18px; font-weight: bold;">APPLE INC.</div>
                            <div style="font-size: 11px; color: var(--text-dim); margin-top: 4px;">(Exact name of Registrant as specified in its charter)</div>
                            <div style="font-size: 11px; margin-top: 8px;">California (State of incorporation) | 94-2404110 (I.R.S. Employer ID)</div>
                            <div style="font-size: 11px; color: var(--text-dim); margin-top: 8px;">One Apple Park Way, Cupertino, California 95014</div>
                            <div style="font-size: 11px; color: var(--text-dim);">(408) 996-1010</div>
                        </div>
                        <div style="font-size: 12px; line-height: 1.8;">
                            <p style="font-size: 14px; font-weight: bold; border-bottom: 1px solid var(--border-color); padding-bottom: 4px;">PART I</p>
                            <p style="margin-top: 12px;"><strong>Item 1. Business</strong></p>
                            <p style="margin-top: 8px;">Apple Inc. ("Apple" or the "Company") designs, manufactures and markets smartphones, personal computers, tablets, wearables and accessories, and sells a variety of related services. The Company's fiscal year is the 52- or 53-week period that ends on the last Saturday of September.</p>
                            <p style="margin-top: 12px;"><strong>Products</strong></p>
                            <p style="margin-top: 8px;"><em>iPhone</em> — iPhone® is the Company's line of smartphones based on its iOS operating system. The iPhone line includes iPhone 16 Pro, iPhone 16, iPhone 15, and iPhone SE®.</p>
                            <p style="margin-top: 8px;"><em>Mac</em> — Mac® is the Company's line of personal computers based on its macOS® operating system. The Mac line includes laptops MacBook Air® and MacBook Pro®, as well as desktops iMac®, Mac mini®, Mac Studio® and Mac Pro®.</p>
                            <p style="margin-top: 8px;"><em>iPad</em> — iPad® is the Company's line of multipurpose tablets based on its iPadOS® operating system. The iPad line includes iPad Pro®, iPad Air®, iPad and iPad mini®.</p>
                            <p style="margin-top: 12px;"><strong>Services</strong></p>
                            <p style="margin-top: 8px;">The Company offers a variety of services including advertising, AppleCare®, cloud services, digital content and payment services. Services revenue includes revenue from the App Store®, Apple Arcade®, Apple Card®, Apple Music®, Apple News+®, Apple TV+®, Apple Pay®, iCloud® and licensing arrangements.</p>
                            <p style="margin-top: 12px;"><strong>Item 1A. Risk Factors</strong></p>
                            <p style="margin-top: 8px;">The Company's business, reputation, results of operations, financial condition and stock price can be affected by a number of factors, whether currently known or unknown, including those described below...</p>
                        </div>
                    </div>
                `
            },
            edinet: {
                'トヨタ自動車 有価証券報告書': `
                    <div style="font-family: 'Yu Gothic', 'Meiryo', sans-serif;">
                        <div style="text-align: center; border-bottom: 2px solid var(--text-primary); padding-bottom: 12px; margin-bottom: 16px;">
                            <div style="font-size: 18px; font-weight: bold;">有価証券報告書</div>
                            <div style="font-size: 11px; color: var(--text-dim); margin-top: 4px;">（金融商品取引法第24条第1項に基づく報告書）</div>
                        </div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 16px;">
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light); width: 35%;">事業年度</td>
                                <td style="padding: 8px;">第121期（自 2025年4月1日 至 2026年3月31日）</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">会社名</td>
                                <td style="padding: 8px;">トヨタ自動車株式会社</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">英訳名</td>
                                <td style="padding: 8px;">TOYOTA MOTOR CORPORATION</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">本店の所在地</td>
                                <td style="padding: 8px;">愛知県豊田市トヨタ町1番地</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">代表者の役職氏名</td>
                                <td style="padding: 8px;">取締役社長 佐藤 恒治</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px; background: var(--bg-light);">資本金</td>
                                <td style="padding: 8px;">6,354億円</td>
                            </tr>
                        </table>
                        <div style="font-size: 14px; font-weight: bold; margin-bottom: 12px; border-bottom: 1px solid var(--border-color); padding-bottom: 4px;">第一部 企業情報</div>
                        <div style="font-size: 13px; font-weight: bold; margin-bottom: 8px;">第1 企業の概況</div>
                        <div style="font-size: 12px; line-height: 1.8;">
                            <p><strong>1. 主要な経営指標等の推移</strong></p>
                            <p style="margin-top: 8px;">当連結会計年度における売上高は45兆953億円（前期比12.4%増）、営業利益は5兆3,529億円（前期比96.4%増）となりました。親会社の所有者に帰属する当期利益は4兆9,449億円（前期比101.7%増）となりました。</p>
                            <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin: 12px 0;">
                                <tr style="background: var(--bg-light); border-bottom: 1px solid var(--border-color);">
                                    <th style="padding: 6px;">指標</th>
                                    <th style="padding: 6px; text-align: right;">当期</th>
                                    <th style="padding: 6px; text-align: right;">前期</th>
                                    <th style="padding: 6px; text-align: right;">増減率</th>
                                </tr>
                                <tr style="border-bottom: 1px solid var(--border-color);">
                                    <td style="padding: 6px;">売上高</td>
                                    <td style="padding: 6px; text-align: right;">45兆953億円</td>
                                    <td style="padding: 6px; text-align: right;">40兆1,281億円</td>
                                    <td style="padding: 6px; text-align: right; color: #4caf50;">+12.4%</td>
                                </tr>
                                <tr style="border-bottom: 1px solid var(--border-color);">
                                    <td style="padding: 6px;">営業利益</td>
                                    <td style="padding: 6px; text-align: right;">5兆3,529億円</td>
                                    <td style="padding: 6px; text-align: right;">2兆7,250億円</td>
                                    <td style="padding: 6px; text-align: right; color: #4caf50;">+96.4%</td>
                                </tr>
                            </table>
                            <p style="margin-top: 12px;"><strong>2. 事業の内容</strong></p>
                            <p style="margin-top: 8px;">当社グループは、自動車事業を中心に、金融事業およびその他の事業を営んでいます。自動車事業においては、セダン、ミニバン、SUV、トラック等の開発・製造・販売を行っています。</p>
                            <p style="margin-top: 12px;"><strong>3. 経営環境および対処すべき課題</strong></p>
                            <p style="margin-top: 8px;">自動車業界はCASE（Connected, Autonomous, Shared, Electric）と呼ばれる技術革新の波にあり、当社は電動化、知能化、多様化を推進しています。2026年までにBEV（バッテリー電気自動車）のグローバル販売台数150万台を目指します。</p>
                        </div>
                    </div>
                `
            },
            legislation: {
                '자본시장법 시행령 일부개정령안 입법예고': `
                    <div style="font-family: 'Malgun Gothic', sans-serif;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 11px; color: var(--text-dim);">대통령령 제○○○○○호</div>
                            <div style="font-size: 16px; font-weight: bold; margin-top: 8px;">자본시장과 금융투자업에 관한 법률 시행령 일부개정령안</div>
                        </div>
                        <div style="border: 1px solid var(--border-color); padding: 12px; margin-bottom: 16px; background: var(--bg-light); font-size: 12px;">
                            <table style="width: 100%;">
                                <tr><td style="width: 100px;"><strong>입법예고기간</strong></td><td>2026.01.31. ~ 2026.03.11. (40일간)</td></tr>
                                <tr><td><strong>소관부처</strong></td><td>금융위원회</td></tr>
                                <tr><td><strong>공포예정일</strong></td><td>2026.05.01.</td></tr>
                                <tr><td><strong>시행예정일</strong></td><td>2026.07.01.</td></tr>
                            </table>
                        </div>
                        <div style="font-size: 13px; font-weight: bold; margin-bottom: 8px; border-bottom: 1px solid var(--border-color); padding-bottom: 4px;">개정 이유</div>
                        <p style="font-size: 12px; line-height: 1.8; margin-bottom: 16px;">가상자산 시장의 급성장에 따라 투자자 보호와 시장 건전성 확보를 위한 제도적 기반 마련이 필요하고, 금융혁신 촉진을 위한 규제 샌드박스 확대 및 디지털금융 활성화를 위한 법적 근거를 정비하려는 것임.</p>
                        <div style="font-size: 13px; font-weight: bold; margin-bottom: 8px; border-bottom: 1px solid var(--border-color); padding-bottom: 4px;">주요 내용</div>
                        <div style="font-size: 12px; line-height: 1.8;">
                            <p><strong>제1조(목적)</strong> 이 영은 「자본시장과 금융투자업에 관한 법률」에서 위임된 사항과 그 시행에 필요한 사항을 규정함을 목적으로 한다.</p>
                            <p style="margin-top: 12px;"><strong>제○조의2(가상자산 관련 규정 신설)</strong></p>
                            <p>① 법 제○조제1항에서 "대통령령으로 정하는 가상자산"이란 다음 각 호의 어느 하나에 해당하는 것을 말한다.</p>
                            <p style="margin-left: 16px;">1. 분산원장기술을 사용하여 전자적으로 거래될 수 있는 전자적 증표</p>
                            <p style="margin-left: 16px;">2. 제1호에 해당하는 것과 교환되거나 연동되어 그 가치가 결정되는 것</p>
                            <p style="margin-left: 16px;">3. 그 밖에 금융위원회가 정하여 고시하는 것</p>
                            <p style="margin-top: 12px;">② 가상자산사업자는 다음 각 호의 사항을 이용자에게 사전에 고지하여야 한다.</p>
                            <p style="margin-left: 16px;">1. 가상자산의 명칭 및 발행자에 관한 사항</p>
                            <p style="margin-left: 16px;">2. 가상자산의 기술적 특성 및 가격 변동 위험에 관한 사항</p>
                            <p style="margin-left: 16px;">3. 이용자 보호를 위한 조치 및 분쟁해결 절차에 관한 사항</p>
                            <p style="margin-top: 12px;"><strong>제○조의3(혁신금융서비스 지정 확대)</strong></p>
                            <p>① 금융위원회는 혁신금융서비스의 지정 기간을 현행 2년에서 4년으로 연장할 수 있다.</p>
                            <p>② 혁신금융서비스 지정 심사 시 인공지능, 블록체인 등 신기술 활용 여부를 우대 요소로 고려할 수 있다.</p>
                        </div>
                    </div>
                `
            },
            policy: {
                '2025년 금융정책 방향 발표': `
                    <div style="font-family: 'Malgun Gothic', sans-serif;">
                        <div style="background: #1a3a5c; color: white; padding: 16px; margin: -16px -16px 16px -16px;">
                            <div style="font-size: 11px; opacity: 0.8;">금융위원회 보도자료</div>
                            <div style="font-size: 16px; font-weight: bold; margin-top: 8px;">2025년 금융정책 방향</div>
                            <div style="font-size: 11px; opacity: 0.8; margin-top: 8px;">2026.01.31.(금) 배포 즉시</div>
                        </div>
                        <div style="font-size: 12px; line-height: 1.8;">
                            <p style="font-weight: bold; color: #1a3a5c; font-size: 13px;">◈ 정책 핵심 방향</p>
                            <p>□ 금융위원회는 '25년 금융정책을 ①혁신금융 활성화, ②금융소비자 보호 강화, ③디지털 금융 기반 확충을 3대 핵심과제로 추진</p>
                            <p>□ 글로벌 금융환경 변화에 선제적으로 대응하고, 국민 체감형 금융서비스 혁신을 통해 금융산업 경쟁력 제고</p>
                            <p style="margin-top: 16px; font-weight: bold; color: #1a3a5c; font-size: 13px;">◈ 세부 추진과제</p>
                            <p style="margin-top: 8px;"><strong>1. 혁신금융 활성화</strong></p>
                            <p style="margin-left: 12px;">○ 핀테크 규제 샌드박스 확대 (연간 100건 → 150건)</p>
                            <p style="margin-left: 12px;">○ 오픈뱅킹 2.0 도입으로 데이터 활용 범위 확대</p>
                            <p style="margin-left: 12px;">○ 마이데이터 2.0 추진으로 의료·공공 데이터 연계 확대</p>
                            <p style="margin-left: 12px;">○ 혁신금융 전용 투자펀드 5,000억원 조성</p>
                            <p style="margin-top: 12px;"><strong>2. 금융소비자 보호 강화</strong></p>
                            <p style="margin-left: 12px;">○ 불완전판매 제재 강화 및 피해구제 절차 간소화</p>
                            <p style="margin-left: 12px;">○ 금융상품 비교공시 플랫폼 고도화</p>
                            <p style="margin-left: 12px;">○ 고령층·취약계층 맞춤형 금융서비스 확대</p>
                            <p style="margin-left: 12px;">○ 금융사기 예방을 위한 AI 기반 이상거래탐지 의무화</p>
                            <p style="margin-top: 12px;"><strong>3. 디지털 금융 기반 확충</strong></p>
                            <p style="margin-left: 12px;">○ CBDC(중앙은행 디지털화폐) 시범사업 본격 추진</p>
                            <p style="margin-left: 12px;">○ 금융권 클라우드 이용 규제 합리화</p>
                            <p style="margin-left: 12px;">○ AI 기반 금융서비스 가이드라인 마련</p>
                            <p style="margin-left: 12px;">○ 사이버보안 대응체계 강화 및 금융ISAC 역할 확대</p>
                            <p style="margin-top: 16px; font-weight: bold; color: #1a3a5c; font-size: 13px;">◈ 기대 효과</p>
                            <p style="margin-left: 12px;">○ 금융혁신 생태계 조성을 통한 핀테크 기업 경쟁력 강화</p>
                            <p style="margin-left: 12px;">○ 소비자 중심의 금융환경 구축으로 금융 신뢰도 제고</p>
                            <p style="margin-left: 12px;">○ 디지털 금융 인프라 구축으로 글로벌 금융허브 도약 기반 마련</p>
                        </div>
                    </div>
                `
            },
            macro: {
                '1월 소비자물가 전년비 2.3% 상승': `
                    <div style="font-family: 'Malgun Gothic', sans-serif;">
                        <div style="text-align: center; margin-bottom: 16px;">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='30'%3E%3Crect fill='%231a3a5c' width='60' height='30'/%3E%3Ctext x='30' y='20' text-anchor='middle' fill='white' font-size='10'>통계청%3C/text%3E%3C/svg%3E" style="margin-bottom: 8px;">
                            <div style="font-size: 16px; font-weight: bold;">2026년 1월 소비자물가동향</div>
                            <div style="font-size: 11px; color: var(--text-dim);">보도일시: 2026.01.31.(금) 08:00</div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                            <div style="flex: 1; background: var(--bg-light); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #e53935;">+2.3%</div>
                                <div style="font-size: 10px; color: var(--text-dim);">전년동월비</div>
                            </div>
                            <div style="flex: 1; background: var(--bg-light); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #ff9800;">+0.4%</div>
                                <div style="font-size: 10px; color: var(--text-dim);">전월비</div>
                            </div>
                            <div style="flex: 1; background: var(--bg-light); padding: 12px; border-radius: 4px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold;">113.24</div>
                                <div style="font-size: 10px; color: var(--text-dim);">물가지수(2020=100)</div>
                            </div>
                        </div>
                        <div style="font-size: 12px; line-height: 1.8;">
                            <p><strong>□ 총지수</strong></p>
                            <p>○ 2026년 1월 소비자물가지수는 113.24(2020=100)로 전년동월대비 2.3% 상승</p>
                            <p>○ 전월대비로는 0.4% 상승하여 4개월 연속 상승세 지속</p>
                            <p style="margin-top: 12px;"><strong>□ 품목별 동향</strong></p>
                            <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin: 8px 0;">
                                <tr style="background: var(--bg-light); border-bottom: 1px solid var(--border-color);">
                                    <th style="padding: 6px; text-align: left;">품목</th>
                                    <th style="padding: 6px; text-align: right;">전년동월비</th>
                                    <th style="padding: 6px; text-align: right;">기여도</th>
                                </tr>
                                <tr style="border-bottom: 1px solid var(--border-color);">
                                    <td style="padding: 6px;">농축수산물</td>
                                    <td style="padding: 6px; text-align: right; color: #e53935;">+4.2%</td>
                                    <td style="padding: 6px; text-align: right;">0.32%p</td>
                                </tr>
                                <tr style="border-bottom: 1px solid var(--border-color);">
                                    <td style="padding: 6px;">공업제품</td>
                                    <td style="padding: 6px; text-align: right; color: #e53935;">+1.8%</td>
                                    <td style="padding: 6px; text-align: right;">0.58%p</td>
                                </tr>
                                <tr style="border-bottom: 1px solid var(--border-color);">
                                    <td style="padding: 6px;">전기·가스·수도</td>
                                    <td style="padding: 6px; text-align: right; color: #e53935;">+5.1%</td>
                                    <td style="padding: 6px; text-align: right;">0.28%p</td>
                                </tr>
                                <tr style="border-bottom: 1px solid var(--border-color);">
                                    <td style="padding: 6px;">서비스</td>
                                    <td style="padding: 6px; text-align: right; color: #e53935;">+2.1%</td>
                                    <td style="padding: 6px; text-align: right;">1.12%p</td>
                                </tr>
                            </table>
                            <p style="margin-top: 12px;"><strong>□ 주요 품목별 상세</strong></p>
                            <p>○ 농축수산물: 배추 +32.1%, 사과 +18.5%, 달걀 +12.3%</p>
                            <p>○ 석유류: 휘발유 +3.8%, 경유 +2.9%</p>
                            <p>○ 서비스: 외식 +2.8%, 집세 +1.9%, 개인서비스 +2.4%</p>
                            <p style="margin-top: 12px;"><strong>□ 근원물가</strong></p>
                            <p>○ 식료품 및 에너지 제외 지수: 전년동월비 +2.1%</p>
                            <p>○ 농산물 및 석유류 제외 지수: 전년동월비 +2.0%</p>
                        </div>
                    </div>
                `
            },
            patent: {
                '삼성전자 차세대 반도체 공정 특허 등록': `
                    <div style="font-family: 'Malgun Gothic', sans-serif;">
                        <div style="border: 2px solid var(--border-color); padding: 16px; margin-bottom: 16px;">
                            <div style="text-align: center;">
                                <div style="font-size: 11px; color: var(--text-dim);">대한민국특허청(KR)</div>
                                <div style="font-size: 14px; font-weight: bold; margin-top: 4px;">(12) 등록특허공보(B1)</div>
                            </div>
                        </div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin-bottom: 16px;">
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 6px; background: var(--bg-light); width: 35%;">(45) 공고일자</td>
                                <td style="padding: 6px;">2026년01월31일</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 6px; background: var(--bg-light);">(11) 등록번호</td>
                                <td style="padding: 6px;">10-2XXXXXX</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 6px; background: var(--bg-light);">(21) 출원번호</td>
                                <td style="padding: 6px;">10-2024-XXXXXXX</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 6px; background: var(--bg-light);">(22) 출원일자</td>
                                <td style="padding: 6px;">2024년03월15일</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 6px; background: var(--bg-light);">(73) 특허권자</td>
                                <td style="padding: 6px;">삼성전자주식회사<br>경기도 수원시 영통구 삼성로 129</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 6px; background: var(--bg-light);">(72) 발명자</td>
                                <td style="padding: 6px;">김○○, 이○○, 박○○</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 6px; background: var(--bg-light);">(51) 국제특허분류</td>
                                <td style="padding: 6px;">H01L 29/423, H01L 29/66</td>
                            </tr>
                        </table>
                        <div style="font-size: 13px; font-weight: bold; margin-bottom: 8px;">(54) 발명의 명칭</div>
                        <p style="font-size: 12px; margin-bottom: 16px;">3나노미터급 GAA 트랜지스터 제조방법 및 이를 포함하는 반도체 소자</p>
                        <div style="font-size: 13px; font-weight: bold; margin-bottom: 8px;">(57) 요약</div>
                        <p style="font-size: 12px; line-height: 1.7; margin-bottom: 16px;">본 발명은 3나노미터급 게이트-올-어라운드(GAA) 구조의 트랜지스터 제조방법에 관한 것으로, 나노시트 채널을 형성하고 사방에서 게이트로 감싸는 구조를 통해 전력 효율과 성능을 획기적으로 개선한다.</p>
                        <div style="font-size: 13px; font-weight: bold; margin-bottom: 8px;">대표도</div>
                        <div style="background: var(--bg-light); padding: 20px; text-align: center; margin-bottom: 16px; border-radius: 4px;">
                            <div style="font-size: 11px; color: var(--text-dim);">[도 1] GAA 트랜지스터 구조 단면도</div>
                            <div style="margin-top: 12px; font-size: 60px;">⬡</div>
                            <div style="font-size: 10px; color: var(--text-dim);">나노시트 채널 구조</div>
                        </div>
                        <div style="font-size: 13px; font-weight: bold; margin-bottom: 8px;">청구범위</div>
                        <div style="font-size: 12px; line-height: 1.7;">
                            <p><strong>청구항 1.</strong> 기판 상에 형성된 복수의 나노시트를 포함하는 채널부; 상기 채널부를 둘러싸는 게이트 전극; 및 상기 채널부의 양단에 형성된 소스/드레인 영역을 포함하는 반도체 소자.</p>
                            <p style="margin-top: 8px;"><strong>청구항 2.</strong> 제1항에 있어서, 상기 나노시트는 5nm 이하의 두께를 갖는 것을 특징으로 하는 반도체 소자.</p>
                            <p style="margin-top: 8px;"><strong>청구항 3.</strong> 제1항에 있어서, 상기 게이트 전극은 고유전율 절연막 및 금속 게이트를 포함하는 것을 특징으로 하는 반도체 소자.</p>
                        </div>
                    </div>
                `
            },
            research: {
                '국내 반도체 산업 경쟁력 분석 연구': `
                    <div style="font-family: 'Times New Roman', serif;">
                        <div style="text-align: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 16px;">
                            <div style="font-size: 11px; color: var(--text-dim);">산업연구원 연구보고서 2026-01</div>
                            <div style="font-size: 16px; font-weight: bold; margin-top: 12px; line-height: 1.4;">국내 반도체 산업 경쟁력 분석 및<br>중장기 발전 전략 연구</div>
                            <div style="font-size: 12px; margin-top: 12px; color: var(--text-dim);">
                                김○○ 선임연구위원 | 이○○ 연구위원 | 박○○ 부연구위원
                            </div>
                            <div style="font-size: 11px; margin-top: 8px; color: var(--text-dim);">
                                발행일: 2026년 1월 30일 | ISBN: 979-11-XXXX-XXX-X
                            </div>
                        </div>
                        <div style="font-size: 12px; line-height: 1.8;">
                            <p style="font-weight: bold;">Abstract</p>
                            <p style="text-align: justify; margin-bottom: 16px; padding: 12px; background: var(--bg-light); border-radius: 4px;">This study analyzes the competitiveness of Korea's semiconductor industry and proposes mid-to-long-term development strategies. Using a comprehensive framework combining patent analysis, trade data, and expert surveys, we evaluate Korea's position in the global semiconductor value chain. Our findings indicate that while Korea maintains strong competitiveness in memory semiconductors, significant challenges remain in system semiconductors and foundry services. We propose a three-pillar strategy focusing on R&D investment, talent development, and supply chain diversification.</p>
                            <p style="font-weight: bold; font-size: 13px;">Ⅰ. 서론</p>
                            <p style="text-align: justify; margin-top: 8px;">반도체 산업은 대한민국 수출의 약 20%를 차지하는 핵심 산업으로, 글로벌 공급망 재편과 기술 패권 경쟁 속에서 그 중요성이 더욱 부각되고 있다. 미중 기술 갈등의 심화, 각국의 반도체 자국 생산 정책 강화, AI 반도체 수요 급증 등 산업 환경이 급변하는 가운데, 국내 반도체 산업의 경쟁력을 객관적으로 진단하고 미래 전략을 수립할 필요성이 높아지고 있다.</p>
                            <p style="font-weight: bold; font-size: 13px; margin-top: 16px;">Ⅱ. 연구 방법</p>
                            <p style="text-align: justify; margin-top: 8px;">본 연구는 다음과 같은 분석 프레임워크를 활용하였다:</p>
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li>특허 데이터 분석 (2015-2025, USPTO/KIPO)</li>
                                <li>무역통계 분석 (UN Comtrade, KITA)</li>
                                <li>전문가 델파이 조사 (N=45)</li>
                                <li>주요 기업 사례 연구</li>
                            </ul>
                            <p style="font-weight: bold; font-size: 13px; margin-top: 16px;">Ⅲ. 주요 연구 결과</p>
                            <p style="text-align: justify; margin-top: 8px;"><strong>1. 메모리 반도체:</strong> 글로벌 시장점유율 60% 이상 유지, HBM 분야 선도적 지위 확보</p>
                            <p style="text-align: justify; margin-top: 8px;"><strong>2. 시스템 반도체:</strong> 글로벌 점유율 3% 수준, 설계-제조 연계 약화가 주요 과제</p>
                            <p style="text-align: justify; margin-top: 8px;"><strong>3. 장비/소재:</strong> 국산화율 20% 수준으로 공급망 취약성 상존</p>
                            <p style="font-weight: bold; font-size: 13px; margin-top: 16px;">Ⅳ. 정책 제언</p>
                            <p style="text-align: justify; margin-top: 8px;">① R&D 투자 확대 및 차세대 공정 선점, ② 반도체 전문인력 10만명 양성, ③ 글로벌 공급망 다변화 및 전략적 제휴 강화</p>
                        </div>
                    </div>
                `
            },
            bloomberg: {
                'Fed Holds Rates Steady, Signals Patience on Cuts': `
                    <div style="font-family: 'Helvetica Neue', Arial, sans-serif;">
                        <div style="border-bottom: 3px solid #000; padding-bottom: 8px; margin-bottom: 16px;">
                            <span style="font-weight: bold; font-size: 18px;">Bloomberg</span>
                            <span style="font-size: 11px; color: var(--text-dim); margin-left: 8px;">Economics</span>
                        </div>
                        <h2 style="font-size: 20px; font-weight: bold; line-height: 1.3; margin-bottom: 12px;">Fed Holds Rates Steady, Signals Patience on Cuts</h2>
                        <div style="font-size: 11px; color: var(--text-dim); margin-bottom: 16px;">
                            By Craig Torres and Catarina Saraiva | January 31, 2026, 4:30 PM EST
                        </div>
                        <div style="font-size: 13px; line-height: 1.8;">
                            <p><strong>(Bloomberg)</strong> — The Federal Reserve held interest rates steady and signaled it's in no rush to cut borrowing costs, saying it needs to see more evidence that inflation is cooling before easing monetary policy.</p>
                            <p style="margin-top: 12px;">The Federal Open Market Committee voted unanimously to keep the benchmark federal funds rate in a target range of 4.25% to 4.5%, as expected. The decision marks the second consecutive meeting where officials have held rates steady after cutting them by a full percentage point between September and December.</p>
                            <p style="margin-top: 12px;">"The Committee judges that the risks to achieving its employment and inflation goals are roughly in balance," the Fed said in its statement. "The economic outlook is uncertain, and the Committee is attentive to the risks to both sides of its dual mandate."</p>
                            <p style="margin-top: 12px;">Chair Jerome Powell, speaking at a press conference following the decision, emphasized that policymakers want to see sustained progress on inflation before considering any rate cuts. "We don't need to be in a hurry to adjust our policy stance," Powell said. "We're well positioned to wait and see how the economy evolves."</p>
                            <p style="margin-top: 12px;"><strong>Key Takeaways from the Fed Decision:</strong></p>
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li style="margin-bottom: 6px;">Rates held at 4.25%-4.5% target range</li>
                                <li style="margin-bottom: 6px;">Statement removed language about "progress" on inflation</li>
                                <li style="margin-bottom: 6px;">Powell signals patience, no urgency to cut rates</li>
                                <li style="margin-bottom: 6px;">Labor market remains "solid" according to Fed assessment</li>
                            </ul>
                            <p style="margin-top: 12px;">The decision comes amid growing uncertainty about the trajectory of the US economy. While the labor market has remained resilient, with unemployment holding near historic lows, inflation has proven stickier than many economists anticipated. The personal consumption expenditures price index, the Fed's preferred inflation gauge, rose 2.6% in December from a year earlier, still above the central bank's 2% target.</p>
                            <p style="margin-top: 12px;">Treasury yields rose following the announcement, with the 10-year yield climbing 5 basis points to 4.58%. The S&P 500 pared gains after the statement was released but recovered during Powell's press conference.</p>
                            <p style="margin-top: 12px;">Markets are now pricing in roughly two quarter-point rate cuts for 2026, down from expectations of four cuts at the start of the year. The first reduction isn't fully priced in until the June meeting, according to fed funds futures.</p>
                            <p style="margin-top: 12px;">"The Fed is clearly signaling that they're comfortable staying on hold for an extended period," said Kathy Bostjancic, chief economist at Nationwide. "They want to see convincing evidence that inflation is on a sustainable path to 2% before they move."</p>
                        </div>
                    </div>
                `
            },
            nytimes: {
                'AI Regulation Bill Advances in Congress': `
                    <div style="font-family: 'Georgia', 'Times New Roman', serif;">
                        <div style="text-align: center; border-bottom: 1px solid #000; padding-bottom: 8px; margin-bottom: 16px;">
                            <span style="font-family: 'Old English Text MT', serif; font-size: 24px;">The New York Times</span>
                        </div>
                        <h2 style="font-size: 22px; font-weight: bold; line-height: 1.3; margin-bottom: 8px;">AI Regulation Bill Advances in Congress</h2>
                        <div style="font-size: 14px; color: var(--text-dim); margin-bottom: 16px;">Bipartisan legislation would require safety testing and transparency from AI developers</div>
                        <div style="font-size: 11px; color: var(--text-dim); margin-bottom: 16px;">
                            By Cecilia Kang and David McCabe | Jan. 31, 2026
                        </div>
                        <div style="font-size: 14px; line-height: 1.9;">
                            <p><span style="font-size: 28px; float: left; margin-right: 8px; line-height: 1;">W</span>ASHINGTON — A landmark artificial intelligence regulation bill cleared a key Senate committee on Thursday, marking the most significant step yet toward establishing federal oversight of the rapidly evolving technology.</p>
                            <p style="margin-top: 12px;">The Artificial Intelligence Safety and Innovation Act, which passed the Commerce Committee by a vote of 18 to 7, would require companies developing powerful AI systems to conduct safety testing before deployment and disclose information about how their models are trained.</p>
                            <p style="margin-top: 12px;">The legislation represents a careful balance between promoting innovation and addressing growing concerns about the potential risks posed by advanced AI systems. Supporters say it will help ensure the technology is developed responsibly, while critics argue it could stifle American competitiveness.</p>
                            <p style="margin-top: 12px;">"This is a historic moment," said Senator Maria Cantwell, Democrat of Washington and the committee's chairwoman. "We're establishing guardrails that will help ensure AI benefits society while minimizing potential harms."</p>
                            <p style="margin-top: 12px;"><strong>Key Provisions of the Bill:</strong></p>
                            <p style="margin-top: 8px;">The legislation would create a new office within the Commerce Department to oversee AI development and establish standards for safety testing. Companies developing AI systems above certain capability thresholds would be required to:</p>
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li style="margin-bottom: 6px;">Conduct pre-deployment safety evaluations</li>
                                <li style="margin-bottom: 6px;">Report serious safety incidents to the government</li>
                                <li style="margin-bottom: 6px;">Implement cybersecurity protections for model weights</li>
                                <li style="margin-bottom: 6px;">Disclose when AI is used to generate content</li>
                            </ul>
                            <p style="margin-top: 12px;">The bill's bipartisan support reflects growing consensus in Congress that some form of AI regulation is necessary. However, significant disagreements remain about how far such rules should go.</p>
                            <p style="margin-top: 12px;">Technology industry groups have lobbied intensively on the legislation. While some major AI companies have expressed support for reasonable regulation, others have warned that overly burdensome rules could drive innovation overseas.</p>
                            <p style="margin-top: 12px;">"We support smart, targeted regulation that addresses real risks," said a spokesman for OpenAI, one of the leading AI developers. "We look forward to working with Congress as this legislation moves forward."</p>
                            <p style="margin-top: 12px;">The bill now heads to the full Senate, where its fate remains uncertain. Republican leaders have expressed concerns that the legislation could give the federal government too much power over the technology sector.</p>
                            <p style="margin-top: 12px;">Senator Ted Cruz of Texas, the committee's ranking Republican, voted against the measure, calling it "well-intentioned but ultimately counterproductive." He argued that the United States should focus on maintaining its lead in AI rather than imposing new regulations.</p>
                        </div>
                    </div>
                `
            },
            reuters: {
                'ECB Signals Rate Cut Timing Uncertain': `
                    <div style="font-family: 'Helvetica Neue', Arial, sans-serif;">
                        <div style="background: #ff6600; color: white; padding: 4px 8px; display: inline-block; margin-bottom: 12px; font-weight: bold; font-size: 14px;">Reuters</div>
                        <h2 style="font-size: 20px; font-weight: bold; line-height: 1.3; margin-bottom: 12px;">ECB Signals Rate Cut Timing Uncertain Amid Sticky Inflation</h2>
                        <div style="font-size: 11px; color: var(--text-dim); margin-bottom: 16px;">
                            By Balazs Koranyi and Francesco Canepa | January 31, 2026 5:00 PM GMT
                        </div>
                        <div style="font-size: 13px; line-height: 1.8;">
                            <p><strong>FRANKFURT (Reuters)</strong> - The European Central Bank held interest rates steady on Thursday and signaled it remains uncertain about when it will be able to start cutting borrowing costs, as inflation proves more persistent than expected.</p>
                            <p style="margin-top: 12px;">The ECB kept its deposit rate at 3.75%, as widely expected, and President Christine Lagarde said policymakers need more evidence that price pressures are durably declining before they can ease policy.</p>
                            <p style="margin-top: 12px;">"We are not pre-committing to any particular rate path," Lagarde told reporters at a press conference in Frankfurt. "Future decisions will continue to be data-dependent and taken on a meeting-by-meeting basis."</p>
                            <p style="margin-top: 12px;">The decision comes as the euro zone economy shows signs of weakness, with business activity contracting and Germany, the bloc's largest economy, teetering on the edge of recession. However, services inflation has remained stubbornly high, complicating the ECB's path forward.</p>
                            <p style="margin-top: 12px;"><strong>Economic Outlook:</strong></p>
                            <p style="margin-top: 8px;">The central bank acknowledged that economic growth has been weaker than anticipated, with the manufacturing sector continuing to struggle and consumer spending remaining subdued. However, Lagarde emphasized that the labor market has held up relatively well.</p>
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li style="margin-bottom: 6px;">Euro zone GDP grew just 0.1% in Q4 2025</li>
                                <li style="margin-bottom: 6px;">Headline inflation at 2.4%, core inflation at 2.7%</li>
                                <li style="margin-bottom: 6px;">Unemployment rate stable at 6.4%</li>
                                <li style="margin-bottom: 6px;">Manufacturing PMI at 46.2, indicating contraction</li>
                            </ul>
                            <p style="margin-top: 12px;">"The inflation outlook remains uncertain," Lagarde said. "Domestic price pressures, particularly in services, remain elevated. Wages are still growing at rates that would be inconsistent with our inflation target if sustained."</p>
                            <p style="margin-top: 12px;">Markets had been pricing in a roughly 60% chance of a rate cut in March, but those expectations moderated following Lagarde's comments. The euro rose 0.3% against the dollar after the press conference.</p>
                            <p style="margin-top: 12px;">Some ECB policymakers have argued that the central bank should cut rates soon to support the struggling economy, while others have urged patience given persistent inflation pressures. The debate reflects a broader tension between the ECB's price stability mandate and concerns about economic growth.</p>
                            <p style="margin-top: 12px;">"The ECB is clearly torn between weak growth and sticky inflation," said Carsten Brzeski, global head of macro at ING. "They're likely to remain in wait-and-see mode for at least another meeting."</p>
                            <p style="margin-top: 12px;">The central bank's next meeting is scheduled for March 6, when it will also publish updated economic projections that could provide more clarity on the rate outlook.</p>
                        </div>
                    </div>
                `
            },
            wsj: {
                'Private Equity Firms Eye Tech Sector Deals': `
                    <div style="font-family: 'Exchange', Georgia, serif;">
                        <div style="border-bottom: 2px solid #000; padding-bottom: 4px; margin-bottom: 16px;">
                            <span style="font-size: 20px; font-weight: bold; font-style: italic;">The Wall Street Journal</span>
                        </div>
                        <div style="font-size: 11px; color: #900; font-weight: bold; margin-bottom: 8px;">FINANCE</div>
                        <h2 style="font-size: 22px; font-weight: bold; line-height: 1.2; margin-bottom: 12px;">Private Equity Firms Eye Tech Sector Deals as Valuations Fall</h2>
                        <div style="font-size: 13px; color: var(--text-dim); margin-bottom: 8px;">Buyout shops see opportunity in software companies hit by rising interest rates</div>
                        <div style="font-size: 11px; color: var(--text-dim); margin-bottom: 16px;">
                            By Miriam Gottfried and Laura Cooper | Jan. 31, 2026 6:30 am ET
                        </div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <p>Private-equity firms are circling the technology sector, seeing opportunities to buy software and cloud companies at valuations that have tumbled from their pandemic-era peaks.</p>
                            <p style="margin-top: 12px;">Buyout giants including Blackstone Inc., KKR & Co., and Thoma Bravo have been actively evaluating potential deals in recent months, according to people familiar with the matter. The firms are particularly interested in enterprise software companies with recurring revenue streams that have seen their stock prices fall sharply.</p>
                            <p style="margin-top: 12px;">"We're seeing the best opportunities in tech that we've seen in years," said Scott Shleifer, a partner at Tiger Global Management. "Valuations have come down significantly, and many of these companies have strong fundamentals."</p>
                            <p style="margin-top: 12px;"><strong>A Shifting Landscape:</strong></p>
                            <p style="margin-top: 8px;">The tech sector's appeal to private equity reflects a dramatic shift from just two years ago, when sky-high valuations made most deals prohibitively expensive. Rising interest rates and a broader market selloff have since brought prices back to earth.</p>
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li style="margin-bottom: 6px;">Nasdaq index down 15% from 2021 highs</li>
                                <li style="margin-bottom: 6px;">Software sector trading at 6x revenue vs. 15x in 2021</li>
                                <li style="margin-bottom: 6px;">PE dry powder exceeds $2.5 trillion globally</li>
                                <li style="margin-bottom: 6px;">Tech deals account for 25% of LBO activity</li>
                            </ul>
                            <p style="margin-top: 12px;">The renewed interest comes as private-equity firms sit on record amounts of uninvested capital and face pressure from their investors to put money to work. At the same time, many tech companies are struggling with slowing growth and intense competition, making their boards more receptive to buyout offers.</p>
                            <p style="margin-top: 12px;">Thoma Bravo, which focuses exclusively on software investments, has been among the most active. The firm recently closed its largest fund ever at $32 billion and has signaled it intends to pursue large-scale deals.</p>
                            <p style="margin-top: 12px;">"Software businesses are uniquely attractive for private equity," said Orlando Bravo, the firm's founder. "They have high margins, predictable revenue, and significant room for operational improvement."</p>
                            <p style="margin-top: 12px;">However, some observers caution that private-equity firms face challenges in the current environment. Higher interest rates have increased borrowing costs, making it harder to finance large leveraged buyouts. And many tech companies have complex capital structures with multiple share classes that can complicate deal negotiations.</p>
                            <p style="margin-top: 12px;">Still, dealmakers say the pipeline of potential transactions is growing. Several public software companies have received preliminary takeover interest in recent weeks, according to people familiar with the matter.</p>
                            <p style="margin-top: 12px;">"The stars are aligning for tech buyouts," said David Friedman, co-head of global technology investment banking at Goldman Sachs. "We expect to see a significant pickup in deal activity over the next 12 months."</p>
                        </div>
                    </div>
                `
            }
        };

        // 피드 항목 상세 보기
        function showFeedItemDetail(categoryId, title) {
            const category = feedSourceData[categoryId];
            const item = category.items.find(i => i.title === title);
            if (!item) return;

            // 현재 피드 상세 정보 저장
            window.currentFeedDetail = { categoryId, title };

            const rightPanel = document.querySelector('.right-panel');
            if (rightPanel) {
                // 해당 카테고리/제목에 대한 상세 콘텐츠가 있는지 확인
                const detailContent = feedDetailContents[categoryId]?.[title];

                let contentHTML = '';
                if (detailContent) {
                    contentHTML = detailContent;
                } else {
                    // 기본 템플릿 (상세 콘텐츠가 없는 경우)
                    contentHTML = `
                        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">${category.title}</div>
                        <h3 style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 10px; line-height: 1.5;">${item.title}</h3>
                        <div style="font-size: 11px; color: var(--text-dim); margin-bottom: 16px;">
                            <span>${item.time}</span> · <span>${item.source}</span>
                        </div>
                        <div style="padding: 12px; background: var(--bg-light); border-radius: 4px; color: var(--text-muted); font-size: 12px; line-height: 1.6;">
                            상세 내용이 여기에 표시됩니다. 실제 데이터 연동 시 해당 항목의 전체 내용이 로드됩니다.
                        </div>
                    `;
                }

                rightPanel.innerHTML = `
                    <div class="feed-detail-wrapper" style="position: relative; height: 100%; display: flex; flex-direction: column;">
                        <div class="feed-detail-header" style="padding: 13px 12px; border-bottom: 1px solid var(--border-color); background: var(--bg-light); display: flex; justify-content: flex-end; align-items: center; gap: 6px; flex-shrink: 0;">
                            <button class="drawing-btn yellow active" onclick="setDrawingColor('yellow')" title="노란색"></button>
                            <button class="drawing-btn green" onclick="setDrawingColor('green')" title="초록색"></button>
                            <button class="drawing-btn blue" onclick="setDrawingColor('blue')" title="파란색"></button>
                            <button class="drawing-btn orange" onclick="setDrawingColor('orange')" title="주황색"></button>
                            <div class="drawing-divider"></div>
                            <button class="drawing-btn eraser" onclick="setDrawingMode('eraser')" title="지우개">⌫</button>
                            <button class="drawing-btn undo" id="undoBtn" onclick="undoDrawing()" title="뒤로가기 (Ctrl+Z)">↩</button>
                        </div>
                        <div class="feed-detail-body" style="position: relative; flex: 1; overflow: hidden;">
                            <canvas class="highlight-canvas" id="highlightCanvas"></canvas>
                            <div class="feed-detail-content" style="padding: 16px; overflow-y: auto; height: 100%;">
                                ${contentHTML}
                            </div>
                        </div>
                    </div>
                `;

                // Canvas 초기화
                initDrawingCanvas();
                // 저장된 드로잉 복원
                restoreDrawing(categoryId, title);
            }
        }

        // 도넛 차트 렌더링 함수
        function renderDonutChart(container, data, unit, centerLabel) {
            const total = data.data.reduce((a, b) => a + b, 0);
            const size = 200;
            const strokeWidth = 35;
            const radius = (size - strokeWidth) / 2;
            const circumference = 2 * Math.PI * radius;

            let currentOffset = 0;
            let circles = '';

            data.data.forEach((value, index) => {
                const percentage = value / total;
                const dashLength = circumference * percentage;
                const dashOffset = circumference - currentOffset;
                const color = data.colors[index];

                circles += `
                    <circle
                        cx="${size/2}"
                        cy="${size/2}"
                        r="${radius}"
                        fill="none"
                        stroke="${color}"
                        stroke-width="${strokeWidth}"
                        stroke-dasharray="${dashLength} ${circumference - dashLength}"
                        stroke-dashoffset="${dashOffset}"
                        style="transition: stroke-dashoffset 0.5s ease;"
                    />
                `;
                currentOffset += dashLength;
            });

            let legendItems = '';
            data.categories.forEach((category, index) => {
                legendItems += `
                    <div class="donut-legend-item">
                        <div class="donut-legend-color" style="background: ${data.colors[index]};"></div>
                        <span class="donut-legend-label">${category}</span>
                        <span class="donut-legend-value">${data.data[index]}${unit}</span>
                    </div>
                `;
            });

            container.innerHTML = `
                <div class="donut-chart-wrapper">
                    <svg width="${size}" height="${size}" class="donut-chart-svg">
                        ${circles}
                        <g transform="rotate(90, ${size/2}, ${size/2})">
                            <text x="${size/2}" y="${size/2 - 8}" class="donut-center-text donut-center-value">${total.toFixed(1)}</text>
                            <text x="${size/2}" y="${size/2 + 14}" class="donut-center-text donut-center-label">${centerLabel}</text>
                        </g>
                    </svg>
                    <div class="donut-legend">
                        ${legendItems}
                    </div>
                </div>
            `;
        }

        // 파이 차트 렌더링 함수
        function renderPieChart(container, data, unit) {
            const total = data.data.reduce((a, b) => a + b, 0);
            const size = 200;
            const cx = size / 2;
            const cy = size / 2;
            const radius = size / 2 - 10;

            let currentAngle = -90;
            let paths = '';

            data.data.forEach((value, index) => {
                const percentage = value / total;
                const angle = percentage * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;

                const startRad = (startAngle * Math.PI) / 180;
                const endRad = (endAngle * Math.PI) / 180;

                const x1 = cx + radius * Math.cos(startRad);
                const y1 = cy + radius * Math.sin(startRad);
                const x2 = cx + radius * Math.cos(endRad);
                const y2 = cy + radius * Math.sin(endRad);

                const largeArcFlag = angle > 180 ? 1 : 0;

                const pathData = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;

                paths += `<path d="${pathData}" fill="${data.colors[index]}" style="transition: opacity 0.3s;" onmouseover="this.style.opacity=0.8" onmouseout="this.style.opacity=1"/>`;

                currentAngle += angle;
            });

            let legendItems = '';
            data.categories.forEach((category, index) => {
                const pct = ((data.data[index] / total) * 100).toFixed(0);
                legendItems += `
                    <div class="pie-legend-item">
                        <div class="pie-legend-color" style="background: ${data.colors[index]};"></div>
                        <span class="pie-legend-label">${category}</span>
                        <span class="pie-legend-value">${data.data[index]}${unit} (${pct}%)</span>
                    </div>
                `;
            });

            container.innerHTML = `
                <div class="pie-chart-wrapper">
                    <svg width="${size}" height="${size}">
                        ${paths}
                    </svg>
                    <div class="pie-legend">
                        ${legendItems}
                    </div>
                </div>
            `;
        }

        // 레이더 차트 렌더링 함수
        function renderRadarChart(container, data, unit) {
            const size = 240;
            const cx = size / 2;
            const cy = size / 2;
            const maxRadius = size / 2 - 40;
            const levels = 4;
            const maxValue = Math.max(...data.data);
            const angleStep = (2 * Math.PI) / data.categories.length;

            // 배경 그리드 생성
            let gridLines = '';
            for (let level = 1; level <= levels; level++) {
                const r = (maxRadius / levels) * level;
                let points = [];
                for (let i = 0; i < data.categories.length; i++) {
                    const angle = i * angleStep - Math.PI / 2;
                    const x = cx + r * Math.cos(angle);
                    const y = cy + r * Math.sin(angle);
                    points.push(`${x},${y}`);
                }
                gridLines += `<polygon points="${points.join(' ')}" fill="none" stroke="var(--border-color)" stroke-width="1" opacity="0.5"/>`;
            }

            // 축 그리기
            let axes = '';
            let labels = '';
            for (let i = 0; i < data.categories.length; i++) {
                const angle = i * angleStep - Math.PI / 2;
                const x = cx + maxRadius * Math.cos(angle);
                const y = cy + maxRadius * Math.sin(angle);
                axes += `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="var(--border-color)" stroke-width="1" opacity="0.5"/>`;

                const labelX = cx + (maxRadius + 25) * Math.cos(angle);
                const labelY = cy + (maxRadius + 25) * Math.sin(angle);
                labels += `<text x="${labelX}" y="${labelY}" text-anchor="middle" dominant-baseline="middle" fill="var(--text-secondary)" font-size="12">${data.categories[i]}</text>`;
            }

            // 데이터 폴리곤 생성
            let dataPoints = [];
            for (let i = 0; i < data.data.length; i++) {
                const value = data.data[i];
                const r = (value / maxValue) * maxRadius;
                const angle = i * angleStep - Math.PI / 2;
                const x = cx + r * Math.cos(angle);
                const y = cy + r * Math.sin(angle);
                dataPoints.push(`${x},${y}`);
            }

            // 데이터 점 생성
            let dots = '';
            for (let i = 0; i < data.data.length; i++) {
                const value = data.data[i];
                const r = (value / maxValue) * maxRadius;
                const angle = i * angleStep - Math.PI / 2;
                const x = cx + r * Math.cos(angle);
                const y = cy + r * Math.sin(angle);
                dots += `<circle cx="${x}" cy="${y}" r="5" fill="${data.colors[i]}" stroke="white" stroke-width="2"/>`;
            }

            let legendItems = '';
            data.categories.forEach((category, index) => {
                legendItems += `
                    <div class="radar-legend-item">
                        <div class="radar-legend-color" style="background: ${data.colors[index]};"></div>
                        <span class="radar-legend-label">${category}</span>
                        <span class="radar-legend-value">${data.data[index]}${unit}</span>
                    </div>
                `;
            });

            container.innerHTML = `
                <div class="radar-chart-wrapper">
                    <svg width="${size}" height="${size}">
                        ${gridLines}
                        ${axes}
                        <polygon points="${dataPoints.join(' ')}" fill="${industryColors[0]}" fill-opacity="0.3" stroke="${industryColors[0]}" stroke-width="2"/>
                        ${dots}
                        ${labels}
                    </svg>
                    <div class="radar-legend">
                        ${legendItems}
                    </div>
                </div>
            `;
        }

        // 산업간 비교 차트 렌더링 (도넛 차트) - 선택된 산업 기반
        function renderInterIndustryChart() {
            const container = document.getElementById('inter-industry-chart');
            if (!container) return;

            // 선택된 산업 데이터로 차트 데이터 생성
            const categories = selectedIndustries.map(key => extendedIndustryData.industries[key].name);
            const values = selectedIndustries.map(key => extendedIndustryData.industries[key].size);
            const colors = selectedIndustries.map((_, idx) => industryColors[idx % industryColors.length]);

            const data = {
                categories: categories,
                data: values,
                colors: colors
            };

            renderDonutChart(container, data, '조원', '총 시장규모');
        }

        // 산업내 비교 차트 렌더링 - 선택된 항목 기반
        function renderIntraIndustryChart() {
            const container = document.getElementById('intra-industry-chart');
            if (!container) return;

            let categories, values, colors, data;

            if (currentIndustryTab === 'competitors') {
                categories = selectedCompanies.map(key => extendedIndustryData.companies[key].name);
                values = selectedCompanies.map(key => extendedIndustryData.companies[key].revenue);
                colors = selectedCompanies.map((_, idx) => industryColors[idx % industryColors.length]);
                data = { categories, data: values, colors };
                renderDonutChart(container, data, '조원', '총 매출');

            } else if (currentIndustryTab === 'genres') {
                categories = selectedGenres.map(key => extendedIndustryData.genres[key].name);
                values = selectedGenres.map(key => extendedIndustryData.genres[key].share);
                colors = selectedGenres.map((_, idx) => industryColors[idx % industryColors.length]);
                data = { categories, data: values, colors };
                renderPieChart(container, data, '%');

            } else if (currentIndustryTab === 'regions') {
                categories = selectedRegions.map(key => extendedIndustryData.regions[key].name);
                values = selectedRegions.map(key => extendedIndustryData.regions[key].revenue);
                colors = selectedRegions.map((_, idx) => industryColors[idx % industryColors.length]);
                data = { categories, data: values, colors };
                renderRadarChart(container, data, '조원');
            }
        }

        // 탭 전환
        function switchIndustryTab(tab) {
            currentIndustryTab = tab;

            // 탭 활성화 상태 변경
            document.querySelectorAll('.industry-tab').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelector(`.industry-tab[data-tab="${tab}"]`).classList.add('active');

            // 선택기, 차트, 테이블 다시 렌더링
            renderIntraSelectorItems();
            renderIntraIndustryChart();
            renderIntraTable();
        }

        // 매뉴얼 데이터 정의
        const manualData = {
            'getting-started': {
                title: '시작하기',
                icon: '🚀',
                description: '화면 구성, 패널 조작, 기본 네비게이션',
                content: {
                    title: '대시보드 시작하기',
                    description: '이 가이드를 통해 투자 대시보드의 주요 기능과 화면 구성을 빠르게 익힐 수 있습니다.',
                    sections: [
                        {
                            subtitle: '화면 구성',
                            text: '대시보드는 세 개의 주요 영역으로 구성되어 있습니다.',
                            list: [
                                '<strong>아이콘 사이드바 (좌측)</strong>: 스냅샷, 피드, 산업분석, 포럼, 캘린더 등 주요 기능에 빠르게 접근할 수 있는 메뉴입니다. 아이콘 위에 마우스를 올리면 기능명이 표시됩니다.',
                                '<strong>중앙 패널</strong>: 선택한 기능의 주요 콘텐츠가 표시되는 영역입니다. 차트, 분석 데이터, 캘린더 등이 이곳에 렌더링됩니다.',
                                '<strong>우측 패널</strong>: 세부 정보, 필터 옵션, 관련 데이터 등 보조 정보를 제공합니다. 현재 보고 있는 기능에 따라 내용이 동적으로 변경됩니다.'
                            ],
                            illustration: 'layout'
                        },
                        {
                            subtitle: '패널 크기 조절',
                            text: '각 패널 사이의 구분선(세로선)을 마우스로 드래그하여 패널 너비를 자유롭게 조절할 수 있습니다. 넓은 차트가 필요하면 중앙 패널을 확장하고, 상세 정보가 필요하면 우측 패널을 확장하세요.',
                            tip: '패널 크기는 세션 동안 유지됩니다. 작업에 최적화된 레이아웃을 설정해보세요.'
                        },
                        {
                            subtitle: '네비게이션',
                            text: '좌측 사이드바의 아이콘을 클릭하여 원하는 기능으로 이동합니다. 현재 선택된 메뉴는 하이라이트되어 표시됩니다.',
                            list: [
                                '<strong>스냅샷</strong>: 주가 차트 및 핵심 정보 요약',
                                '<strong>피드</strong>: 뉴스, 공시, 리포트 피드',
                                '<strong>캘린더</strong>: 실적 발표, 배당, IR 일정',
                                '<strong>차트랩</strong>: 데이터 검색/업로드, 차트 생성 및 편집',
                                '<strong>산업분석</strong>: 산업별, 경쟁사별 비교 분석',
                                '<strong>포럼</strong>: 투자자 커뮤니티 및 토론',
                                '<strong>관심회사</strong>: 관심 종목 관리',
                                '<strong>알림</strong>: 가격/이벤트 알림 설정',
                                '<strong>매뉴얼</strong>: 사용 가이드 및 도움말',
                                '<strong>테마</strong>: 다크/라이트 모드 전환',
                                '<strong>계정</strong>: 사용자 계정 관리'
                            ]
                        }
                    ]
                }
            },
            'snapshot': {
                title: '스냅샷',
                icon: '📈',
                description: '주가 차트, 캔들스틱/라인, 기간 조회',
                content: {
                    title: '스냅샷 (주가 차트)',
                    description: '실시간 주가 데이터를 다양한 차트 형식으로 확인하고 기술적 분석을 수행할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '차트 유형 선택',
                            text: '상단의 차트 유형 버튼을 클릭하여 캔들스틱 차트와 라인 차트를 전환할 수 있습니다. 각 차트 유형은 서로 다른 분석 목적에 적합합니다.',
                            list: [
                                '<strong>캔들스틱 차트</strong>: 시가, 고가, 저가, 종가를 한눈에 파악할 수 있습니다. 양봉(상승)과 음봉(하락)으로 가격 움직임의 방향과 강도를 직관적으로 확인할 수 있어 단기 트레이딩에 유용합니다.',
                                '<strong>라인 차트</strong>: 종가만을 연결한 부드러운 곡선으로 전체적인 추세를 파악하기 좋습니다. 장기 투자자에게 적합하며, 가격의 큰 흐름을 한눈에 볼 수 있습니다.'
                            ],
                            illustration: 'chart-types'
                        },
                        {
                            subtitle: '기간 선택',
                            text: '상단의 기간 버튼을 클릭하여 조회할 데이터 범위를 설정합니다.',
                            list: [
                                '<strong>1일</strong>: 당일 장중 가격 움직임 (분봉 기준)',
                                '<strong>1주</strong>: 최근 7일간의 일봉 데이터',
                                '<strong>1개월</strong>: 최근 30일간의 일봉 데이터',
                                '<strong>3개월</strong>: 최근 90일간의 일봉 데이터',
                                '<strong>1년</strong>: 최근 1년간의 주봉 데이터',
                                '<strong>전체</strong>: 상장 이후 전체 데이터 (월봉 기준)'
                            ],
                            illustration: 'period-selector'
                        },
                        {
                            subtitle: '확대/축소',
                            text: '차트 영역 위에서 마우스 휠을 스크롤하여 차트를 확대하거나 축소할 수 있습니다. 특정 기간의 세부적인 가격 움직임을 확인하거나, 전체 추세를 조망할 때 활용하세요.',
                            tip: '마우스 휠을 위로 굴리면 확대, 아래로 굴리면 축소됩니다. 차트를 드래그하여 좌우로 이동할 수도 있습니다.'
                        },
                        {
                            subtitle: '상세 정보 확인',
                            text: '차트 위에 마우스 커서를 올리면 해당 시점의 상세 정보가 툴팁으로 표시됩니다.',
                            list: [
                                '<strong>시가 (Open)</strong>: 해당 기간의 시작 가격',
                                '<strong>고가 (High)</strong>: 해당 기간의 최고 가격',
                                '<strong>저가 (Low)</strong>: 해당 기간의 최저 가격',
                                '<strong>종가 (Close)</strong>: 해당 기간의 마감 가격',
                                '<strong>거래량 (Volume)</strong>: 해당 기간의 총 거래량'
                            ],
                            tip: '십자선 커서를 따라 정확한 가격과 날짜를 확인할 수 있습니다.'
                        },
                        {
                            subtitle: '거래량 차트',
                            text: '메인 차트 하단에 거래량 바 차트가 함께 표시됩니다. 거래량은 가격 움직임의 신뢰도를 판단하는 중요한 지표입니다. 가격 상승 시 거래량이 함께 증가하면 상승 추세가 강하다고 볼 수 있습니다.'
                        }
                    ]
                }
            },
            'feed': {
                title: '피드',
                icon: '📡',
                description: '뉴스, 공시, 리포트 실시간 피드',
                content: {
                    title: '피드',
                    description: '관심 종목과 관련된 뉴스, 공시, 애널리스트 리포트를 실시간으로 확인할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '피드 종류',
                            text: '다양한 유형의 정보가 실시간으로 업데이트됩니다.',
                            list: [
                                '<strong>뉴스</strong>: 관심 종목 관련 최신 뉴스 기사',
                                '<strong>공시</strong>: 기업의 공식 발표 및 규제 기관 제출 문서',
                                '<strong>리포트</strong>: 증권사 애널리스트의 분석 리포트',
                                '<strong>시장 동향</strong>: 업종별, 테마별 시장 흐름'
                            ]
                        },
                        {
                            subtitle: '피드 필터',
                            text: '상단의 필터 옵션을 사용하여 원하는 유형의 피드만 표시할 수 있습니다.',
                            list: [
                                '뉴스만 보기',
                                '공시만 보기',
                                '특정 종목 관련 피드만 보기',
                                '날짜 범위 지정'
                            ],
                            tip: '중요 피드에는 별표를 눌러 북마크할 수 있습니다.'
                        },
                        {
                            subtitle: '피드 상세 보기',
                            text: '피드 항목을 클릭하면 전체 내용을 확인할 수 있습니다. 원문 링크가 있는 경우 외부 사이트로 이동할 수 있습니다.'
                        }
                    ]
                }
            },
            'industry': {
                title: '산업분석',
                icon: '📊',
                description: '산업별 비교, 재무 지표, 시장 점유율',
                content: {
                    title: '산업분석',
                    description: '관심 종목을 동일 산업 내 경쟁사와 비교하고, 다양한 재무 지표와 시장 점유율을 분석할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '산업별 분석',
                            text: '동일 산업 내 주요 기업들의 핵심 지표를 한눈에 비교할 수 있습니다.',
                            list: [
                                '<strong>시가총액</strong>: 기업의 시장 가치를 비교하여 상대적 규모 파악',
                                '<strong>매출액</strong>: 연간 또는 분기별 매출 규모 비교',
                                '<strong>영업이익</strong>: 핵심 사업의 수익성 비교',
                                '<strong>순이익</strong>: 최종 수익성 비교',
                                '<strong>성장률</strong>: 전년 대비 또는 전분기 대비 성장률'
                            ],
                            illustration: 'industry-analysis'
                        },
                        {
                            subtitle: '탭 전환',
                            text: '상단의 탭을 클릭하여 다양한 관점의 분석 데이터를 확인할 수 있습니다.',
                            list: [
                                '<strong>산업 탭</strong>: 동일 산업 내 경쟁사 비교',
                                '<strong>장르 탭</strong>: 세부 카테고리별 시장 점유율',
                                '<strong>지역 탭</strong>: 지역별 매출 분포 및 비중'
                            ],
                            tip: '각 탭에서 차트와 테이블 형태로 데이터를 확인할 수 있습니다.'
                        },
                        {
                            subtitle: '비교 항목 선택',
                            text: '우측 패널에서 비교하고 싶은 기업들을 선택하거나 해제할 수 있습니다. 관심 있는 경쟁사만 선별하여 더 집중적인 비교가 가능합니다.'
                        },
                        {
                            subtitle: '데이터 테이블',
                            text: '차트 하단의 테이블에서 정확한 수치를 확인할 수 있습니다. 열 헤더를 클릭하면 해당 항목 기준으로 정렬됩니다.',
                            tip: '테이블의 행을 클릭하면 해당 기업의 상세 정보를 볼 수 있습니다.'
                        }
                    ]
                }
            },
            'forum': {
                title: '포럼',
                icon: '💬',
                description: '투자자 커뮤니티, 토론, 의견 공유',
                content: {
                    title: '포럼',
                    description: '다른 투자자들과 의견을 나누고, 종목에 대한 토론에 참여할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '게시판 종류',
                            text: '다양한 주제별 게시판이 제공됩니다.',
                            list: [
                                '<strong>종목 토론</strong>: 특정 종목에 대한 분석과 의견 공유',
                                '<strong>시장 전망</strong>: 전체 시장 흐름에 대한 토론',
                                '<strong>투자 전략</strong>: 투자 기법, 포트폴리오 구성 논의',
                                '<strong>자유 게시판</strong>: 일반적인 투자 관련 대화'
                            ]
                        },
                        {
                            subtitle: '글 작성',
                            text: '우측 상단의 "글쓰기" 버튼을 클릭하여 새 글을 작성할 수 있습니다.',
                            list: [
                                '제목과 본문 입력',
                                '관련 종목 태그 추가',
                                '이미지, 차트 첨부 가능',
                                '작성 후 수정/삭제 가능'
                            ]
                        },
                        {
                            subtitle: '상호작용',
                            text: '다른 사용자의 글에 댓글을 달거나 추천할 수 있습니다.',
                            tip: '유익한 글에는 추천을 눌러주세요. 추천이 많은 글은 상단에 노출됩니다.'
                        }
                    ]
                }
            },
            'calendar': {
                title: '캘린더',
                icon: '📅',
                description: '실적 발표, 배당, IR 일정 확인 및 필터',
                content: {
                    title: '캘린더',
                    description: '실적 발표, 배당 일정, IR 행사 등 투자에 중요한 이벤트를 캘린더에서 확인하고 관리할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '이벤트 종류',
                            text: '다양한 종류의 이벤트가 구분되어 표시됩니다.',
                            list: [
                                '<strong>실적 발표</strong>: 분기별/연간 실적 발표 일정. 어닝 서프라이즈 여부에 따라 주가 변동이 클 수 있으므로 미리 확인하세요.',
                                '<strong>배당</strong>: 배당 기준일, 배당락일, 배당금 지급일 등 배당 관련 일정.',
                                '<strong>신제품 출시</strong>: 신작 게임이나 주요 제품 출시 일정. 매출에 직접적인 영향을 줄 수 있습니다.',
                                '<strong>IR 행사</strong>: 기업설명회, 투자자 간담회, NDR(Non-Deal Roadshow) 등 IR 관련 일정.'
                            ]
                        },
                        {
                            subtitle: '캘린더 네비게이션',
                            text: '상단의 화살표 버튼을 클릭하여 이전/다음 달로 이동할 수 있습니다. 오늘 버튼을 클릭하면 현재 월로 돌아옵니다.',
                            tip: '캘린더의 날짜를 클릭하면 해당 날짜의 모든 이벤트 목록을 볼 수 있습니다.'
                        },
                        {
                            subtitle: '이벤트 필터',
                            text: '우측 패널의 필터를 사용하여 특정 유형의 이벤트만 표시할 수 있습니다. 체크박스를 선택하거나 해제하여 원하는 이벤트만 필터링하세요.',
                            illustration: 'calendar-filter',
                            list: [
                                '실적 발표만 보기',
                                '배당 일정만 보기',
                                '특정 기업의 이벤트만 보기',
                                '여러 필터 조합 가능'
                            ]
                        },
                        {
                            subtitle: '이벤트 상세 정보',
                            text: '캘린더의 이벤트를 클릭하면 상세 정보 팝업이 표시됩니다.',
                            list: [
                                '<strong>일시</strong>: 이벤트 날짜 및 시간',
                                '<strong>제목</strong>: 이벤트 명칭',
                                '<strong>설명</strong>: 상세 내용 및 관련 정보',
                                '<strong>관련 종목</strong>: 해당 이벤트와 관련된 종목 링크'
                            ]
                        }
                    ]
                }
            },
            'watchlist': {
                title: '관심회사',
                icon: '⭐',
                description: '관심 종목 등록, 그룹 관리, 빠른 조회',
                content: {
                    title: '관심회사',
                    description: '자주 확인하는 종목을 관심 목록에 등록하여 빠르게 접근하고 관리할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '관심 종목 추가',
                            text: '관심 종목을 추가하는 방법은 여러 가지가 있습니다.',
                            list: [
                                '<strong>검색 후 추가</strong>: 종목 검색 후 별표 아이콘 클릭',
                                '<strong>차트에서 추가</strong>: 차트 화면에서 관심 종목 버튼 클릭',
                                '<strong>직접 입력</strong>: 관심회사 패널에서 종목코드 직접 입력'
                            ],
                            tip: '관심 종목은 최대 50개까지 등록할 수 있습니다.'
                        },
                        {
                            subtitle: '그룹 관리',
                            text: '관심 종목을 그룹으로 분류하여 체계적으로 관리할 수 있습니다.',
                            list: [
                                '새 그룹 생성 및 이름 지정',
                                '종목을 그룹 간 이동',
                                '그룹별 정렬 및 필터링',
                                '그룹 삭제 (종목은 유지됨)'
                            ]
                        },
                        {
                            subtitle: '빠른 조회',
                            text: '관심 종목 목록에서 종목을 클릭하면 해당 종목의 차트와 상세 정보로 바로 이동합니다.',
                            list: [
                                '현재가 및 등락률 실시간 표시',
                                '거래량 변화 표시',
                                '클릭 한 번으로 차트 전환'
                            ]
                        },
                        {
                            subtitle: '종목 제거',
                            text: '관심 종목을 제거하려면 목록에서 해당 종목의 X 버튼을 클릭하거나, 차트 화면에서 별표를 다시 클릭하세요.'
                        }
                    ]
                }
            },
            'chart-lab': {
                title: '차트랩',
                icon: '🧪',
                description: '데이터 검색/업로드, 차트 생성 및 편집',
                content: {
                    title: '차트랩',
                    description: '외부 데이터를 검색하거나 직접 업로드하여 나만의 차트를 만들고 편집할 수 있는 실험 공간입니다.',
                    sections: [
                        {
                            subtitle: '데이터 가져오기',
                            text: '다양한 방법으로 차트에 사용할 데이터를 준비할 수 있습니다.',
                            list: [
                                '<strong>검색으로 불러오기</strong>: 주식, 경제지표, 통계 데이터를 검색하여 바로 불러옵니다.',
                                '<strong>파일 업로드</strong>: CSV, Excel, JSON 형식의 데이터를 직접 업로드합니다.',
                                '<strong>API 연동</strong>: 외부 데이터 소스와 연결하여 실시간 데이터를 가져옵니다.'
                            ]
                        },
                        {
                            subtitle: '차트 만들기',
                            text: '불러온 데이터를 바탕으로 다양한 차트를 생성할 수 있습니다.',
                            list: [
                                '<strong>라인 차트</strong>: 시계열 데이터의 추세 표현',
                                '<strong>바 차트</strong>: 항목별 비교',
                                '<strong>파이 차트</strong>: 구성 비율 표현',
                                '<strong>산점도</strong>: 두 변수 간의 관계 분석'
                            ]
                        },
                        {
                            subtitle: '차트 편집하기',
                            text: '생성한 차트를 자유롭게 수정하고 꾸밀 수 있습니다.',
                            list: [
                                '색상, 라벨, 범례 등 스타일 변경',
                                '축 범위 및 눈금 조정',
                                '여러 데이터를 하나의 차트에 겹쳐서 비교',
                                '차트 이미지로 내보내기'
                            ],
                            tip: '실험한 차트는 저장하여 나중에 다시 불러올 수 있습니다.'
                        }
                    ]
                }
            },
            'notifications': {
                title: '알림',
                icon: '🔔',
                description: '가격 알림, 이벤트 알림, 알림 관리',
                content: {
                    title: '알림',
                    description: '중요한 이벤트나 가격 변동에 대한 알림을 설정하여 투자 기회를 놓치지 않도록 관리할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '알림 종류',
                            text: '다양한 유형의 알림을 설정할 수 있습니다.',
                            list: [
                                '<strong>가격 알림</strong>: 특정 가격에 도달하면 알림을 받습니다. 목표 매수가, 목표 매도가를 설정해두면 유용합니다.',
                                '<strong>변동률 알림</strong>: 일정 비율(%) 이상 상승 또는 하락 시 알림을 받습니다. 급등/급락 종목을 빠르게 파악할 수 있습니다.',
                                '<strong>이벤트 알림</strong>: 실적 발표, 배당, IR 행사 등 중요 일정 전에 미리 알림을 받습니다.',
                                '<strong>뉴스 알림</strong>: 관심 종목 관련 주요 뉴스가 발생하면 알림을 받습니다.'
                            ]
                        },
                        {
                            subtitle: '알림 설정 방법',
                            text: '알림을 새로 추가하려면 알림 아이콘을 클릭한 후 "알림 추가" 버튼을 클릭합니다.',
                            list: [
                                '알림 종류 선택 (가격, 변동률, 이벤트, 뉴스)',
                                '대상 종목 선택',
                                '조건 설정 (가격, 비율 등)',
                                '알림 방식 선택 (앱 내 알림, 이메일 등)'
                            ],
                            tip: '자주 사용하는 알림 설정은 템플릿으로 저장하여 재사용할 수 있습니다.'
                        },
                        {
                            subtitle: '알림 관리',
                            text: '설정된 알림 목록을 확인하고 개별적으로 관리할 수 있습니다.',
                            list: [
                                '<strong>토글 스위치</strong>: 개별 알림을 켜거나 끌 수 있습니다',
                                '<strong>수정 버튼</strong>: 알림 조건을 변경할 수 있습니다',
                                '<strong>삭제 버튼</strong>: 불필요한 알림을 삭제합니다',
                                '<strong>알림 이력</strong>: 과거에 발생한 알림 내역을 확인할 수 있습니다'
                            ]
                        },
                        {
                            subtitle: '알림 히스토리',
                            text: '알림 패널 하단에서 과거에 발생한 알림들을 확인할 수 있습니다. 놓친 알림이 있는지 확인하고, 알림 설정이 적절한지 검토해보세요.'
                        }
                    ]
                }
            },
            'theme': {
                title: '테마',
                icon: '🌙',
                description: '다크 모드, 라이트 모드 전환',
                content: {
                    title: '테마 변경',
                    description: '대시보드의 테마를 다크 모드와 라이트 모드 중에서 선택할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '테마 전환',
                            text: '좌측 사이드바 하단의 테마 아이콘(해/달)을 클릭하여 테마를 전환할 수 있습니다.',
                            list: [
                                '<strong>다크 모드</strong>: 어두운 배경에 밝은 텍스트. 눈의 피로를 줄여주며 야간 사용에 적합합니다.',
                                '<strong>라이트 모드</strong>: 밝은 배경에 어두운 텍스트. 주간 사용이나 밝은 환경에 적합합니다.'
                            ]
                        },
                        {
                            subtitle: '테마 저장',
                            text: '선택한 테마는 브라우저에 자동으로 저장됩니다. 다음에 대시보드를 방문할 때도 이전에 선택한 테마가 유지됩니다.',
                            tip: '눈의 피로도와 주변 조명에 따라 편한 테마를 선택하세요.'
                        }
                    ]
                }
            },
            'manual': {
                title: '매뉴얼',
                icon: '📖',
                description: '사용 가이드 및 도움말',
                content: {
                    title: '매뉴얼',
                    description: '대시보드의 모든 기능에 대한 사용 가이드와 도움말을 제공합니다.',
                    sections: [
                        {
                            subtitle: '매뉴얼 사용법',
                            text: '좌측 사이드바에서 매뉴얼 아이콘을 클릭하면 이 화면으로 이동합니다.',
                            list: [
                                '<strong>목차 탐색</strong>: 우측 패널의 목차에서 원하는 항목을 클릭하세요.',
                                '<strong>상세 내용</strong>: 중앙 패널에서 선택한 기능의 자세한 사용법을 확인할 수 있습니다.',
                                '<strong>팁 확인</strong>: 각 섹션에 포함된 팁을 통해 효율적인 사용법을 익히세요.'
                            ]
                        },
                        {
                            subtitle: '도움이 필요할 때',
                            text: '특정 기능에 대해 궁금한 점이 있다면 해당 기능의 매뉴얼 항목을 참고하세요. 각 기능별로 상세한 설명과 사용 팁이 제공됩니다.'
                        }
                    ]
                }
            },
            'account': {
                title: '계정',
                icon: '👤',
                description: '사용자 계정 관리',
                content: {
                    title: '계정',
                    description: '사용자 계정 정보를 관리하고 개인 설정을 변경할 수 있습니다.',
                    sections: [
                        {
                            subtitle: '계정 기능',
                            text: '계정 메뉴에서는 다음과 같은 기능을 이용할 수 있습니다.',
                            list: [
                                '<strong>로그인/로그아웃</strong>: 계정에 로그인하거나 로그아웃합니다.',
                                '<strong>프로필 관리</strong>: 사용자 정보를 확인하고 수정합니다.',
                                '<strong>설정 동기화</strong>: 여러 기기에서 동일한 설정을 사용할 수 있습니다.'
                            ],
                            tip: '현재 계정 기능은 준비 중입니다.'
                        }
                    ]
                }
            },
        };

        // 테마 전환 함수
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const newTheme = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        // 테마 아이콘 업데이트 함수
        function updateThemeIcon(theme) {
            const themeIcon = document.getElementById('themeIcon');
            if (theme === 'light') {
                // 라이트 모드일 때 해(sun) 아이콘 표시
                themeIcon.innerHTML = `
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                `;
            } else {
                // 다크 모드일 때 달(moon) 아이콘 표시
                themeIcon.innerHTML = `
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                `;
            }
        }

        // 알림 모달 현재 탭 상태
        let currentNotificationTab = 'all';
        let companyDropdownOpen = false;

        // 읽지 않은 알림 badge 업데이트
        function updateNotificationBadge() {
            const unreadCount = notificationData.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                if (unreadCount > 0) {
                    badge.classList.add('show');
                } else {
                    badge.classList.remove('show');
                }
            }
        }

        // 페이지 로드 시 badge 초기화
        document.addEventListener('DOMContentLoaded', function() {
            updateNotificationBadge();
            loadDrawingData();
        });

        // 계정 표시 함수
        function showAccount() {
            // 추후 구현 예정
        }

        // 알림 표시 함수
        function showNotifications() {
            const existing = document.getElementById('notificationModal');
            if (existing) {
                closeNotificationModal();
                return;
            }

            const iconEl = document.querySelector('.icon-sidebar-item[title="알람"]');
            const rect = iconEl.getBoundingClientRect();

            const modal = document.createElement('div');
            modal.id = 'notificationModal';
            modal.className = 'notification-modal';
            modal.style.left = (rect.right + 8) + 'px';
            modal.style.top = Math.min(rect.top, window.innerHeight - 500) + 'px';
            modal.innerHTML = renderNotificationContent('all');
            document.body.appendChild(modal);

            // 외부 클릭 시 닫기
            setTimeout(() => {
                document.addEventListener('click', handleNotificationOutsideClick);
            }, 10);
        }

        function closeNotificationModal() {
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.remove();
            }
            document.removeEventListener('click', handleNotificationOutsideClick);
            companyDropdownOpen = false;
        }

        function handleNotificationOutsideClick(e) {
            const modal = document.getElementById('notificationModal');
            const iconEl = document.querySelector('.icon-sidebar-item[title="알람"]');
            if (modal && !modal.contains(e.target) && !iconEl.contains(e.target)) {
                closeNotificationModal();
            }
        }

        function renderNotificationContent(tab) {
            currentNotificationTab = tab;

            const unreadCount = notificationData.filter(n => !n.read).length;

            let html = `
                <div class="notification-header">
                    <h3>NOTIFICATIONS</h3>
                    <button class="notification-mark-read" onclick="markAllAsRead(event)">
                        모두 읽음 ✓
                    </button>
                </div>
                <div class="notification-tabs">
                    <div class="notification-tab ${tab === 'all' ? 'active' : ''}" onclick="switchNotificationTab(event, 'all')">전체</div>
                    <div class="notification-tab ${tab === 'company' ? 'active' : ''}" onclick="switchNotificationTab(event, 'company')">회사</div>
                    <div class="notification-tab ${tab === 'reply' ? 'active' : ''}" onclick="switchNotificationTab(event, 'reply')">답글</div>
                    <div class="notification-tab ${tab === 'settings' ? 'active' : ''}" onclick="switchNotificationTab(event, 'settings')">⚙ 설정</div>
                </div>
            `;

            if (tab === 'settings') {
                html += renderNotificationSettings();
            } else {
                html += renderNotificationList(tab);
            }

            return html;
        }

        function renderNotificationList(tab) {
            let filteredData = notificationData;

            if (tab === 'company') {
                filteredData = notificationData.filter(n => n.type === 'company');
            } else if (tab === 'reply') {
                filteredData = notificationData.filter(n => n.type === 'reply');
            }

            if (filteredData.length === 0) {
                return `
                    <div class="notification-empty">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <h4>알림이 없습니다</h4>
                        <p>관심 회사를 등록하면<br>새로운 소식을 받아볼 수 있어요</p>
                        <button onclick="switchNotificationTab(event, 'settings')">알림 설정하기</button>
                    </div>
                `;
            }

            let html = '<div class="notification-list">';
            filteredData.forEach(item => {
                const timeAgo = formatTimeAgo(item.date);
                const isUnread = !item.read;

                let desc = '';
                if (item.type === 'company') {
                    desc = `관심 회사 업데이트 · ${item.company}`;
                } else if (item.type === 'reply') {
                    desc = `"${item.content}" - ${item.author}`;
                }

                html += `
                    <div class="notification-item ${isUnread ? 'unread' : ''}" onclick="markAsRead(event, '${item.id}')">
                        <div class="notification-item-header">
                            <div class="notification-item-title">
                                <span class="dot"></span>
                                ${item.title}
                            </div>
                            <span class="notification-item-time">${timeAgo}</span>
                        </div>
                        <div class="notification-item-desc">${desc}</div>
                    </div>
                `;
            });
            html += '</div>';

            return html;
        }

        function renderNotificationSettings() {
            return `
                <div class="notification-settings">
                    <div class="notification-settings-section">
                        <h4>게시글 알림</h4>
                        <div class="notification-toggle-item">
                            <span class="notification-toggle-label">내 글에 댓글이 달리면</span>
                            <div class="notification-toggle ${notificationSettings.postNotifications.commentOnMyPost ? 'active' : ''}" onclick="togglePostNotification(event, 'commentOnMyPost')"></div>
                        </div>
                        <div class="notification-toggle-item">
                            <span class="notification-toggle-label">내 댓글에 답글이 달리면</span>
                            <div class="notification-toggle ${notificationSettings.postNotifications.replyToMyComment ? 'active' : ''}" onclick="togglePostNotification(event, 'replyToMyComment')"></div>
                        </div>
                        <div class="notification-toggle-item">
                            <span class="notification-toggle-label">내가 멘션되면</span>
                            <div class="notification-toggle ${notificationSettings.postNotifications.mentionMe ? 'active' : ''}" onclick="togglePostNotification(event, 'mentionMe')"></div>
                        </div>
                    </div>
                    <div class="notification-settings-section">
                        <h4>알림 전달 방식</h4>
                        <div class="notification-toggle-item">
                            <span class="notification-toggle-label">이메일 알림</span>
                            <div class="notification-toggle ${notificationSettings.emailNotification ? 'active' : ''}" onclick="toggleEmailNotification(event)"></div>
                        </div>
                        <div class="notification-email-input" style="display: ${notificationSettings.emailNotification ? 'block' : 'none'};">
                            <input type="email" placeholder="이메일 주소 입력" value="${notificationSettings.emailAddress}" onchange="updateEmailAddress(event)" />
                        </div>
                    </div>
                    <div class="notification-settings-section">
                        <h4>알림 빈도</h4>
                        <div class="notification-radio-group">
                            <div class="notification-radio-item" onclick="event.stopPropagation(); updateNotificationFrequency('realtime')">
                                <input type="radio" name="notificationFrequency" value="realtime" ${notificationSettings.notificationFrequency === 'realtime' ? 'checked' : ''}>
                                <label>실시간</label>
                            </div>
                            <div class="notification-radio-item" onclick="event.stopPropagation(); updateNotificationFrequency('daily')">
                                <input type="radio" name="notificationFrequency" value="daily" ${notificationSettings.notificationFrequency === 'daily' ? 'checked' : ''}>
                                <label>매일 요약</label>
                            </div>
                            <div class="notification-radio-item" onclick="event.stopPropagation(); updateNotificationFrequency('weekly')">
                                <input type="radio" name="notificationFrequency" value="weekly" ${notificationSettings.notificationFrequency === 'weekly' ? 'checked' : ''}>
                                <label>매주 요약</label>
                            </div>
                        </div>
                    </div>
                    <div class="notification-settings-section">
                        <h4>알림음</h4>
                        <div class="notification-toggle-item">
                            <span class="notification-toggle-label">알림음 사용</span>
                            <div class="notification-toggle ${notificationSettings.soundEnabled ? 'active' : ''}" onclick="toggleSoundNotification(event)"></div>
                        </div>
                    </div>
                    <div class="notification-settings-section">
                        <h4>조용한 시간대</h4>
                        <div class="notification-toggle-item">
                            <span class="notification-toggle-label">조용한 시간대 설정</span>
                            <div class="notification-toggle ${notificationSettings.quietHoursEnabled ? 'active' : ''}" onclick="toggleQuietHours(event)"></div>
                        </div>
                        <div class="notification-quiet-hours" style="display: ${notificationSettings.quietHoursEnabled ? 'flex' : 'none'};">
                            <input type="time" value="${notificationSettings.quietHoursStart}" onchange="updateQuietHoursStart(event)" /> ~ <input type="time" value="${notificationSettings.quietHoursEnd}" onchange="updateQuietHoursEnd(event)" />
                        </div>
                    </div>
                </div>
            `;
        }

        function switchNotificationTab(event, tab) {
            event.stopPropagation();
            companyDropdownOpen = false;
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent(tab);
            }
        }

        function markAsRead(event, id) {
            event.stopPropagation();
            const item = notificationData.find(n => n.id === id);
            if (item) {
                item.read = true;
                const modal = document.getElementById('notificationModal');
                if (modal) {
                    modal.innerHTML = renderNotificationContent(currentNotificationTab);
                }
                updateNotificationBadge();
            }
        }

        function markAllAsRead(event) {
            event.stopPropagation();
            notificationData.forEach(n => n.read = true);
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent(currentNotificationTab);
            }
            updateNotificationBadge();
        }

        function toggleCompanyDropdown(event) {
            event.stopPropagation();
            companyDropdownOpen = !companyDropdownOpen;
            const dropdown = document.getElementById('companyDropdown');
            if (dropdown) {
                dropdown.style.display = companyDropdownOpen ? 'block' : 'none';
            }
        }

        function addCompanyToWatch(event, company) {
            event.stopPropagation();
            if (!notificationSettings.companies.hasOwnProperty(company)) {
                notificationSettings.companies[company] = true;
            }
            companyDropdownOpen = false;
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent('settings');
            }
        }

        function removeCompanyFromWatch(event, company) {
            event.stopPropagation();
            if (notificationSettings.companies.hasOwnProperty(company)) {
                delete notificationSettings.companies[company];
            }
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent('settings');
            }
        }

        function toggleCompanyNotification(event, company) {
            event.stopPropagation();
            if (notificationSettings.companies.hasOwnProperty(company)) {
                notificationSettings.companies[company] = !notificationSettings.companies[company];
            }
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent('settings');
            }
        }

        function togglePostNotification(event, key) {
            event.stopPropagation();
            notificationSettings.postNotifications[key] = !notificationSettings.postNotifications[key];
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent('settings');
            }
        }

        function toggleEmailNotification(event) {
            event.stopPropagation();
            notificationSettings.emailNotification = !notificationSettings.emailNotification;
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent('settings');
            }
        }

        function updateEmailAddress(event) {
            event.stopPropagation();
            notificationSettings.emailAddress = event.target.value;
        }

        function updateNotificationFrequency(value) {
            notificationSettings.notificationFrequency = value;
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent('settings');
            }
        }

        function toggleSoundNotification(event) {
            event.stopPropagation();
            notificationSettings.soundEnabled = !notificationSettings.soundEnabled;
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent('settings');
            }
        }

        function toggleQuietHours(event) {
            event.stopPropagation();
            notificationSettings.quietHoursEnabled = !notificationSettings.quietHoursEnabled;
            const modal = document.getElementById('notificationModal');
            if (modal) {
                modal.innerHTML = renderNotificationContent('settings');
            }
        }

        function updateQuietHoursStart(event) {
            event.stopPropagation();
            notificationSettings.quietHoursStart = event.target.value;
        }

        function updateQuietHoursEnd(event) {
            event.stopPropagation();
            notificationSettings.quietHoursEnd = event.target.value;
        }

        function formatTimeAgo(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffMins < 60) {
                return `${diffMins}분 전`;
            } else if (diffHours < 24) {
                return `${diffHours}시간 전`;
            } else if (diffDays < 7) {
                return `${diffDays}일 전`;
            } else {
                return date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
            }
        }

        // 페이지 로드 시 저장된 테마 적용
        (function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            // DOM 로드 후 아이콘 업데이트
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => updateThemeIcon(savedTheme));
            } else {
                updateThemeIcon(savedTheme);
            }
        })();

        // 관심회사 데이터
        const watchlistData = {
            myList: [],
            categories: ['전체', 'KOSPI', 'KOSDAQ', '게임', '상승', '하락']
        };

        const availableStocks = [
            { id: 1, name: '넥슨', ticker: 'NEXON', change: '+3.32%', category: ['KOSPI', '게임', '상승'] },
            { id: 2, name: '크래프톤', ticker: 'KRAFTON', change: '+2.35%', category: ['KOSPI', '게임', '상승'] },
            { id: 3, name: '엔씨소프트', ticker: 'NCSOFT', change: '-1.24%', category: ['KOSPI', '게임', '하락'] },
            { id: 4, name: '넷마블', ticker: 'NETMARBLE', change: '+0.85%', category: ['KOSPI', '게임', '상승'] },
            { id: 5, name: '펄어비스', ticker: 'PEARL ABYSS', change: '-2.15%', category: ['KOSDAQ', '게임', '하락'] },
            { id: 6, name: '컴투스', ticker: 'COM2US', change: '+1.45%', category: ['KOSDAQ', '게임', '상승'] },
            { id: 7, name: '위메이드', ticker: 'WEMADE', change: '-0.67%', category: ['KOSDAQ', '게임', '하락'] },
            { id: 8, name: '카카오게임즈', ticker: 'KAKAOGAMES', change: '+0.23%', category: ['KOSDAQ', '게임', '상승'] },
            { id: 9, name: '데브시스터즈', ticker: 'DEVSISTERS', change: '+4.12%', category: ['KOSDAQ', '게임', '상승'] },
            { id: 10, name: '스마일게이트', ticker: 'SMILEGATE', change: '-0.45%', category: ['KOSPI', '게임', '하락'] },
            { id: 11, name: '삼성전자', ticker: 'SAMSUNG', change: '+1.23%', category: ['KOSPI', '상승'] },
            { id: 12, name: 'SK하이닉스', ticker: 'SK HYNIX', change: '+2.87%', category: ['KOSPI', '상승'] },
            { id: 13, name: 'LG에너지솔루션', ticker: 'LG ENERGY', change: '-0.92%', category: ['KOSPI', '하락'] },
            { id: 14, name: '현대자동차', ticker: 'HYUNDAI', change: '+0.56%', category: ['KOSPI', '상승'] },
            { id: 15, name: '카카오', ticker: 'KAKAO', change: '-1.78%', category: ['KOSPI', '하락'] }
        ];

        let currentWatchlistCategory = '전체';
        let watchlistSearchQuery = '';

        function showWatchlist() {
            const existing = document.getElementById('watchlistModal');
            if (existing) {
                closeWatchlistModal();
                return;
            }

            const iconEl = document.querySelector('.icon-sidebar-item[title="관심회사"]');
            const rect = iconEl.getBoundingClientRect();

            const modal = document.createElement('div');
            modal.id = 'watchlistModal';
            modal.className = 'watchlist-modal';
            modal.style.left = (rect.right + 8) + 'px';
            modal.style.top = Math.min(rect.top, window.innerHeight - 540) + 'px';
            modal.innerHTML = renderWatchlistContent();
            modal.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            document.body.appendChild(modal);

            setTimeout(() => {
                document.addEventListener('click', handleWatchlistOutsideClick);
            }, 10);
        }

        function closeWatchlistModal() {
            const modal = document.getElementById('watchlistModal');
            if (modal) {
                modal.remove();
            }
            document.removeEventListener('click', handleWatchlistOutsideClick);
        }

        function handleWatchlistOutsideClick(e) {
            const modal = document.getElementById('watchlistModal');
            const iconEl = document.querySelector('.icon-sidebar-item[title="관심회사"]');
            if (modal && !modal.contains(e.target) && !iconEl.contains(e.target)) {
                closeWatchlistModal();
            }
        }

        function renderWatchlistContent() {
            const filteredStocks = getFilteredStocks();
            const selectedCount = watchlistData.myList.length;

            let html = `
                <div class="watchlist-header">
                    <h3>관심회사</h3>
                    <button class="watchlist-close" onclick="event.stopPropagation(); closeWatchlistModal()">×</button>
                </div>
                <div class="watchlist-search">
                    <div class="watchlist-search-wrapper">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" placeholder="회사, 종목 검색..." value="${watchlistSearchQuery}" oninput="searchWatchlistCompany(event.target.value)" onclick="event.stopPropagation()" />
                    </div>
                </div>
                <div class="watchlist-tabs">
                    ${watchlistData.categories.map(cat => `
                        <div class="watchlist-tab ${currentWatchlistCategory === cat ? 'active' : ''}" onclick="event.stopPropagation(); filterWatchlistByCategory('${cat}')">${cat}</div>
                    `).join('')}
                </div>
                <div class="watchlist-info">
                    <span class="watchlist-info-title">내 관심 회사에 추가</span>
                    <span>${filteredStocks.length}개 회사 &nbsp;|&nbsp; 오늘 변동률</span>
                </div>
                <div class="watchlist-company-list">
            `;

            if (filteredStocks.length === 0) {
                html += `
                    <div class="watchlist-empty">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <p>검색 결과가 없습니다</p>
                    </div>
                `;
            } else {
                filteredStocks.forEach(stock => {
                    const isSelected = watchlistData.myList.includes(stock.id);
                    const changeClass = stock.change.startsWith('+') ? 'positive' : 'negative';
                    html += `
                        <div class="watchlist-company-item ${isSelected ? 'selected' : ''}" onclick="event.stopPropagation(); toggleWatchlistItem(${stock.id})">
                            <div class="watchlist-company-checkbox">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="watchlist-company-info">
                                <div class="watchlist-company-name">${stock.name}</div>
                                <div class="watchlist-company-ticker">${stock.ticker}</div>
                            </div>
                            <div class="watchlist-company-change ${changeClass}">${stock.change}</div>
                        </div>
                    `;
                });
            }

            html += '</div>';

            // 하단 추가 버튼
            html += `
                <div class="watchlist-footer">
                    <div class="watchlist-footer-count">
                        <span>${selectedCount}</span>개 선택됨
                    </div>
                    <button class="watchlist-add-btn" ${selectedCount === 0 ? 'disabled' : ''} onclick="applyWatchlist()">
                        추가하기
                    </button>
                </div>
            `;

            return html;
        }

        function getFilteredStocks() {
            let stocks = [...availableStocks];

            if (currentWatchlistCategory !== '전체') {
                stocks = stocks.filter(stock => stock.category.includes(currentWatchlistCategory));
            }

            if (watchlistSearchQuery) {
                const query = watchlistSearchQuery.toLowerCase();
                stocks = stocks.filter(stock =>
                    stock.name.toLowerCase().includes(query) ||
                    stock.ticker.toLowerCase().includes(query)
                );
            }

            return stocks;
        }

        function searchWatchlistCompany(query) {
            watchlistSearchQuery = query;
            refreshWatchlistContent();
        }

        function toggleWatchlistItem(id) {
            const index = watchlistData.myList.indexOf(id);
            if (index > -1) {
                watchlistData.myList.splice(index, 1);
            } else {
                watchlistData.myList.push(id);
            }
            refreshWatchlistContent();
        }

        function filterWatchlistByCategory(category) {
            currentWatchlistCategory = category;
            refreshWatchlistContent();
        }

        function refreshWatchlistContent() {
            const modal = document.getElementById('watchlistModal');
            if (modal) {
                modal.innerHTML = renderWatchlistContent();
            }
        }

        function applyWatchlist() {
            if (watchlistData.myList.length === 0) return;

            const selectedCompanies = availableStocks.filter(stock =>
                watchlistData.myList.includes(stock.id)
            );

            const companyNames = selectedCompanies.map(c => c.name).join(', ');
            alert(`${selectedCompanies.length}개 회사가 관심 목록에 추가되었습니다:\n${companyNames}`);

            closeWatchlistModal();
        }

        // 사용자 매뉴얼 표시 함수
        function showUserManual() {
            // 사이드바 아이콘 활성화 상태 변경
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="매뉴얼"]').classList.add('active');

            // 우측 패널에 목차 표시
            const rightPanel = document.querySelector('.right-panel');
            rightPanel.innerHTML = `
                <div class="manual-toc">
                    <div class="manual-toc-header">
                        <div class="manual-toc-header-title">사용자 매뉴얼 목차</div>
                        <div class="manual-toc-header-desc">항목을 선택하면 자세한 내용을 볼 수 있습니다.</div>
                    </div>
                    ${Object.entries(manualData).map(([key, data]) => `
                        <div class="manual-toc-item" data-manual="${key}" onclick="showManualDetail('${key}')">
                            <div class="manual-toc-text">
                                <div class="manual-toc-title">${data.title}</div>
                                <div class="manual-toc-desc">${data.description}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            // 중앙 패널에 환영 메시지 표시
            const centerPanel = document.querySelector('.center-panel');
            centerPanel.innerHTML = `
                <div class="manual-welcome">
                    <div class="manual-welcome-title">사용자 매뉴얼</div>
                    <div class="manual-welcome-text">
                        우측 목록에서 항목을 선택하면<br>
                        자세한 사용법을 확인할 수 있습니다.
                    </div>
                </div>
            `;

            // 첫 번째 항목 자동 선택
            setTimeout(() => showManualDetail('getting-started'), 100);
        }

        // 세팅 페이지 표시 함수
        function showSettings() {
            // 사이드바 아이콘 활성화 상태 변경
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="세팅"]').classList.add('active');

            // 중앙 패널에 세팅 페이지 표시
            const centerPanel = document.querySelector('.center-panel');
            centerPanel.innerHTML = `
                <div class="manual-welcome">
                    <div class="manual-welcome-title">세팅</div>
                    <div class="manual-welcome-text">
                        설정 페이지는 준비 중입니다.
                    </div>
                </div>
            `;

            // 우측 패널 초기화
            const rightPanel = document.querySelector('.right-panel');
            rightPanel.innerHTML = '';
        }

        // My 페이지 표시 함수
        function showMyPage() {
            // 사이드바 아이콘 활성화 상태 변경
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="My"]').classList.add('active');

            // 중앙 패널에 My 페이지 표시
            const centerPanel = document.querySelector('.center-panel');
            centerPanel.innerHTML = `
                <div class="manual-welcome">
                    <div class="manual-welcome-title">My 페이지</div>
                    <div class="manual-welcome-text">
                        My 페이지는 준비 중입니다.
                    </div>
                </div>
            `;

            // 우측 패널 초기화
            const rightPanel = document.querySelector('.right-panel');
            rightPanel.innerHTML = '';
        }

        // 매뉴얼 상세 표시 함수
        function showManualDetail(key) {
            const data = manualData[key];
            if (!data) return;

            // 목차에서 활성 상태 변경
            document.querySelectorAll('.manual-toc-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.querySelector(`[data-manual="${key}"]`);
            if (activeItem) activeItem.classList.add('active');

            // 중앙 패널에 상세 내용 표시
            const centerPanel = document.querySelector('.center-panel');
            centerPanel.innerHTML = `
                <div class="manual-detail">
                    <div class="manual-detail-header">
                        <h1 class="manual-detail-title">${data.content.title}</h1>
                        <p class="manual-detail-desc">${data.content.description}</p>
                    </div>
                    ${data.content.sections.map(section => `
                        <div class="manual-detail-section">
                            <h2 class="manual-detail-subtitle">${section.subtitle}</h2>
                            <p class="manual-detail-text">${section.text}</p>
                            ${section.list ? `
                                <ul class="manual-detail-list">
                                    ${section.list.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            ` : ''}
                            ${section.illustration ? renderManualIllustration(section.illustration) : ''}
                            ${section.tip ? `
                                <div class="manual-tip">
                                    <div class="manual-tip-title">팁</div>
                                    <div class="manual-tip-text">${section.tip}</div>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 매뉴얼 일러스트레이션 렌더링
        function renderManualIllustration(type) {
            const illustrations = {
                'layout': `
                    <div class="manual-illustration">
                        <svg viewBox="0 0 400 200">
                            <!-- 배경 -->
                            <rect x="0" y="0" width="400" height="200" fill="var(--bg-medium)" rx="8"/>

                            <!-- 아이콘 사이드바 -->
                            <rect x="10" y="10" width="40" height="180" fill="var(--bg-dark)" rx="4"/>
                            <circle cx="30" cy="35" r="8" fill="var(--claude-orange)" opacity="0.3"/>
                            <circle cx="30" cy="60" r="8" fill="var(--claude-orange)" opacity="0.3"/>
                            <circle cx="30" cy="85" r="8" fill="var(--claude-orange)" opacity="0.3"/>
                            <circle cx="30" cy="110" r="8" fill="var(--claude-orange)"/>
                            <text x="30" y="140" font-size="8" fill="var(--text-muted)" text-anchor="middle">사이드바</text>

                            <!-- 중앙 패널 -->
                            <rect x="60" y="10" width="200" height="180" fill="var(--bg-dark)" rx="4"/>
                            <rect x="70" y="20" width="180" height="20" fill="var(--bg-light)" rx="2"/>
                            <rect x="70" y="50" width="180" height="100" fill="var(--bg-light)" rx="2"/>
                            <polyline points="80,120 110,90 140,110 170,70 200,100 230,80" stroke="var(--claude-orange)" stroke-width="2" fill="none"/>
                            <text x="160" y="170" font-size="8" fill="var(--text-muted)" text-anchor="middle">중앙 패널</text>

                            <!-- 우측 패널 -->
                            <rect x="270" y="10" width="120" height="180" fill="var(--bg-dark)" rx="4"/>
                            <rect x="280" y="20" width="100" height="15" fill="var(--bg-light)" rx="2"/>
                            <rect x="280" y="45" width="100" height="40" fill="var(--bg-light)" rx="2"/>
                            <rect x="280" y="95" width="100" height="40" fill="var(--bg-light)" rx="2"/>
                            <text x="330" y="170" font-size="8" fill="var(--text-muted)" text-anchor="middle">우측 패널</text>
                        </svg>
                        <div class="illustration-caption">대시보드 화면 구성</div>
                    </div>
                `,
                'chart-types': `
                    <div class="manual-illustration">
                        <svg viewBox="0 0 400 150">
                            <!-- 캔들스틱 -->
                            <rect x="10" y="10" width="180" height="130" fill="var(--bg-dark)" rx="4"/>
                            <text x="100" y="30" font-size="10" fill="var(--text-primary)" text-anchor="middle">캔들스틱</text>
                            <!-- 캔들들 -->
                            <rect x="35" y="50" width="8" height="40" fill="#7D8471"/>
                            <line x1="39" y1="45" x2="39" y2="95" stroke="#7D8471" stroke-width="1"/>
                            <rect x="55" y="60" width="8" height="30" fill="#C15F3C"/>
                            <line x1="59" y1="55" x2="59" y2="100" stroke="#C15F3C" stroke-width="1"/>
                            <rect x="75" y="45" width="8" height="50" fill="#7D8471"/>
                            <line x1="79" y1="40" x2="79" y2="100" stroke="#7D8471" stroke-width="1"/>
                            <rect x="95" y="55" width="8" height="35" fill="#7D8471"/>
                            <line x1="99" y1="50" x2="99" y2="95" stroke="#7D8471" stroke-width="1"/>
                            <rect x="115" y="70" width="8" height="25" fill="#C15F3C"/>
                            <line x1="119" y1="65" x2="119" y2="105" stroke="#C15F3C" stroke-width="1"/>
                            <rect x="135" y="50" width="8" height="45" fill="#7D8471"/>
                            <line x1="139" y1="45" x2="139" y2="100" stroke="#7D8471" stroke-width="1"/>
                            <rect x="155" y="40" width="8" height="50" fill="#7D8471"/>
                            <line x1="159" y1="35" x2="159" y2="95" stroke="#7D8471" stroke-width="1"/>

                            <!-- 라인 차트 -->
                            <rect x="210" y="10" width="180" height="130" fill="var(--bg-dark)" rx="4"/>
                            <text x="300" y="30" font-size="10" fill="var(--text-primary)" text-anchor="middle">라인 차트</text>
                            <polyline points="230,90 250,70 270,80 290,50 310,60 330,45 350,55 370,40"
                                      stroke="var(--claude-orange)" stroke-width="2" fill="none"/>
                            <circle cx="230" cy="90" r="3" fill="var(--claude-orange)"/>
                            <circle cx="290" cy="50" r="3" fill="var(--claude-orange)"/>
                            <circle cx="370" cy="40" r="3" fill="var(--claude-orange)"/>
                        </svg>
                        <div class="illustration-caption">차트 유형 비교</div>
                    </div>
                `,
                'period-selector': `
                    <div class="manual-illustration">
                        <svg viewBox="0 0 400 80">
                            <rect x="0" y="0" width="400" height="80" fill="var(--bg-dark)" rx="8"/>
                            <rect x="20" y="25" width="40" height="30" fill="var(--bg-light)" rx="4"/>
                            <text x="40" y="45" font-size="10" fill="var(--text-muted)" text-anchor="middle">1일</text>
                            <rect x="70" y="25" width="40" height="30" fill="var(--bg-light)" rx="4"/>
                            <text x="90" y="45" font-size="10" fill="var(--text-muted)" text-anchor="middle">1주</text>
                            <rect x="120" y="25" width="50" height="30" fill="var(--claude-orange)" rx="4"/>
                            <text x="145" y="45" font-size="10" fill="white" text-anchor="middle">1개월</text>
                            <rect x="180" y="25" width="50" height="30" fill="var(--bg-light)" rx="4"/>
                            <text x="205" y="45" font-size="10" fill="var(--text-muted)" text-anchor="middle">3개월</text>
                            <rect x="240" y="25" width="40" height="30" fill="var(--bg-light)" rx="4"/>
                            <text x="260" y="45" font-size="10" fill="var(--text-muted)" text-anchor="middle">1년</text>
                            <rect x="290" y="25" width="40" height="30" fill="var(--bg-light)" rx="4"/>
                            <text x="310" y="45" font-size="10" fill="var(--text-muted)" text-anchor="middle">전체</text>
                        </svg>
                        <div class="illustration-caption">기간 선택 버튼</div>
                    </div>
                `,
                'industry-analysis': `
                    <div class="manual-illustration">
                        <svg viewBox="0 0 400 180">
                            <rect x="0" y="0" width="400" height="180" fill="var(--bg-dark)" rx="8"/>
                            <!-- 바 차트 -->
                            <text x="30" y="30" font-size="9" fill="var(--text-muted)">넥슨</text>
                            <rect x="80" y="20" width="200" height="16" fill="var(--claude-orange)" rx="2"/>
                            <text x="290" y="32" font-size="9" fill="var(--text-primary)">45.2조</text>

                            <text x="30" y="60" font-size="9" fill="var(--text-muted)">엔씨소프트</text>
                            <rect x="80" y="50" width="120" height="16" fill="#6B7B8C" rx="2"/>
                            <text x="210" y="62" font-size="9" fill="var(--text-primary)">27.1조</text>

                            <text x="30" y="90" font-size="9" fill="var(--text-muted)">크래프톤</text>
                            <rect x="80" y="80" width="150" height="16" fill="#7D8471" rx="2"/>
                            <text x="240" y="92" font-size="9" fill="var(--text-primary)">33.8조</text>

                            <text x="30" y="120" font-size="9" fill="var(--text-muted)">넷마블</text>
                            <rect x="80" y="110" width="80" height="16" fill="#9B8AA6" rx="2"/>
                            <text x="170" y="122" font-size="9" fill="var(--text-primary)">18.2조</text>

                            <text x="30" y="150" font-size="9" fill="var(--text-muted)">펄어비스</text>
                            <rect x="80" y="140" width="50" height="16" fill="#D4A574" rx="2"/>
                            <text x="140" y="152" font-size="9" fill="var(--text-primary)">11.3조</text>
                        </svg>
                        <div class="illustration-caption">산업 내 시가총액 비교</div>
                    </div>
                `,
                'calendar-filter': `
                    <div class="manual-illustration">
                        <svg viewBox="0 0 300 150">
                            <rect x="0" y="0" width="300" height="150" fill="var(--bg-dark)" rx="8"/>
                            <text x="20" y="25" font-size="11" fill="var(--text-primary)" font-weight="600">이벤트 필터</text>

                            <!-- 체크박스들 -->
                            <rect x="20" y="40" width="16" height="16" fill="var(--claude-orange)" rx="2"/>
                            <text x="22" y="52" font-size="10" fill="white">✓</text>
                            <text x="45" y="52" font-size="10" fill="var(--text-primary)">실적 발표</text>

                            <rect x="20" y="65" width="16" height="16" fill="var(--bg-light)" rx="2" stroke="var(--border-color)"/>
                            <text x="45" y="77" font-size="10" fill="var(--text-muted)">배당</text>

                            <rect x="20" y="90" width="16" height="16" fill="#7D8471" rx="2"/>
                            <text x="22" y="102" font-size="10" fill="white">✓</text>
                            <text x="45" y="102" font-size="10" fill="var(--text-primary)">게임 출시</text>

                            <rect x="20" y="115" width="16" height="16" fill="#9B8AA6" rx="2"/>
                            <text x="22" y="127" font-size="10" fill="white">✓</text>
                            <text x="45" y="127" font-size="10" fill="var(--text-primary)">IR 행사</text>
                        </svg>
                        <div class="illustration-caption">이벤트 필터 옵션</div>
                    </div>
                `
            };

            return illustrations[type] || '';
        }

        // 포럼 샘플 데이터
        const forumPosts = [
            {
                id: 1,
                category: 'portfolio',
                categoryLabel: '포트폴리오',
                title: '2025년 1월 포트폴리오 리밸런싱 전략',
                author: 'investor_kim',
                time: '2시간 전',
                tickers: ['AAPL', 'TSLA', 'NVDA'],
                likes: 127,
                comments: 23,
                views: 1200,
                awards: 3,
                unread: true,
                content: `안녕하세요, 2025년 첫 포트폴리오 리밸런싱 내용을 공유합니다.

지난 분기 AI 관련주들의 급등으로 포트폴리오 비중이 많이 변경되었습니다. 특히 NVDA의 비중이 30%를 넘어서면서 리밸런싱이 필요했습니다.

변경 사항:
• NVDA 30% → 20% (일부 차익실현)
• AAPL 15% → 20% (저평가 구간 진입)
• TSLA 10% → 15% (생산량 증가 기대)
• 현금 비중 5% → 10% (변동성 대비)

향후 전망:
- AI 인프라 투자는 지속될 것으로 예상
- 금리 인하 사이클 시작으로 기술주 추가 상승 여력 있음
- 다만 밸류에이션 부담으로 선별적 접근 필요`
            },
            {
                id: 2,
                category: 'stock',
                categoryLabel: '종목분석',
                title: '삼성전자 4Q 실적 프리뷰 - HBM이 관건',
                author: 'analyst_park',
                time: '5시간 전',
                tickers: ['005930.KS'],
                likes: 89,
                comments: 45,
                views: 2300,
                awards: 2,
                unread: true,
                content: `삼성전자 4분기 실적 프리뷰입니다.

실적 전망:
• 매출: 75조원 (YoY +8%)
• 영업이익: 8.5조원 (YoY +30%)

핵심 포인트:
1. HBM3E 양산 본격화로 메모리 실적 개선 기대
2. 파운드리 적자 지속, 가동률 회복은 2H25 예상
3. 스마트폰은 갤럭시 S25 출시 앞두고 보합

투자의견: 매수 유지, 목표가 85,000원`
            },
            {
                id: 3,
                category: 'discussion',
                categoryLabel: '토론',
                title: '2025년 가장 유망한 섹터는?',
                author: 'trader_lee',
                time: '8시간 전',
                tickers: [],
                likes: 56,
                comments: 78,
                views: 890,
                awards: 1,
                unread: false,
                content: `새해를 맞아 2025년 유망 섹터에 대한 토론을 열어봅니다.

개인적인 의견:
1. AI 인프라 (데이터센터, 반도체)
2. 바이오/헬스케어 (GLP-1, 유전자치료)
3. 신재생에너지 (ESS, 그리드)
4. 방산/항공우주

여러분의 의견은 어떠신가요?`
            },
            {
                id: 4,
                category: 'portfolio',
                categoryLabel: '포트폴리오',
                title: '배당주 중심 은퇴 포트폴리오 구성기',
                author: 'dividend_master',
                time: '1일 전',
                tickers: ['JNJ', 'PG', 'KO', 'O'],
                likes: 234,
                comments: 67,
                views: 3400,
                awards: 7,
                unread: false,
                content: `60세에 은퇴를 앞두고 배당 중심 포트폴리오로 전환했습니다.

목표 배당수익률: 연 4%
포트폴리오 구성:
• Johnson & Johnson (JNJ) - 20%
• Procter & Gamble (PG) - 20%
• Coca-Cola (KO) - 15%
• Realty Income (O) - 15%
• 국내 고배당주 - 20%
• 채권/현금 - 10%

총 투자금액 5억원 기준 연 2,000만원 배당 목표입니다.`
            },
            {
                id: 5,
                category: 'news',
                categoryLabel: '뉴스',
                title: 'Fed 파월 연설 요약 - 금리인하 시사',
                author: 'macro_watcher',
                time: '1일 전',
                tickers: ['SPY', 'QQQ'],
                likes: 178,
                comments: 34,
                views: 4500,
                awards: 4,
                unread: false,
                content: `어제 파월 의장 연설 핵심 내용 정리합니다.

주요 발언:
• "인플레이션이 목표치에 근접하고 있다"
• "노동시장은 여전히 견조하나 완화 조짐"
• "경제 상황에 따라 정책 조정 준비 되어있다"

시장 해석:
- 3월 FOMC에서 금리 인하 가능성 상승
- 연내 3-4회 인하 예상 (시장 컨센서스)

투자 시사점:
- 장기채 매력도 상승
- 성장주/기술주 긍정적`
            },
            {
                id: 6,
                category: 'stock',
                categoryLabel: '종목분석',
                title: 'NVIDIA 목표가 상향 - AI 슈퍼사이클',
                author: 'tech_analyst',
                time: '2일 전',
                tickers: ['NVDA'],
                likes: 312,
                comments: 89,
                views: 5600,
                awards: 9,
                unread: false,
                content: `NVIDIA 목표가를 $180 → $220로 상향합니다.

근거:
1. Blackwell 아키텍처 출시로 데이터센터 매출 급증 예상
2. 클라우드 업체들의 AI Capex 확대 지속
3. 자율주행, 로보틱스 등 새로운 성장 동력

밸류에이션:
• FY25 EPS: $6.50
• Forward P/E: 34x (프리미엄 정당화)

리스크 요인:
- 중국 수출 규제 강화
- AMD, 인텔의 경쟁 심화`
            },
            {
                id: 7,
                category: 'discussion',
                categoryLabel: '토론',
                title: '코스피 3000 돌파 전망 - 가능할까?',
                author: 'market_guru',
                time: '2일 전',
                tickers: ['005930.KS', '000660.KS'],
                likes: 21500,
                comments: 6200,
                views: 8900,
                awards: 13,
                unread: false,
                content: `코스피 3000 돌파 가능성에 대한 분석입니다.

긍정적 요인:
• 외국인 순매수 지속
• 반도체 슈퍼사이클 진입
• 금리 인하 기대감

부정적 요인:
• 원화 약세 지속
• 중국 경기 둔화
• 지정학적 리스크

개인적 전망: 상반기 내 3000 돌파 가능성 60%로 봅니다.`
            },
            {
                id: 8,
                category: 'stock',
                categoryLabel: '종목분석',
                title: '현대차 EV 전략 심층 분석 - 아이오닉의 미래',
                author: 'auto_analyst',
                time: '3일 전',
                tickers: ['005380.KS'],
                likes: 4300,
                comments: 890,
                views: 6700,
                awards: 5,
                unread: false,
                content: `현대차의 전기차 전략을 분석했습니다.

핵심 포인트:
• 아이오닉 라인업 확장 (6, 7, 9)
• 미국 조지아 공장 가동 시작
• 배터리 내재화 전략

경쟁력 분석:
- E-GMP 플랫폼 기술력 우수
- 충전 속도 업계 최고 수준
- 가격 경쟁력 확보

목표가: 280,000원 (현재 대비 +25%)`
            },
            {
                id: 9,
                category: 'stock',
                categoryLabel: '종목분석',
                title: '반도체 업종 투자 포인트 총정리',
                author: 'chip_master',
                time: '3일 전',
                tickers: ['005930.KS', '000660.KS', 'NVDA', 'AMD'],
                likes: 8700,
                comments: 1200,
                views: 12000,
                awards: 8,
                unread: false,
                content: `2025년 반도체 투자 핵심 포인트입니다.

메모리 반도체:
• HBM 수요 폭발적 증가
• DDR5 전환 가속화
• 공급 부족 지속 예상

시스템 반도체:
• AI 가속기 시장 급성장
• 자율주행 칩 수요 증가
• 파운드리 경쟁 심화

추천 종목: SK하이닉스 > 삼성전자 > NVIDIA`
            },
            {
                id: 10,
                category: 'portfolio',
                categoryLabel: '포트폴리오',
                title: '2차전지 밸류체인 완벽 정리',
                author: 'battery_expert',
                time: '4일 전',
                tickers: ['373220.KS', '006400.KS', '051910.KS'],
                likes: 15600,
                comments: 2300,
                views: 18000,
                awards: 21,
                unread: false,
                content: `2차전지 밸류체인을 정리했습니다.

양극재:
• 에코프로비엠, 포스코퓨처엠, 엘앤에프

음극재:
• 포스코퓨처엠, 대주전자재료

분리막:
• SK아이이테크놀로지, 더블유씨피

전해질:
• 솔브레인, 엔켐

투자 전략: 양극재 > 분리막 > 음극재 순으로 비중 추천`
            },
            {
                id: 11,
                category: 'discussion',
                categoryLabel: '토론',
                title: '바이오 섹터 리스크 분석 - 거품인가 성장인가',
                author: 'bio_watcher',
                time: '4일 전',
                tickers: ['068270.KS', '326030.KS'],
                likes: 3200,
                comments: 780,
                views: 5400,
                awards: 2,
                unread: false,
                content: `바이오 섹터의 리스크와 기회를 분석합니다.

리스크 요인:
• 임상 실패 위험
• 규제 불확실성
• 높은 밸류에이션

기회 요인:
• GLP-1 계열 약물 성장
• 세포유전자치료 발전
• 글로벌 기술이전 증가

결론: 선별적 투자 필요, 대형주 중심 접근 권장`
            },
            {
                id: 12,
                category: 'portfolio',
                categoryLabel: '포트폴리오',
                title: 'ETF 포트폴리오 추천 - 초보자용',
                author: 'etf_master',
                time: '5일 전',
                tickers: ['SPY', 'QQQ', 'VTI'],
                likes: 9800,
                comments: 1500,
                views: 22000,
                awards: 15,
                unread: false,
                content: `투자 초보자를 위한 ETF 포트폴리오입니다.

보수적 포트폴리오 (안정형):
• SPY 40% + BND 40% + GLD 20%

균형 포트폴리오:
• VTI 50% + VXUS 30% + BND 20%

공격적 포트폴리오:
• QQQ 50% + SOXX 30% + ARKK 20%

월 100만원씩 적립식 투자 추천합니다.`
            }
        ];

        // 포럼 인기 작성자 데이터
        const forumTopAuthors = [
            { name: 'analyst_park', views: 23400, posts: 45 },
            { name: 'investor_kim', views: 18200, posts: 32 },
            { name: 'trader_lee', views: 12100, posts: 28 },
            { name: 'dividend_master', views: 9800, posts: 21 },
            { name: 'macro_watcher', views: 8500, posts: 19 }
        ];

        // 포럼 핫 토픽 데이터
        const forumHotTopics = [
            { name: '삼성전자', ticker: '005930.KS', change: '+23%', positive: true },
            { name: 'NVIDIA', ticker: 'NVDA', change: '+18%', positive: true },
            { name: '테슬라', ticker: 'TSLA', change: '+15%', positive: true },
            { name: 'SK하이닉스', ticker: '000660.KS', change: '+12%', positive: true },
            { name: '애플', ticker: 'AAPL', change: '-5%', positive: false }
        ];

        // 현재 선택된 포럼 카테고리 및 게시물
        let currentForumCategory = 'all';
        let currentForumSort = 'latest';
        let selectedForumPost = null;
        let currentForumSearch = '';

        function showForum() {
            // 사이드바 아이콘 활성화 상태 변경
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="포럼"]').classList.add('active');

            // 중앙 패널에 포럼 게시판 표시
            const centerPanel = document.querySelector('.center-panel');
            centerPanel.innerHTML = `
                <div class="forum-container">
                    <div class="forum-list-panel">
                        <div class="forum-header">
                            <div class="forum-tabs">
                                <button class="forum-tab active" data-category="all" onclick="filterForumCategory('all')">전체</button>
                                <button class="forum-tab" data-category="portfolio" onclick="filterForumCategory('portfolio')">포트폴리오</button>
                                <button class="forum-tab" data-category="stock" onclick="filterForumCategory('stock')">종목분석</button>
                                <button class="forum-tab" data-category="discussion" onclick="filterForumCategory('discussion')">토론</button>
                            </div>
                            <div class="forum-actions">
                                <select class="forum-sort-select" onchange="sortForumPosts(this.value)">
                                    <option value="latest">최신순</option>
                                    <option value="popular">인기순</option>
                                    <option value="comments">댓글순</option>
                                </select>
                                <div class="forum-search-box">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    </svg>
                                    <input type="text" id="forumSearchInput" placeholder="게시글 검색..." oninput="searchForumPosts(this.value)" />
                                </div>
                                <button class="forum-write-btn" onclick="openForumWriteModal()">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                    글쓰기
                                </button>
                            </div>
                        </div>
                        <div class="forum-post-list" id="forumPostList">
                            <!-- 게시물 리스트가 여기에 렌더링됩니다 -->
                        </div>
                    </div>
                    <div class="forum-detail-panel" id="forumDetailPanel">
                        <!-- 기본 대시보드가 여기에 렌더링됩니다 -->
                    </div>
                </div>
            `;

            // 우측 패널에 랭킹 표시
            const rightPanel = document.querySelector('.right-panel');
            rightPanel.innerHTML = `
                <div class="forum-ranking-section">
                    <div class="forum-ranking-title">인기 작성자</div>
                    <div class="forum-ranking-list" id="forumTopAuthorsRanking">
                        <!-- 인기 작성자 랭킹 -->
                    </div>
                </div>
                <div class="forum-ranking-section">
                    <div class="forum-ranking-title">핫 토픽</div>
                    <div class="forum-ranking-list" id="forumHotTopicsRanking">
                        <!-- 핫 토픽 랭킹 -->
                    </div>
                </div>
                <div class="forum-ranking-section">
                    <div class="forum-ranking-title">추천 많은 글</div>
                    <div class="forum-ranking-list" id="forumTopPostsRanking">
                        <!-- 추천 많은 글 랭킹 -->
                    </div>
                </div>
            `;

            // 초기 렌더링
            renderForumPosts();
            renderForumRankings();
            renderForumDashboard();
        }

        function searchForumPosts(query) {
            currentForumSearch = query.toLowerCase().trim();
            renderForumPosts();
        }

        function renderForumDashboard() {
            const detailPanel = document.getElementById('forumDetailPanel');
            if (!detailPanel || selectedForumPost) return;

            // 인기글 TOP 3 (조회수 + 추천수 기준)
            const popularPosts = [...forumPosts]
                .sort((a, b) => (b.views + b.likes) - (a.views + a.likes))
                .slice(0, 3);

            // 최신글 3개
            const recentPosts = [...forumPosts].slice(0, 3);

            detailPanel.innerHTML = `
                <div class="forum-dashboard">
                    <div class="forum-dashboard-section">
                        <div class="forum-dashboard-section-title">오늘의 인기글</div>
                        <div class="forum-popular-list">
                            ${popularPosts.map((post, idx) => `
                                <div class="forum-popular-card" onclick="selectForumPost(${post.id})">
                                    <div class="forum-popular-card-header">
                                        <span class="forum-popular-rank">#${idx + 1}</span>
                                        <span class="forum-post-category ${post.category}">${post.categoryLabel}</span>
                                    </div>
                                    <div class="forum-popular-title">${post.title}</div>
                                    <div class="forum-popular-meta">
                                        <span>${post.author}</span>
                                        <span>조회 ${formatNumber(post.views)}</span>
                                        <span>추천 ${formatNumber(post.likes)}</span>
                                        <span>댓글 ${post.comments}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="forum-dashboard-section">
                        <div class="forum-dashboard-section-title">최신 글</div>
                        <div class="forum-recent-list">
                            ${recentPosts.map(post => `
                                <div class="forum-recent-item" onclick="selectForumPost(${post.id})">
                                    <span class="forum-post-category ${post.category}">${post.categoryLabel}</span>
                                    <span class="forum-recent-title">${post.title}</span>
                                    <span class="forum-recent-time">${post.time}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderForumPosts() {
            const listEl = document.getElementById('forumPostList');
            if (!listEl) return;

            let filteredPosts = [...forumPosts];

            // 검색 필터링
            if (currentForumSearch) {
                filteredPosts = filteredPosts.filter(p =>
                    p.title.toLowerCase().includes(currentForumSearch) ||
                    p.content.toLowerCase().includes(currentForumSearch) ||
                    p.author.toLowerCase().includes(currentForumSearch)
                );
            }

            // 카테고리 필터링
            if (currentForumCategory !== 'all') {
                filteredPosts = filteredPosts.filter(p => p.category === currentForumCategory);
            }

            // 정렬
            switch (currentForumSort) {
                case 'popular':
                    filteredPosts.sort((a, b) => b.views - a.views);
                    break;
                case 'comments':
                    filteredPosts.sort((a, b) => b.comments - a.comments);
                    break;
                default: // latest
                    filteredPosts.sort((a, b) => a.id - b.id);
            }

            listEl.innerHTML = filteredPosts.map(post => `
                <div class="forum-post-card ${post.unread ? 'unread' : ''} ${selectedForumPost === post.id ? 'active' : ''}"
                     onclick="selectForumPost(${post.id})">
                    <span class="forum-post-category ${post.category}">${post.categoryLabel}</span>
                    <div class="forum-post-title">${post.title}</div>
                    <div class="forum-post-meta">
                        <span class="forum-post-author">${post.author}</span>
                        <span>•</span>
                        <span>${post.time}</span>
                    </div>
                    <div class="forum-post-stats">
                        <span class="forum-post-stat">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="18 15 12 9 6 15"></polyline>
                            </svg>
                            ${post.likes}
                        </span>
                        <span class="forum-post-stat">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            ${post.comments}
                        </span>
                        <span class="forum-post-stat">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            ${formatNumber(post.views)}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        function renderForumRankings() {
            // 인기 작성자 랭킹
            const authorsEl = document.getElementById('forumTopAuthorsRanking');
            if (authorsEl) {
                const maxViews = Math.max(...forumTopAuthors.map(a => a.views));
                authorsEl.innerHTML = forumTopAuthors.map((author, idx) => `
                    <div class="forum-ranking-item">
                        <span class="forum-ranking-rank ${idx < 3 ? 'top' : ''}">${idx + 1}</span>
                        <div style="flex:1">
                            <div class="forum-ranking-name">${author.name}</div>
                            <div class="forum-ranking-bar">
                                <div class="forum-ranking-bar-fill" style="width:${(author.views / maxViews) * 100}%"></div>
                            </div>
                        </div>
                        <span class="forum-ranking-value">${formatNumber(author.views)}</span>
                    </div>
                `).join('');
            }

            // 핫 토픽 랭킹
            const topicsEl = document.getElementById('forumHotTopicsRanking');
            if (topicsEl) {
                topicsEl.innerHTML = forumHotTopics.map((topic, idx) => `
                    <div class="forum-ranking-item">
                        <span class="forum-ranking-rank ${idx < 3 ? 'top' : ''}">${idx + 1}</span>
                        <span class="forum-ranking-name">${topic.name}</span>
                        <span class="forum-hot-change ${topic.positive ? 'positive' : 'negative'}">${topic.change}</span>
                    </div>
                `).join('');
            }

            // 추천 많은 글 랭킹
            const postsEl = document.getElementById('forumTopPostsRanking');
            if (postsEl) {
                const topPosts = [...forumPosts].sort((a, b) => b.likes - a.likes).slice(0, 5);
                postsEl.innerHTML = topPosts.map((post, idx) => `
                    <div class="forum-ranking-item" onclick="selectForumPost(${post.id})">
                        <span class="forum-ranking-rank ${idx < 3 ? 'top' : ''}">${idx + 1}</span>
                        <span class="forum-ranking-name">${post.title}</span>
                        <span class="forum-ranking-value">${post.likes}</span>
                    </div>
                `).join('');
            }
        }

        function filterForumCategory(category) {
            currentForumCategory = category;

            // 탭 활성화 상태 변경
            document.querySelectorAll('.forum-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.category === category);
            });

            renderForumPosts();
        }

        function sortForumPosts(sortType) {
            currentForumSort = sortType;
            renderForumPosts();
        }

        // 작성자별 아바타 색상 반환
        const forumAvatarColors = [
            "#C15F3C",   // Crail (메인 러스트 오렌지)
            "#B1ADA1",   // Cloudy (웜 그레이)
            "#da7756",   // Terra Cotta (테라코타)
            "#7D8471",   // Sage (세이지 그린)
            "#9B8AA6",   // Lavender (라벤더)
            "#D4A574",   // Tan (탄)
            "#6B7B8C",   // Slate (슬레이트 그레이)
            "#A67B5B"    // Coffee (커피 브라운)
        ];

        function getAuthorAvatarColor(author) {
            let hash = 0;
            for (let i = 0; i < author.length; i++) {
                hash = author.charCodeAt(i) + ((hash << 5) - hash);
            }
            return forumAvatarColors[Math.abs(hash) % forumAvatarColors.length];
        }

        function selectForumPost(postId) {
            selectedForumPost = postId;
            const post = forumPosts.find(p => p.id === postId);
            if (!post) return;

            // 읽음 처리
            post.unread = false;

            // 게시물 리스트 업데이트
            renderForumPosts();

            // 상세 패널 렌더링
            const detailPanel = document.getElementById('forumDetailPanel');
            if (!detailPanel) return;

            const tickersHtml = post.tickers.length > 0
                ? `<div class="forum-tickers">
                    ${post.tickers.map(t => `<span class="forum-ticker">$${t}</span>`).join('')}
                   </div>`
                : '';

            detailPanel.innerHTML = `
                <div class="forum-detail-content">
                    <div class="forum-detail-header">
                        <span class="forum-post-category ${post.category}">${post.categoryLabel}</span>
                        <h1 class="forum-detail-title">${post.title}</h1>
                        <div class="forum-detail-meta">
                            <div class="forum-detail-author">
                                <div class="forum-author-avatar" style="background:${getAuthorAvatarColor(post.author)}">${post.author.charAt(0).toUpperCase()}</div>
                                <div>
                                    <div class="forum-author-name">${post.author}</div>
                                    <div style="font-size:11px;color:var(--text-dim)">${post.time}</div>
                                </div>
                            </div>
                            <span>조회 ${formatNumber(post.views)}</span>
                        </div>
                    </div>

                    <div class="forum-detail-body">
                        ${post.content.split('\n').map(p => p.trim() ? `<p>${p}</p>` : '').join('')}
                    </div>

                    ${tickersHtml}

                    ${post.tickers.length > 0 && [1, 2, 3].includes(post.id) ? `
                    <div class="forum-chart-snapshot">
                        <div class="forum-chart-snapshot-title">차트 스냅샷 (1년) - ${post.tickers.join(', ')}</div>
                        <svg viewBox="0 0 700 280" class="forum-chart-svg">
                            ${(() => {
                                if (!forumChartDataCache[post.id]) {
                                    forumChartDataCache[post.id] = generateForumChartData(post.id);
                                }
                                return generateForumChartSVG(forumChartDataCache[post.id], post.id);
                            })()}
                        </svg>
                    </div>
                    ` : ''}

                    <div class="forum-detail-actions">
                        <div class="forum-vote-group">
                            <button class="forum-vote-btn" onclick="votePost(${post.id}, 'up')" title="추천">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4l-8 8h5v8h6v-8h5z"/>
                                </svg>
                            </button>
                            <span class="forum-vote-count">${formatNumber(post.likes)}</span>
                            <button class="forum-vote-btn" onclick="votePost(${post.id}, 'down')" title="비추천">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 20l8-8h-5v-8h-6v8h-5z"/>
                                </svg>
                            </button>
                        </div>
                        <button class="forum-action-btn">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            </svg>
                            ${formatNumber(post.comments)}
                        </button>
                        <button class="forum-action-btn forum-award-btn">
                            어워드 ${post.awards || 0}
                        </button>
                        <button class="forum-action-btn">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"/>
                                <circle cx="6" cy="12" r="3"/>
                                <circle cx="18" cy="19" r="3"/>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                            </svg>
                            공유
                        </button>
                    </div>
                </div>
            `;
        }

        function toggleForumLike(postId) {
            const post = forumPosts.find(p => p.id === postId);
            if (post) {
                post.likes += 1;
                selectForumPost(postId);
                renderForumRankings();
            }
        }

        function formatNumber(num) {
            if (num >= 10000) {
                return (num / 10000).toFixed(1) + '만';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + '천';
            }
            return num.toString();
        }

        function votePost(postId, direction) {
            const post = forumPosts.find(p => p.id === postId);
            if (post) {
                if (direction === 'up') {
                    post.likes += 1;
                } else if (direction === 'down' && post.likes > 0) {
                    post.likes -= 1;
                }
                selectForumPost(postId);
                renderForumRankings();
            }
        }

        // 글쓰기 모달 관련 변수
        let forumWriteCategory = 'portfolio';

        function openForumWriteModal() {
            // 모달 오버레이 생성 (이미 존재하면 제거 후 재생성)
            let existingModal = document.querySelector('.forum-write-modal-overlay');
            if (existingModal) {
                existingModal.remove();
            }

            const modalHtml = `
                <div class="forum-write-modal-overlay" id="forumWriteModalOverlay">
                    <div class="forum-write-modal">
                        <div class="forum-write-header">
                            <span class="forum-write-title">새 글 작성</span>
                            <button class="forum-write-close" onclick="closeForumWriteModal()">&times;</button>
                        </div>
                        <div class="forum-write-body">
                            <div class="forum-write-group">
                                <label class="forum-write-label">카테고리</label>
                                <div class="forum-write-category-btns">
                                    <button class="forum-write-category-btn active" data-cat="portfolio" onclick="selectWriteCategory('portfolio')">포트폴리오</button>
                                    <button class="forum-write-category-btn" data-cat="stock" onclick="selectWriteCategory('stock')">종목분석</button>
                                    <button class="forum-write-category-btn" data-cat="discussion" onclick="selectWriteCategory('discussion')">토론</button>
                                    <button class="forum-write-category-btn" data-cat="news" onclick="selectWriteCategory('news')">뉴스</button>
                                </div>
                            </div>
                            <div class="forum-write-group">
                                <label class="forum-write-label">제목</label>
                                <input type="text" class="forum-write-input" id="forumWriteTitle" placeholder="제목을 입력하세요">
                            </div>
                            <div class="forum-write-group">
                                <label class="forum-write-label">관련 종목 (쉼표로 구분)</label>
                                <input type="text" class="forum-write-input" id="forumWriteTickers" placeholder="예: AAPL, TSLA, NVDA">
                            </div>
                            <div class="forum-write-group">
                                <label class="forum-write-label">내용</label>
                                <textarea class="forum-write-textarea" id="forumWriteContent" placeholder="내용을 입력하세요"></textarea>
                            </div>
                            <div class="forum-write-group">
                                <label class="forum-write-label">이미지 첨부</label>
                                <div class="forum-write-image-upload" id="forumImageUpload" onclick="document.getElementById('forumImageInput').click()">
                                    <input type="file" id="forumImageInput" accept="image/*" multiple style="display:none" onchange="handleForumImageSelect(event)">
                                    <div class="forum-write-image-upload-icon">
                                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                            <polyline points="21 15 16 10 5 21"></polyline>
                                        </svg>
                                    </div>
                                    <div class="forum-write-image-upload-text">클릭하거나 이미지를 드래그해서 업로드</div>
                                    <div class="forum-write-image-upload-hint">PNG, JPG, GIF (최대 5MB)</div>
                                </div>
                                <div class="forum-write-image-preview" id="forumImagePreview"></div>
                            </div>
                        </div>
                        <div class="forum-write-footer">
                            <button class="forum-write-btn-cancel" onclick="closeForumWriteModal()">취소</button>
                            <button class="forum-write-btn-submit" onclick="submitForumPost()">게시하기</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);

            // 약간의 딜레이 후 visible 클래스 추가 (애니메이션)
            setTimeout(() => {
                document.getElementById('forumWriteModalOverlay').classList.add('visible');
                setupForumImageDragDrop();
            }, 10);
        }

        function closeForumWriteModal() {
            const overlay = document.getElementById('forumWriteModalOverlay');
            if (overlay) {
                overlay.classList.remove('visible');
                setTimeout(() => overlay.remove(), 200);
            }
            // 업로드된 이미지 초기화
            forumUploadedImages = [];
        }

        // 이미지 업로드 관련
        let forumUploadedImages = [];

        function handleForumImageSelect(event) {
            const files = event.target.files;
            if (!files) return;

            for (let file of files) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('이미지 크기는 5MB를 초과할 수 없습니다.');
                    continue;
                }
                if (!file.type.startsWith('image/')) {
                    continue;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    forumUploadedImages.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        data: e.target.result
                    });
                    renderForumImagePreview();
                };
                reader.readAsDataURL(file);
            }
        }

        function renderForumImagePreview() {
            const previewContainer = document.getElementById('forumImagePreview');
            if (!previewContainer) return;

            previewContainer.innerHTML = forumUploadedImages.map(img => `
                <div class="forum-write-image-item">
                    <img src="${img.data}" alt="${img.name}">
                    <button class="forum-write-image-remove" onclick="removeForumImage(${img.id})">&times;</button>
                </div>
            `).join('');
        }

        function removeForumImage(imageId) {
            forumUploadedImages = forumUploadedImages.filter(img => img.id !== imageId);
            renderForumImagePreview();
        }

        // 드래그 앤 드롭 설정
        function setupForumImageDragDrop() {
            const uploadArea = document.getElementById('forumImageUpload');
            if (!uploadArea) return;

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById('forumImageInput').files = files;
                    handleForumImageSelect({ target: { files } });
                }
            });
        }

        function selectWriteCategory(category) {
            forumWriteCategory = category;
            document.querySelectorAll('.forum-write-category-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.cat === category);
            });
        }

        function submitForumPost() {
            const title = document.getElementById('forumWriteTitle').value.trim();
            const content = document.getElementById('forumWriteContent').value.trim();
            const tickersInput = document.getElementById('forumWriteTickers').value.trim();

            if (!title || !content) {
                alert('제목과 내용을 입력해주세요.');
                return;
            }

            const categoryLabels = {
                portfolio: '포트폴리오',
                stock: '종목분석',
                discussion: '토론',
                news: '뉴스'
            };

            const tickers = tickersInput ? tickersInput.split(',').map(t => t.trim()).filter(t => t) : [];

            const newPost = {
                id: forumPosts.length + 1,
                category: forumWriteCategory,
                categoryLabel: categoryLabels[forumWriteCategory],
                title: title,
                author: 'user_me',
                time: '방금 전',
                tickers: tickers,
                likes: 0,
                comments: 0,
                views: 0,
                unread: false,
                content: content
            };

            forumPosts.unshift(newPost);
            closeForumWriteModal();
            renderForumPosts();
            selectForumPost(newPost.id);
        }

        // ===== 차트랩 기능 =====

        // 개별 차트 상태 생성 함수 (Livedocs 스타일)
        function createChartLabChartState(id) {
            return {
                id: id,
                dataSource: 'sample_sales',
                chartType: 'grouped-column',  // Livedocs 기본값
                xAxis: {
                    field: 'month',
                    scaleType: 'datetime',
                    timeUnit: 'year',
                    sort: 'ascending'  // ascending, descending
                },
                yAxis: [{ field: 'orders', aggregate: 'sum' }],
                colorBy: { field: 'category' },
                faceting: { field: null },
                tooltips: { includeXYColor: true, custom: [] },
                filters: [],
                style: {
                    title: '',
                    fontSize: 10,
                    colors: ['#C15F3C', '#B1ADA1', '#da7756', '#7D8471', '#9B8AA6', '#D4A574', '#6B7B8C', '#A67B5B'],
                    legendPosition: 'right',
                    showOutliers: true,
                    showTooltip: true
                },
                activeTab: 'data',
                collapsed: false
            };
        }

        // 차트 목록
        let chartLabCharts = [createChartLabChartState(1)];
        let chartLabNextId = 2;
        let chartLabActiveChartId = 1;  // 현재 선택된 차트
        let chartLabPreviewId = null;  // 현재 미리보기 중인 차트 ID
        let chartLabPreviewType = null;  // 'recent' 또는 'saved'

        // 특정 차트 상태 가져오기
        function getChartLabChart(id) {
            return chartLabCharts.find(c => c.id === id);
        }

        // 현재 활성 차트 가져오기
        function getActiveChartLabChart() {
            return getChartLabChart(chartLabActiveChartId);
        }

        // 하위 호환성을 위한 chartLabState (첫 번째 차트 참조)
        const chartLabState = createChartLabChartState(1);
        chartLabCharts[0] = chartLabState;

        // 샘플 데이터소스
        const chartLabDataSources = {
            sample_sales: {
                name: '매출 데이터 (샘플)',
                fields: [
                    { id: 'month', name: '월', type: 'datetime' },
                    { id: 'category', name: '카테고리', type: 'string' },
                    { id: 'orders', name: '주문수', type: 'number' },
                    { id: 'revenue', name: '매출', type: 'number' }
                ],
                data: [
                    // 2019
                    { month: '2019-01-01', category: 'Dumplings', orders: 1200, revenue: 24000 },
                    { month: '2019-01-01', category: 'Noodles', orders: 800, revenue: 16000 },
                    { month: '2019-01-01', category: 'Quick Bites', orders: 1500, revenue: 22500 },
                    { month: '2019-01-01', category: 'Sweets', orders: 600, revenue: 9000 },
                    { month: '2019-01-01', category: 'Veggies', orders: 400, revenue: 8000 },
                    // 2020
                    { month: '2020-01-01', category: 'Dumplings', orders: 1400, revenue: 28000 },
                    { month: '2020-01-01', category: 'Noodles', orders: 1000, revenue: 20000 },
                    { month: '2020-01-01', category: 'Quick Bites', orders: 1800, revenue: 27000 },
                    { month: '2020-01-01', category: 'Sweets', orders: 750, revenue: 11250 },
                    { month: '2020-01-01', category: 'Veggies', orders: 500, revenue: 10000 },
                    // 2021
                    { month: '2021-01-01', category: 'Dumplings', orders: 1800, revenue: 36000 },
                    { month: '2021-01-01', category: 'Noodles', orders: 1200, revenue: 24000 },
                    { month: '2021-01-01', category: 'Quick Bites', orders: 2200, revenue: 33000 },
                    { month: '2021-01-01', category: 'Sweets', orders: 900, revenue: 13500 },
                    { month: '2021-01-01', category: 'Veggies', orders: 650, revenue: 13000 },
                    // 2022
                    { month: '2022-01-01', category: 'Dumplings', orders: 2100, revenue: 42000 },
                    { month: '2022-01-01', category: 'Noodles', orders: 1500, revenue: 30000 },
                    { month: '2022-01-01', category: 'Quick Bites', orders: 2600, revenue: 39000 },
                    { month: '2022-01-01', category: 'Sweets', orders: 1100, revenue: 16500 },
                    { month: '2022-01-01', category: 'Veggies', orders: 800, revenue: 16000 },
                    // 2023
                    { month: '2023-01-01', category: 'Dumplings', orders: 2400, revenue: 48000 },
                    { month: '2023-01-01', category: 'Noodles', orders: 1800, revenue: 36000 },
                    { month: '2023-01-01', category: 'Quick Bites', orders: 3000, revenue: 45000 },
                    { month: '2023-01-01', category: 'Sweets', orders: 1300, revenue: 19500 },
                    { month: '2023-01-01', category: 'Veggies', orders: 950, revenue: 19000 },
                    // 2024
                    { month: '2024-01-01', category: 'Dumplings', orders: 2700, revenue: 54000 },
                    { month: '2024-01-01', category: 'Noodles', orders: 2000, revenue: 40000 },
                    { month: '2024-01-01', category: 'Quick Bites', orders: 3300, revenue: 49500 },
                    { month: '2024-01-01', category: 'Sweets', orders: 1500, revenue: 22500 },
                    { month: '2024-01-01', category: 'Veggies', orders: 1100, revenue: 22000 },
                    // 2025
                    { month: '2025-01-01', category: 'Dumplings', orders: 2900, revenue: 58000 },
                    { month: '2025-01-01', category: 'Noodles', orders: 2200, revenue: 44000 },
                    { month: '2025-01-01', category: 'Quick Bites', orders: 3500, revenue: 52500 },
                    { month: '2025-01-01', category: 'Sweets', orders: 1650, revenue: 24750 },
                    { month: '2025-01-01', category: 'Veggies', orders: 1250, revenue: 25000 },
                    // 2026
                    { month: '2026-01-01', category: 'Dumplings', orders: 3100, revenue: 62000 },
                    { month: '2026-01-01', category: 'Noodles', orders: 2400, revenue: 48000 },
                    { month: '2026-01-01', category: 'Quick Bites', orders: 3700, revenue: 55500 },
                    { month: '2026-01-01', category: 'Sweets', orders: 1800, revenue: 27000 },
                    { month: '2026-01-01', category: 'Veggies', orders: 1400, revenue: 28000 }
                ]
            },
            sample_stock: {
                name: '주가 데이터 (샘플)',
                fields: [
                    { id: 'date', name: '날짜', type: 'datetime' },
                    { id: 'symbol', name: '종목', type: 'string' },
                    { id: 'close', name: '종가', type: 'number' },
                    { id: 'volume', name: '거래량', type: 'number' },
                    { id: 'sector', name: '섹터', type: 'string' }
                ],
                data: [
                    { date: '2024-01-01', symbol: 'AAPL', close: 185.5, volume: 45000000, sector: 'Technology' },
                    { date: '2024-02-01', symbol: 'AAPL', close: 182.3, volume: 42000000, sector: 'Technology' },
                    { date: '2024-03-01', symbol: 'AAPL', close: 178.7, volume: 48000000, sector: 'Technology' },
                    { date: '2024-04-01', symbol: 'AAPL', close: 170.2, volume: 51000000, sector: 'Technology' },
                    { date: '2024-05-01', symbol: 'AAPL', close: 189.8, volume: 39000000, sector: 'Technology' },
                    { date: '2024-06-01', symbol: 'AAPL', close: 195.2, volume: 44000000, sector: 'Technology' },
                    { date: '2024-01-01', symbol: 'GOOGL', close: 140.2, volume: 28000000, sector: 'Technology' },
                    { date: '2024-02-01', symbol: 'GOOGL', close: 138.5, volume: 26000000, sector: 'Technology' },
                    { date: '2024-03-01', symbol: 'GOOGL', close: 155.8, volume: 32000000, sector: 'Technology' },
                    { date: '2024-04-01', symbol: 'GOOGL', close: 160.3, volume: 29000000, sector: 'Technology' },
                    { date: '2024-05-01', symbol: 'GOOGL', close: 175.4, volume: 35000000, sector: 'Technology' },
                    { date: '2024-06-01', symbol: 'GOOGL', close: 182.1, volume: 31000000, sector: 'Technology' },
                    { date: '2024-01-01', symbol: 'MSFT', close: 375.2, volume: 22000000, sector: 'Technology' },
                    { date: '2024-02-01', symbol: 'MSFT', close: 402.5, volume: 25000000, sector: 'Technology' },
                    { date: '2024-03-01', symbol: 'MSFT', close: 415.8, volume: 21000000, sector: 'Technology' },
                    { date: '2024-04-01', symbol: 'MSFT', close: 408.3, volume: 24000000, sector: 'Technology' },
                    { date: '2024-05-01', symbol: 'MSFT', close: 420.7, volume: 20000000, sector: 'Technology' },
                    { date: '2024-06-01', symbol: 'MSFT', close: 445.2, volume: 23000000, sector: 'Technology' }
                ]
            },
            sample_economic: {
                name: '경제 지표 (샘플)',
                fields: [
                    { id: 'date', name: '날짜', type: 'datetime' },
                    { id: 'indicator', name: '지표', type: 'string' },
                    { id: 'value', name: '값', type: 'number' },
                    { id: 'country', name: '국가', type: 'string' }
                ],
                data: [
                    { date: '2023-Q1', indicator: 'GDP Growth', value: 2.1, country: 'USA' },
                    { date: '2023-Q2', indicator: 'GDP Growth', value: 2.4, country: 'USA' },
                    { date: '2023-Q3', indicator: 'GDP Growth', value: 4.9, country: 'USA' },
                    { date: '2023-Q4', indicator: 'GDP Growth', value: 3.3, country: 'USA' },
                    { date: '2024-Q1', indicator: 'GDP Growth', value: 1.6, country: 'USA' },
                    { date: '2023-Q1', indicator: 'Inflation', value: 6.0, country: 'USA' },
                    { date: '2023-Q2', indicator: 'Inflation', value: 4.0, country: 'USA' },
                    { date: '2023-Q3', indicator: 'Inflation', value: 3.7, country: 'USA' },
                    { date: '2023-Q4', indicator: 'Inflation', value: 3.4, country: 'USA' },
                    { date: '2024-Q1', indicator: 'Inflation', value: 3.5, country: 'USA' },
                    { date: '2023-Q1', indicator: 'Unemployment', value: 3.5, country: 'USA' },
                    { date: '2023-Q2', indicator: 'Unemployment', value: 3.6, country: 'USA' },
                    { date: '2023-Q3', indicator: 'Unemployment', value: 3.8, country: 'USA' },
                    { date: '2023-Q4', indicator: 'Unemployment', value: 3.7, country: 'USA' },
                    { date: '2024-Q1', indicator: 'Unemployment', value: 3.9, country: 'USA' }
                ]
            },
            custom: {
                name: '사용자 데이터',
                fields: [],
                data: []
            }
        };

        // 차트 유형 정의 (Livedocs 스타일) - SVG 아이콘
        const chartLabChartTypes = [
            { id: 'grouped-column', name: 'Grouped column', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="10" width="4" height="10" rx="0.5"/><rect x="10" y="6" width="4" height="14" rx="0.5"/><rect x="16" y="12" width="4" height="8" rx="0.5"/></svg>` },
            { id: 'stacked-column', name: 'Stacked column', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="14" width="4" height="6" rx="0.5"/><rect x="4" y="8" width="4" height="5" rx="0.5" opacity="0.6"/><rect x="10" y="10" width="4" height="10" rx="0.5"/><rect x="10" y="4" width="4" height="5" rx="0.5" opacity="0.6"/><rect x="16" y="12" width="4" height="8" rx="0.5"/><rect x="16" y="6" width="4" height="5" rx="0.5" opacity="0.6"/></svg>` },
            { id: '100-stacked-column', name: '100% stacked column', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="4" height="16" rx="0.5"/><rect x="10" y="4" width="4" height="16" rx="0.5"/><rect x="16" y="4" width="4" height="16" rx="0.5"/></svg>` },
            { id: 'grouped-bar', name: 'Grouped bar', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="10" height="4" rx="0.5"/><rect x="4" y="10" width="14" height="4" rx="0.5"/><rect x="4" y="16" width="8" height="4" rx="0.5"/></svg>` },
            { id: 'stacked-bar', name: 'Stacked bar', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="6" height="4" rx="0.5"/><rect x="11" y="4" width="5" height="4" rx="0.5" opacity="0.6"/><rect x="4" y="10" width="8" height="4" rx="0.5"/><rect x="13" y="10" width="5" height="4" rx="0.5" opacity="0.6"/><rect x="4" y="16" width="10" height="4" rx="0.5"/><rect x="15" y="16" width="4" height="4" rx="0.5" opacity="0.6"/></svg>` },
            { id: '100-stacked-bar', name: '100% stacked bar', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="4" rx="0.5"/><rect x="4" y="10" width="16" height="4" rx="0.5"/><rect x="4" y="16" width="16" height="4" rx="0.5"/></svg>` },
            { id: 'line', name: 'Line chart', icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4,18 8,12 12,15 16,8 20,10"/></svg>` },
            { id: 'stacked-area', name: 'Stacked area', icon: `<svg viewBox="0 0 24 24" fill="currentColor" opacity="0.7"><path d="M4,20 L4,14 L8,10 L12,13 L16,8 L20,11 L20,20 Z"/></svg>` },
            { id: '100-stacked-area', name: '100% stacked area', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M4,20 L4,4 L8,8 L12,5 L16,9 L20,4 L20,20 Z" opacity="0.7"/></svg>` },
            { id: 'histogram', name: 'Histogram', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="14" width="3" height="6" rx="0.5"/><rect x="7" y="10" width="3" height="10" rx="0.5"/><rect x="11" y="6" width="3" height="14" rx="0.5"/><rect x="15" y="10" width="3" height="10" rx="0.5"/><rect x="19" y="14" width="3" height="6" rx="0.5"/></svg>` },
            { id: 'scatter', name: 'Scatterplot', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><circle cx="6" cy="16" r="2"/><circle cx="10" cy="10" r="2"/><circle cx="14" cy="14" r="2"/><circle cx="18" cy="8" r="2"/></svg>` },
            { id: 'pie', name: 'Pie chart', icon: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12,2 A10,10 0 1,1 2,12 L12,12 Z"/><path d="M14,2.5 A10,10 0 0,1 21.5,10 L12,12 Z" opacity="0.6"/></svg>` }
        ];

        // 집계 함수
        const chartLabAggregations = [
            { id: 'sum', name: 'Sum' },
            { id: 'avg', name: 'Average' },
            { id: 'min', name: 'Min' },
            { id: 'max', name: 'Max' },
            { id: 'count', name: 'Count' }
        ];

        // 시간 단위
        const chartLabTimeUnits = [
            { id: 'day', name: 'Day' },
            { id: 'week', name: 'Week' },
            { id: 'month', name: 'Month' },
            { id: 'quarter', name: 'Quarter' },
            { id: 'year', name: 'Year' }
        ];

        // 메인 차트랩 표시 함수
        function showChartLab() {
            // 사이드바 아이콘 활성화
            document.querySelectorAll('.icon-sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.icon-sidebar-item[title="차트랩"]').classList.add('active');

            // center-panel에 차트 편집 영역 렌더링
            const centerPanel = document.querySelector('.center-panel');
            centerPanel.innerHTML = renderChartLabUI();

            // right-panel에 차트 목록 렌더링
            const rightPanel = document.querySelector('.right-panel');
            rightPanel.style.display = 'block';
            rightPanel.innerHTML = renderChartLabListPanel();

            // 이벤트 리스너 등록
            attachChartLabEventListeners();

            // 모든 차트 렌더링
            chartLabCharts.filter(c => !c.collapsed).forEach(chart => {
                setTimeout(() => updateChartLabChartById(chart.id), 100);
            });
        }

        // UI 렌더링 (다중 차트 지원)
        function renderChartLabUI() {
            return `
                <div class="chartlab-container">
                    ${renderChartLabGlobalHeader()}
                    <div class="chartlab-scroll-container">
                        ${chartLabCharts.map(chart => renderChartLabBlock(chart)).join('')}
                        <button class="chartlab-add-chart-btn" onclick="addChartLabChart()" style="font-size: 12px; padding: 24px;">
                            + 새 차트 추가
                        </button>
                    </div>
                </div>
            `;
        }

        // 글로벌 헤더 렌더링
        function renderChartLabGlobalHeader() {
            return `
                <div class="chartlab-header">
                    <div class="chartlab-header-left">
                        <span style="font-size: 12px; color: var(--text-secondary);">
                            데이터를 시각화하여 인사이트를 발견하세요
                        </span>
                    </div>
                    <div class="chartlab-header-right">
                    </div>
                </div>
            `;
        }

        // 개별 차트 블록 렌더링 (Livedocs 스타일)
        function renderChartLabBlock(chart) {
            const ds = chartLabDataSources[chart.dataSource];
            const isActive = chart.id === chartLabActiveChartId;
            const chartType = chartLabChartTypes.find(t => t.id === chart.chartType);
            return `
                <div class="chartlab-chart-block ${chart.collapsed ? 'collapsed' : ''} ${isActive ? 'active' : ''}"
                     data-chart-id="${chart.id}" onclick="selectChartLabChart(${chart.id})">
                    <!-- Livedocs 스타일 헤더: Cell title + 데이터소스 -->
                    <div class="chartlab-block-header">
                        <div class="chartlab-block-title">
                            <input type="text" class="chartlab-block-title-input"
                                   value="${chart.style.title || '차트 #' + chart.id}"
                                   placeholder="차트 제목"
                                   onchange="handleChartLabTitleChangeById(${chart.id}, this.value)"
                                   onclick="event.stopPropagation()"
                                   style="font-size: 12px;">
                        </div>
                        <div class="chartlab-block-datasource">
                            <select class="chartlab-block-datasource-select"
                                    onchange="handleChartLabDataSourceChangeById(${chart.id}, this.value)"
                                    onclick="event.stopPropagation()"
                                    style="font-size: 11px;">
                                ${Object.entries(chartLabDataSources).map(([id, d]) => `
                                    <option value="${id}" ${chart.dataSource === id ? 'selected' : ''}>${d.name}</option>
                                `).join('')}
                            </select>
                            <div class="chartlab-block-actions">
                                <button class="chartlab-block-action-btn" onclick="event.stopPropagation(); toggleChartLabBlockCollapse(${chart.id})" title="${chart.collapsed ? '펼치기' : '접기'}" style="font-size: 10px;">
                                    ${chart.collapsed ? '▶' : '▼'}
                                </button>
                                <button class="chartlab-block-action-btn" onclick="event.stopPropagation(); duplicateChartLabChart(${chart.id})" title="복제" style="font-size: 10px;">복제</button>
                                <button class="chartlab-block-action-btn" onclick="event.stopPropagation(); exportChartLabChartById(${chart.id})" title="내보내기" style="font-size: 10px;">내보내기</button>
                                <button class="chartlab-block-action-btn chartlab-delete-btn" onclick="event.stopPropagation(); removeChartLabChart(${chart.id})" title="삭제" style="font-size: 10px;">삭제</button>
                            </div>
                        </div>
                    </div>
                    <div class="chartlab-block-body">
                        ${renderChartLabBlockSidebar(chart)}
                        ${renderChartLabBlockMain(chart)}
                    </div>
                </div>
            `;
        }

        // 차트 블록 사이드바 렌더링 (Livedocs Data/Style 탭)
        function renderChartLabBlockSidebar(chart) {
            const dataSource = chartLabDataSources[chart.dataSource];
            return `
                <div class="chartlab-block-sidebar">
                    <!-- Data/Style 토글 (Livedocs 스타일) -->
                    <div class="chartlab-tab-toggle">
                        <button class="chartlab-tab-toggle-btn ${chart.activeTab === 'data' ? 'active' : ''}"
                                onclick="event.stopPropagation(); switchChartLabTabById(${chart.id}, 'data')">데이터</button>
                        <button class="chartlab-tab-toggle-btn ${chart.activeTab === 'style' ? 'active' : ''}"
                                onclick="event.stopPropagation(); switchChartLabTabById(${chart.id}, 'style')">스타일</button>
                    </div>
                    <div class="chartlab-tab-content">
                        ${chart.activeTab === 'data' ? renderChartLabBlockDataTab(chart, dataSource) : renderChartLabBlockStyleTab(chart)}
                    </div>
                </div>
            `;
        }

        // Data 탭 렌더링 (차트별)
        function renderChartLabBlockDataTab(chart, dataSource) {
            if (!dataSource) dataSource = { fields: [], data: [] };
            return `
                ${renderChartLabBlockTypeSelector(chart)}
                ${renderChartLabBlockXAxis(chart, dataSource)}
                ${renderChartLabBlockYAxis(chart, dataSource)}
            `;
        }

        // 차트 유형 선택기 (차트별) - 커스텀 드롭다운
        function renderChartLabBlockTypeSelector(chart) {
            const currentType = chartLabChartTypes.find(t => t.id === chart.chartType);
            return `
                <div class="chartlab-section">
                    <div class="chartlab-section-header">
                        <div class="chartlab-section-title">차트 유형</div>
                    </div>
                    <div class="chartlab-section-content">
                        <div class="chartlab-custom-dropdown" data-chart-id="${chart.id}">
                            <div class="chartlab-dropdown-selected" onclick="event.stopPropagation(); toggleChartTypeDropdown(${chart.id})">
                                <span class="chartlab-dropdown-icon">${currentType.icon}</span>
                                <span class="chartlab-dropdown-text">${currentType.name}</span>
                                <svg class="chartlab-dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6,9 12,15 18,9"/>
                                </svg>
                            </div>
                            <div class="chartlab-dropdown-options">
                                ${chartLabChartTypes.map(type => `
                                    <div class="chartlab-dropdown-option ${chart.chartType === type.id ? 'selected' : ''}"
                                         onclick="event.stopPropagation(); selectChartType(${chart.id}, '${type.id}')">
                                        <span class="chartlab-dropdown-icon">${type.icon}</span>
                                        <span>${type.name}</span>
                                        ${chart.chartType === type.id ? `<svg class="chartlab-dropdown-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 커스텀 드롭다운 토글
        function toggleChartTypeDropdown(chartId) {
            const dropdown = document.querySelector(`.chartlab-custom-dropdown[data-chart-id="${chartId}"]`);
            if (dropdown) {
                // 다른 열린 드롭다운 닫기
                document.querySelectorAll('.chartlab-custom-dropdown.open').forEach(d => {
                    if (d !== dropdown) d.classList.remove('open');
                });
                dropdown.classList.toggle('open');
            }
        }

        // 차트 유형 선택
        function selectChartType(chartId, typeId) {
            handleChartLabChartTypeChangeById(chartId, typeId);
            const dropdown = document.querySelector(`.chartlab-custom-dropdown[data-chart-id="${chartId}"]`);
            if (dropdown) {
                dropdown.classList.remove('open');
            }
        }

        // 드롭다운 외부 클릭 시 닫기
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.chartlab-custom-dropdown')) {
                document.querySelectorAll('.chartlab-custom-dropdown.open').forEach(d => d.classList.remove('open'));
            }
        });

        // X축 설정 (차트별, Livedocs 스타일)
        function renderChartLabBlockXAxis(chart, dataSource) {
            const xField = dataSource.fields.find(f => f.id === chart.xAxis.field);
            const isDatetime = xField && xField.type === 'datetime';
            return `
                <div class="chartlab-section">
                    <div class="chartlab-section-header">
                        <div class="chartlab-section-title">X축</div>
                    </div>
                    <div class="chartlab-section-content">
                        <select class="chartlab-field-dropdown" onchange="handleChartLabXAxisChangeById(${chart.id}, this.value)" onclick="event.stopPropagation()">
                            <option value="">컬럼 선택...</option>
                            ${dataSource.fields.map(field => `
                                <option value="${field.id}" ${chart.xAxis.field === field.id ? 'selected' : ''}>${field.name} (${field.type})</option>
                            `).join('')}
                        </select>
                        ${chart.xAxis.field ? `
                            <!-- Scale type & Sort (Livedocs 스타일) -->
                            <div class="chartlab-axis-options">
                                <div class="chartlab-axis-option">
                                    <div class="chartlab-axis-option-label">스케일 유형</div>
                                    <select class="chartlab-axis-option-select" onchange="handleChartLabScaleTypeChange(${chart.id}, this.value)" onclick="event.stopPropagation()">
                                        <option value="linear" ${chart.xAxis.scaleType === 'linear' ? 'selected' : ''}>숫자</option>
                                        <option value="datetime" ${chart.xAxis.scaleType === 'datetime' ? 'selected' : ''}>날짜/시간</option>
                                    </select>
                                </div>
                                <div class="chartlab-axis-option">
                                    <div class="chartlab-axis-option-label">정렬</div>
                                    <select class="chartlab-axis-option-select" onchange="handleChartLabSortChange(${chart.id}, this.value)" onclick="event.stopPropagation()">
                                        <option value="ascending" ${chart.xAxis.sort === 'ascending' ? 'selected' : ''}>오름차순</option>
                                        <option value="descending" ${chart.xAxis.sort === 'descending' ? 'selected' : ''}>내림차순</option>
                                    </select>
                                </div>
                            </div>
                            ${isDatetime ? `
                                <div style="margin-top: 6px;">
                                    <div class="chartlab-axis-option-label">시간 단위</div>
                                    <select class="chartlab-axis-option-select" onchange="handleChartLabTimeUnitChangeById(${chart.id}, this.value)" onclick="event.stopPropagation()">
                                        ${chartLabTimeUnits.map(unit => `
                                            <option value="${unit.id}" ${chart.xAxis.timeUnit === unit.id ? 'selected' : ''}>${unit.name}</option>
                                        `).join('')}
                                    </select>
                                </div>
                            ` : ''}
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Y축 설정 (차트별, Livedocs 스타일)
        function renderChartLabBlockYAxis(chart, dataSource) {
            const hasXAxis = !!chart.xAxis.field;
            return `
                <div class="chartlab-section">
                    <div class="chartlab-section-header">
                        <div class="chartlab-section-title">Y축</div>
                        ${hasXAxis ? `<span class="chartlab-add-link" onclick="event.stopPropagation(); addChartLabYAxisById(${chart.id})">+ 추가</span>` : ''}
                    </div>
                    <div class="chartlab-section-content">
                        ${!hasXAxis ? `
                            <div class="chartlab-axis-hint">X축을 먼저 추가하세요</div>
                        ` : `
                            ${chart.yAxis.map((yConfig, idx) => {
                                const yField = dataSource.fields.find(f => f.id === yConfig.field);
                                return yConfig.field ? `
                                    <div class="chartlab-field-item">
                                        <div class="chartlab-field-info">
                                            <div class="chartlab-field-name">${yField ? yField.name : yConfig.field}</div>
                                            <div class="chartlab-field-meta">집계: ${yConfig.aggregate}</div>
                                        </div>
                                        <button class="chartlab-field-remove" onclick="event.stopPropagation(); removeChartLabYAxisById(${chart.id}, ${idx})">✕</button>
                                    </div>
                                    <select class="chartlab-field-dropdown" onchange="handleChartLabYAxisAggregateChangeById(${chart.id}, ${idx}, this.value)" onclick="event.stopPropagation()">
                                        ${chartLabAggregations.map(agg => `
                                            <option value="${agg.id}" ${yConfig.aggregate === agg.id ? 'selected' : ''}>${agg.name}</option>
                                        `).join('')}
                                    </select>
                                ` : `
                                    <select class="chartlab-field-dropdown" onchange="handleChartLabYAxisChangeById(${chart.id}, ${idx}, this.value)" onclick="event.stopPropagation()">
                                        <option value="">컬럼 선택...</option>
                                        ${dataSource.fields.filter(f => f.type === 'number').map(field => `
                                            <option value="${field.id}">${field.name}</option>
                                        `).join('')}
                                    </select>
                                `;
                            }).join('')}
                            <button class="chartlab-add-field-btn" onclick="event.stopPropagation(); addChartLabYAxisById(${chart.id})">
                                + 시리즈 추가
                            </button>
                        `}
                    </div>
                </div>
            `;
        }

        // Color by 설정 (차트별)
        function renderChartLabBlockColorBy(chart, dataSource) {
            const colorField = dataSource.fields.find(f => f.id === chart.colorBy.field);
            return `
                <div class="chartlab-section">
                    <div class="chartlab-section-header">
                        <div class="chartlab-section-title">색상 기준</div>
                    </div>
                    <div class="chartlab-section-content">
                        ${chart.colorBy.field ? `
                            <div class="chartlab-field-item">
                                <div class="chartlab-field-info">
                                    <div class="chartlab-field-name">${colorField ? colorField.name : chart.colorBy.field}</div>
                                    <div class="chartlab-field-meta">시리즈</div>
                                </div>
                                <button class="chartlab-field-remove" onclick="event.stopPropagation(); removeChartLabColorByById(${chart.id})">✕</button>
                            </div>
                        ` : `
                            <select class="chartlab-field-dropdown" onchange="handleChartLabColorByChangeById(${chart.id}, this.value)" onclick="event.stopPropagation()">
                                <option value="">컬럼 선택...</option>
                                ${dataSource.fields.filter(f => f.type === 'string').map(field => `
                                    <option value="${field.id}">${field.name}</option>
                                `).join('')}
                            </select>
                        `}
                    </div>
                </div>
            `;
        }

        // Style 탭 렌더링 (차트별, Livedocs 아코디언)
        function renderChartLabBlockStyleTab(chart) {
            return `
                <!-- General 섹션 -->
                <div class="chartlab-style-accordion">
                    <div class="chartlab-style-accordion-header" onclick="event.stopPropagation(); toggleStyleAccordion(this)">
                        <span style="font-size: 11px;">일반</span>
                        <svg class="chartlab-accordion-icon" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="chartlab-style-accordion-content">
                        <div class="chartlab-style-row">
                            <span class="chartlab-style-label" style="margin-bottom: 0; font-size: 10px;">글꼴 크기</span>
                            <input type="number" class="chartlab-style-number-input" value="${chart.style.fontSize || 10}"
                                   onchange="handleChartLabFontSizeChange(${chart.id}, this.value)" onclick="event.stopPropagation()" min="8" max="24" style="font-size: 10px;">
                        </div>
                    </div>
                </div>

                <!-- 색상 팔레트 섹션 -->
                <div class="chartlab-style-accordion">
                    <div class="chartlab-style-accordion-header" onclick="event.stopPropagation(); toggleStyleAccordion(this)">
                        <span style="font-size: 11px;">색상</span>
                        <svg class="chartlab-accordion-icon" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="chartlab-style-accordion-content">
                        <div class="chartlab-color-palette">
                            ${chart.style.colors.map((color, idx) => `
                                <div class="chartlab-color-swatch"
                                    style="background: ${color}; width: 24px; height: 24px;"
                                    onclick="event.stopPropagation(); editChartLabColorById(${chart.id}, ${idx})"
                                    title="${color}">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <!-- Legend 섹션 -->
                <div class="chartlab-style-accordion ${chart.style.legendPosition !== 'none' ? '' : 'collapsed'}">
                    <div class="chartlab-style-accordion-header" style="cursor: default;">
                        <span style="font-size: 11px;">범례</span>
                        <label class="chartlab-toggle" onclick="event.stopPropagation()">
                            <input type="checkbox"
                                   ${chart.style.legendPosition !== 'none' ? 'checked' : ''}
                                   onchange="handleChartLabLegendToggle(${chart.id}, this.checked)"
                                   onclick="event.stopPropagation()">
                            <span class="chartlab-toggle-slider"></span>
                        </label>
                    </div>
                    <div class="chartlab-style-accordion-content" style="${chart.style.legendPosition !== 'none' ? '' : 'display: none;'}">
                        <div class="chartlab-style-row">
                            <span class="chartlab-style-label" style="font-size: 10px;">위치</span>
                            <select class="chartlab-mini-dropdown" onchange="handleChartLabLegendPositionChangeById(${chart.id}, this.value)" onclick="event.stopPropagation()">
                                <option value="right" ${chart.style.legendPosition === 'right' ? 'selected' : ''}>오른쪽</option>
                                <option value="bottom" ${chart.style.legendPosition === 'bottom' ? 'selected' : ''}>아래</option>
                                <option value="top" ${chart.style.legendPosition === 'top' ? 'selected' : ''}>위</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Tooltip 섹션 -->
                <div class="chartlab-style-accordion">
                    <div class="chartlab-style-accordion-header" style="cursor: default;">
                        <span style="font-size: 11px;">툴팁</span>
                        <label class="chartlab-toggle" onclick="event.stopPropagation()">
                            <input type="checkbox"
                                   ${chart.style.showTooltip ? 'checked' : ''}
                                   onchange="handleChartLabTooltipToggle(${chart.id}, this.checked)"
                                   onclick="event.stopPropagation()">
                            <span class="chartlab-toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- 이상치 섹션 -->
                <div class="chartlab-style-accordion">
                    <div class="chartlab-style-accordion-header" style="cursor: default;">
                        <span style="font-size: 11px;">이상치</span>
                        <label class="chartlab-toggle" onclick="event.stopPropagation()">
                            <input type="checkbox"
                                   ${chart.style.showOutliers ? 'checked' : ''}
                                   onchange="handleChartLabOutlierToggle(${chart.id}, this.checked)"
                                   onclick="event.stopPropagation()">
                            <span class="chartlab-toggle-slider"></span>
                        </label>
                    </div>
                </div>
            `;
        }

        // Style 아코디언 토글
        function toggleStyleAccordion(header) {
            header.parentElement.classList.toggle('collapsed');
        }

        // 이상치 표시 토글 핸들러
        function handleChartLabOutlierToggle(chartId, show) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.style.showOutliers = show;
            updateChartLabChartById(chartId);
        }

        // 툴팁 표시 토글 핸들러
        function handleChartLabTooltipToggle(chartId, show) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.style.showTooltip = show;
            updateChartLabChartById(chartId);
        }

        // 차트 블록 메인 영역 렌더링
        function renderChartLabBlockMain(chart) {
            return `
                <div class="chartlab-block-main">
                    <div class="chartlab-block-chart-wrapper">
                        ${chart.style.title ? `<div class="chartlab-chart-title">${chart.style.title}</div>` : ''}
                        <div id="chartlab-chart-${chart.id}" style="flex: 1; min-height: 140px;"></div>
                    </div>
                </div>
            `;
        }

        // 우측 패널 (차트 목록) 렌더링
        function renderChartLabListPanel() {
            // 최근 작업 차트 (현재 세션의 차트들)
            const recentCharts = chartLabCharts;

            // 저장된 차트 (샘플 데이터)
            const savedCharts = [
                { id: 'saved-1', title: '삼성전자 2024년 실적 전망', dataSource: '재무 데이터' },
                { id: 'saved-2', title: 'LG화학 매출액 분석 보고서', dataSource: '매출 데이터' },
                { id: 'saved-3', title: '반도체 vs 배터리 산업 비교', dataSource: '산업 데이터' },
                { id: 'saved-4', title: '네이버 분기별 성장률 추이', dataSource: '성장 데이터' }
            ];

            return `
                <div class="chartlab-list-panel" style="display: flex; flex-direction: column; height: 100%;">
                    <!-- 최근 작업한 차트 섹션 (1/3) -->
                    <div class="chartlab-list-section" style="flex: 1; min-height: 0; overflow: hidden; display: flex; flex-direction: column;">
                        <div class="chartlab-list-header" style="flex-shrink: 0;">
                            <span>최근 작업한 차트</span>
                            <span style="color: var(--text-muted); font-size: 11px;">${recentCharts.length}개</span>
                        </div>
                        <div class="chartlab-list-content" style="flex: 1; overflow-y: auto;">
                            ${recentCharts.map(chart => renderChartLabListItem(chart)).join('')}
                        </div>
                    </div>

                    <!-- 저장된 차트 섹션 (1/3) -->
                    <div class="chartlab-list-section" style="flex: 1; min-height: 0; overflow: hidden; display: flex; flex-direction: column; border-top: 1px solid var(--border-color);">
                        <div class="chartlab-list-header" style="flex-shrink: 0;">
                            <span>저장된 차트</span>
                            <span style="color: var(--text-muted); font-size: 11px;">${savedCharts.length}개</span>
                        </div>
                        <div class="chartlab-list-content" style="flex: 1; overflow-y: auto;">
                            ${savedCharts.map(chart => renderSavedChartItem(chart)).join('')}
                        </div>
                    </div>

                    <!-- 미리보기 섹션 (1/3) -->
                    ${renderChartLabPreviewSection()}
                </div>
            `;
        }

        // 저장된 차트 아이템 렌더링
        function renderSavedChartItem(chart) {
            const isActive = chartLabPreviewId === chart.id && chartLabPreviewType === 'saved';
            return `
                <div class="chartlab-list-item ${isActive ? 'active' : ''}" style="padding: 10px; cursor: pointer;" onclick="showChartLabPreview('${chart.id}', 'saved')">
                    <div class="chartlab-list-item-title" style="font-size: 11px; display: flex; justify-content: space-between; align-items: center;">
                        <span>${chart.title}</span>
                        <button class="chartlab-block-action-btn chartlab-delete-btn"
                                onclick="event.stopPropagation(); alert('저장된 차트 삭제: ${chart.title}')"
                                title="삭제" style="font-size: 10px; padding: 2px 6px;">삭제</button>
                    </div>
                    <div class="chartlab-list-item-meta" style="font-size: 10px; margin-top: 4px;">
                        ${chart.dataSource}
                    </div>
                </div>
            `;
        }

        // 차트 목록 아이템 렌더링
        function renderChartLabListItem(chart) {
            const isActive = chartLabPreviewId === chart.id && chartLabPreviewType === 'recent';
            return `
                <div class="chartlab-list-item ${isActive ? 'active' : ''}" style="padding: 10px; cursor: pointer;" onclick="selectChartLabChart(${chart.id})">
                    <div class="chartlab-list-item-title" style="font-size: 11px; display: flex; justify-content: space-between; align-items: center;">
                        <span>${chart.style.title || '차트 #' + chart.id}</span>
                        <button class="chartlab-block-action-btn chartlab-delete-btn"
                                onclick="event.stopPropagation(); removeChartLabChart(${chart.id})"
                                title="삭제" style="font-size: 10px; padding: 2px 6px;">삭제</button>
                    </div>
                    <div class="chartlab-list-item-meta" style="font-size: 10px; margin-top: 4px;">
                        ${chartLabDataSources[chart.dataSource]?.name || chart.dataSource || '데이터 소스 미선택'}
                    </div>
                </div>
            `;
        }

        // 차트 선택
        function selectChartLabChart(chartId) {
            chartLabActiveChartId = chartId;
            showChartLabPreview(chartId, 'recent');
            refreshChartLabUI();
            setTimeout(() => {
                const block = document.querySelector(`[data-chart-id="${chartId}"]`);
                if (block) {
                    block.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        // 미리보기 섹션 렌더링
        function renderChartLabPreviewSection() {
            return `
                <div class="chartlab-preview-section">
                    <div class="chartlab-preview-header">
                        <span>미리보기</span>
                        ${chartLabPreviewId ? `<span style="font-size: 10px; color: var(--text-muted);">${chartLabPreviewType === 'recent' ? '최근 차트' : '저장된 차트'}</span>` : ''}
                    </div>
                    <div class="chartlab-preview-content">
                        ${chartLabPreviewId
                            ? `<div id="chartlab-panel-preview" class="chartlab-preview-chart"></div>`
                            : `<div class="chartlab-preview-empty">차트를 선택하세요</div>`
                        }
                    </div>
                </div>
            `;
        }

        // 미리보기 표시
        function showChartLabPreview(chartId, type) {
            chartLabPreviewId = chartId;
            chartLabPreviewType = type;

            // 우측 패널 다시 렌더링
            const listPanel = document.querySelector('.chartlab-list-panel');
            if (listPanel) {
                listPanel.outerHTML = renderChartLabListPanel();
            }

            // 미리보기 차트 렌더링
            setTimeout(() => {
                updateChartLabPreview();
            }, 50);
        }

        // 미리보기 차트 업데이트
        function updateChartLabPreview() {
            const container = document.getElementById('chartlab-panel-preview');
            if (!container) return;

            if (chartLabPreviewType === 'recent') {
                // 최근 차트: chartLabCharts에서 찾기
                const chart = chartLabCharts.find(c => c.id === chartLabPreviewId);
                if (chart && chart.dataSource) {
                    const options = buildChartLabHighchartsOptions(chart);
                    // 미리보기용으로 일부 옵션 조정
                    options.chart = options.chart || {};
                    options.chart.height = null;
                    options.title = { text: null };
                    options.legend = { enabled: false };
                    options.credits = { enabled: false };
                    options.colors = ['#F4D03F', '#5ECEC1', '#5DADE2', '#E891B0'];
                    options.plotOptions = options.plotOptions || {};
                    options.plotOptions.column = { ...(options.plotOptions.column || {}), borderWidth: 0 };
                    options.plotOptions.bar = { ...(options.plotOptions.bar || {}), borderWidth: 0 };
                    Highcharts.chart('chartlab-panel-preview', options);
                } else {
                    container.innerHTML = '<div class="chartlab-preview-empty">데이터 소스를 선택하세요</div>';
                }
            } else if (chartLabPreviewType === 'saved') {
                // 저장된 차트: 샘플 차트 표시
                renderSavedChartPreview(container, chartLabPreviewId);
            }
        }

        // 저장된 차트 미리보기 렌더링
        function renderSavedChartPreview(container, savedChartId) {
            // 저장된 차트별 샘플 데이터로 차트 렌더링
            const sampleData = {
                'saved-1': {
                    type: 'column',
                    categories: ['1Q', '2Q', '3Q', '4Q'],
                    series: [
                        { name: '매출', data: [65, 72, 78, 85] },
                        { name: '영업이익', data: [28, 35, 32, 42] },
                        { name: '순이익', data: [18, 22, 20, 28] },
                        { name: '현금흐름', data: [12, 15, 18, 22] }
                    ]
                },
                'saved-2': {
                    type: 'line',
                    categories: ['1월', '2월', '3월', '4월', '5월'],
                    series: [
                        { name: 'LG화학', data: [30, 35, 42, 38, 45] },
                        { name: '삼성SDI', data: [25, 28, 35, 40, 38] },
                        { name: 'SK이노', data: [20, 22, 28, 32, 35] },
                        { name: '포스코퓨처엠', data: [15, 18, 22, 25, 30] }
                    ]
                },
                'saved-3': {
                    type: 'bar',
                    categories: ['시장점유율', '성장률', '영업이익'],
                    series: [
                        { name: '반도체', data: [45, 12, 28] },
                        { name: '배터리', data: [32, 25, 18] },
                        { name: '디스플레이', data: [22, 8, 15] },
                        { name: '바이오', data: [18, 15, 12] }
                    ]
                },
                'saved-4': {
                    type: 'area',
                    categories: ['1Q', '2Q', '3Q', '4Q'],
                    series: [
                        { name: '네이버', data: [8, 12, 15, 18] },
                        { name: '카카오', data: [6, 9, 11, 14] },
                        { name: '쿠팡', data: [4, 7, 10, 12] },
                        { name: '배민', data: [3, 5, 7, 9] }
                    ]
                }
            };

            const data = sampleData[savedChartId];
            if (!data) {
                container.innerHTML = '<div class="chartlab-preview-empty">미리보기 없음</div>';
                return;
            }

            Highcharts.chart(container, {
                chart: { type: data.type, height: null, backgroundColor: 'transparent' },
                title: { text: null },
                colors: ['#FFAB91', '#5ECEC1', '#5DADE2', '#E891B0'],
                xAxis: { categories: data.categories, labels: { style: { fontSize: '9px', color: '#888' } } },
                yAxis: { title: { text: null }, labels: { style: { fontSize: '9px', color: '#888' } } },
                legend: { enabled: false },
                credits: { enabled: false },
                plotOptions: {
                    series: { animation: false },
                    column: { borderWidth: 0 },
                    bar: { borderWidth: 0 }
                },
                series: data.series
            });
        }

        // === 차트 관리 함수들 ===

        // 차트 추가 (빈 차트 바로 생성)
        function addChartLabChart() {
            const newChart = createChartLabChartState(chartLabNextId++);
            newChart.dataSource = '';  // 데이터 소스 미선택 상태
            newChart.xAxis.field = '';
            newChart.yAxis = [{ field: '', aggregate: 'sum' }];
            newChart.colorBy = { field: '' };
            chartLabCharts.push(newChart);
            chartLabActiveChartId = newChart.id;
            refreshChartLabUI();
            setTimeout(() => {
                const block = document.querySelector(`[data-chart-id="${newChart.id}"]`);
                if (block) block.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // 데이터소스 선택 모달 표시
        function showDataSourceModal(chartId) {
            // 샘플 데이터프레임 목록
            const dataframes = [
                { id: 'results', name: 'results' },
                { id: 'sales_data', name: 'sales_data' },
                { id: 'dataframe_2', name: 'dataframe_2' },
                { id: 'dataframe_0', name: 'dataframe_0' }
            ];

            const modal = document.createElement('div');
            modal.className = 'chartlab-datasource-modal';
            modal.onclick = (e) => { if (e.target === modal) closeDataSourceModal(); };
            modal.innerHTML = `
                <div class="chartlab-datasource-modal-content">
                    <div class="chartlab-ds-search">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" placeholder="Search..." id="dsSearchInput" oninput="filterDataSourceItems(this.value)" autofocus>
                    </div>
                    <div class="chartlab-ds-sections">
                        <!-- DATA SOURCES -->
                        <div class="chartlab-ds-section" data-section="datasources">
                            <div class="chartlab-ds-section-title">DATA SOURCES</div>
                            ${Object.entries(chartLabDataSources).map(([id, ds]) => `
                                <div class="chartlab-ds-item" onclick="selectDataSourceForChart(${chartId}, '${id}')" data-name="${ds.name.toLowerCase()}">
                                    <span class="chartlab-ds-item-icon">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                            <rect x="4" y="4" width="3" height="16" rx="0.5"/>
                                            <rect x="10" y="8" width="3" height="12" rx="0.5"/>
                                            <rect x="16" y="6" width="3" height="14" rx="0.5"/>
                                        </svg>
                                    </span>
                                    <span>${ds.name}</span>
                                </div>
                            `).join('')}
                        </div>
                        <!-- DATAFRAMES -->
                        <div class="chartlab-ds-section" data-section="dataframes">
                            <div class="chartlab-ds-section-title">DATAFRAMES</div>
                            ${dataframes.map(df => `
                                <div class="chartlab-ds-item" onclick="selectDataSourceForChart(${chartId}, 'sample_sales')" data-name="${df.name.toLowerCase()}">
                                    <span class="chartlab-ds-item-icon">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                                            <line x1="3" y1="9" x2="21" y2="9"/>
                                            <line x1="9" y1="21" x2="9" y2="9"/>
                                        </svg>
                                    </span>
                                    <span>${df.name}</span>
                                </div>
                            `).join('')}
                        </div>
                        <!-- FILES -->
                        <div class="chartlab-ds-section" data-section="files">
                            <div class="chartlab-ds-section-title">FILES</div>
                            <div class="chartlab-ds-item" onclick="alert('파일 탐색 기능 준비 중')" data-name="workspace files">
                                <span class="chartlab-ds-item-icon">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </span>
                                <span>Workspace Files</span>
                                <span class="chartlab-ds-item-arrow">›</span>
                            </div>
                            <div class="chartlab-ds-item" onclick="alert('파일 탐색 기능 준비 중')" data-name="local files">
                                <span class="chartlab-ds-item-icon">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </span>
                                <span>Local Files</span>
                                <span class="chartlab-ds-item-arrow">›</span>
                            </div>
                        </div>
                    </div>
                    <div class="chartlab-ds-footer">
                        <div class="chartlab-ds-footer-item">
                            <span class="chartlab-ds-footer-key">↑</span>
                            <span class="chartlab-ds-footer-key">↓</span>
                            <span>NAVIGATE</span>
                        </div>
                        <div class="chartlab-ds-footer-item">
                            <span class="chartlab-ds-footer-key">↵</span>
                            <span>SELECT</span>
                        </div>
                        <div class="chartlab-ds-footer-item">
                            <span class="chartlab-ds-footer-key">ESC</span>
                            <span>CLOSE</span>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // ESC 키로 닫기
            const handleKeydown = (e) => {
                if (e.key === 'Escape') {
                    closeDataSourceModal();
                    document.removeEventListener('keydown', handleKeydown);
                }
            };
            document.addEventListener('keydown', handleKeydown);
        }

        // 데이터소스 검색 필터
        function filterDataSourceItems(query) {
            const items = document.querySelectorAll('.chartlab-ds-item');
            const lowerQuery = query.toLowerCase();
            items.forEach(item => {
                const name = item.dataset.name || '';
                item.style.display = name.includes(lowerQuery) ? '' : 'none';
            });
        }

        // 차트에 데이터소스 선택
        function selectDataSourceForChart(chartId, dataSourceId) {
            closeDataSourceModal();
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.dataSource = dataSourceId;
            chart.xAxis.field = '';
            chart.yAxis = [{ field: '', aggregate: 'sum' }];
            chart.colorBy = { field: '' };
            refreshChartLabUI();
            setTimeout(() => updateChartLabChartById(chartId), 100);
        }

        // 데이터소스 선택 모달 닫기
        function closeDataSourceModal() {
            const modal = document.querySelector('.chartlab-datasource-modal');
            if (modal) modal.remove();
        }

        // 차트 삭제
        function removeChartLabChart(chartId) {
            if (!confirm('이 차트를 삭제하시겠습니까?')) return;
            chartLabCharts = chartLabCharts.filter(c => c.id !== chartId);

            // 마지막 차트 삭제 시 빈 상태로 전환
            if (chartLabCharts.length === 0) {
                chartLabActiveChartId = null;
            } else if (chartLabActiveChartId === chartId) {
                chartLabActiveChartId = chartLabCharts[0].id;
            }
            refreshChartLabUI();
        }

        // 차트 복제
        function duplicateChartLabChart(chartId) {
            const source = getChartLabChart(chartId);
            if (!source) return;
            const newChart = JSON.parse(JSON.stringify(source));
            newChart.id = chartLabNextId++;
            newChart.style.title = (source.style.title || 'Chart #' + source.id) + ' (복사본)';
            chartLabCharts.push(newChart);
            chartLabActiveChartId = newChart.id;
            refreshChartLabUI();
            setTimeout(() => updateChartLabChartById(newChart.id), 100);
        }

        // 차트 블록 접기/펼치기
        function toggleChartLabBlockCollapse(chartId) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.collapsed = !chart.collapsed;
            refreshChartLabUI();
            if (!chart.collapsed) {
                setTimeout(() => updateChartLabChartById(chartId), 100);
            }
        }

        // UI 전체 새로고침
        function refreshChartLabUI() {
            const centerPanel = document.querySelector('.center-panel');
            const rightPanel = document.querySelector('.right-panel');
            if (centerPanel) centerPanel.innerHTML = renderChartLabUI();
            if (rightPanel) rightPanel.innerHTML = renderChartLabListPanel();
            attachChartLabEventListeners();
            chartLabCharts.filter(c => !c.collapsed).forEach(chart => {
                setTimeout(() => updateChartLabChartById(chart.id), 100);
            });
        }

        // 특정 차트 블록 사이드바 새로고침
        function refreshChartLabBlockSidebar(chartId) {
            const block = document.querySelector(`[data-chart-id="${chartId}"]`);
            if (!block) return;
            const chart = getChartLabChart(chartId);
            const sidebar = block.querySelector('.chartlab-block-sidebar');
            if (sidebar && chart) {
                sidebar.outerHTML = renderChartLabBlockSidebar(chart);
            }
            attachChartLabEventListeners();
        }

        // 우측 패널만 새로고침
        function refreshChartLabListPanel() {
            const rightPanel = document.querySelector('.right-panel');
            if (rightPanel) rightPanel.innerHTML = renderChartLabListPanel();
        }

        // === ID 기반 핸들러 함수들 ===

        // 데이터소스 변경 (차트별)
        function handleChartLabDataSourceChangeById(chartId, sourceId) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.dataSource = sourceId;
            // 필드 초기화
            const ds = chartLabDataSources[sourceId];
            if (ds.fields.length > 0) {
                const dateField = ds.fields.find(f => f.type === 'datetime');
                const numField = ds.fields.find(f => f.type === 'number');
                const strField = ds.fields.find(f => f.type === 'string');
                chart.xAxis.field = dateField ? dateField.id : (ds.fields[0] ? ds.fields[0].id : null);
                chart.yAxis = [{ field: numField ? numField.id : null, aggregate: 'sum' }];
                chart.colorBy.field = strField ? strField.id : null;
            } else {
                chart.xAxis.field = null;
                chart.yAxis = [{ field: null, aggregate: 'sum' }];
                chart.colorBy.field = null;
            }
            chart.filters = [];
            refreshChartLabBlockSidebar(chartId);
            updateChartLabChartById(chartId);
            refreshChartLabListPanel();
        }

        // 차트 유형 변경 (차트별)
        function handleChartLabChartTypeChangeById(chartId, type) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.chartType = type;
            updateChartLabChartById(chartId);
            refreshChartLabListPanel();
        }

        // X축 변경 (차트별)
        function handleChartLabXAxisChangeById(chartId, fieldId) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.xAxis.field = fieldId || null;
            const ds = chartLabDataSources[chart.dataSource];
            const field = ds.fields.find(f => f.id === fieldId);
            chart.xAxis.scaleType = field && field.type === 'datetime' ? 'datetime' : 'linear';
            refreshChartLabBlockSidebar(chartId);
            updateChartLabChartById(chartId);
        }

        // Scale type 변경 (차트별)
        function handleChartLabScaleTypeChange(chartId, scaleType) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.xAxis.scaleType = scaleType;
            updateChartLabChartById(chartId);
        }

        // Sort 변경 (차트별)
        function handleChartLabSortChange(chartId, sort) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.xAxis.sort = sort;
            updateChartLabChartById(chartId);
        }

        // 시간 단위 변경 (차트별)
        function handleChartLabTimeUnitChangeById(chartId, unit) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.xAxis.timeUnit = unit;
            updateChartLabChartById(chartId);
        }

        // Y축 추가 (차트별)
        function addChartLabYAxisById(chartId) {
            const chart = getChartLabChart(chartId);
            if (!chart || !chart.xAxis.field) return;
            chart.yAxis.push({ field: null, aggregate: 'sum' });
            refreshChartLabBlockSidebar(chartId);
        }

        // Y축 변경 (차트별)
        function handleChartLabYAxisChangeById(chartId, index, fieldId) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.yAxis[index].field = fieldId || null;
            refreshChartLabBlockSidebar(chartId);
            updateChartLabChartById(chartId);
        }

        // Y축 집계 변경 (차트별)
        function handleChartLabYAxisAggregateChangeById(chartId, index, aggregate) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.yAxis[index].aggregate = aggregate;
            updateChartLabChartById(chartId);
        }

        // Y축 제거 (차트별)
        function removeChartLabYAxisById(chartId, index) {
            const chart = getChartLabChart(chartId);
            if (!chart || chart.yAxis.length <= 1) return;
            chart.yAxis.splice(index, 1);
            refreshChartLabBlockSidebar(chartId);
            updateChartLabChartById(chartId);
        }

        // Color by 변경 (차트별)
        function handleChartLabColorByChangeById(chartId, fieldId) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.colorBy.field = fieldId || null;
            refreshChartLabBlockSidebar(chartId);
            updateChartLabChartById(chartId);
        }

        // Color by 제거 (차트별)
        function removeChartLabColorByById(chartId) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.colorBy.field = null;
            refreshChartLabBlockSidebar(chartId);
            updateChartLabChartById(chartId);
        }

        // 탭 전환 (차트별)
        function switchChartLabTabById(chartId, tab) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.activeTab = tab;
            refreshChartLabBlockSidebar(chartId);
        }

        // 제목 변경 (차트별)
        function handleChartLabTitleChangeById(chartId, title) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.style.title = title;
            // 차트 영역의 제목도 업데이트
            const block = document.querySelector(`[data-chart-id="${chartId}"]`);
            if (block) {
                const titleEl = block.querySelector('.chartlab-chart-title');
                if (titleEl) {
                    titleEl.textContent = title;
                } else if (title) {
                    const wrapper = block.querySelector('.chartlab-block-chart-wrapper');
                    if (wrapper) {
                        const chartEl = wrapper.querySelector(`#chartlab-chart-${chartId}`);
                        if (chartEl) {
                            const newTitleEl = document.createElement('div');
                            newTitleEl.className = 'chartlab-chart-title';
                            newTitleEl.textContent = title;
                            wrapper.insertBefore(newTitleEl, chartEl);
                        }
                    }
                }
            }
            refreshChartLabListPanel();
        }

        // 폰트 크기 변경 (차트별)
        function handleChartLabFontSizeChange(chartId, size) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.style.fontSize = parseInt(size) || 10;
            updateChartLabChartById(chartId);
        }

        // 범례 위치 변경 (차트별)
        function handleChartLabLegendPositionChangeById(chartId, position) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            chart.style.legendPosition = position;
            updateChartLabChartById(chartId);
        }

        // 범례 토글 (차트별)
        function handleChartLabLegendToggle(chartId, enabled) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            if (enabled) {
                // 켜면 이전 위치 또는 기본값 'right'
                chart.style.legendPosition = chart.style._lastLegendPosition || 'right';
            } else {
                // 끄면 현재 위치 저장 후 'none'
                chart.style._lastLegendPosition = chart.style.legendPosition;
                chart.style.legendPosition = 'none';
            }
            refreshChartLabBlockSidebar(chartId);
            updateChartLabChartById(chartId);
        }

        // 색상 편집 (차트별)
        function editChartLabColorById(chartId, index) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;
            const newColor = prompt('새 색상 (HEX 형식):', chart.style.colors[index]);
            if (newColor && /^#[0-9A-Fa-f]{6}$/.test(newColor)) {
                chart.style.colors[index] = newColor;
                refreshChartLabBlockSidebar(chartId);
                updateChartLabChartById(chartId);
            }
        }

        // 차트 내보내기 (차트별)
        function exportChartLabChartById(chartId) {
            const charts = Highcharts.charts.filter(c => c && c.renderTo && c.renderTo.id === `chartlab-chart-${chartId}`);
            if (charts.length > 0) {
                charts[0].exportChart({ type: 'image/png' });
            } else {
                showChartLabToast('내보낼 차트가 없습니다.', 'error');
            }
        }

        // 모든 차트 내보내기
        function exportAllChartLabCharts() {
            const chart = Highcharts.charts.find(c => c && c.renderTo && c.renderTo.id && c.renderTo.id.startsWith('chartlab-chart-'));
            if (chart) {
                chart.exportChart({ type: 'image/png' });
            } else {
                showChartLabToast('내보낼 차트가 없습니다.', 'error');
            }
        }

        // 특정 차트 업데이트
        function updateChartLabChartById(chartId) {
            const chart = getChartLabChart(chartId);
            if (!chart) return;

            const chartEl = document.getElementById(`chartlab-chart-${chartId}`);
            if (!chartEl) return;

            const ds = chartLabDataSources[chart.dataSource];

            // 데이터 소스가 선택되지 않은 경우
            if (!ds) {
                chartEl.innerHTML = `
                    <div class="chartlab-empty-state" style="cursor: pointer;" onclick="showDataSourceModal(${chartId})">
                        <svg class="chartlab-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        <div class="chartlab-empty-text" style="text-decoration: underline;">Start by selecting a data source</div>
                        <div class="chartlab-empty-hint">클릭하여 데이터 소스를 선택하세요</div>
                    </div>
                `;
                return;
            }

            // X축이 선택되지 않은 경우
            if (!ds.data || ds.data.length === 0 || !chart.xAxis.field) {
                chartEl.innerHTML = `
                    <div class="chartlab-empty-state">
                        <svg class="chartlab-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        <div class="chartlab-empty-text">차트 구성을 완료하세요</div>
                        <div class="chartlab-empty-hint">좌측 패널에서 X축, Y축 필드를 선택하세요</div>
                    </div>
                `;
                return;
            }

            // 차트 렌더링
            const processedData = processChartLabData(ds.data, chart);
            const options = buildHighchartsOptions(chart, processedData);
            Highcharts.chart(`chartlab-chart-${chartId}`, options);
        }

        // 헤더 렌더링 (하위 호환성 유지)
        function renderChartLabHeader() {
            const dataSource = chartLabDataSources[chartLabState.dataSource];
            return `
                <div class="chartlab-header">
                    <div class="chartlab-header-left">
                        <select class="chartlab-datasource-select" id="chartlabDataSource" onchange="handleChartLabDataSourceChange(this.value)">
                            ${Object.entries(chartLabDataSources).map(([id, ds]) => `
                                <option value="${id}" ${chartLabState.dataSource === id ? 'selected' : ''}>${ds.name}</option>
                            `).join('')}
                        </select>
                        <div class="chartlab-filter-chips">
                            ${chartLabState.filters.map((filter, idx) => `
                                <div class="chartlab-filter-chip">
                                    ${filter.field} ${filter.operator} ${filter.value}
                                    <span class="remove-btn" onclick="removeChartLabFilter(${idx})">✕</span>
                                </div>
                            `).join('')}
                            <button class="chartlab-add-filter-btn" onclick="showChartLabFilterModal()">
                                + 필터 추가
                            </button>
                        </div>
                    </div>
                    <div class="chartlab-header-right">
                        <button class="chartlab-btn chartlab-btn-secondary" onclick="saveChartLabConfig()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                            저장
                        </button>
                        <button class="chartlab-btn chartlab-btn-primary" onclick="exportChartLabAsImage()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            이미지 내보내기
                        </button>
                    </div>
                </div>
            `;
        }

        // 사이드바 렌더링
        function renderChartLabSidebar() {
            const dataSource = chartLabDataSources[chartLabState.dataSource];
            return `
                <div class="chartlab-sidebar">
                    ${renderChartLabTypeSelector()}
                    ${renderChartLabTabs()}
                    <div class="chartlab-tab-content">
                        ${chartLabState.activeTab === 'data' ? renderChartLabDataTab(dataSource) : renderChartLabStyleTab()}
                    </div>
                </div>
            `;
        }

        // 차트 유형 선택기
        function renderChartLabTypeSelector() {
            const currentType = chartLabChartTypes.find(t => t.id === chartLabState.chartType);
            return `
                <div class="chartlab-type-selector">
                    <div class="chartlab-type-label">Type</div>
                    <select class="chartlab-type-dropdown" id="chartlabChartType" onchange="handleChartLabChartTypeChange(this.value)">
                        ${chartLabChartTypes.map(type => `
                            <option value="${type.id}" ${chartLabState.chartType === type.id ? 'selected' : ''}>
                                ${type.icon} ${type.name}
                            </option>
                        `).join('')}
                    </select>
                </div>
            `;
        }

        // 탭 렌더링
        function renderChartLabTabs() {
            return `
                <div class="chartlab-tabs">
                    <button class="chartlab-tab ${chartLabState.activeTab === 'data' ? 'active' : ''}" onclick="switchChartLabTab('data')">Data</button>
                    <button class="chartlab-tab ${chartLabState.activeTab === 'style' ? 'active' : ''}" onclick="switchChartLabTab('style')">Style</button>
                </div>
            `;
        }

        // Data 탭 렌더링
        function renderChartLabDataTab(dataSource) {
            return `
                ${renderChartLabUploadArea()}
                ${renderChartLabXAxis(dataSource)}
                ${renderChartLabYAxis(dataSource)}
                ${renderChartLabColorBy(dataSource)}
                ${renderChartLabFaceting(dataSource)}
                ${renderChartLabTooltips(dataSource)}
            `;
        }

        // 파일 업로드 영역
        function renderChartLabUploadArea() {
            return `
                <div class="chartlab-upload-area">
                    <div class="chartlab-upload-dropzone" id="chartlabDropzone">
                        <svg class="chartlab-upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <div class="chartlab-upload-text">파일을 드래그하거나 클릭하여 업로드</div>
                        <div class="chartlab-upload-hint">CSV, JSON 파일 지원</div>
                        <input type="file" id="chartlabFileInput" accept=".csv,.json" style="display:none" onchange="handleChartLabFileSelect(event)">
                    </div>
                </div>
            `;
        }

        // X축 설정
        function renderChartLabXAxis(dataSource) {
            const xField = dataSource.fields.find(f => f.id === chartLabState.xAxis.field);
            const isDatetime = xField && xField.type === 'datetime';

            return `
                <div class="chartlab-section" id="chartlab-xaxis-section">
                    <div class="chartlab-section-header" onclick="toggleChartLabSection('chartlab-xaxis-section')">
                        <div class="chartlab-section-title">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                <polyline points="12 5 19 12 12 19"></polyline>
                            </svg>
                            X-axis
                        </div>
                        <svg class="chartlab-section-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="chartlab-section-content">
                        ${chartLabState.xAxis.field ? `
                            <div class="chartlab-field-item">
                                <div class="chartlab-field-info">
                                    <div class="chartlab-field-name">${xField ? xField.name : chartLabState.xAxis.field}</div>
                                    <div class="chartlab-field-meta">Scale: ${isDatetime ? 'Date' : 'Linear'}</div>
                                </div>
                                <button class="chartlab-field-remove" onclick="removeChartLabXAxis()">✕</button>
                            </div>
                            ${isDatetime ? `
                                <select class="chartlab-field-dropdown" onchange="handleChartLabTimeUnitChange(this.value)">
                                    ${chartLabTimeUnits.map(unit => `
                                        <option value="${unit.id}" ${chartLabState.xAxis.timeUnit === unit.id ? 'selected' : ''}>${unit.name}</option>
                                    `).join('')}
                                </select>
                            ` : ''}
                        ` : `
                            <select class="chartlab-field-dropdown" onchange="handleChartLabXAxisChange(this.value)">
                                <option value="">필드 선택...</option>
                                ${dataSource.fields.map(field => `
                                    <option value="${field.id}">${field.name} (${field.type})</option>
                                `).join('')}
                            </select>
                        `}
                    </div>
                </div>
            `;
        }

        // Y축 설정
        function renderChartLabYAxis(dataSource) {
            return `
                <div class="chartlab-section" id="chartlab-yaxis-section">
                    <div class="chartlab-section-header" onclick="toggleChartLabSection('chartlab-yaxis-section')">
                        <div class="chartlab-section-title">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="19" x2="12" y2="5"></line>
                                <polyline points="5 12 12 5 19 12"></polyline>
                            </svg>
                            Y-axis
                        </div>
                        <svg class="chartlab-section-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="chartlab-section-content">
                        ${chartLabState.yAxis.map((yConfig, idx) => {
                            const yField = dataSource.fields.find(f => f.id === yConfig.field);
                            return yConfig.field ? `
                                <div class="chartlab-field-item">
                                    <div class="chartlab-field-info">
                                        <div class="chartlab-field-name">${yField ? yField.name : yConfig.field}</div>
                                        <div class="chartlab-field-meta">Aggregate: ${yConfig.aggregate}</div>
                                    </div>
                                    <button class="chartlab-field-remove" onclick="removeChartLabYAxis(${idx})">✕</button>
                                </div>
                                <select class="chartlab-field-dropdown" onchange="handleChartLabYAxisAggregateChange(${idx}, this.value)">
                                    ${chartLabAggregations.map(agg => `
                                        <option value="${agg.id}" ${yConfig.aggregate === agg.id ? 'selected' : ''}>${agg.name}</option>
                                    `).join('')}
                                </select>
                            ` : `
                                <select class="chartlab-field-dropdown" onchange="handleChartLabYAxisChange(${idx}, this.value)">
                                    <option value="">필드 선택...</option>
                                    ${dataSource.fields.filter(f => f.type === 'number').map(field => `
                                        <option value="${field.id}">${field.name}</option>
                                    `).join('')}
                                </select>
                            `;
                        }).join('')}
                        <button class="chartlab-add-field-btn" onclick="addChartLabYAxis()">
                            + Y-axis 추가
                        </button>
                    </div>
                </div>
            `;
        }

        // Color by 설정
        function renderChartLabColorBy(dataSource) {
            const colorField = dataSource.fields.find(f => f.id === chartLabState.colorBy.field);
            return `
                <div class="chartlab-section" id="chartlab-color-section">
                    <div class="chartlab-section-header" onclick="toggleChartLabSection('chartlab-color-section')">
                        <div class="chartlab-section-title">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="13.5" cy="6.5" r="2.5"></circle>
                                <circle cx="6.5" cy="17.5" r="2.5"></circle>
                                <circle cx="17.5" cy="17.5" r="2.5"></circle>
                            </svg>
                            Color by
                        </div>
                        <svg class="chartlab-section-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="chartlab-section-content">
                        ${chartLabState.colorBy.field ? `
                            <div class="chartlab-field-item">
                                <div class="chartlab-field-info">
                                    <div class="chartlab-field-name">${colorField ? colorField.name : chartLabState.colorBy.field}</div>
                                    <div class="chartlab-field-meta">Series</div>
                                </div>
                                <button class="chartlab-field-remove" onclick="removeChartLabColorBy()">✕</button>
                            </div>
                        ` : `
                            <select class="chartlab-field-dropdown" onchange="handleChartLabColorByChange(this.value)">
                                <option value="">필드 선택...</option>
                                ${dataSource.fields.filter(f => f.type === 'string').map(field => `
                                    <option value="${field.id}">${field.name}</option>
                                `).join('')}
                            </select>
                        `}
                    </div>
                </div>
            `;
        }

        // Faceting 설정
        function renderChartLabFaceting(dataSource) {
            const facetField = dataSource.fields.find(f => f.id === chartLabState.faceting.field);
            return `
                <div class="chartlab-section" id="chartlab-facet-section">
                    <div class="chartlab-section-header" onclick="toggleChartLabSection('chartlab-facet-section')">
                        <div class="chartlab-section-title">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                            </svg>
                            Faceting
                        </div>
                        <svg class="chartlab-section-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="chartlab-section-content">
                        ${chartLabState.faceting.field ? `
                            <div class="chartlab-field-item">
                                <div class="chartlab-field-info">
                                    <div class="chartlab-field-name">${facetField ? facetField.name : chartLabState.faceting.field}</div>
                                    <div class="chartlab-field-meta">분할 기준</div>
                                </div>
                                <button class="chartlab-field-remove" onclick="removeChartLabFaceting()">✕</button>
                            </div>
                        ` : `
                            <select class="chartlab-field-dropdown" onchange="handleChartLabFacetingChange(this.value)">
                                <option value="">필드 선택 (선택사항)...</option>
                                ${dataSource.fields.filter(f => f.type === 'string').map(field => `
                                    <option value="${field.id}">${field.name}</option>
                                `).join('')}
                            </select>
                        `}
                    </div>
                </div>
            `;
        }

        // Tooltips 설정
        function renderChartLabTooltips(dataSource) {
            return `
                <div class="chartlab-section" id="chartlab-tooltip-section">
                    <div class="chartlab-section-header" onclick="toggleChartLabSection('chartlab-tooltip-section')">
                        <div class="chartlab-section-title">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="9" y1="9" x2="15" y2="9"></line>
                                <line x1="9" y1="13" x2="15" y2="13"></line>
                            </svg>
                            Tooltips
                        </div>
                        <svg class="chartlab-section-toggle" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="chartlab-section-content">
                        <div class="chartlab-field-item">
                            <div class="chartlab-field-info">
                                <div class="chartlab-field-name">기본 정보</div>
                                <div class="chartlab-field-meta">X, Y, Color 값 표시</div>
                            </div>
                            <input type="checkbox" checked disabled style="accent-color: var(--claude-orange);">
                        </div>
                        <button class="chartlab-add-field-btn" onclick="addChartLabTooltipField()">
                            + 추가 필드
                        </button>
                    </div>
                </div>
            `;
        }

        // Style 탭 렌더링
        function renderChartLabStyleTab() {
            return `
                <div class="chartlab-style-section">
                    <div class="chartlab-style-label">차트 제목</div>
                    <input type="text" class="chartlab-style-input" id="chartlabTitle"
                        value="${chartLabState.style.title}"
                        placeholder="제목을 입력하세요..."
                        onchange="handleChartLabTitleChange(this.value)">
                </div>
                <div class="chartlab-style-section">
                    <div class="chartlab-style-label">색상 팔레트</div>
                    <div class="chartlab-color-palette">
                        ${chartLabState.style.colors.map((color, idx) => `
                            <div class="chartlab-color-swatch"
                                style="background: ${color}"
                                onclick="editChartLabColor(${idx})"
                                title="${color}">
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="chartlab-style-section">
                    <div class="chartlab-style-label">범례 위치</div>
                    <div class="chartlab-radio-group">
                        <label class="chartlab-radio-item">
                            <input type="radio" name="legendPosition" value="right"
                                ${chartLabState.style.legendPosition === 'right' ? 'checked' : ''}
                                onchange="handleChartLabLegendPositionChange(this.value)">
                            오른쪽
                        </label>
                        <label class="chartlab-radio-item">
                            <input type="radio" name="legendPosition" value="bottom"
                                ${chartLabState.style.legendPosition === 'bottom' ? 'checked' : ''}
                                onchange="handleChartLabLegendPositionChange(this.value)">
                            아래
                        </label>
                        <label class="chartlab-radio-item">
                            <input type="radio" name="legendPosition" value="top"
                                ${chartLabState.style.legendPosition === 'top' ? 'checked' : ''}
                                onchange="handleChartLabLegendPositionChange(this.value)">
                            위
                        </label>
                        <label class="chartlab-radio-item">
                            <input type="radio" name="legendPosition" value="none"
                                ${chartLabState.style.legendPosition === 'none' ? 'checked' : ''}
                                onchange="handleChartLabLegendPositionChange(this.value)">
                            숨김
                        </label>
                    </div>
                </div>
            `;
        }

        // 메인 차트 영역 렌더링
        function renderChartLabMain() {
            return `
                <div class="chartlab-main">
                    <div class="chartlab-chart-wrapper">
                        ${chartLabState.style.title ? `<div class="chartlab-chart-title">${chartLabState.style.title}</div>` : ''}
                        <div id="chartlab-chart"></div>
                    </div>
                </div>
            `;
        }

        // 이벤트 리스너 등록
        function attachChartLabEventListeners() {
            // 파일 드롭존 이벤트
            const dropzone = document.getElementById('chartlabDropzone');
            if (dropzone) {
                dropzone.addEventListener('click', () => {
                    document.getElementById('chartlabFileInput').click();
                });

                dropzone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropzone.classList.add('dragover');
                });

                dropzone.addEventListener('dragleave', () => {
                    dropzone.classList.remove('dragover');
                });

                dropzone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropzone.classList.remove('dragover');
                    const file = e.dataTransfer.files[0];
                    if (file) handleChartLabFileUpload(file);
                });
            }
        }

        // 탭 전환
        function switchChartLabTab(tab) {
            chartLabState.activeTab = tab;
            refreshChartLabSidebar();
        }

        // 섹션 토글
        function toggleChartLabSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.toggle('collapsed');
            }
        }

        // 사이드바 새로고침
        function refreshChartLabSidebar() {
            const sidebar = document.querySelector('.chartlab-sidebar');
            if (sidebar) {
                const dataSource = chartLabDataSources[chartLabState.dataSource];
                sidebar.innerHTML = `
                    ${renderChartLabTypeSelector()}
                    ${renderChartLabTabs()}
                    <div class="chartlab-tab-content">
                        ${chartLabState.activeTab === 'data' ? renderChartLabDataTab(dataSource) : renderChartLabStyleTab()}
                    </div>
                `;
                attachChartLabEventListeners();
            }
        }

        // 데이터소스 변경
        function handleChartLabDataSourceChange(sourceId) {
            chartLabState.dataSource = sourceId;
            // 필드 초기화
            const ds = chartLabDataSources[sourceId];
            if (ds.fields.length > 0) {
                const dateField = ds.fields.find(f => f.type === 'datetime');
                const numField = ds.fields.find(f => f.type === 'number');
                const strField = ds.fields.find(f => f.type === 'string');

                chartLabState.xAxis.field = dateField ? dateField.id : (ds.fields[0] ? ds.fields[0].id : null);
                chartLabState.yAxis = [{ field: numField ? numField.id : null, aggregate: 'sum' }];
                chartLabState.colorBy.field = strField ? strField.id : null;
            } else {
                chartLabState.xAxis.field = null;
                chartLabState.yAxis = [{ field: null, aggregate: 'sum' }];
                chartLabState.colorBy.field = null;
            }
            chartLabState.faceting.field = null;
            chartLabState.filters = [];

            refreshChartLabSidebar();
            updateChartLabChart();
        }

        // 차트 유형 변경
        function handleChartLabChartTypeChange(type) {
            chartLabState.chartType = type;
            updateChartLabChart();
        }

        // X축 변경
        function handleChartLabXAxisChange(fieldId) {
            chartLabState.xAxis.field = fieldId;
            const ds = chartLabDataSources[chartLabState.dataSource];
            const field = ds.fields.find(f => f.id === fieldId);
            chartLabState.xAxis.scaleType = field && field.type === 'datetime' ? 'datetime' : 'linear';
            refreshChartLabSidebar();
            updateChartLabChart();
        }

        // X축 제거
        function removeChartLabXAxis() {
            chartLabState.xAxis.field = null;
            refreshChartLabSidebar();
            updateChartLabChart();
        }

        // 시간 단위 변경
        function handleChartLabTimeUnitChange(unit) {
            chartLabState.xAxis.timeUnit = unit;
            updateChartLabChart();
        }

        // Y축 변경
        function handleChartLabYAxisChange(index, fieldId) {
            chartLabState.yAxis[index].field = fieldId;
            refreshChartLabSidebar();
            updateChartLabChart();
        }

        // Y축 집계 변경
        function handleChartLabYAxisAggregateChange(index, aggregate) {
            chartLabState.yAxis[index].aggregate = aggregate;
            updateChartLabChart();
        }

        // Y축 추가
        function addChartLabYAxis() {
            chartLabState.yAxis.push({ field: null, aggregate: 'sum' });
            refreshChartLabSidebar();
        }

        // Y축 제거
        function removeChartLabYAxis(index) {
            if (chartLabState.yAxis.length > 1) {
                chartLabState.yAxis.splice(index, 1);
                refreshChartLabSidebar();
                updateChartLabChart();
            }
        }

        // Color by 변경
        function handleChartLabColorByChange(fieldId) {
            chartLabState.colorBy.field = fieldId;
            refreshChartLabSidebar();
            updateChartLabChart();
        }

        // Color by 제거
        function removeChartLabColorBy() {
            chartLabState.colorBy.field = null;
            refreshChartLabSidebar();
            updateChartLabChart();
        }

        // Faceting 변경
        function handleChartLabFacetingChange(fieldId) {
            chartLabState.faceting.field = fieldId;
            refreshChartLabSidebar();
            updateChartLabChart();
        }

        // Faceting 제거
        function removeChartLabFaceting() {
            chartLabState.faceting.field = null;
            refreshChartLabSidebar();
            updateChartLabChart();
        }

        // 제목 변경
        function handleChartLabTitleChange(title) {
            chartLabState.style.title = title;
            const titleEl = document.querySelector('.chartlab-chart-title');
            if (titleEl) {
                titleEl.textContent = title;
            } else if (title) {
                const wrapper = document.querySelector('.chartlab-chart-wrapper');
                const chartEl = document.getElementById('chartlab-chart');
                if (wrapper && chartEl) {
                    const titleDiv = document.createElement('div');
                    titleDiv.className = 'chartlab-chart-title';
                    titleDiv.textContent = title;
                    wrapper.insertBefore(titleDiv, chartEl);
                }
            }
        }

        // 범례 위치 변경
        function handleChartLabLegendPositionChange(position) {
            chartLabState.style.legendPosition = position;
            updateChartLabChart();
        }

        // 색상 편집
        function editChartLabColor(index) {
            const newColor = prompt('새 색상 (HEX 형식):', chartLabState.style.colors[index]);
            if (newColor && /^#[0-9A-Fa-f]{6}$/.test(newColor)) {
                chartLabState.style.colors[index] = newColor;
                refreshChartLabSidebar();
                updateChartLabChart();
            }
        }

        // 필터 모달 표시
        function showChartLabFilterModal() {
            const ds = chartLabDataSources[chartLabState.dataSource];
            const modalHtml = `
                <div class="chartlab-filter-modal" onclick="if(event.target===this)closeChartLabFilterModal()">
                    <div class="chartlab-filter-modal-content">
                        <div class="chartlab-filter-modal-header">
                            <div class="chartlab-filter-modal-title">필터 추가</div>
                            <button class="chartlab-filter-modal-close" onclick="closeChartLabFilterModal()">✕</button>
                        </div>
                        <div class="chartlab-filter-modal-body">
                            <div class="chartlab-filter-row">
                                <select class="chartlab-filter-select" id="filterField">
                                    <option value="">필드 선택...</option>
                                    ${ds.fields.map(f => `<option value="${f.id}">${f.name}</option>`).join('')}
                                </select>
                            </div>
                            <div class="chartlab-filter-row">
                                <select class="chartlab-filter-select" id="filterOperator">
                                    <option value="=">=</option>
                                    <option value="!=">!=</option>
                                    <option value=">">&gt;</option>
                                    <option value="<">&lt;</option>
                                    <option value=">=">>=</option>
                                    <option value="<="><=</option>
                                    <option value="contains">포함</option>
                                </select>
                            </div>
                            <div class="chartlab-filter-row">
                                <input type="text" class="chartlab-style-input" id="filterValue" placeholder="값 입력...">
                            </div>
                        </div>
                        <div class="chartlab-filter-modal-footer">
                            <button class="chartlab-btn chartlab-btn-secondary" onclick="closeChartLabFilterModal()">취소</button>
                            <button class="chartlab-btn chartlab-btn-primary" onclick="applyChartLabFilter()">적용</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // 필터 모달 닫기
        function closeChartLabFilterModal() {
            const modal = document.querySelector('.chartlab-filter-modal');
            if (modal) modal.remove();
        }

        // 필터 적용
        function applyChartLabFilter() {
            const field = document.getElementById('filterField').value;
            const operator = document.getElementById('filterOperator').value;
            const value = document.getElementById('filterValue').value;

            if (field && value) {
                chartLabState.filters.push({ field, operator, value });
                closeChartLabFilterModal();
                refreshChartLabHeader();
                updateChartLabChart();
            }
        }

        // 헤더 새로고침
        function refreshChartLabHeader() {
            const header = document.querySelector('.chartlab-header');
            if (header) {
                header.outerHTML = renderChartLabHeader();
            }
        }

        // 필터 제거
        function removeChartLabFilter(index) {
            chartLabState.filters.splice(index, 1);
            refreshChartLabHeader();
            updateChartLabChart();
        }

        // 툴팁 필드 추가
        function addChartLabTooltipField() {
            showChartLabToast('툴팁 커스터마이징 기능은 추후 업데이트 예정입니다.', 'info');
        }

        // 토스트 알림
        function showChartLabToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `chartlab-toast chartlab-toast-${type}`;
            toast.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${type === 'success' ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>' :
                    '<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>'}
                </svg>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // 파일 선택 핸들러
        function handleChartLabFileSelect(event) {
            const file = event.target.files[0];
            if (file) handleChartLabFileUpload(file);
        }

        // 파일 업로드 처리
        function handleChartLabFileUpload(file) {
            const reader = new FileReader();

            reader.onload = function(e) {
                const content = e.target.result;
                let data, fields;

                try {
                    if (file.name.endsWith('.csv')) {
                        const result = parseChartLabCSV(content);
                        data = result.data;
                        fields = result.fields;
                    } else if (file.name.endsWith('.json')) {
                        const result = parseChartLabJSON(content);
                        data = result.data;
                        fields = result.fields;
                    } else {
                        showChartLabToast('지원하지 않는 파일 형식입니다.', 'error');
                        return;
                    }

                    chartLabDataSources.custom = {
                        name: file.name,
                        fields: fields,
                        data: data
                    };

                    chartLabState.dataSource = 'custom';

                    // 필드 자동 설정
                    const dateField = fields.find(f => f.type === 'datetime');
                    const numField = fields.find(f => f.type === 'number');
                    const strField = fields.find(f => f.type === 'string');

                    chartLabState.xAxis.field = dateField ? dateField.id : (fields[0] ? fields[0].id : null);
                    chartLabState.yAxis = [{ field: numField ? numField.id : null, aggregate: 'sum' }];
                    chartLabState.colorBy.field = strField ? strField.id : null;
                    chartLabState.faceting.field = null;
                    chartLabState.filters = [];

                    // UI 업데이트
                    refreshChartLabHeader();
                    refreshChartLabSidebar();
                    updateChartLabChart();

                    showChartLabToast(`${file.name} 파일이 업로드되었습니다.`, 'success');
                } catch (err) {
                    showChartLabToast('파일 파싱 중 오류가 발생했습니다: ' + err.message, 'error');
                }
            };

            reader.readAsText(file);
        }

        // CSV 파싱
        function parseChartLabCSV(content) {
            const lines = content.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/^["']|["']$/g, ''));

            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/^["']|["']$/g, ''));
                const row = {};
                headers.forEach((header, idx) => {
                    row[header] = values[idx] || '';
                });
                data.push(row);
            }

            // 필드 타입 추론
            const fields = headers.map(header => {
                const sampleValues = data.slice(0, 10).map(row => row[header]).filter(v => v);
                let type = 'string';

                if (sampleValues.every(v => !isNaN(parseFloat(v)))) {
                    type = 'number';
                } else if (sampleValues.every(v => !isNaN(Date.parse(v)))) {
                    type = 'datetime';
                }

                return { id: header, name: header, type };
            });

            // 숫자 변환
            data.forEach(row => {
                fields.forEach(field => {
                    if (field.type === 'number') {
                        row[field.id] = parseFloat(row[field.id]) || 0;
                    }
                });
            });

            return { data, fields };
        }

        // JSON 파싱
        function parseChartLabJSON(content) {
            const json = JSON.parse(content);
            const data = Array.isArray(json) ? json : (json.data || []);

            if (data.length === 0) {
                return { data: [], fields: [] };
            }

            // 필드 추론
            const sampleRow = data[0];
            const fields = Object.keys(sampleRow).map(key => {
                const sampleValues = data.slice(0, 10).map(row => row[key]).filter(v => v !== null && v !== undefined);
                let type = 'string';

                if (sampleValues.every(v => typeof v === 'number')) {
                    type = 'number';
                } else if (sampleValues.every(v => !isNaN(Date.parse(v)))) {
                    type = 'datetime';
                }

                return { id: key, name: key, type };
            });

            return { data, fields };
        }

        // 데이터 처리
        function processChartLabData(data, state) {
            const ds = chartLabDataSources[state.dataSource];
            let processedData = [...data];

            // 필터 적용
            if (state.filters.length > 0) {
                processedData = processedData.filter(row => {
                    return state.filters.every(filter => {
                        const value = row[filter.field];
                        const filterVal = filter.value;

                        switch (filter.operator) {
                            case '=': return String(value) === filterVal;
                            case '!=': return String(value) !== filterVal;
                            case '>': return parseFloat(value) > parseFloat(filterVal);
                            case '<': return parseFloat(value) < parseFloat(filterVal);
                            case '>=': return parseFloat(value) >= parseFloat(filterVal);
                            case '<=': return parseFloat(value) <= parseFloat(filterVal);
                            case 'contains': return String(value).toLowerCase().includes(filterVal.toLowerCase());
                            default: return true;
                        }
                    });
                });
            }

            // X축 필드가 없으면 빈 배열 반환
            if (!state.xAxis.field) return { series: [], categories: [] };

            // X축 그룹화 키 생성 함수
            const getXKey = (row) => {
                const val = row[state.xAxis.field];
                if (state.xAxis.scaleType === 'datetime') {
                    const date = new Date(val);
                    switch (state.xAxis.timeUnit) {
                        case 'year': return date.getFullYear().toString();
                        case 'quarter': return `${date.getFullYear()}-Q${Math.floor(date.getMonth() / 3) + 1}`;
                        case 'month': return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                        case 'week': return `${date.getFullYear()}-W${getWeekNumber(date)}`;
                        case 'day': return date.toISOString().split('T')[0];
                        default: return date.getFullYear().toString();
                    }
                }
                return String(val);
            };

            // Color by가 있으면 시리즈 분리
            if (state.colorBy.field) {
                const seriesMap = {};
                const categories = new Set();

                processedData.forEach(row => {
                    const xKey = getXKey(row);
                    const seriesKey = row[state.colorBy.field];
                    categories.add(xKey);

                    if (!seriesMap[seriesKey]) {
                        seriesMap[seriesKey] = {};
                    }
                    if (!seriesMap[seriesKey][xKey]) {
                        seriesMap[seriesKey][xKey] = [];
                    }
                    seriesMap[seriesKey][xKey].push(row);
                });

                const sortedCategories = Array.from(categories).sort();
                const yConfig = state.yAxis[0] || { field: null, aggregate: 'sum' };

                const series = Object.entries(seriesMap).map(([name, xData]) => ({
                    name,
                    data: sortedCategories.map(cat => {
                        const rows = xData[cat] || [];
                        return aggregateValue(rows, yConfig.field, yConfig.aggregate);
                    })
                }));

                return { series, categories: sortedCategories };
            } else {
                // 단일 시리즈
                const grouped = {};
                processedData.forEach(row => {
                    const xKey = getXKey(row);
                    if (!grouped[xKey]) grouped[xKey] = [];
                    grouped[xKey].push(row);
                });

                const categories = Object.keys(grouped).sort();
                const yConfig = state.yAxis[0] || { field: null, aggregate: 'sum' };

                const series = [{
                    name: yConfig.field || 'Value',
                    data: categories.map(cat => aggregateValue(grouped[cat], yConfig.field, yConfig.aggregate))
                }];

                return { series, categories };
            }
        }

        // 주차 계산
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // 집계 계산
        function aggregateValue(rows, field, aggregate) {
            if (!field || rows.length === 0) return 0;

            const values = rows.map(r => parseFloat(r[field]) || 0);

            switch (aggregate) {
                case 'sum': return values.reduce((a, b) => a + b, 0);
                case 'avg': return values.reduce((a, b) => a + b, 0) / values.length;
                case 'min': return Math.min(...values);
                case 'max': return Math.max(...values);
                case 'count': return rows.length;
                default: return values.reduce((a, b) => a + b, 0);
            }
        }

        // Highcharts 옵션 생성 (Livedocs 스타일 차트 유형 지원)
        function buildHighchartsOptions(state, processedData) {
            const chartType = state.chartType;

            // Livedocs 스타일 차트 유형 매핑
            let highchartsType = 'column';
            let isStacked = false;
            let isPercent = false;

            // 차트 유형 파싱
            if (chartType === 'grouped-column' || chartType === 'column') {
                highchartsType = 'column';
            } else if (chartType === 'stacked-column') {
                highchartsType = 'column';
                isStacked = true;
            } else if (chartType === '100-stacked-column') {
                highchartsType = 'column';
                isStacked = true;
                isPercent = true;
            } else if (chartType === 'grouped-bar' || chartType === 'bar') {
                highchartsType = 'bar';
            } else if (chartType === 'stacked-bar') {
                highchartsType = 'bar';
                isStacked = true;
            } else if (chartType === '100-stacked-bar') {
                highchartsType = 'bar';
                isStacked = true;
                isPercent = true;
            } else if (chartType === 'line') {
                highchartsType = 'line';
            } else if (chartType === 'stacked-area' || chartType === 'area') {
                highchartsType = 'area';
                isStacked = chartType.includes('stacked');
            } else if (chartType === '100-stacked-area') {
                highchartsType = 'area';
                isStacked = true;
                isPercent = true;
            } else if (chartType === 'histogram') {
                highchartsType = 'column';
            } else if (chartType === 'scatter') {
                highchartsType = 'scatter';
            } else if (chartType === 'pie') {
                highchartsType = 'pie';
            }

            const legendAlign = state.style.legendPosition === 'right' ? 'right' :
                               state.style.legendPosition === 'bottom' ? 'center' : 'center';
            const legendVerticalAlign = state.style.legendPosition === 'right' ? 'middle' :
                                        state.style.legendPosition === 'bottom' ? 'bottom' : 'top';
            const legendLayout = state.style.legendPosition === 'right' ? 'vertical' : 'horizontal';

            const fontSize = state.style.fontSize || 10;

            const options = {
                chart: {
                    type: highchartsType,
                    backgroundColor: 'transparent',
                    style: {
                        fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        fontSize: fontSize + 'px'
                    }
                },
                title: { text: null },
                colors: state.style.colors,
                xAxis: {
                    categories: processedData.categories,
                    labels: {
                        style: { color: '#888', fontSize: fontSize + 'px' }
                    },
                    lineColor: '#444',
                    tickColor: '#444'
                },
                yAxis: {
                    title: { text: null },
                    labels: {
                        style: { color: '#888', fontSize: fontSize + 'px' },
                        format: isPercent ? '{value}%' : '{value}'
                    },
                    gridLineColor: '#333',
                    max: isPercent ? 100 : undefined
                },
                legend: {
                    enabled: state.style.legendPosition !== 'none',
                    align: legendAlign,
                    verticalAlign: legendVerticalAlign,
                    layout: legendLayout,
                    itemStyle: { color: '#ccc', fontSize: fontSize + 'px' },
                    itemHoverStyle: { color: '#fff' }
                },
                tooltip: {
                    enabled: state.style.showTooltip !== false,
                    backgroundColor: '#1a1a1a',
                    borderColor: '#333',
                    style: { color: '#fff', fontSize: fontSize + 'px' },
                    shared: true,
                    pointFormat: isPercent ?
                        '<span style="color:{point.color}">\u25CF</span> {series.name}: <b>{point.percentage:.1f}%</b><br/>' :
                        '<span style="color:{point.color}">\u25CF</span> {series.name}: <b>{point.y}</b><br/>'
                },
                plotOptions: {
                    series: {
                        stacking: isStacked ? (isPercent ? 'percent' : 'normal') : undefined
                    },
                    column: {
                        borderRadius: 1,
                        borderWidth: 0
                    },
                    bar: {
                        borderRadius: 1,
                        borderWidth: 0
                    },
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            color: '#ccc',
                            format: '<b>{point.name}</b>: {point.percentage:.1f}%',
                            style: { fontSize: fontSize + 'px' }
                        }
                    }
                },
                series: processedData.series,
                credits: { enabled: false }
            };

            // 파이 차트 특수 처리
            if (highchartsType === 'pie') {
                const pieData = processedData.categories.map((cat, i) => ({
                    name: cat,
                    y: processedData.series[0] ? processedData.series[0].data[i] : 0
                }));
                options.series = [{ name: 'Data', data: pieData }];
            }

            return options;
        }

        // 차트 업데이트
        function updateChartLabChart() {
            const chartEl = document.getElementById('chartlab-chart');
            if (!chartEl) return;

            const ds = chartLabDataSources[chartLabState.dataSource];

            // 데이터가 없으면 빈 상태 표시
            if (!ds.data || ds.data.length === 0 || !chartLabState.xAxis.field) {
                chartEl.innerHTML = `
                    <div class="chartlab-empty-state">
                        <svg class="chartlab-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        <div class="chartlab-empty-text">차트를 생성하려면 데이터와 축을 설정하세요</div>
                        <div class="chartlab-empty-hint">좌측 패널에서 X축, Y축 필드를 선택하세요</div>
                    </div>
                `;
                return;
            }

            // Faceting 처리
            if (chartLabState.faceting.field) {
                renderFacetedCharts(ds);
            } else {
                const processedData = processChartLabData(ds.data, chartLabState);
                const options = buildHighchartsOptions(chartLabState, processedData);
                Highcharts.chart('chartlab-chart', options);
            }
        }

        // Faceted 차트 렌더링
        function renderFacetedCharts(ds) {
            const facetField = chartLabState.faceting.field;
            const facetValues = [...new Set(ds.data.map(row => row[facetField]))];

            const chartEl = document.getElementById('chartlab-chart');
            chartEl.innerHTML = `
                <div class="chartlab-facet-grid">
                    ${facetValues.map((val, idx) => `
                        <div class="chartlab-facet-chart">
                            <div class="chartlab-facet-title">${val}</div>
                            <div id="chartlab-facet-${idx}" style="height: 200px;"></div>
                        </div>
                    `).join('')}
                </div>
            `;

            // 각 facet에 대해 차트 렌더링
            facetValues.forEach((val, idx) => {
                const filteredData = ds.data.filter(row => row[facetField] === val);
                const tempState = { ...chartLabState, faceting: { field: null } };
                const processedData = processChartLabData(filteredData, tempState);
                const options = buildHighchartsOptions(tempState, processedData);
                options.chart.height = 200;
                Highcharts.chart(`chartlab-facet-${idx}`, options);
            });
        }

        // 설정 저장 (모든 차트)
        function saveChartLabConfig() {
            const configToSave = {
                charts: chartLabCharts,
                nextId: chartLabNextId,
                activeChartId: chartLabActiveChartId
            };
            localStorage.setItem('chartlab_config_v2', JSON.stringify(configToSave));
            showChartLabToast('모든 차트가 저장되었습니다.', 'success');
        }

        // 설정 불러오기 (모든 차트)
        function loadChartLabConfig() {
            // 새 버전 설정 먼저 시도
            const savedV2 = localStorage.getItem('chartlab_config_v2');
            if (savedV2) {
                try {
                    const config = JSON.parse(savedV2);
                    if (config.charts && config.charts.length > 0) {
                        chartLabCharts = config.charts;
                        chartLabNextId = config.nextId || (Math.max(...config.charts.map(c => c.id)) + 1);
                        chartLabActiveChartId = config.activeChartId || config.charts[0].id;
                        // chartLabState도 첫 번째 차트로 업데이트 (하위 호환성)
                        Object.assign(chartLabState, chartLabCharts[0]);
                    }
                    return;
                } catch (e) {
                    console.error('Failed to load chartlab config v2:', e);
                }
            }

            // 이전 버전 설정 불러오기 (하위 호환성)
            const saved = localStorage.getItem('chartlab_config');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    Object.assign(chartLabState, config);
                    chartLabCharts[0] = chartLabState;
                } catch (e) {
                    console.error('Failed to load chartlab config:', e);
                }
            }
        }

        // 이미지 내보내기
        function exportChartLabAsImage() {
            const charts = Highcharts.charts.filter(c => c && c.renderTo && c.renderTo.id && c.renderTo.id.startsWith('chartlab'));
            if (charts.length > 0) {
                charts[0].exportChart({ type: 'image/png' });
            } else {
                showChartLabToast('내보낼 차트가 없습니다.', 'error');
            }
        }

        // 페이지 로드시 설정 불러오기
        loadChartLabConfig();

        // 초기화
        initChart();
        initResizers();
        initChartSearch();
        initPeriodSelector();

        // ========== 형광펜 드로잉 기능 ==========

        // 드로잉 데이터 저장소 (localStorage)
        let drawingData = {};
        let isDrawing = false;
        let currentColor = 'yellow';
        let currentMode = 'draw';  // 'draw' | 'eraser'
        let lastX = 0;
        let lastY = 0;
        let drawingHistory = [];  // Undo를 위한 히스토리
        const MAX_HISTORY = 50;   // 최대 히스토리 수
        window.currentFeedDetail = null;

        const colorMap = {
            yellow: 'rgba(255, 235, 59, 0.25)',
            green: 'rgba(129, 199, 132, 0.25)',
            blue: 'rgba(100, 181, 246, 0.25)',
            orange: 'rgba(255, 152, 0, 0.25)'
        };

        // 드로잉 데이터 로드
        function loadDrawingData() {
            try {
                const saved = localStorage.getItem('feedDrawings');
                if (saved) {
                    drawingData = JSON.parse(saved);
                }
            } catch (e) {
                console.error('드로잉 데이터 로드 실패:', e);
                drawingData = {};
            }
        }

        // 드로잉 데이터 저장
        function saveDrawingData() {
            try {
                localStorage.setItem('feedDrawings', JSON.stringify(drawingData));
            } catch (e) {
                console.error('드로잉 데이터 저장 실패:', e);
            }
        }

        // Canvas 초기화
        function initDrawingCanvas() {
            const canvas = document.getElementById('highlightCanvas');
            if (!canvas) return;

            const wrapper = canvas.parentElement;

            // Canvas 크기를 wrapper에 맞춤
            canvas.width = wrapper.offsetWidth;
            canvas.height = wrapper.offsetHeight;

            const ctx = canvas.getContext('2d');
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineWidth = 20;

            // 이벤트 리스너
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseleave', stopDrawing);

            // 터치 이벤트 지원
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', stopDrawing);

            // Canvas 활성화
            canvas.classList.add('active');

            // 윈도우 리사이즈 시 Canvas 크기 조정
            window.addEventListener('resize', resizeCanvas);

            // Ctrl+Z 단축키 지원
            document.addEventListener('keydown', handleDrawingKeydown);

            // 히스토리 초기화
            drawingHistory = [];
            updateUndoButton();
        }

        // 키보드 이벤트 핸들러
        function handleDrawingKeydown(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'z') {
                const canvas = document.getElementById('highlightCanvas');
                if (canvas && window.currentFeedDetail) {
                    e.preventDefault();
                    undoDrawing();
                }
            }
        }

        // Undo 버튼 상태 업데이트
        function updateUndoButton() {
            const undoBtn = document.getElementById('undoBtn');
            if (undoBtn) {
                undoBtn.disabled = drawingHistory.length === 0;
            }
        }

        // Canvas 리사이즈
        function resizeCanvas() {
            const canvas = document.getElementById('highlightCanvas');
            if (!canvas || !window.currentFeedDetail) return;

            const wrapper = canvas.parentElement;
            const { categoryId, title } = window.currentFeedDetail;
            const key = `${categoryId}::${title}`;
            const dataURL = drawingData[key];

            // 현재 그림 저장
            const tempDataURL = canvas.toDataURL();

            // Canvas 크기 조정
            canvas.width = wrapper.offsetWidth;
            canvas.height = wrapper.offsetHeight;

            // 저장된 그림 복원
            if (dataURL) {
                const ctx = canvas.getContext('2d');
                const img = new Image();
                img.onload = () => {
                    ctx.drawImage(img, 0, 0);
                };
                img.src = dataURL;
            }
        }

        // 히스토리에 현재 상태 저장
        function saveToHistory() {
            const canvas = document.getElementById('highlightCanvas');
            if (!canvas) return;

            // 히스토리에 현재 상태 저장
            drawingHistory.push(canvas.toDataURL());

            // 최대 히스토리 수 제한
            if (drawingHistory.length > MAX_HISTORY) {
                drawingHistory.shift();
            }

            updateUndoButton();
        }

        // 드로잉 시작
        function startDrawing(e) {
            // 드로잉 시작 전 현재 상태를 히스토리에 저장
            saveToHistory();

            isDrawing = true;
            const canvas = document.getElementById('highlightCanvas');
            const rect = canvas.getBoundingClientRect();

            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;

            const ctx = canvas.getContext('2d');
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
        }

        // 터치 시작 핸들러
        function handleTouchStart(e) {
            e.preventDefault();

            // 드로잉 시작 전 현재 상태를 히스토리에 저장
            saveToHistory();

            const touch = e.touches[0];
            const canvas = document.getElementById('highlightCanvas');
            const rect = canvas.getBoundingClientRect();

            isDrawing = true;
            lastX = touch.clientX - rect.left;
            lastY = touch.clientY - rect.top;

            const ctx = canvas.getContext('2d');
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
        }

        // 드로잉 (마우스 이동)
        function draw(e) {
            if (!isDrawing) return;

            const canvas = document.getElementById('highlightCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();

            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (currentMode === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 30;
            } else {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = colorMap[currentColor];
                ctx.lineWidth = 20;
            }

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);

            lastX = x;
            lastY = y;
        }

        // 터치 이동 핸들러
        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing) return;

            const touch = e.touches[0];
            const canvas = document.getElementById('highlightCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();

            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            if (currentMode === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 30;
            } else {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = colorMap[currentColor];
                ctx.lineWidth = 20;
            }

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);

            lastX = x;
            lastY = y;
        }

        // 드로잉 종료
        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                saveDrawing();
            }
        }

        // 색상 설정
        function setDrawingColor(color) {
            currentColor = color;
            currentMode = 'draw';

            // 버튼 활성화 상태 업데이트
            document.querySelectorAll('.drawing-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.drawing-btn.${color}`)?.classList.add('active');
        }

        // 모드 설정 (지우개)
        function setDrawingMode(mode) {
            currentMode = mode;

            // 버튼 활성화 상태 업데이트
            document.querySelectorAll('.drawing-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.drawing-btn.eraser')?.classList.add('active');
        }

        // 뒤로가기 (Undo)
        function undoDrawing() {
            if (drawingHistory.length === 0) return;

            const canvas = document.getElementById('highlightCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // 히스토리에서 이전 상태 가져오기
            const previousState = drawingHistory.pop();

            // Canvas 초기화
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 이전 상태 복원
            const img = new Image();
            img.onload = () => {
                ctx.drawImage(img, 0, 0);
                // 복원 후 저장
                saveDrawing();
            };
            img.src = previousState;

            updateUndoButton();
        }

        // 전체 지우기
        function clearDrawing() {
            const canvas = document.getElementById('highlightCanvas');
            if (!canvas) return;

            // 지우기 전 현재 상태를 히스토리에 저장
            saveToHistory();

            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 저장된 데이터도 삭제
            if (window.currentFeedDetail) {
                const { categoryId, title } = window.currentFeedDetail;
                const key = `${categoryId}::${title}`;
                delete drawingData[key];
                saveDrawingData();
            }
        }

        // 드로잉 저장
        function saveDrawing() {
            if (!window.currentFeedDetail) return;

            const { categoryId, title } = window.currentFeedDetail;
            const key = `${categoryId}::${title}`;
            const canvas = document.getElementById('highlightCanvas');

            if (!canvas) return;

            // Canvas를 dataURL로 저장
            drawingData[key] = canvas.toDataURL();
            saveDrawingData();
        }

        // 저장된 드로잉 복원
        function restoreDrawing(categoryId, title) {
            // 히스토리 초기화 (새 피드 항목이므로)
            drawingHistory = [];
            updateUndoButton();

            const key = `${categoryId}::${title}`;
            const dataURL = drawingData[key];

            if (!dataURL) return;

            const canvas = document.getElementById('highlightCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = () => {
                ctx.drawImage(img, 0, 0);
            };
            img.src = dataURL;
        }
    </script>
</body>
</html>
